"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[604],{2107:($,Z,v)=>{v.d(Z,{G:()=>g});var S=v(4523),e=v(4438),E=v(7785),O=v(8936),D=v(525),i=v(6255),m=v(3437),a=v(710),u=v(1152),n=v(3312),c=v(875),o=v(4764),p=v(6078),I=v(162),l=v(1389),C=v(3909);let g=(()=>{class M{constructor(){this.elementsService=(0,e.WQX)(i.L),this.canvasService=(0,e.WQX)(D.W),this.selectionService=(0,e.WQX)(u.A),this.toolsService=(0,e.WQX)(n.H),this.ioService=(0,e.WQX)(l.q),this.historyService=(0,e.WQX)(c.k),this.zoomService=(0,e.WQX)(o.T),this.panService=(0,e.WQX)(a.l),this.layerService=(0,e.WQX)(m.a),this.configService=(0,e.WQX)(E.w),this.clipboardService=(0,e.WQX)(C.W),this.eventBusService=(0,e.WQX)(O.W),this.elements=this.elementsService.elements,this.draftElements=this.elementsService.draftElements,this.allElements=this.elementsService.allElements,this.selectedElements=this.selectionService.getSelectedElementsSignal(),this.config=(0,e.EWP)(()=>this.configService.getConfig()),this.elementsCount=this.elementsService.elementsCount,this.hasElements=this.elementsService.hasElements,this.selectedTool=this.toolsService.selectedTool,this.availableTools=this.toolsService.availableTools,this.layers=this.layerService.layers,this.activeLayerId=this.layerService.activeLayerId,this.activeLayer=this.layerService.activeLayer}setElements(h){this.elementsService.setElements(h)}getElements(){return this.elementsService.getElements()}addElements(h){this.elementsService.addElements(h)}updateElements(h){const w=h.map(W=>({...W,id:W.id}));this.elementsService.updateElements(w)}removeElements(h){this.elementsService.removeElements(h)}clear(){this.elementsService.clear()}clearAll(){this.elementsService.clear(),this.selectionService.clearSelection()}addElement(h){this.addElements([h])}updateElement(h){this.updateElements([h])}removeElementsByIds(h){this.elementsService.removeElementsByIds(h)}getElementById(h){return this.elementsService.getElementById(h)}getElementsByIds(h){return this.elementsService.getElementsByIds(h)}getNextZIndex(){return this.elementsService.getNextZIndex()}getAllElements(){return this.elementsService.getElements()}getDraftElements(){return this.elementsService.getDraftElements()}addDraftElements(h){this.elementsService.addDraftElements(h)}updateDraftElements(h){this.elementsService.updateDraftElements(h)}removeDraftElements(h){this.elementsService.removeDraftElements(h)}commitDraftElements(){this.elementsService.commitDraftElements()}elementExists(h){return this.elementsService.elementExists(h)}selectElements(h,w=!1){this.selectionService.selectElements(h,w)}deselectElement(h){this.selectionService.deselectElement(h)}toggleSelection(h){this.selectionService.toggleSelection(h)}clearSelection(){this.selectionService.clearSelection()}selectAll(){this.selectionService.selectAll()}getSelectedElements(){return this.selectionService.getSelectedElements()}updateSelectedElements(h){this.selectionService.updateSelectedElements(h)}removeSelectedElements(){this.selectionService.removeSelectedElements()}isSelected(h){return this.selectionService.isSelected(h)}clearSelectionBox(){this.selectionService.clearSelectionBox()}transformSelectedElements(h){this.selectionService.transformSelectedElements(h)}setSelectionBox(h){this.selectionService.setSelectionBox(h)}updateBoundingBox(){this.selectionService.updateBoundingBox()}getBoundingBox(){return this.selectionService.getBoundingBox()}setBoundingBox(h){this.selectionService.setBoundingBox(h)}getClipboardInfo(){return this.clipboardService.getClipboardInfo()}copyElements(){this.selectionService.copyElements()}cutElements(){this.selectionService.cutElements()}pasteElements(){this.selectionService.pasteElements()}duplicateElements(){this.selectionService.duplicateElements()}deleteSelectedElements(){this.selectionService.deleteSelectedElements()}bringToFront(){this.selectionService.bringToFront()}bringForward(){this.selectionService.bringForward()}sendBackward(){this.selectionService.sendBackward()}sendToBack(){this.selectionService.sendToBack()}groupSelectedElements(){this.selectionService.groupSelectedElements()}ungroupSelectedElements(){this.selectionService.ungroupSelectedElements()}lockElements(){this.selectionService.lockElements()}unlockElements(){this.selectionService.unlockElements()}alignElements(h){this.selectionService.alignElements(h)}distributeHorizontally(){this.selectionService.distributeHorizontally()}distributeVertically(){this.selectionService.distributeVertically()}flipHorizontal(){this.selectionService.flipHorizontal()}flipVertical(){this.selectionService.flipVertical()}moveSelectedElements(h,w){this.selectionService.moveSelectedElements(h,w)}rotateSelectedElements(h){this.selectionService.rotateSelectedElements(h)}scaleSelectedElements(h){this.selectionService.scaleSelectedElements(h)}initializeWhiteboard(h){this.canvasService.initializeCanvas(h),this.toolsService.setApiService(this)}getCanvas(){return this.canvasService.getCanvas()}setCanvasDimensions(h,w){this.canvasService.setCanvasDimensions(h,w)}centerCanvas(){this.canvasService.centerCanvas()}fullScreen(){this.canvasService.fullScreen()}exitFullScreen(h,w){this.canvasService.exitFullScreen(h,w)}resetCanvas(){this.canvasService.resetCanvas()}setZoom(h){this.zoomService.zoom(h)}zoomIn(){this.zoomService.zoomIn()}zoomOut(){this.zoomService.zoomOut()}resetZoom(){this.zoomService.resetZoom()}zoomToFit(){this.zoomService.zoomToFit()}zoomToSelection(){this.zoomService.zoomToSelection()}pan(h,w){this.panService.pan(h,w)}panTo(h,w){this.panService.panTo(h,w)}resetPan(){this.panService.resetPan()}save(h=p.o8.Base64,w="whiteboard"){var W=this;return(0,S.A)(function*(){return W.ioService.save(h,w)})()}addImage(h){this.ioService.addImage(h)}importImageFile(h,w,W){var z=this;return(0,S.A)(function*(){return z.ioService.importImageFile(h,w,W)})()}exportData(){return this.ioService.exportData()}importData(h){this.ioService.importData(h)}exportAsPNG(h="whiteboard"){var w=this;return(0,S.A)(function*(){return w.ioService.exportAsPng(h)})()}exportAsSVG(h="whiteboard"){var w=this;return(0,S.A)(function*(){return w.ioService.exportAsSvg(h)})()}exportAsJSON(h="whiteboard"){const w=this.ioService.exportData(),W=new Blob([w],{type:"application/json"}),z=URL.createObjectURL(W),P=document.createElement("a");P.href=z,P.download=`${h}.json`,P.click(),URL.revokeObjectURL(z)}undo(){const h=this.historyService.undo();return!!h&&(this.elementsService.setElements(h),this.selectionService.clearSelection(),this.eventBusService.emit(I.w.Undo,void 0),!0)}redo(){const h=this.historyService.redo();return!!h&&(this.elementsService.setElements(h),this.selectionService.clearSelection(),this.eventBusService.emit(I.w.Redo,void 0),!0)}getCanUndoSignal(){return this.historyService.getCanUndoSignal()}getCanRedoSignal(){return this.historyService.getCanRedoSignal()}clearHistory(){this.historyService.clearHistory()}recordElementCreation(h,w){this.historyService.recordElementCreation(h,w)}recordElementUpdate(h,w){this.historyService.recordElementUpdate(h,w)}recordElementDeletion(h,w){this.historyService.recordElementDeletion(h,w)}recordClear(h,w){this.historyService.recordClear(h,w)}recordChange(h,w,W){this.historyService.recordChange(h,w,W)}getConfig(){return this.configService.getConfig()}updateConfig(h){this.configService.updateConfig(h)}updateConfigValue(h,w){this.configService.updateConfigValue(h,w)}addLayer(h){return this.layerService.addLayer(h)}removeLayer(h){return this.layerService.removeLayer(h)}setActiveLayer(h){return this.layerService.setActiveLayer(h)}getActiveLayerId(){return this.layerService.getActiveLayerId()}toggleLayerVisibility(h){return this.layerService.toggleLayerVisibility(h)}toggleLayerLock(h){return this.layerService.toggleLayerLock(h)}renameLayer(h,w){return this.layerService.renameLayer(h,w)}setLayerOpacity(h,w){return this.layerService.setLayerOpacity(h,w)}setLayerBlendMode(h,w){return this.layerService.setLayerBlendMode(h,w)}moveLayerUp(h){return this.layerService.moveLayerUp(h)}moveLayerDown(h){return this.layerService.moveLayerDown(h)}reorderLayersByIndex(h,w){return this.layerService.reorderLayersByIndex(h,w)}toggleGrid(){this.canvasService.toggleGrid()}toggleSnapToGrid(){this.canvasService.toggleSnapToGrid()}setGridSize(h){this.canvasService.setGridSize(h)}setActiveTool(h){this.toolsService.setActiveTool(h)}getActiveTool(){return this.toolsService.getActiveToolType()}setToolEnabled(h,w){return this.toolsService.setToolEnabledByType(h,w)}setEnabledTools(h){this.toolsService.setEnabledTools(h)}setCursor(h){this.toolsService.setCursor(h)}resetCursor(){this.toolsService.resetCursor()}screenToCanvas(h,w){return this.canvasService.screenToCanvas(h,w)}canvasToScreen(h,w){return this.canvasService.canvasToScreen(h,w)}getSelectionBoxSignal(){return this.selectionService.getSelectionBoxSignal()}getBoundingBoxSignal(){return this.selectionService.getBoundingBoxSignal()}static{this.\u0275fac=function(w){return new(w||M)}}static{this.\u0275prov=e.jDH({token:M,factory:M.\u0275fac})}}return M})()},525:($,Z,v)=>{v.d(Z,{W:()=>D});var S=v(4438),e=v(162),E=v(7785),O=v(8936);let D=(()=>{class i{constructor(a,u,n){this.configService=a,this.eventBusService=u,this.svgContainer=null,this.transform=(0,S.EWP)(()=>{const{zoom:c,x:o,y:p}=this.getConfig();return`translate(${o}, ${p}) scale(${c})`}),this.renderer=n.createRenderer(null,null)}initializeCanvas(a){this.svgContainer=a;const{fullScreen:u,center:n}=this.getConfig();!u&&n&&setTimeout(()=>{this.centerCanvas()},0),this.eventBusService.emit(e.w.Ready)}getCanvas(){if(!this.svgContainer)throw new Error("SVG container not initialized");return this.svgContainer}isCanvasInitialized(){return null!==this.svgContainer}getConfig(){return this.configService.getConfig()}setCanvasDimensions(a,u){this.configService.updateConfig({canvasWidth:a,canvasHeight:u})}setCanvasPosition(a,u){this.configService.updateConfig({x:a,y:u})}getCanvasDimensions(){const a=this.getConfig();return{width:a.canvasWidth,height:a.canvasHeight}}getCanvasPosition(){const a=this.getConfig();return{x:a.x,y:a.y}}getContainerDimensions(){return this.svgContainer?{width:this.svgContainer.clientWidth||0,height:this.svgContainer.clientHeight||0}:{width:0,height:0}}fullScreen(){const{width:a,height:u}=this.getContainerDimensions();this.setCanvasDimensions(a,u),this.configService.updateConfig({fullScreen:!0}),this.centerCanvas()}exitFullScreen(a=800,u=600){this.setCanvasDimensions(a,u),this.configService.updateConfig({fullScreen:!1,zoom:1}),this.centerCanvas()}centerCanvas(){const{fullScreen:a}=this.getConfig();if(a)this.configService.updateConfig({x:0,y:0,canvasX:0,canvasY:0});else{const{canvasWidth:u,canvasHeight:n,zoom:c,center:o}=this.getConfig(),{width:p,height:I}=this.getContainerDimensions();this.configService.updateConfig({x:o?u/2:0,y:o?n/2:0,canvasX:(p-u*c)/2,canvasY:(I-n*c)/2})}}resetCanvas(){this.configService.updateConfig({x:0,y:0,zoom:1,canvasX:0,canvasY:0})}toggleGrid(){const{enableGrid:a}=this.getConfig();this.configService.updateConfig({enableGrid:!a})}setGridVisible(a){this.configService.updateConfig({enableGrid:a})}setGridSize(a){this.configService.updateConfig({gridSize:a})}toggleSnapToGrid(){const{snapToGrid:a}=this.getConfig();this.configService.updateConfig({snapToGrid:!a})}getTransform(){return this.transform}getTransformString(){return this.transform()}screenToCanvas(a,u){const{zoom:n,x:c,y:o}=this.getConfig();return{x:(a-c)/n,y:(u-o)/n}}canvasToScreen(a,u){const{zoom:n,x:c,y:o}=this.getConfig();return{x:a*n+c,y:u*n+o}}getVisibleBounds(){const{zoom:a,x:u,y:n}=this.getConfig(),{width:c,height:o}=this.getContainerDimensions();return{left:-u/a,top:-n/a,right:(-u+c)/a,bottom:(-n+o)/a}}isPointVisible(a,u){const n=this.getVisibleBounds();return a>=n.left&&a<=n.right&&u>=n.top&&u<=n.bottom}isRectVisible(a,u,n,c){const o=this.getVisibleBounds();return!(a+n<o.left||a>o.right||u+c<o.top||u>o.bottom)}getCanvasDimensionsProvider(){return()=>this.getCanvasDimensions()}getContainerDimensionsProvider(){return()=>this.getContainerDimensions()}transformCoordinates(a,u){return{x:a,y:u}}validateZoom(a){return Math.max(.1,Math.min(10,a))}static{this.\u0275fac=function(u){return new(u||i)(S.KVO(E.w),S.KVO(O.W),S.KVO(S._9s))}}static{this.\u0275prov=S.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},4446:($,Z,v)=>{v.d(Z,{b:()=>E});var S=v(4438),e=v(2107);let E=(()=>{class O{constructor(){this.instances=new Map,this._activeId=(0,S.vPA)(null),this.activeId=this._activeId.asReadonly(),this._registryVersion=(0,S.vPA)(0),this.registryVersion=this._registryVersion.asReadonly()}register(i,m){if(!i||0===i.trim().length)throw new Error("Whiteboard instance ID cannot be empty.");if(!(m instanceof e.G))throw new Error("Instance must be an ApiService instance.");this.instances.set(i,m),this._registryVersion.update(a=>a+1)}unregister(i){const m=this.instances.delete(i);return m&&(this._activeId()===i&&this._activeId.set(null),this._registryVersion.update(a=>a+1)),m}getInstance(i){return this.instances.get(i)}hasInstance(i){return this.instances.has(i)}getAllInstanceIds(){return Array.from(this.instances.keys())}getInstanceCount(){return this.instances.size}setActive(i){if(!this.hasInstance(i))throw new Error(`Whiteboard with ID "${i}" not found in registry. Cannot set as active.`);this._activeId.set(i)}clearActive(){this._activeId.set(null)}getActiveInstance(){const i=this._activeId();return i?this.instances.get(i):void 0}clearAll(){this.instances.clear(),this._activeId.set(null),this._registryVersion.update(i=>i+1)}static{this.\u0275fac=function(m){return new(m||O)}}static{this.\u0275prov=S.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()},7785:($,Z,v)=>{v.d(Z,{w:()=>i});var S=v(4438),e=v(6078),E=v(3265),O=v(162),D=v(8936);let i=(()=>{class m{constructor(u){this.eventBusService=u,this.config=(0,S.vPA)({drawingEnabled:!0,canvasWidth:800,canvasHeight:600,fullScreen:!0,center:!0,canvasX:0,canvasY:0,strokeColor:"#333333",strokeWidth:2,backgroundColor:"#F8F9FA",lineJoin:e.pP.Round,lineCap:e.$3.Round,fill:"transparent",zoom:1,x:0,y:0,fontFamily:"sans-serif",fontSize:24,dasharray:"",dashoffset:0,enableGrid:!1,gridSize:10,snapToGrid:!0,keyboardShortcutsEnabled:!0,penType:E.mY.Pen}),this.editorConfig=(0,S.vPA)({title:"Whiteboard",enableEditor:!0,showTitle:!0,showZoom:!0,showLayers:!0,showTools:!0,showGrid:!0,showBackground:!0,showStroke:!0,showFill:!0,showOpacity:!0,showFont:!0,showDash:!0,showEraser:!0,showUndo:!0,showRedo:!0,showClear:!0,showSave:!0,showLoad:!1,showExport:!0,showImport:!1,showShare:!1,showSettings:!1,showHelp:!1,showAbout:!1,showFeedback:!1,showSupport:!1,showContact:!1,showPrivacy:!1,showTerms:!1,showLicense:!1,showAttribution:!1,showCredits:!1,showChangelog:!1,showReleaseNotes:!1,showRoadmap:!1,showBlog:!1,showForum:!1,showCommunity:!1,showEvents:!1,showWebinars:!1,showWorkshops:!1,showTutorials:!1,showDocumentation:!1,showAPI:!1,showSDK:!1,showCLI:!1,showPlugins:!1,showExtensions:!1,showIntegrations:!1,showAddons:!1,showThemes:!1,showTemplates:!1,showSnippets:!1,showExamples:!0,showDemos:!0,showSamples:!1,showShowcases:!1,showPortfolios:!1,showCaseStudies:!1,showSuccessStories:!1,showTestimonials:!1,showReviews:!1,showRatings:!1,showComparisons:!1,showAlternatives:!1,showInsights:!1})}getConfig(){return this.config()}getConfigSignal(){return this.config.asReadonly()}getEditorConfig(){return this.editorConfig()}getEditorConfigSignal(){return this.editorConfig.asReadonly()}updateConfig(u,n=!0){if(this.config.update(o=>({...o,...u})),"zoom"in u){const o=this.config();this.eventBusService.emit(O.w.ZoomChange,{zoom:o.zoom})}n&&this.eventBusService.emit(O.w.ConfigChange,this.config())}isConfigDifferent(u,n){return this.config()[u]!==n}updateConfigValue(u,n){this.config.update(c=>({...c,[u]:n})),this.eventBusService.emit(O.w.ConfigChange,this.config())}updateEditorConfigValue(u,n){this.editorConfig.update(c=>({...c,[u]:n}))}checkAndUpdateConfig(u,n){this.isConfigDifferent(u,n)&&this.updateConfigValue(u,n)}getConfigValue(u){return this.config()[u]}setConfigValue(u,n){this.config.update(c=>({...c,[u]:n})),this.eventBusService.emit(O.w.ConfigChange,this.config())}getConfigKeys(){return Object.keys(this.config())}getConfigValues(){return Object.values(this.config())}static{this.\u0275fac=function(n){return new(n||m)(S.KVO(D.W))}}static{this.\u0275prov=S.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})()},7879:($,Z,v)=>{v.d(Z,{AD:()=>z,Be:()=>m,Bn:()=>u,DQ:()=>o,Dr:()=>g,Mt:()=>S,RZ:()=>E,Sb:()=>i,Vu:()=>W,Wd:()=>M,YO:()=>D,_:()=>h,aM:()=>I,aR:()=>w,aW:()=>l,bL:()=>c,c1:()=>B,fh:()=>C,i$:()=>O,nD:()=>p,wM:()=>e});const S="selectorGroup",e="svgroot",E="item_",O="selectorBox",D="selectorGrip_",i="selectorGrip_resize",m="selectorGrip_rotate",u="data-wb-id",c=.25,o=.1,p=5,I=1,l=.5,C={LEFT:0,MIDDLE:1,RIGHT:2},g={PAN_MIDDLE:"pan-middle",PAN_SPACE:"pan-space"},M={HTML:"text/html",PLAIN:"text/plain",JSON:"application/json"},B={COPY:"copy"},h={ESCAPE:"Escape",ENTER:"Enter",SPACE:"Space",DELETE:"Delete",BACKSPACE:"Backspace",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",TAB:"Tab"},w={ESCAPE:"escape",ENTER:"enter",SPACE:"space",DELETE:"delete",BACKSPACE:"backspace",ARROW_UP:"arrowup",ARROW_DOWN:"arrowdown",ARROW_LEFT:"arrowleft",ARROW_RIGHT:"arrowright",TAB:"tab"},W={IMAGE:"image/"},z={SMALL_STEP:1,LARGE_STEP:10}},2173:($,Z,v)=>{v.d(Z,{n:()=>z,lE:()=>h});var S=v(2262),e=v(6078);const E={strokeWidth:2,strokeColor:"#000000",fill:"#000000",lineJoin:e.pP.Round,lineCap:e.$3.Round,dasharray:"",dashoffset:0},O={...E,fontSize:14,fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal",color:"#000000"};function D(){return Math.random().toString(36).substring(2).padEnd(12,"0").substring(0,12)}var i=v(6042);function m(P,s,T,k){const L=[[{x:P.minX,y:P.minY},{x:P.maxX,y:P.minY}],[{x:P.maxX,y:P.minY},{x:P.maxX,y:P.maxY}],[{x:P.maxX,y:P.maxY},{x:P.minX,y:P.maxY}],[{x:P.minX,y:P.maxY},{x:P.minX,y:P.minY}]];for(const[d,b]of L)if((0,i.Em)(s,T,d,b,k))return!0;return!1}function u(P,s,T,k,L,d,b){const x={x:P,y:s},A={x:T,y:k};return(0,i.d4)(L.x,L.y,x,A)<=b||(0,i.d4)(d.x,d.y,x,A)<=b}var l=v(2319);const B={[S.R.Arrow]:new class c{create(s){return{type:S.R.Arrow,id:D(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...s,style:{...E,...s.style}}}resize(s,T,k,L){return T.includes(e.OP.N)&&(s.y2+=L),T.includes(e.OP.S)&&(s.y1+=L),T.includes(e.OP.W)&&(s.x1+=k),T.includes(e.OP.E)&&(s.x2+=k),s}getBounds(s){const T=s.x1+s.x,k=s.y1+s.y,L=s.x2+s.x,d=s.y2+s.y;return{minX:Math.min(T,L),minY:Math.min(k,d),maxX:Math.max(T,L),maxY:Math.max(k,d),width:Math.abs(L-T),height:Math.abs(d-k)}}hitTest(s,T,k,L){const{x1:d,y1:b,x2:x,y2:A}=s;return u(d,b,x,A,T,k,L)}},[S.R.Ellipse]:new class o{create(s){return{type:S.R.Ellipse,id:D(),x:0,y:0,cx:0,cy:0,rx:1,ry:1,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...s,style:{...E,...s.style}}}resize(s,T,k,L){if(T.includes(e.OP.N)){const d=s.ry-L/2;d>0&&(s.ry=d,s.cy+=L/2)}if(T.includes(e.OP.S)){const d=s.ry+L/2;d>0&&(s.ry=d,s.cy+=L/2)}if(T.includes(e.OP.W)){const d=s.rx-k/2;d>0&&(s.rx=d,s.cx+=k/2)}if(T.includes(e.OP.E)){const d=s.rx+k/2;d>0&&(s.rx=d,s.cx+=k/2)}return s}getBounds(s){const T=s.cx+s.x,k=s.cy+s.y;return{minX:T-s.rx,minY:k-s.ry,maxX:T+s.rx,maxY:k+s.ry,width:2*s.rx,height:2*s.ry}}hitTest(s,T,k,L){const{cx:d,cy:b,rx:x,ry:A}=s;return function a(P,s,T,k,L,d,b){return(0,i.d4)(P,s,L,d)<=Math.max(T,k)+b}(d,b,x,A,T,k,L)}},[S.R.Image]:new class p{create(s){return{type:S.R.Image,id:D(),x:0,y:0,width:1,height:1,src:"",rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...s,style:{...E,...s.style}}}resize(s,T,k,L){if(T.includes(e.OP.N)){const d=s.height-L;d>0&&(s.y+=L,s.height=d)}if(T.includes(e.OP.S)){const d=s.height+L;d>0&&(s.height=d)}if(T.includes(e.OP.W)){const d=s.width-k;d>0&&(s.x+=k,s.width=d)}if(T.includes(e.OP.E)){const d=s.width+k;d>0&&(s.width=d)}return s}getBounds(s){return{minX:s.x,minY:s.y,maxX:s.x+s.width,maxY:s.y+s.height,width:s.width,height:s.height}}hitTest(s,T,k,L){return m(this.getBounds(s),T,k,L)}},[S.R.Line]:new class I{create(s){return{type:S.R.Line,id:D(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...s,style:{...E,...s.style}}}resize(s,T,k,L){return T.includes(e.OP.N)&&(s.y1+=L),T.includes(e.OP.S)&&(s.y2+=L),T.includes(e.OP.W)&&(s.x1+=k),T.includes(e.OP.E)&&(s.x2+=k),s}getBounds(s){const T=s.x1+s.x,k=s.y1+s.y,L=s.x2+s.x,d=s.y2+s.y;return{minX:Math.min(T,L),minY:Math.min(k,d),maxX:Math.max(T,L),maxY:Math.max(k,d),width:Math.abs(L-T),height:Math.abs(d-k)}}hitTest(s,T,k,L){const{x1:d,y1:b,x2:x,y2:A}=s;return u(d,b,x,A,T,k,L)}},[S.R.Pen]:new class C{create(s){return{type:S.R.Pen,id:D(),x:0,y:0,points:[],rotation:0,opacity:100,zIndex:1,selectAfterDraw:!1,...s,style:{...E,...s.style}}}resize(s,T,k,L){const d=(0,l.AJ)(s.points),{points:b,position:x}=this.getScaleFactors(T,d,k,L),A=d.minX+d.width/2,N=d.minY+d.height/2,[H,Y]=b;return d.width*H<10||d.height*Y<10||(s.x+=x.x,s.y+=x.y,s.points=s.points.map(U=>[A+(U[0]-A)*H,N+(U[1]-N)*Y])),s}getScaleFactors(s,T,k,L){const d=[1,1],b={x:0,y:0};return s.includes("w")&&(d[0]=(T.width-k)/T.width,b.x+=k/2),s.includes("n")&&(d[1]=(T.height-L)/T.height,b.y+=L/2),s.includes("e")&&(d[0]=(T.width+k)/T.width,b.x+=k/2),s.includes("s")&&(d[1]=(T.height+L)/T.height,b.y+=L/2),{points:d,position:b}}getBounds(s){const{minX:T,minY:k,maxX:L,maxY:d,width:b,height:x}=(0,l.AJ)(s.points);return{minX:T+s.x,minY:k+s.y,maxX:L+s.x,maxY:d+s.y,width:b,height:x}}hitTest(s,T,k,L){return function n(P,s,T,k){for(let L=0;L<P.length-1;L++){const d={x:P[L][0],y:P[L][1]},b={x:P[L+1][0],y:P[L+1][1]};if((0,i.d4)(s.x,s.y,d,b)<=k||(0,i.d4)(T.x,T.y,d,b)<=k)return!0}return!1}(s.points,T,k,L)}},[S.R.Rectangle]:new class g{create(s){return{type:S.R.Rectangle,id:D(),x:0,y:0,width:1,height:1,rx:5,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...s,style:{...E,...s.style}}}resize(s,T,k,L){if(T.includes(e.OP.N)){const d=s.height-L;d>0&&(s.y+=L,s.height=d)}if(T.includes(e.OP.S)){const d=s.height+L;d>0&&(s.height=d)}if(T.includes(e.OP.W)){const d=s.width-k;d>0&&(s.x+=k,s.width=d)}if(T.includes(e.OP.E)){const d=s.width+k;d>0&&(s.width=d)}return s}getBounds(s){return{minX:s.x,minY:s.y,maxX:s.x+s.width,maxY:s.y+s.height,width:s.width,height:s.height}}hitTest(s,T,k,L){return m(this.getBounds(s),T,k,L)}},[S.R.Text]:new class M{create(s){return{type:S.R.Text,id:D(),x:0,y:0,text:"",rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,scaleX:1,scaleY:1,...s,style:{...O,...s.style}}}resize(s,T,k,L){const x=.016*k,A=.016*L;switch(T){case e.OP.NW:s.x+=k,s.y+=L,s.scaleX=Math.max(.1,s.scaleX-x),s.scaleY=Math.max(.1,s.scaleY-A);break;case e.OP.N:s.y+=L,s.scaleY=Math.max(.1,s.scaleY-A);break;case e.OP.NE:s.y+=L,s.scaleX=Math.max(.1,s.scaleX+x),s.scaleY=Math.max(.1,s.scaleY-A);break;case e.OP.E:s.scaleX=Math.max(.1,s.scaleX+x);break;case e.OP.SE:s.scaleX=Math.max(.1,s.scaleX+x),s.scaleY=Math.max(.1,s.scaleY+A);break;case e.OP.S:s.scaleY=Math.max(.1,s.scaleY+A);break;case e.OP.SW:s.x+=k,s.scaleX=Math.max(.1,s.scaleX-x),s.scaleY=Math.max(.1,s.scaleY+A);break;case e.OP.W:s.x+=k,s.scaleX=Math.max(.1,s.scaleX-x)}return s}getBounds(s){const{text:T,x:k,y:L,scaleX:d,scaleY:b,style:x}=s,A=x.fontSize??O.fontSize??16,N=1.2*A,H=.6*A,Y=T.split("\n"),j=H*Y.reduce((le,V)=>Math.max(le,V.length),0)*d||A*d,Q=N*Y.length*b||A*b,q=.8*A*b;return{minX:k,minY:L-q,maxX:k+j,maxY:L-q+Q,width:j,height:Q}}hitTest(s,T,k,L){return m(this.getBounds(s),T,k,L)}}};function h(P){return B[P]}let w=null;function z(P,s,T){const L={...s,layerId:T||(w?w():"")};return B[P].create(L)}},6255:($,Z,v)=>{v.d(Z,{L:()=>m});var S=v(875),e=v(4438),E=v(162),O=v(9820),D=v(3437),i=v(8936);let m=(()=>{class a{constructor(n){this.eventBus=n,this.historyService=(0,e.WQX)(S.k),this.layerManagement=(0,e.WQX)(D.a),this._elements=(0,e.vPA)([]),this._draftElements=(0,e.vPA)([]),this._maxZIndex=(0,e.vPA)(0),this._locks=(0,e.vPA)(new Map),this.elements=this._elements.asReadonly(),this.draftElements=this._draftElements.asReadonly(),this.allElements=(0,e.EWP)(()=>[...this._elements(),...this._draftElements()]),this.elementsCount=(0,e.EWP)(()=>this._elements().length),this.hasElements=(0,e.EWP)(()=>this.elementsCount()>0),this.elementTypes=(0,e.EWP)(()=>{const c=this._elements().map(o=>o.type);return[...new Set(c)]}),this.elementsByType=(0,e.EWP)(()=>{const c=this._elements(),o=new Map;return c.forEach(p=>{const I=p.type;o.has(I)||o.set(I,[]);const l=o.get(I);l&&l.push(p)}),o}),this.maxZIndex=(0,e.EWP)(()=>this._maxZIndex()),this.elementsByZIndex=(0,e.EWP)(()=>[...this._elements()].sort((c,o)=>(c.zIndex||0)-(o.zIndex||0))),this.lockedElements=(0,e.EWP)(()=>this._elements().filter(c=>!0===c.locked)),this.unlockedElements=(0,e.EWP)(()=>this._elements().filter(c=>!0!==c.locked)),this.lockedElementsCount=(0,e.EWP)(()=>this.lockedElements().length),this.hasLockedElements=(0,e.EWP)(()=>this.lockedElementsCount()>0),this.lockStats=(0,e.EWP)(()=>{const c=this.elementsCount(),o=this.lockedElementsCount();return{total:c,locked:o,unlocked:c-o,lockPercentage:c>0?Math.round(o/c*100):0,allLocked:c>0&&o===c,noneLocked:0===o}}),this.locks=this._locks.asReadonly()}getElements(){return[...this._elements()]}getDraftElements(){return[...this._draftElements()]}getAllElements(){return this.allElements()}addElements(n){if(!n?.length)return;const c=this.layerManagement.getActiveLayerId(),o=n.map(l=>({...l,zIndex:l.zIndex??this.getNextZIndex(),layerId:l.layerId??c}));this.updateMaxZIndex(o);const p=this._elements(),I=[...p,...o];this._elements.set(I),o.forEach(l=>{l.layerId&&this.layerManagement.assignElementToLayer(l.id,l.layerId)}),this.historyService.recordElementCreation(p,I),this.eventBus.emit(E.w.ElementsAdded,o),this.eventBus.emit(E.w.DataChange,I)}updateElements(n,c=!1){if(!n?.length)return;const o=this._elements(),p=new Map(n.map(C=>[C.id,C])),I=[],l=o.map(C=>{const g=p.get(C.id);if(!g)return C;if(!c&&C.locked&&!this.isLockOperation(g))return console.warn(`Attempted to modify locked element: ${C.id}`),C;if(!c&&C.layerId){const B=this.layerManagement.getElementLayer(C.id);if(B?.locked)return console.warn(`Attempted to modify element on locked layer: ${B.name}`),C}const M={...C,...g};return null!=M.zIndex&&this._maxZIndex.update(B=>Math.max(B,M.zIndex)),I.push(M),M});this._elements.set(l),I.length>0&&this.historyService.recordElementUpdate(o,l),I.length>0&&(this.eventBus.emit(E.w.ElementsUpdated,I),this.eventBus.emit(E.w.DataChange,l))}removeElementsByIds(n,c=!1){if(!n?.length)return;const o=new Set(n),p=this._elements(),I=p.filter(g=>{if(!o.has(g.id))return!1;if(!c&&g.locked)return console.warn(`Attempted to remove locked element: ${g.id}`),!1;if(!c&&g.layerId){const M=this.layerManagement.getElementLayer(g.id);if(M?.locked)return console.warn(`Attempted to remove element from locked layer: ${M.name}`),!1}return!0});if(0===I.length)return;const l=new Set(I.map(g=>g.id)),C=p.filter(g=>!l.has(g.id));this._elements.set(C),I.forEach(g=>{this.layerManagement.removeElementFromAllLayers(g.id)}),this.historyService.recordElementDeletion(p,C),this.eventBus.emit(E.w.ElementsRemoved,I),this.eventBus.emit(E.w.DataChange,C)}removeElements(n,c=!1){const o=n.map(p=>p.id);this.removeElementsByIds(o,c)}clear(){const n=this._elements();this._elements.set([]),this._maxZIndex.set(0),n.forEach(c=>{this.layerManagement.removeElementFromAllLayers(c.id)}),this.historyService.recordClear(n,[]),this.eventBus.emit(E.w.DataChange,[])}setElements(n){const c=n.map(o=>({...o,zIndex:o.zIndex??this.getNextZIndex()}));this.updateMaxZIndex(c),this._elements.set([...c]),this.eventBus.emit(E.w.DataChange,c)}addDraftElements(n){if(!n?.length)return;const c=this.layerManagement.activeLayer();if(c?.locked)return void console.warn(`Cannot draw on locked layer: ${c.name}`);const o=n.map(l=>({...l,zIndex:l.zIndex??this.getNextZIndex()}));this.updateMaxZIndex(o);const I=[...this._draftElements(),...o];this._draftElements.set(I)}updateDraftElements(n){if(!n?.length)return;const c=this._draftElements(),o=new Map(n.map(l=>[l.id,l])),p=[],I=c.map(l=>{const C=o.get(l.id);if(C){const g={...l,...C};return p.push(g),g}return l});this._draftElements.set(I)}removeDraftElements(n){if(!n?.length)return;const c=new Set(n),p=this._draftElements().filter(I=>!c.has(I.id));this._draftElements.set(p)}clearDraftElements(){this._draftElements.set([])}commitDraftElements(n){const c=this._draftElements(),o=n?c.filter(l=>n.includes(l.id)):c;if(0===o.length)return[];const p=this.layerManagement.activeLayer();if(p?.locked)return console.warn(`Cannot commit elements to locked layer: ${p.name}`),this._draftElements.set([]),[];this.addElements(o);const I=n?c.filter(l=>!n.includes(l.id)):[];return this._draftElements.set(I),o}getNextZIndex(){return this._maxZIndex.update(n=>n+1),this._maxZIndex()}bringToFront(n,c=!1){if(!n?.length)return;const o=this.getNextZIndex(),p=n.map(I=>({id:I,zIndex:o}));this.updateElements(p,c)}sendToBack(n,c=!1){if(!n?.length)return;const o=n.map(p=>({id:p,zIndex:0}));this.updateElements(o,c)}lockElements(n){if(!n?.length)return;const c={timestamp:Date.now(),reason:"User locked"},o=this._locks(),p=new Map(o),I=n.map(l=>(p.set(l,c),{id:l,locked:!0}));this._locks.set(p),this.updateElements(I,!0)}unlockElements(n){if(!n?.length)return;const c=this._locks(),o=new Map(c),p=n.map(I=>(o.delete(I),{id:I,locked:!1}));this._locks.set(o),this.updateElements(p,!0)}toggleElementsLock(n){if(!n?.length)return;const c=[],o=[];n.forEach(p=>{const I=this.getElementById(p);I&&(I.locked?o.push(p):c.push(p))}),c.length>0&&this.lockElements(c),o.length>0&&this.unlockElements(o)}lockAllElements(){const n=this._elements().map(c=>c.id);this.lockElements(n)}unlockAllElements(){const n=this._elements().map(c=>c.id);this.unlockElements(n)}isElementLocked(n){return!!this.getElementById(n)?.locked}getLockedElementIds(){return this.lockedElements().map(n=>n.id)}getUnlockedElementIds(){return this.unlockedElements().map(n=>n.id)}moveToLayer(n,c,o=!1){if(!n?.length)return;const p=n.map(I=>({id:I,layerId:c}));this.updateElements(p,o)}getElementsByLayer(n){return this._elements().filter(c=>c.layerId===n)}getElementById(n){return this._elements().find(o=>o.id===n)||this._draftElements().find(o=>o.id===n)}getElementsByIds(n){const c=new Set(n);return this.allElements().filter(p=>c.has(p.id))}getElementsByType(n){return this._elements().filter(c=>c.type===n)}searchElements(n){let c=this._elements();if(n.type&&(c=c.filter(o=>o.type===n.type)),n.layerId&&(c=c.filter(o=>o.layerId===n.layerId)),void 0!==n.locked&&(c=c.filter(o=>!!o.locked===n.locked)),n.textContent){const o=n.textContent.toLowerCase();c=c.filter(p=>(p.text||p.content||"").toLowerCase().includes(o))}if(n.zIndexRange){const{min:o,max:p}=n.zIndexRange;c=c.filter(I=>{const l=I.zIndex||0;return l>=o&&l<=p})}return n.bounds&&(c=this.findElementsInBounds(n.bounds).filter(o=>c.some(p=>p.id===o.id))),c}findElementsByText(n){return this.searchElements({textContent:n})}getElementsInRadius(n,c,o){return this._elements().filter(p=>{const I=p.x-n,l=p.y-c;return Math.sqrt(I*I+l*l)<=o})}getNearestElement(n,c){const o=this._elements();if(0===o.length)return;let p=o[0],I=this.getDistanceToElement(n,c,p);for(let l=1;l<o.length;l++){const C=this.getDistanceToElement(n,c,o[l]);C<I&&(I=C,p=o[l])}return p}createSnapshot(){return{elements:[...this._elements()],draftElements:[...this._draftElements()],maxZIndex:this._maxZIndex(),timestamp:Date.now()}}restoreSnapshot(n){this._elements.set([...n.elements]),this._draftElements.set([...n.draftElements]),this._maxZIndex.set(n.maxZIndex)}findElementsInBounds(n){return this._elements().filter(c=>c.x<n.x+n.width&&c.x+(c.width||50)>n.x&&c.y<n.y+n.height&&c.y+(c.height||50)>n.y)}calculateElementsBounds(n){if(0===n.length)return null;const c=n.map(O.P),o=Math.min(...c.map(M=>M.minX)),p=Math.min(...c.map(M=>M.minY)),C=Math.max(...c.map(M=>M.maxX))-o,g=Math.max(...c.map(M=>M.maxY))-p;return{x:o,y:p,width:C,height:g,centerX:o+C/2,centerY:p+g/2}}getElementsCount(){return this.elementsCount()}getElementTypes(){return this.elementTypes()}normalizeZIndices(){const n=[...this._elements()].sort((o,p)=>(o.zIndex||0)-(p.zIndex||0)),c=n.map((o,p)=>({id:o.id,zIndex:p+1}));this._maxZIndex.set(n.length),this.updateElements(c,!0)}addElement(n){this.addElements([n])}updateElement(n,c=!1){this.updateElements([n],c)}removeElement(n,c=!1){this.removeElementsByIds([n.id],c)}elementExists(n){return void 0!==this.getElementById(n)}getElementsByZIndexRange(n,c){return this._elements().filter(o=>{const p=o.zIndex||0;return p>=n&&p<=c})}getElementsByProperty(n,c){return this._elements().filter(o=>o[n]===c)}lockElement(n){this.lockElements([n])}unlockElement(n){this.unlockElements([n])}toggleElementLock(n){this.toggleElementsLock([n])}getModifiableElements(){return this.unlockedElements()}hasLockedElementsInSelection(n){return n.some(c=>this.isElementLocked(c))}filterUnlockedElements(n){return n.filter(c=>!this.isElementLocked(c))}getModifiableElementsFromIds(n){const c=this.filterUnlockedElements(n);return this.getElementsByIds(c)}safeUpdateElements(n){const c=[],o=[],p=n.filter(I=>this.isElementLocked(I.id)?(c.push(I.id),!1):(o.push(I.id),!0));return p.length>0&&this.updateElements(p,!1),{updated:o,locked:c}}isLockOperation(n){return"locked"in n}updateMaxZIndex(n){const c=Math.max(...n.map(o=>o.zIndex||0));this._maxZIndex.update(o=>Math.max(o,c))}getDistanceToElement(n,c,o){const g=n-(o.x+(o.width||50)/2),M=c-(o.y+(o.height||50)/2);return Math.sqrt(g*g+M*M)}static{this.\u0275fac=function(c){return new(c||a)(e.KVO(i.W))}}static{this.\u0275prov=e.jDH({token:a,factory:a.\u0275fac,providedIn:"root"})}}return a})()},3437:($,Z,v)=>{v.d(Z,{a:()=>E});var S=v(4438),e=v(4289);let E=(()=>{class O{constructor(){this._layers=(0,S.vPA)([]),this._activeLayerId=(0,S.vPA)(""),this.layers=this._layers.asReadonly(),this.activeLayerId=this._activeLayerId.asReadonly(),this.activeLayer=(0,S.EWP)(()=>{const i=this._layers(),m=this._activeLayerId();return i.find(a=>a.id===m)||i[0]}),this.sortedLayers=(0,S.EWP)(()=>[...this._layers()].sort((i,m)=>i.zIndex-m.zIndex)),this.visibleLayers=(0,S.EWP)(()=>this._layers().filter(i=>i.visible)),this.unlockedLayers=(0,S.EWP)(()=>this._layers().filter(i=>!i.locked)),this.initializeDefaultLayer()}addLayer(i){const m=this._layers(),a=Math.max(...m.map(o=>o.zIndex),0)+1,u=m.length+1,n={id:this.generateLayerId(),name:i||`Layer ${u}`,visible:!0,locked:!1,zIndex:a,elements:[],opacity:1,blendMode:"normal"},c=m.map(o=>({...o,visible:!1}));return this._layers.set([...c,n]),this.setActiveLayer(n.id),n}removeLayer(i){const m=this._layers();if(m.length<=1)return console.warn("Cannot delete the last remaining layer"),!1;if(!m.find(n=>n.id===i))return console.warn(`Layer with id ${i} not found`),!1;const u=m.filter(n=>n.id!==i);if(this._layers.set(u),this._activeLayerId()===i){const n=u[Math.max(0,u.length-1)];this.setActiveLayer(n.id)}return!0}renameLayer(i,m){const a=this._layers(),u=a.findIndex(c=>c.id===i);if(-1===u)return console.warn(`Layer with id ${i} not found`),!1;if(a[u].locked)return console.warn(`Cannot rename locked layer: ${a[u].name}`),!1;const n=[...a];return n[u]={...n[u],name:m.trim()||`Layer ${u+1}`},this._layers.set(n),!0}reorderLayer(i,m){const a=this._layers(),u=a.findIndex(c=>c.id===i);if(-1===u)return console.warn(`Layer with id ${i} not found`),!1;if(a[u].locked)return console.warn(`Cannot reorder locked layer: ${a[u].name}`),!1;const n=[...a];return n[u]={...n[u],zIndex:m},this._layers.set(n),!0}moveLayerUp(i){const m=this.sortedLayers(),a=m.findIndex(c=>c.id===i);if(-1===a||a===m.length-1)return!1;const u=m[a];if(u.locked)return console.warn(`Cannot move locked layer: ${u.name}`),!1;const n=m[a+1];return this.reorderLayer(u.id,n.zIndex)&&this.reorderLayer(n.id,u.zIndex)}moveLayerDown(i){const m=this.sortedLayers(),a=m.findIndex(c=>c.id===i);if(-1===a||0===a)return!1;const u=m[a];if(u.locked)return console.warn(`Cannot move locked layer: ${u.name}`),!1;const n=m[a-1];return this.reorderLayer(u.id,n.zIndex)&&this.reorderLayer(n.id,u.zIndex)}reorderLayersByIndex(i,m){const a=this._layers();if(i===m)return!1;if(i<0||i>=a.length||m<0||m>=a.length)return console.warn("Invalid layer indices for reordering"),!1;const u=a[i];if(u.locked)return console.warn(`Cannot reorder locked layer: ${u.name}`),!1;const n=[...a];n.splice(i,1),n.splice(m,0,u);const c=n.map((o,p)=>({...o,zIndex:n.length-1-p}));return this._layers.set(c),!0}toggleLayerVisibility(i){return this.updateLayerProperty(i,"visible",m=>!m)}toggleLayerLock(i){return this._layers().find(u=>u.id===i)?this.updateLayerProperty(i,"locked",u=>!u):(console.warn(`Layer with id ${i} not found`),!1)}setLayerOpacity(i,m){const u=this._layers().find(c=>c.id===i);if(!u)return console.warn(`Layer with id ${i} not found`),!1;if(u.locked)return console.warn(`Cannot change opacity of locked layer: ${u.name}`),!1;const n=Math.max(0,Math.min(1,m));return this.updateLayerProperty(i,"opacity",()=>n)}setLayerBlendMode(i,m){const u=this._layers().find(c=>c.id===i);return u?u.locked?(console.warn(`Cannot change blend mode of locked layer: ${u.name}`),!1):e.B.map(c=>c.value).includes(m)?this.updateLayerProperty(i,"blendMode",()=>m):(console.warn(`Invalid blend mode: ${m}. Using 'normal' instead.`),this.updateLayerProperty(i,"blendMode",()=>"normal")):(console.warn(`Layer with id ${i} not found`),!1)}setActiveLayer(i){const m=this._layers();if(!m.find(n=>n.id===i))return console.warn(`Layer with id ${i} not found`),!1;const u=m.map(n=>({...n,visible:n.id===i}));return this._layers.set(u),this._activeLayerId.set(i),!0}getActiveLayerId(){return this._activeLayerId()}isActiveLayerValid(){const i=this.activeLayer();return!!i&&i.visible&&!i.locked}getActiveLayerIssues(){const i=this.activeLayer();if(!i)return["No active layer"];const m=[];return i.visible||m.push("Active layer is hidden"),i.locked&&m.push("Active layer is locked"),m}assignElementToActiveLayer(i){const m=this._activeLayerId();return this.assignElementToLayer(i,m)}assignElementToLayer(i,m){const a=this._layers(),u=a.findIndex(I=>I.id===m);if(-1===u)return console.warn(`Layer with id ${m} not found`),!1;if(a[u].locked)return console.warn(`Cannot assign elements to locked layer: ${a[u].name}`),!1;this.removeElementFromAllLayers(i);const n=this._layers(),c=n.findIndex(I=>I.id===m),o=[...n],p=[...o[c].elements];return p.includes(i)||(p.push(i),o[c]={...o[c],elements:p},this._layers.set(o)),!0}removeElementFromAllLayers(i){const a=this._layers().map(u=>({...u,elements:u.elements.filter(n=>n!==i)}));this._layers.set(a)}getElementLayer(i){return this._layers().find(a=>a.elements.includes(i))||null}getVisibleElements(i){const m=this.visibleLayers(),a=new Set(m.flatMap(u=>u.elements));return i.filter(u=>a.has(u.id))}getEditableElements(i){const m=this.unlockedLayers(),a=new Set(m.flatMap(u=>u.elements));return i.filter(u=>a.has(u.id))}getSortedElements(i){const m=this.sortedLayers(),a=new Map;return m.forEach(u=>{u.elements.forEach(n=>{a.set(n,u.zIndex)})}),i.sort((u,n)=>(a.get(u.id)??0)-(a.get(n.id)??0))}exportLayerState(){return{layers:this._layers(),activeLayerId:this._activeLayerId()}}importLayerState(i){if(!i.layers||0===i.layers.length)return console.warn("Invalid layer state provided"),void this.initializeDefaultLayer();this._layers.set(i.layers);const m=i.layers.find(a=>a.id===i.activeLayerId);this._activeLayerId.set(m?i.activeLayerId:i.layers[0].id)}reset(){this.initializeDefaultLayer()}initializeDefaultLayer(){const i={id:"default",name:"Layer 1",visible:!0,locked:!1,zIndex:0,elements:[],opacity:1,blendMode:"normal"};this._layers.set([i]),this._activeLayerId.set(i.id)}generateLayerId(){return`layer-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}updateLayerProperty(i,m,a){const u=this._layers(),n=u.findIndex(p=>p.id===i);if(-1===n)return console.warn(`Layer with id ${i} not found`),!1;const c=[...u];return c[n]={...c[n],[m]:a(c[n][m])},this._layers.set(c),!0}static{this.\u0275fac=function(m){return new(m||O)}}static{this.\u0275prov=S.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()},1152:($,Z,v)=>{v.d(Z,{A:()=>o});var S=v(4438),e=v(872),E=v(6078),O=v(162),D=v(9820),i=v(2500),m=v(8936),a=v(3909),u=v(6255),n=v(3312),c=v(525);let o=(()=>{class p{constructor(l,C,g,M,B){this.eventBus=l,this.clipboardService=C,this.elementsService=g,this.toolsService=M,this.canvasService=B,this.OFFSET_INCREMENT=20,this.selectedElementIdsSignal=(0,S.vPA)(new Set),this.selectionBoxSignal=(0,S.vPA)({x:0,y:0,width:0,height:0,visible:!1}),this.boundingBoxSignal=(0,S.vPA)(null),this.selectedIdsSignal=(0,S.EWP)(()=>Array.from(this.selectedElementIdsSignal())),this.hasSelectionSignal=(0,S.EWP)(()=>this.selectedElementIdsSignal().size>0),this.initializeDataProviders()}initializeDataProviders(){this.getElementsFn=()=>this.elementsService.getElements(),this.updateElementsFn=l=>this.elementsService.updateElements(l),this.removeElementsFn=(l,C)=>this.elementsService.removeElements(l,C)}cutElements(){const l=this.getSelectedElements();0!==l.length&&(this.clipboardService.cut(l),this.deleteSelectedElements())}copyElements(){const l=this.getSelectedElements();0!==l.length&&this.clipboardService.copy(l)}pasteElements(){const l=this.clipboardService.paste();l.length>0&&this.selectElements(l)}duplicateElements(){const l=this.getSelectedElements();if(0===l.length)return;const C=this.clipboardService.duplicateElements(l);C.length>0&&this.selectElements(C)}deleteSelectedElements(){const l=this.getSelectedElements();0===l.length||!this.removeElementsFn||(this.removeElementsFn(l,!0),this.clearSelection())}getSelectedIds(){return this.selectedIdsSignal()}getSelectedElements(){if(!this.getElementsFn)return console.warn("Element data provider not set"),[];const l=this.getSelectedIds();return this.getElementsFn().filter(C=>l.includes(C.id))}getSelectedElementsSignal(){return(0,S.EWP)(()=>this.getSelectedElements())}isSelected(l){const C="string"==typeof l?l:l.id;return this.selectedElementIdsSignal().has(C)}getSelectionCount(){return this.selectedElementIdsSignal().size}hasSelection(){return this.getSelectionCount()>0}selectElements(l,C=!1){const M=(Array.isArray(l)?l:[l]).map(z=>"string"==typeof z?z:z.id),B=this.expandSelectionToIncludeGroups(M),h=Array.from(this.selectedElementIdsSignal()),w=C?[...new Set([...h,...B])]:B;this.selectedElementIdsSignal.set(new Set(w)),w.length>0&&this.toolsService.setActiveTool(e.p.Select);const W=this.getSelectedElements();this.updateBoundingBoxFromElements(W),this.eventBus.emit(O.w.ElementsSelected,W)}deselectElement(l){const C="string"==typeof l?l:l.id,g=new Set(this.selectedElementIdsSignal());if(g.has(C)){this.expandSelectionToIncludeGroups([C]).forEach(h=>{g.delete(h)}),this.selectedElementIdsSignal.set(g),this.updateBoundingBox();const B=this.getSelectedElements();this.eventBus.emit(O.w.ElementsSelected,B)}}toggleSelection(l){const C="string"==typeof l?l:l.id,g=new Set(this.selectedElementIdsSignal()),M=g.has(C),B=this.expandSelectionToIncludeGroups([C]);M?B.forEach(w=>{g.delete(w)}):(B.forEach(w=>{g.add(w)}),this.toolsService.setActiveTool(e.p.Select)),this.selectedElementIdsSignal.set(g),this.updateBoundingBox();const h=this.getSelectedElements();this.eventBus.emit(O.w.ElementsSelected,h)}clearSelection(){this.selectedElementIdsSignal.set(new Set),this.clearBoundingBox(),this.eventBus.emit(O.w.ElementsSelected,[])}selectAll(){if(!this.getElementsFn)return void console.warn("Element data provider not set");const l=this.getElementsFn(),C=new Set(l.map(g=>g.id));this.selectedElementIdsSignal.set(C),l.length>0&&this.toolsService.setActiveTool(e.p.Select),this.updateBoundingBox(),this.eventBus.emit(O.w.ElementsSelected,l)}selectElementsInArea(l){if(!this.getElementsFn)return void console.warn("Element data provider not set");const C=this.getElementsFn(),g=[];C.forEach(M=>{const B=(0,D.P)(M);!(B.maxX<l.x||B.minX>l.x+l.width||B.maxY<l.y||B.minY>l.y+l.height)&&g.push(M.id)}),g.length>0&&this.selectElements(g)}setSelectionBox(l){this.selectionBoxSignal.set(l)}getSelectionBox(){return this.selectionBoxSignal()}getSelectionBoxSignal(){return this.selectionBoxSignal.asReadonly()}clearSelectionBox(){this.selectionBoxSignal.set({x:0,y:0,width:0,height:0,visible:!1})}updateBoundingBox(){const l=this.getSelectedElements();this.updateBoundingBoxFromElements(l)}getBoundingBox(){return this.boundingBoxSignal()}getBoundingBoxSignal(){return this.boundingBoxSignal.asReadonly()}clearBoundingBox(){this.boundingBoxSignal.set(null)}setBoundingBox(l){this.boundingBoxSignal.set(l)}expandSelectionToIncludeGroups(l){if(!this.getElementsFn)return l;const C=this.getElementsFn(),g=C.filter(h=>l.includes(h.id)),M=new Set(g.map(h=>h.groupId).filter(h=>null!=h));return 0===M.size?l:C.filter(h=>l.includes(h.id)||h.groupId&&M.has(h.groupId)).map(h=>h.id)}calculateBoundingBox(l){let C,g=0;if(1===l.length){const T=l[0];g=T.rotation||0,C=(0,D.P)(T)}else{const T=(0,i.L)(l);if(!T)throw new Error("Cannot calculate bounding box for empty element list");C=T,g=0}const{minX:M,minY:B,maxX:h,maxY:w,width:W,height:z}=C;return{x:M,y:B,width:W,height:z,handles:{topLeft:{x:M,y:B},topRight:{x:h,y:B},bottomLeft:{x:M,y:w},bottomRight:{x:h,y:w},rotateHandle:{x:M+W/2,y:B-20}},rotation:g}}updateBoundingBoxFromElements(l){l&&0!==l.length?this.boundingBoxSignal.set(this.calculateBoundingBox(l)):this.clearBoundingBox()}updateSelectedElements(l,C){const g=this.getSelectedElements();if(0===g.length)return;const M=C||this.updateElementsFn;if(!M)return;M(g.map(w=>({...l,id:w.id})),!0),this.updateBoundingBox();const h=this.getSelectedElements();this.eventBus.emit(O.w.ElementsSelected,h)}transformSelectedElements(l,C){const g=this.getSelectedElements();if(0===g.length)return;const M=C||this.updateElementsFn;if(!M)return;M(l(g).map(W=>({...W,id:W.id})),!0),this.updateBoundingBox();const w=this.getSelectedElements();this.eventBus.emit(O.w.ElementsSelected,w)}getSelectionBounds(){const l=this.getSelectedElements();if(0===l.length)return null;const C=l.map(D.P);return{minX:Math.min(...C.map(g=>g.minX)),minY:Math.min(...C.map(g=>g.minY)),maxX:Math.max(...C.map(g=>g.maxX)),maxY:Math.max(...C.map(g=>g.maxY))}}selectionContainsType(l){return this.getSelectedElements().some(C=>C.type===l)}getSelectedElementTypes(){const l=this.getSelectedElements().map(C=>C.type);return[...new Set(l)]}removeSelectedElements(){const l=this.getSelectedElements();0!==l.length&&this.removeElementsFn&&(this.removeElementsFn(l,!0),this.clearSelection())}bringToFront(){const l=this.getSelectedElements();if(0===l.length||!this.getElementsFn||!this.updateElementsFn)return;const C=this.getElementsFn(),g=Math.max(...C.map(B=>B.zIndex||0)),M=l.map((B,h)=>({id:B.id,zIndex:g+h+1}));this.updateElementsFn(M)}bringForward(){const l=this.getSelectedElements();if(0===l.length||!this.getElementsFn||!this.updateElementsFn)return;const g=[...this.getElementsFn()].sort((B,h)=>(B.zIndex||0)-(h.zIndex||0)),M=[];l.forEach(B=>{let w=g.findIndex(W=>W.id===B.id)+1;for(;w<g.length&&l.some(W=>W.id===g[w].id);)w++;if(w<g.length){const W=g[w];M.push({id:B.id,zIndex:W.zIndex}),M.push({id:W.id,zIndex:B.zIndex})}}),M.length>0&&this.updateElementsFn(M)}sendBackward(){const l=this.getSelectedElements();if(0===l.length||!this.getElementsFn||!this.updateElementsFn)return;const g=[...this.getElementsFn()].sort((B,h)=>(B.zIndex||0)-(h.zIndex||0)),M=[];l.forEach(B=>{let w=g.findIndex(W=>W.id===B.id)-1;for(;w>=0&&l.some(W=>W.id===g[w].id);)w--;if(w>=0){const W=g[w];M.push({id:B.id,zIndex:W.zIndex}),M.push({id:W.id,zIndex:B.zIndex})}}),M.length>0&&this.updateElementsFn(M)}sendToBack(){const l=this.getSelectedElements();if(0===l.length||!this.getElementsFn||!this.updateElementsFn)return;const C=l.map((h,w)=>({id:h.id,zIndex:w+1}));this.updateElementsFn(C);const B=this.getElementsFn().filter(h=>!l.some(w=>w.id===h.id)).map((h,w)=>({id:h.id,zIndex:l.length+w+1}));B.length>0&&this.updateElementsFn(B)}groupSelectedElements(){const l=this.getSelectedElements();if(l.length<2||!this.updateElementsFn)return;const C=`group_${Date.now()}`,g=l.map(M=>({id:M.id,groupId:C}));this.updateElementsFn(g)}ungroupSelectedElements(){const l=this.getSelectedElements();if(0===l.length||!this.getElementsFn||!this.updateElementsFn)return;const C=l.filter(w=>null!=w.groupId);if(0===C.length)return;const g=[...new Set(C.map(w=>w.groupId).filter(Boolean))],h=this.getElementsFn().filter(w=>null!=w.groupId&&g.includes(w.groupId)).map(w=>({id:w.id,groupId:void 0}));this.updateElementsFn(h)}lockElements(){const l=this.getSelectedElements();if(0===l.length||!this.updateElementsFn)return;const C=l.map(g=>({id:g.id,locked:!0}));this.updateElementsFn(C)}unlockElements(){const l=this.getSelectedElements();if(0===l.length||!this.updateElementsFn)return;const C=l.map(g=>({id:g.id,locked:!1}));this.updateElementsFn(C)}alignElements(l){const C=this.getSelectedElements();if(0===C.length)return;if(!this.updateElementsFn)return void console.warn("Update elements function not available");const g=this.calculateAlignmentUpdates(C,l);g.length>0&&(this.updateElementsFn(g,!0),this.updateBoundingBox())}distributeHorizontally(){this.alignElements(E.Yu.DistributeHorizontally)}distributeVertically(){this.alignElements(E.Yu.DistributeVertically)}calculateAlignmentUpdates(l,C){if(0===l.length)return[];const g=[],M=l.map(B=>({element:B,bounds:(0,D.P)(B)}));if(1===l.length){const B=this.canvasService.getVisibleBounds(),h=M[0].bounds,w=M[0].element;switch(C){case E.Yu.Left:{const W=B.left-h.minX;0!==W&&g.push({id:w.id,x:w.x+W});break}case E.Yu.Center:{const P=(B.left+B.right)/2-(h.minX+h.width/2);0!==P&&g.push({id:w.id,x:w.x+P});break}case E.Yu.Right:{const W=B.right-h.maxX;0!==W&&g.push({id:w.id,x:w.x+W});break}case E.Yu.Top:{const W=B.top-h.minY;0!==W&&g.push({id:w.id,y:w.y+W});break}case E.Yu.Middle:{const P=(B.top+B.bottom)/2-(h.minY+h.height/2);0!==P&&g.push({id:w.id,y:w.y+P});break}case E.Yu.Bottom:{const W=B.bottom-h.maxY;0!==W&&g.push({id:w.id,y:w.y+W});break}default:return console.warn("Unsupported alignment type for single element:",C),[]}return g}switch(C){case E.Yu.Left:{const B=Math.min(...M.map(h=>h.bounds.minX));M.forEach(({element:h,bounds:w})=>{const W=B-w.minX;0!==W&&g.push({id:h.id,x:h.x+W})});break}case E.Yu.Center:{const B=M.reduce((h,w)=>h+(w.bounds.minX+w.bounds.width/2),0)/M.length;M.forEach(({element:h,bounds:w})=>{const z=B-(w.minX+w.width/2);0!==z&&g.push({id:h.id,x:h.x+z})});break}case E.Yu.Right:{const B=Math.max(...M.map(h=>h.bounds.maxX));M.forEach(({element:h,bounds:w})=>{const W=B-w.maxX;0!==W&&g.push({id:h.id,x:h.x+W})});break}case E.Yu.Top:{const B=Math.min(...M.map(h=>h.bounds.minY));M.forEach(({element:h,bounds:w})=>{const W=B-w.minY;0!==W&&g.push({id:h.id,y:h.y+W})});break}case E.Yu.Middle:{const B=M.reduce((h,w)=>h+(w.bounds.minY+w.bounds.height/2),0)/M.length;M.forEach(({element:h,bounds:w})=>{const z=B-(w.minY+w.height/2);0!==z&&g.push({id:h.id,y:h.y+z})});break}case E.Yu.Bottom:{const B=Math.max(...M.map(h=>h.bounds.maxY));M.forEach(({element:h,bounds:w})=>{const W=B-w.maxY;0!==W&&g.push({id:h.id,y:h.y+W})});break}case E.Yu.DistributeHorizontally:{if(l.length<3)return[];const B=M.sort((k,L)=>k.bounds.minX-L.bounds.minX),h=B[0].bounds.minX,s=(B[B.length-1].bounds.maxX-h-B.reduce((k,L)=>k+L.bounds.width,0))/(B.length-1);let T=h;B.forEach(({element:k,bounds:L},d)=>{if(0===d)T+=L.width;else{if(d===B.length-1)return;{T+=s;const b=T-L.minX;0!==b&&g.push({id:k.id,x:k.x+b}),T+=L.width}}});break}case E.Yu.DistributeVertically:{if(l.length<3)return[];const B=M.sort((k,L)=>k.bounds.minY-L.bounds.minY),h=B[0].bounds.minY,s=(B[B.length-1].bounds.maxY-h-B.reduce((k,L)=>k+L.bounds.height,0))/(B.length-1);let T=h;B.forEach(({element:k,bounds:L},d)=>{if(0===d)T+=L.height;else{if(d===B.length-1)return;{T+=s;const b=T-L.minY;0!==b&&g.push({id:k.id,y:k.y+b}),T+=L.height}}});break}default:return console.warn("Unsupported alignment type:",C),[]}return g}flipHorizontal(){const l=this.getSelectedElements();if(0===l.length||!this.updateElementsFn)return;const C=l.map(g=>({id:g.id,scaleX:-(g.scaleX??1)}));this.updateElementsFn(C,!0),this.updateBoundingBox()}flipVertical(){const l=this.getSelectedElements();if(0===l.length||!this.updateElementsFn)return;const C=l.map(g=>({id:g.id,scaleY:-(g.scaleY??1)}));this.updateElementsFn(C,!0),this.updateBoundingBox()}moveSelectedElements(l,C){const g=this.getSelectedElements();if(0===g.length||!this.updateElementsFn)return;const M=g.map(B=>({id:B.id,x:B.x+l,y:B.y+C}));this.updateElementsFn(M,!0),this.updateBoundingBox()}rotateSelectedElements(l){const C=this.getSelectedElements();if(0===C.length||!this.updateElementsFn)return;const g=C.map(M=>({id:M.id,rotation:(M.rotation||0)+l}));this.updateElementsFn(g,!0),this.updateBoundingBox()}scaleSelectedElements(l){const C=this.getSelectedElements();if(0===C.length||!this.updateElementsFn)return;const g=C.map(M=>{const B={id:M.id};return"width"in M&&void 0!==M.width&&(B.width=M.width*l),"height"in M&&void 0!==M.height&&(B.height=M.height*l),void 0!==M.style?.strokeWidth&&(B.style={...M.style,strokeWidth:M.style.strokeWidth*l}),"rx"in M&&void 0!==M.rx&&(B.rx=M.rx*l),"ry"in M&&void 0!==M.ry&&(B.ry=M.ry*l),B}).filter(M=>Object.keys(M).length>1);g.length>0&&(this.updateElementsFn(g,!0),this.updateBoundingBox())}static{this.\u0275fac=function(C){return new(C||p)(S.KVO(m.W),S.KVO(a.W),S.KVO(u.L),S.KVO(n.H),S.KVO(c.W))}}static{this.\u0275prov=S.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()},8936:($,Z,v)=>{v.d(Z,{W:()=>o});var S=v(4438),e=v(1413),E=v(5964),O=v(6354),D=v(152),i=v(3669),m=v(9974),a=v(4360);function n(p,I){return p===I}var c=v(162);let o=(()=>{class p{constructor(){this.eventSubject=new e.B,this.eventSignals={[c.w.Ready]:(0,S.vPA)(void 0),[c.w.Destroyed]:(0,S.vPA)(void 0),[c.w.DrawStart]:(0,S.vPA)(void 0),[c.w.Drawing]:(0,S.vPA)(void 0),[c.w.DrawEnd]:(0,S.vPA)(void 0),[c.w.ElementsAdded]:(0,S.vPA)(void 0),[c.w.ElementsUpdated]:(0,S.vPA)(void 0),[c.w.ElementsSelected]:(0,S.vPA)(void 0),[c.w.ElementsRemoved]:(0,S.vPA)(void 0),[c.w.ElementDoubleClicked]:(0,S.vPA)(void 0),[c.w.Undo]:(0,S.vPA)(void 0),[c.w.Redo]:(0,S.vPA)(void 0),[c.w.Clear]:(0,S.vPA)(void 0),[c.w.DataChange]:(0,S.vPA)(void 0),[c.w.Save]:(0,S.vPA)(void 0),[c.w.ImageAdded]:(0,S.vPA)(void 0),[c.w.ToolChange]:(0,S.vPA)(void 0),[c.w.ConfigChange]:(0,S.vPA)(void 0),[c.w.ZoomChange]:(0,S.vPA)(void 0)},this.lastEventInternal=(0,S.vPA)(void 0),this.lastEvent=this.lastEventInternal.asReadonly(),this.defaultDebounceConfigs={[c.w.ElementsAdded]:{debounceTime:100,distinctUntilChanged:!0},[c.w.Drawing]:{debounceTime:16,distinctUntilChanged:!1}}}ngOnDestroy(){this.destroy()}emit(l,C){const g={type:l,payload:C,timestamp:Date.now()};this.eventSubject.next(g),(0,S.O8t)(()=>{this.eventSignals[l].set(g.payload),this.lastEventInternal.set(g)})}listen(){return this.eventSubject.asObservable()}getEventSignal(l){return this.eventSignals[l].asReadonly()}getAllEventsSignal(){return this.lastEvent}on(l,C){let g=this.eventSubject.pipe((0,E.p)(B=>B.type===l),(0,O.T)(B=>B.payload));const M=C||this.defaultDebounceConfigs[l];return M?(M.debounceTime>0&&(g=g.pipe((0,D.B)(M.debounceTime))),M.distinctUntilChanged&&(g=g.pipe(function u(p,I=i.D){return p=p??n,(0,m.N)((l,C)=>{let g,M=!0;l.subscribe((0,a._)(C,B=>{const h=I(B);(M||!p(g,h))&&(M=!1,g=h,C.next(B))}))})}(M.comparator))),g):g}listenToMultiple(l){return this.eventSubject.pipe((0,E.p)(C=>l.includes(C.type)),(0,O.T)(C=>({type:C.type,payload:C.payload,timestamp:C.timestamp})))}destroy(){this.eventSubject.complete()}static{this.\u0275fac=function(C){return new(C||p)}}static{this.\u0275prov=S.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})()},875:($,Z,v)=>{v.d(Z,{k:()=>e});var S=v(4438);let e=(()=>{class E{constructor(){this.undoStack=[],this.redoStack=[],this.MAX_HISTORY=50,this.canUndoSignal=(0,S.vPA)(!1),this.canRedoSignal=(0,S.vPA)(!1),this.undoDescriptionSignal=(0,S.vPA)(void 0),this.redoDescriptionSignal=(0,S.vPA)(void 0),this.batching=!1,this.batchDepth=0,this.batchBeforeSnapshot=null,this.batchDescription="Batch operation",this.pendingBatchAfter=null}getCanUndoSignal(){return this.canUndoSignal.asReadonly()}getCanRedoSignal(){return this.canRedoSignal.asReadonly()}getUndoDescriptionSignal(){return this.undoDescriptionSignal.asReadonly()}getRedoDescriptionSignal(){return this.redoDescriptionSignal.asReadonly()}recordChange(D,i,m){this.batching||this.snapshotsEqual(D,i)||this.pushHistory({before:this.cloneElements(D),after:this.cloneElements(i),description:m,timestamp:Date.now()})}recordElementCreation(D,i){this.recordChange(D,i,"Create element")}recordElementUpdate(D,i){this.recordChange(D,i,"Update element")}recordElementDeletion(D,i){this.recordChange(D,i,"Delete element")}recordClear(D,i){this.recordChange(D,i,"Clear whiteboard")}startBatch(D,i){return 0===this.batchDepth&&(this.batchBeforeSnapshot=this.cloneElements(i),this.batchDescription=D,this.batching=!0),this.batchDepth++,{execute:()=>this.finishBatchCommit(),clear:()=>this.cancelBatch()}}completeBatch(D){this.batching&&(this.pendingBatchAfter=this.cloneElements(D))}finishBatchCommit(){if(this.batchDepth=Math.max(0,this.batchDepth-1),this.batchDepth>0)return;if(!this.batching||!this.batchBeforeSnapshot)return void this.resetBatchState();const D=this.pendingBatchAfter??this.batchBeforeSnapshot;this.snapshotsEqual(this.batchBeforeSnapshot,D)||this.pushHistory({before:this.batchBeforeSnapshot,after:D,description:this.batchDescription,timestamp:Date.now()}),this.resetBatchState()}cancelBatch(){this.batchDepth=0,this.resetBatchState()}resetBatchState(){this.batching=!1,this.batchBeforeSnapshot=null,this.batchDescription="Batch operation"}undo(){return this.performUndo()}redo(){return this.performRedo()}clearHistory(){this.undoStack=[],this.redoStack=[],this.updateSignals()}performUndo(){if(0===this.undoStack.length)return null;const D=this.undoStack.pop();return D?(this.redoStack.push(D),this.updateSignals(),this.cloneElements(D.before)):null}performRedo(){if(0===this.redoStack.length)return null;const D=this.redoStack.pop();return D?(this.undoStack.push(D),this.updateSignals(),this.cloneElements(D.after)):null}pushHistory(D){this.undoStack.push(D),this.undoStack.length>this.MAX_HISTORY&&this.undoStack.shift(),this.redoStack=[],this.updateSignals()}updateSignals(){this.canUndoSignal.set(this.undoStack.length>0),this.canRedoSignal.set(this.redoStack.length>0),this.undoDescriptionSignal.set(this.undoStack[this.undoStack.length-1]?.description),this.redoDescriptionSignal.set(this.redoStack[this.redoStack.length-1]?.description)}cloneElements(D){return D.map(i=>{const m={...i},a=i.points;return Array.isArray(a)&&(m.points=a.map(u=>[...u])),m})}snapshotsEqual(D,i){if(D.length!==i.length)return!1;const m=new Map(D.map(a=>[a.id,a]));for(const a of i){const u=m.get(a.id);if(!u||JSON.stringify(u)!==JSON.stringify(a))return!1}return!0}static{this.\u0275fac=function(i){return new(i||E)}}static{this.\u0275prov=S.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()},3909:($,Z,v)=>{v.d(Z,{W:()=>E});var S=v(4438),e=v(6255);let E=(()=>{class O{constructor(i){this.elementsService=i,this.CLIPBOARD_KEY="whiteboard-clipboard",this.OFFSET_INCREMENT=20}copy(i){if(0===i.length)return;const m={elements:i,timestamp:Date.now()};try{localStorage.setItem(this.CLIPBOARD_KEY,JSON.stringify(m))}catch(a){console.error("Failed to copy elements to clipboard:",a)}}cut(i){this.copy(i)}paste(){const i=this.getData();if(!i?.elements.length)return[];const m=this.duplicateElementsWithOffset(i.elements,this.OFFSET_INCREMENT,this.OFFSET_INCREMENT);return this.elementsService.addElements(m),m}clear(){try{localStorage.removeItem(this.CLIPBOARD_KEY)}catch(i){console.error("Failed to clear clipboard:",i)}}hasData(){const i=this.getData();return null!==i&&i.elements.length>0}getData(){try{const i=localStorage.getItem(this.CLIPBOARD_KEY);return i?JSON.parse(i):null}catch(i){return console.error("Failed to read clipboard data:",i),null}}duplicateElements(i,m=this.OFFSET_INCREMENT,a=this.OFFSET_INCREMENT){if(0===i.length)return[];const u=this.duplicateElementsWithOffset(i,m,a);return this.elementsService.addElements(u),u}createDuplicates(i,m=this.OFFSET_INCREMENT,a=this.OFFSET_INCREMENT){return this.duplicateElementsWithOffset(i,m,a)}getClipboardInfo(){const i=this.getData();return i?{elementCount:i.elements.length,timestamp:i.timestamp}:null}isDataFresh(i=3e5){const m=this.getData();return!!m&&Date.now()-m.timestamp<=i}getClipboardElementTypes(){const i=this.getData();if(!i)return[];const m=i.elements.map(a=>a.type);return[...new Set(m)]}duplicateElementsWithOffset(i,m,a){return i.map(u=>({...u,id:`${u.id}_copy_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x:u.x+m,y:u.y+a}))}static{this.\u0275fac=function(m){return new(m||O)(S.KVO(e.L))}}static{this.\u0275prov=S.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()},1389:($,Z,v)=>{v.d(Z,{q:()=>h});var S=v(4523),e=v(2173),E=v(2262),O=v(6078),D=v(162),n=v(7879),c=v(4438),o=v(6255),p=v(525),I=v(4764),l=v(710),C=v(8936),g=v(1152),M=v(3437),B=v(7785);let h=(()=>{class w{constructor(z,P,s,T,k,L,d,b){this.elementsService=z,this.canvasService=P,this.zoomService=s,this.panService=T,this.eventBusService=k,this.selectionService=L,this.layerManagementService=d,this.configService=b}addImage(z){const P=new Image;P.onload=()=>{const{canvasHeight:s}=this.canvasService.getConfig(),k=P.height,d=k>s?s-40:k;let x=z.x||0,A=z.y||0;x<0&&(x=0),A<0&&(A=0);const N=(0,e.n)(E.R.Image,{src:z.image,width:d===s-40?P.width/P.height*(s-40):P.width,height:d,x,y:A,zIndex:this.elementsService.getNextZIndex()});this.elementsService.addElements([N]),N.selectAfterDraw&&this.selectionService.selectElements([N.id]),this.eventBusService.emit(D.w.ImageAdded,N.src)},P.onerror=()=>{console.error("Failed to load image")},P.src=z.image}importImageFile(z,P,s){return new Promise((T,k)=>{if(!z.type.startsWith(n.Vu.IMAGE))return void k(new Error("Invalid file type. Only images are supported."));const L=new FileReader;L.onload=d=>{const b=d.target?.result;b?(this.addImage({image:b,x:P,y:s}),T()):k(new Error("Failed to read file"))},L.onerror=()=>{k(new Error("Failed to read file"))},L.readAsDataURL(z)})}importImageFromUrl(z,P,s){var T=this;return(0,S.A)(function*(){try{const L=yield(yield fetch(z)).blob();return new Promise((d,b)=>{const x=new FileReader;x.onload=A=>{const N=A.target?.result;N?(T.addImage({image:N,x:P,y:s}),d()):b(new Error("Failed to process URL"))},x.onerror=()=>{b(new Error("Failed to process URL"))},x.readAsDataURL(L)})}catch(k){throw new Error(`Failed to load image from URL: ${k}`)}})()}save(z=O.o8.Base64,P="New board"){var s=this;return(0,S.A)(function*(){const k=s.canvasService.getCanvas().getElementById("svgcontent");if(!k)throw new Error("SVG content not found");const L=s.prepareSvgForExport(k),d=(new XMLSerializer).serializeToString(L),{canvasWidth:b,canvasHeight:x}=s.canvasService.getConfig();try{const A=yield function u(w,W,z,P=O.o8.Png){return new Promise((s,T)=>{const k=document.createElement("canvas");k.width=W,k.height=z;const L=k.getContext("2d"),d=new Image,b=encodeURIComponent(w);d.src=`data:image/svg+xml;charset=utf-8,${b}`,d.onload=()=>{L.drawImage(d,0,0,W,z);const x=k.toDataURL(`image/${P}`);s(x)},d.onerror=x=>{T(x)}})}(d,b,x,z);switch(z){case O.o8.Base64:s.eventBusService.emit(D.w.Save,A);break;case O.o8.Svg:{const N="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(d)));s.downloadFile(N,P,"svg"),s.eventBusService.emit(D.w.Save,N);break}default:s.downloadFile(A,P,s.getFileExtension(z)),s.eventBusService.emit(D.w.Save,A)}return A}catch(A){throw console.error("Failed to save whiteboard:",A),A}})()}exportAsPng(z="whiteboard"){var P=this;return(0,S.A)(function*(){return P.save(O.o8.Png,z)})()}exportAsJpeg(z="whiteboard"){var P=this;return(0,S.A)(function*(){return P.save(O.o8.Jpeg,z)})()}exportAsSvg(z="whiteboard"){var P=this;return(0,S.A)(function*(){return P.save(O.o8.Svg,z)})()}exportAsBase64(){var z=this;return(0,S.A)(function*(){return z.save(O.o8.Base64)})()}exportData(){const z=this.elementsService.getElements(),P=this.canvasService.getConfig(),s=this.layerManagementService.exportLayerState(),T=this.configService.getEditorConfig(),k={version:"1.0",timestamp:(new Date).toISOString(),elements:z,layers:s,canvas:{width:P.canvasWidth,height:P.canvasHeight,backgroundColor:P.backgroundColor,fullScreen:P.fullScreen,center:P.center},viewport:{zoom:P.zoom,x:P.x,y:P.y,canvasX:P.canvasX,canvasY:P.canvasY},drawing:{strokeColor:P.strokeColor,strokeWidth:P.strokeWidth,fill:P.fill,lineJoin:P.lineJoin,lineCap:P.lineCap,dasharray:P.dasharray,dashoffset:P.dashoffset,penType:P.penType},grid:{enabled:P.enableGrid,size:P.gridSize,snapToGrid:P.snapToGrid},text:{fontFamily:P.fontFamily,fontSize:P.fontSize},editor:T,settings:{drawingEnabled:P.drawingEnabled,keyboardShortcutsEnabled:P.keyboardShortcutsEnabled}};return JSON.stringify(k,null,2)}exportDataAsFile(z="whiteboard-export"){const P=this.exportData(),s="data:application/json;charset=utf-8,"+encodeURIComponent(P);this.downloadFile(s,z,"json"),this.eventBusService.emit(D.w.Save,P)}importData(z){try{const P=JSON.parse(z);if(!P.elements||!Array.isArray(P.elements))throw new Error("Invalid data format: elements array not found");if(this.elementsService.clear(),P.layers&&this.layerManagementService.importLayerState(P.layers),this.elementsService.setElements(P.elements),P.canvas){const{canvas:s}=P;s.width&&s.height&&this.canvasService.setCanvasDimensions(s.width,s.height),void 0!==s.backgroundColor&&this.configService.updateConfig({backgroundColor:s.backgroundColor},!1),void 0!==s.fullScreen&&this.configService.updateConfig({fullScreen:s.fullScreen},!1),void 0!==s.center&&this.configService.updateConfig({center:s.center},!1)}if(P.viewport){const{viewport:s}=P;void 0!==s.zoom&&this.zoomService.zoom(s.zoom),void 0!==s.x&&void 0!==s.y&&this.panService.panTo(s.x,s.y),void 0!==s.canvasX&&void 0!==s.canvasY&&this.configService.updateConfig({canvasX:s.canvasX,canvasY:s.canvasY},!1)}if(P.drawing){const{drawing:s}=P,T={};void 0!==s.strokeColor&&(T.strokeColor=s.strokeColor),void 0!==s.strokeWidth&&(T.strokeWidth=s.strokeWidth),void 0!==s.fill&&(T.fill=s.fill),void 0!==s.lineJoin&&(T.lineJoin=s.lineJoin),void 0!==s.lineCap&&(T.lineCap=s.lineCap),void 0!==s.dasharray&&(T.dasharray=s.dasharray),void 0!==s.dashoffset&&(T.dashoffset=s.dashoffset),void 0!==s.penType&&(T.penType=s.penType),this.configService.updateConfig(T,!1)}if(P.grid){const{grid:s}=P,T={};void 0!==s.enabled&&(T.enableGrid=s.enabled),void 0!==s.size&&(T.gridSize=s.size),void 0!==s.snapToGrid&&(T.snapToGrid=s.snapToGrid),this.configService.updateConfig(T,!1)}if(P.text){const{text:s}=P,T={};void 0!==s.fontFamily&&(T.fontFamily=s.fontFamily),void 0!==s.fontSize&&(T.fontSize=s.fontSize),this.configService.updateConfig(T,!1)}if(P.editor&&Object.keys(P.editor).forEach(T=>{this.configService.updateEditorConfigValue(T,P.editor[T])}),P.settings){const{settings:s}=P,T={};void 0!==s.drawingEnabled&&(T.drawingEnabled=s.drawingEnabled),void 0!==s.keyboardShortcutsEnabled&&(T.keyboardShortcutsEnabled=s.keyboardShortcutsEnabled),this.configService.updateConfig(T,!1)}this.configService.updateConfig({},!0),this.eventBusService.emit(D.w.ElementsAdded,P.elements)}catch(P){throw console.error("Failed to import data:",P),new Error(`Failed to import data: ${P}`)}}importDataFromFile(z){return new Promise((P,s)=>{if(!z.type.includes("json"))return void s(new Error("Invalid file type. Only JSON files are supported."));const T=new FileReader;T.onload=k=>{const L=k.target?.result;if(L&&"string"==typeof L)try{this.importData(L),P()}catch(d){s(d)}else s(new Error("Failed to read file"))},T.onerror=()=>{s(new Error("Failed to read file"))},T.readAsText(z)})}downloadFile(z,P,s){!function i(w,W){const z=document.createElement("a");z.href=w,z.setAttribute("visibility","hidden"),z.download=W||"new white-board",document.body.appendChild(z),z.click(),document.body.removeChild(z)}(z,`${P}.${s}`)}getFileExtension(z){switch(z){case O.o8.Png:return"png";case O.o8.Jpeg:return"jpg";case O.o8.Svg:return"svg";case O.o8.Base64:return"txt";default:return"png"}}prepareSvgForExport(z){const P=z.cloneNode(!0),s=P.querySelector("#selectorParentGroup");s&&s.remove();const T=P.querySelector("#contentBackground");return T&&T.removeAttribute("opacity"),P.setAttribute("x","0"),P.setAttribute("y","0"),P}importMultipleImages(z,P=50){var s=this;return(0,S.A)(function*(){const T=[];let k=0,L=0;for(let d=0;d<z.length;d++)T.push(s.importImageFile(z[d],k,L)),k+=200+P,k>800&&(k=0,L+=200+P);yield Promise.all(T)})()}processImage(z){return z}static{this.\u0275fac=function(P){return new(P||w)(c.KVO(o.L),c.KVO(p.W),c.KVO(I.T),c.KVO(l.l),c.KVO(C.W),c.KVO(g.A),c.KVO(M.a),c.KVO(B.w))}}static{this.\u0275prov=c.jDH({token:w,factory:w.\u0275fac,providedIn:"root"})}}return w})()},3452:($,Z,v)=>{v.d(Z,{r:()=>k});var S=v(2173),e=v(872),E=v(2262),O=v(6212),D=v(6084);class i{constructor(d){this.apiService=d,this.active=!1,this.baseCursor=D.x.Default}get whiteboardConfig(){return this.apiService?.getConfig()}getPointerPosition({x:d,y:b}){return(0,O.y1)(this.apiService.getConfig(),{x:d,y:b})}activate(){this.active=!0,this.onActivate?.()}deactivate(){this.active=!1,this.onDeactivate?.()}setCursor(d){this.apiService.setCursor(d)}resetCursor(){this.apiService.resetCursor()}get isActive(){return this.active}}class m extends i{constructor(){super(...arguments),this.type=e.p.Arrow,this.baseCursor=D.x.Crosshair,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(d){if(!this.active)return;const b=this.getPointerPosition(d);let{x,y:A}=b;const{snapToGrid:N}=this.whiteboardConfig;if(N){const{gridSize:H}=this.whiteboardConfig;x=(0,O.Ej)(x,H),A=(0,O.Ej)(A,H)}this.startPoint={x,y:A},this.lastX=x,this.lastY=A,this.element=(0,S.n)(E.R.Arrow,{x1:x,y1:A,x2:x,y2:A,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element)return;const b=this.getPointerPosition(d);let x=b.x,A=b.y;const{snapToGrid:N}=this.whiteboardConfig;if(N){const{gridSize:H}=this.whiteboardConfig;x=(0,O.Ej)(x,H),A=(0,O.Ej)(A,H)}if(d.shiftKey){const H=this.element.x1,Y=this.element.y1,{x:U,y:j}=(0,O.Jt)(H,Y,x,A);x=U,A=j}(Math.abs(x-this.lastX)>this.MIN_LENGTH||Math.abs(A-this.lastY)>this.MIN_LENGTH)&&(this.apiService.updateDraftElements([{id:this.element.id,x2:x,y2:A}]),this.lastX=x,this.lastY=A)}handlePointerUp(){if(this.active){if(this.element&&this.startPoint){const d=this.element;this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.startPoint=null,this.element=null}this.lastX=0,this.lastY=0}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class a extends i{constructor(){super(...arguments),this.type=e.p.Ellipse,this.baseCursor=D.x.Crosshair,this.element=null,this.startPoint=null}handlePointerDown(d){if(!this.active)return;let{x:b,y:x}=this.getPointerPosition(d);const{snapToGrid:A}=this.whiteboardConfig;if(A){const{gridSize:N}=this.whiteboardConfig;b=(0,O.Ej)(b,N),x=(0,O.Ej)(x,N)}this.startPoint={x:b,y:x},this.element=(0,S.n)(E.R.Ellipse,{cx:b,cy:x,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element||!this.startPoint)return;const{x:b,y:x}=this.getPointerPosition(d),{x:A,y:N}=this.startPoint;let H,Y,U,j;d.altKey?(H=A,Y=N,U=Math.abs(b-H),j=d.shiftKey?U:Math.abs(x-Y)):(H=(A+b)/2,Y=(N+x)/2,U=Math.abs(A-b)/2,j=d.shiftKey?U:Math.abs(N-x)/2,d.shiftKey&&(Y=x>N?N+U:N-U)),this.apiService.updateDraftElements([{id:this.element.id,rx:U,ry:j,cx:H,cy:Y}])}handlePointerUp(){if(this.active&&this.element&&this.startPoint){const d=this.element;this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.startPoint=null,this.element=null}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var u=v(2319);class n extends i{constructor(){super(...arguments),this.type=e.p.Eraser,this.baseCursor=D.x.Eraser,this.isErasing=!1,this.hoveredElementIds=new Set,this.lastPosition=null}handlePointerDown(d){if(!this.active)return;this.hoveredElementIds.clear();const b=this.getPointerPosition(d);this.isErasing=!0,this.eraseElementsAt(b,b),this.lastPosition=b}handlePointerMove(d){if(!this.active||!this.isErasing||!this.lastPosition)return;const b=this.getPointerPosition(d);this.eraseElementsAt(this.lastPosition,b,d.altKey),this.lastPosition=b}handlePointerUp(){if(this.active){if(this.hoveredElementIds.size>0){const d=Array.from(this.hoveredElementIds),b=this.expandToIncludeGroups(d),x=this.apiService.getElements().filter(A=>b.includes(A.id));x.forEach(A=>{A.isDeleting=!1}),this.apiService.updateElements(x),this.apiService.removeElements(x)}this.hoveredElementIds.clear(),this.isErasing=!1,this.lastPosition=null}}eraseElementsAt(d,b,x=!1){const A=this.apiService.getElements(),N=this.apiService.getConfig()?.zoom||1,H=Math.hypot(b.x-d.x,b.y-d.y),j=10/N+H*(.5*Math.log2(H+1));for(const Q of A){const q=(0,S.lE)(Q.type).getBounds(Q);if((0,u.DB)(q,d,b,j)&&this.isPointInElement(Q,d,b,j)){x&&this.expandToIncludeGroups([Q.id]).forEach(he=>{this.hoveredElementIds.delete(he);const re=A.find(de=>de.id===he);re&&(re.isDeleting=!1)}),!x&&!this.hoveredElementIds.has(Q.id)&&this.expandToIncludeGroups([Q.id]).forEach(he=>{this.hoveredElementIds.add(he);const re=A.find(de=>de.id===he);re&&(re.isDeleting=!0)});const le=this.expandToIncludeGroups([Q.id]),V=A.filter(ee=>le.includes(ee.id));this.apiService.updateElements(V)}}}isPointInElement(d,b,x,A){return(0,S.lE)(d.type).hitTest(d,b,x,A)}expandToIncludeGroups(d){const b=this.apiService.getElements(),x=b.filter(H=>d.includes(H.id)),A=new Set(x.map(H=>H.groupId).filter(H=>null!=H));return 0===A.size?d:b.filter(H=>d.includes(H.id)||H.groupId&&A.has(H.groupId)).map(H=>H.id)}}class c extends i{constructor(){super(...arguments),this.type=e.p.Hand,this.baseCursor=D.x.Grab,this.isDragging=!1,this.startX=0,this.startY=0}handlePointerDown(d){this.isDragging=!0,this.startX=d.clientX,this.startY=d.clientY,this.setCursor(D.x.Grabbing)}handlePointerMove(d){if(!this.isDragging)return;const{zoom:b}=this.whiteboardConfig;this.apiService.pan((d.clientX-this.startX)/b,(d.clientY-this.startY)/b),this.startX=d.clientX,this.startY=d.clientY}handlePointerUp(){this.isDragging=!1,this.resetCursor()}}class o extends i{constructor(){super(...arguments),this.type=e.p.Image,this.baseCursor=D.x.Image}handlePointerDown(d){const{x:b,y:x}=this.getPointerPosition(d),A=document.createElement("input");A.type="file",A.accept="image/*",A.onchange=N=>{const H=N.target.files;if(H){const Y=new FileReader;Y.onload=U=>{this.apiService.addImage({image:U.target.result,x:b,y:x})},Y.readAsDataURL(H[0])}},A.click()}}class p extends i{constructor(){super(...arguments),this.type=e.p.Line,this.baseCursor=D.x.Crosshair,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(d){if(!this.active)return;let{x:b,y:x}=this.getPointerPosition(d);const{snapToGrid:A}=this.whiteboardConfig;if(A){const{gridSize:N}=this.whiteboardConfig;b=(0,O.Ej)(b,N),x=(0,O.Ej)(x,N)}this.startPoint={x:b,y:x},this.lastX=b,this.lastY=x,this.element=(0,S.n)(E.R.Line,{x1:b,y1:x,x2:b,y2:x,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element)return;const b=this.getPointerPosition(d);let x=b.x,A=b.y;const{snapToGrid:N}=this.whiteboardConfig;if(N){const{gridSize:H}=this.whiteboardConfig;x=(0,O.Ej)(x,H),A=(0,O.Ej)(A,H)}if(d.shiftKey){const H=this.element.x1,Y=this.element.y1,{x:U,y:j}=(0,O.Jt)(H,Y,x,A);[x,A]=[U,j]}(Math.abs(x-this.lastX)>this.MIN_LENGTH||Math.abs(A-this.lastY)>this.MIN_LENGTH)&&(this.apiService.updateDraftElements([{id:this.element.id,x2:x,y2:A}]),this.lastX=x,this.lastY=A)}handlePointerUp(){if(this.active){if(this.element&&this.startPoint){const d=this.element;this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.startPoint=null,this.element=null}this.lastX=0,this.lastY=0}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var I=v(3265);class l extends i{constructor(d){super(d),this.type=e.p.Pen,this.baseCursor=D.x.Crosshair,this.element=null}getCurrentPathOptions(){const x=(0,I.Nn)(this.whiteboardConfig.penType,I.Of.Medium).strokeOptions;return{smoothing:x.smoothing||.5,streamline:x.streamline||.5,thinning:x.thinning||.5,simulatePressure:void 0===x.simulatePressure||x.simulatePressure,size:x.size||16,easing:x.easing||(A=>A<.5?2*A*A:1-Math.pow(-2*A+2,2)/2),start:x.start||{cap:!0,taper:.3},end:x.end||{cap:!0,taper:.4}}}handlePointerDown(d){if(!this.active)return;const b=this.getPointerPosition(d),x=this.getCurrentPathOptions();this.element=(0,S.n)(E.R.Pen,{points:[[b.x,b.y]],pathOptions:x,isComplete:!1,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element)return;const{x:b,y:x}=this.getPointerPosition(d),A=[...this.element.points,[b,x]];this.element.points=A,this.apiService.updateDraftElements([{id:this.element.id,points:A}])}handlePointerUp(){if(this.active&&this.element){const d=this.element;this.apiService.updateDraftElements([{id:d.id,isComplete:!0}]),this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.element=null}}getElementStyle(){const b=(0,I.Nn)(this.whiteboardConfig.penType,I.Of.Medium);return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,lineJoin:this.whiteboardConfig.lineJoin,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,opacity:b.opacity}}}class C extends i{constructor(){super(...arguments),this.type=e.p.Rectangle,this.baseCursor=D.x.Crosshair,this.element=null,this.startPoint=null}handlePointerDown(d){if(!this.active)return;let{x:b,y:x}=this.getPointerPosition(d);const{snapToGrid:A}=this.whiteboardConfig;if(A){const{gridSize:N}=this.whiteboardConfig;b=(0,O.Ej)(b,N),x=(0,O.Ej)(x,N)}this.startPoint={x:b,y:x},this.element=(0,S.n)(E.R.Rectangle,{x:b,y:x,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element||!this.startPoint)return;const{x:b,y:x}=this.getPointerPosition(d),A=this.startPoint.x,N=this.startPoint.y;let H=Math.abs(b-A),Y=Math.abs(x-N),U=null,j=null;d.shiftKey?(H=Y=Math.max(H,Y),U=A<b?A:A-H,j=N<x?N:N-Y):(U=Math.min(A,b),j=Math.min(N,x)),d.altKey&&(H*=2,Y*=2,U=A-H/2,j=N-Y/2);const{snapToGrid:Q}=this.whiteboardConfig;if(Q){const{gridSize:q}=this.whiteboardConfig;H=(0,O.Ej)(H,q),Y=(0,O.Ej)(Y,q),U=(0,O.Ej)(U,q),j=(0,O.Ej)(j,q)}this.apiService.updateDraftElements([{id:this.element.id,width:H,height:Y,x:U,y:j}])}handlePointerUp(){if(this.active&&this.element&&this.startPoint){const d=this.element;this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.startPoint=null,this.element=null}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineJoin:this.whiteboardConfig.lineJoin,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var g=v(7879),M=v(6078),B=v(6751),h=v(6042),w=v(2500),W=v(9820),z=function(L){return L[L.None=0]="None",L[L.Select=1]="Select",L[L.Move=2]="Move",L[L.Resize=3]="Resize",L[L.Rotate=4]="Rotate",L[L.BoxSelect=5]="BoxSelect",L}(z||{});class P extends i{constructor(){super(...arguments),this.type=e.p.Select,this.baseCursor=D.x.Default,this.currentAction=z.None,this.startPoint=null,this.currentHandle=null,this.rotateStartAngle=null,this.selectionCenter=null,this.initialBoundingBox=null,this.initialElementRotations=new Map,this.initialElementStates=new Map,this.rafId=null,this.pendingPointerEvent=null}getCurrentAction(){return this.currentAction}getStartPoint(){return this.startPoint}getCurrentHandle(){return this.currentHandle}onDeactivate(){this.apiService.clearSelection()}handlePointerDown(d){const b=(0,B.r)(d),x=b?.id??"";if(this.startPoint=this.getPointerPosition(d),x.includes(g.RZ)){const A=b?.getAttribute(g.Bn)??null;this.handleElementSelect(A,d.shiftKey),this.currentAction=z.Move}else x.includes(g.Sb)?(this.currentHandle=this.getResizeDirection(x),this.initializeResize(),this.currentAction=z.Resize):x.includes(g.Be)?(this.initializeRotation(d),this.currentAction=z.Rotate):x.includes(g.i$)?this.currentAction=z.Move:(this.initializeBoxSelect(d),this.currentAction=z.BoxSelect)}handlePointerMove(d){this.pendingPointerEvent=d,null===this.rafId&&(this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.pendingPointerEvent||!this.startPoint)return;const b=this.pendingPointerEvent,x=this.getPointerPosition(b);switch(this.currentAction){case z.Move:this.handleMove(x,b.shiftKey);break;case z.Resize:this.handleResize(x,b.shiftKey);break;case z.Rotate:this.handleRotate(x,b.ctrlKey);break;case z.BoxSelect:this.handleBoxSelect(x,b.shiftKey)}}))}handlePointerUp(){null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pendingPointerEvent=null,this.currentAction===z.BoxSelect&&this.apiService.clearSelectionBox(),this.currentAction===z.Rotate&&(this.initialElementRotations.clear(),this.apiService.updateBoundingBox()),this.initialElementStates.clear(),this.currentAction=z.None,this.startPoint=null,this.currentHandle=null,this.rotateStartAngle=null,this.selectionCenter=null,this.initialBoundingBox=null}handleElementSelect(d,b){if(!d)return;const x=this.apiService.getElementById(d);x&&(x.locked||(b?this.apiService.toggleSelection(x):this.apiService.selectElements([x])))}handleMove(d,b){if(!this.startPoint)return;const x=d.x-this.startPoint.x,A=d.y-this.startPoint.y;let N=x,H=A;if(b){const Y=(0,h.ZN)(x,A);N=Y.x,H=Y.y}this.apiService.transformSelectedElements(Y=>Y.map(U=>U.locked?U:{...U,x:U.x+N,y:U.y+H})),this.startPoint=d}handleResize(d,b){if(!this.startPoint||null===this.currentHandle||!this.initialBoundingBox)return;const x=this.currentHandle,A=this.apiService.getSelectedElements();if(!A.length)return;if(1===A.length){const re=A[0];if(!this.initialElementStates.get(re.id))return;const se=d.x-this.startPoint.x,ye=d.y-this.startPoint.y;let Ie=se,Ce=ye;if(re.rotation&&0!==re.rotation){const ue=-re.rotation*Math.PI/180,oe=Math.cos(ue),ie=Math.sin(ue);Ie=se*oe-ye*ie,Ce=se*ie+ye*oe}let Pe=Ie,De=Ce;if(b){const ue=(0,h.ZN)(Ie,Ce);Pe=ue.x,De=ue.y}return void this.apiService.transformSelectedElements(ue=>ue.map(oe=>{if(oe.locked)return oe;const ie=this.initialElementStates.get(oe.id);if(!ie)return oe;let _e=null;if(ie.rotation&&0!==ie.rotation){const Ee=ie.width||2*ie.rx||0,we=ie.height||2*ie.ry||0;let ge=0,fe=0;fe=x.includes(M.OP.N)?we:x.includes(M.OP.S)?0:we/2,ge=x.includes(M.OP.W)?Ee:x.includes(M.OP.E)?0:Ee/2;const Te=ie.rotation*Math.PI/180,Me=Math.cos(Te),be=Math.sin(Te);_e={x:ie.x+(ge*Me-fe*be),y:ie.y+(ge*be+fe*Me)}}const Se=(0,S.lE)(ie.type).resize({...ie},x,Pe,De);if(ie.rotation&&0!==ie.rotation&&_e){const Ee=Se.width||2*Se.rx||0,we=Se.height||2*Se.ry||0;let ge=0,fe=0;fe=x.includes(M.OP.N)?we:x.includes(M.OP.S)?0:we/2,ge=x.includes(M.OP.W)?Ee:x.includes(M.OP.E)?0:Ee/2;const Me=(Se.rotation??0)*Math.PI/180,be=Math.cos(Me),Ae=Math.sin(Me),Be={x:Se.x+(ge*be-fe*Ae),y:Se.y+(ge*Ae+fe*be)};Se.x+=_e.x-Be.x,Se.y+=_e.y-Be.y}return Se}))}const N=this.initialBoundingBox,H=d.x-this.startPoint.x,Y=d.y-this.startPoint.y;let U,j,Q,q;switch(x){case M.OP.N:U=N.x,j=N.y+N.height,Q=N.width,q=N.height-Y;break;case M.OP.S:U=N.x,j=N.y,Q=N.width,q=N.height+Y;break;case M.OP.E:U=N.x,j=N.y,Q=N.width+H,q=N.height;break;case M.OP.W:U=N.x+N.width,j=N.y,Q=N.width-H,q=N.height;break;case M.OP.NE:U=N.x,j=N.y+N.height,Q=N.width+H,q=N.height-Y;break;case M.OP.NW:U=N.x+N.width,j=N.y+N.height,Q=N.width-H,q=N.height-Y;break;case M.OP.SE:U=N.x,j=N.y,Q=N.width+H,q=N.height+Y;break;case M.OP.SW:U=N.x+N.width,j=N.y,Q=N.width-H,q=N.height+Y;break;default:return}if(Q<=0||q<=0)return;const le=Q/N.width,V=q/N.height;let ee=le,he=V;if(b){const re=Math.min(Math.abs(le),Math.abs(V))*Math.sign(le)*Math.sign(V);ee=re,he=re}this.apiService.transformSelectedElements(re=>re.map(de=>{if(de.locked)return de;const se=this.initialElementStates.get(de.id);if(!se)return de;const De=U+(se.x-U)*ee,ue=j+(se.y-j)*he,oe={...de,x:De,y:ue};if("width"in se&&void 0!==se.width&&(oe.width=se.width*Math.abs(ee)),"height"in se&&void 0!==se.height&&(oe.height=se.height*Math.abs(he)),se.style?.strokeWidth){const ie=(Math.abs(ee)+Math.abs(he))/2;oe.style={...de.style,strokeWidth:se.style.strokeWidth*ie}}return oe.rotation=se.rotation,oe}))}handleRotate(d,b){if(!this.startPoint||!this.selectionCenter||null===this.rotateStartAngle)return;const x=this.apiService.getSelectedElements();if(0===x.length)return;let N=(0,h.Qu)(this.selectionCenter,d)-this.rotateStartAngle;if(N>180&&(N-=360),N<-180&&(N+=360),b&&(N=15*Math.round(N/15)),x.length>1){const H=this.selectionCenter;this.apiService.transformSelectedElements(Y=>Y.map(U=>{if(U.locked)return U;const j=this.initialElementStates.get(U.id);if(!j)return U;const Q=this.initialElementRotations.get(U.id)??j.rotation??0,le=(0,S.lE)(j.type).getBounds(j),V={x:(le.minX+le.maxX)/2,y:(le.minY+le.maxY)/2},ee=(0,w.U)(V,H,N),de=ee.x-(V.x-j.x),se=ee.y-(V.y-j.y),ye=(0,h.n0)(Q+N);return{...U,x:de,y:se,rotation:ye}}))}else{const H=x[0];let U=(this.initialElementRotations.get(H.id)??H.rotation??0)+N;U=(0,h.n0)(U),this.apiService.transformSelectedElements(j=>j.map(Q=>Q.locked?Q:{...Q,rotation:U}))}}handleBoxSelect(d,b){if(!this.startPoint)return;const x={x:Math.min(this.startPoint.x,d.x),y:Math.min(this.startPoint.y,d.y),width:Math.abs(d.x-this.startPoint.x),height:Math.abs(d.y-this.startPoint.y),visible:!0};this.apiService.setSelectionBox(x);const N=this.apiService.getElements().filter(H=>this.checkElementInSelectionBox(H,x)&&!H.locked);this.apiService.selectElements(N,b),this.apiService.updateBoundingBox()}initializeBoxSelect(d){d.shiftKey||this.apiService.clearSelection();const{x:b,y:x}=this.getPointerPosition(d);this.apiService.setSelectionBox({x:b,y:x,width:0,height:0,visible:!0})}initializeResize(){const d=this.apiService.getSelectedElements();if(0===d.length)return;this.initialElementStates.clear(),d.forEach(Y=>{this.initialElementStates.set(Y.id,{...Y})});const b=d.map(Y=>(0,W.P)(Y)),x=Math.min(...b.map(Y=>Y.minX)),A=Math.min(...b.map(Y=>Y.minY)),N=Math.max(...b.map(Y=>Y.maxX)),H=Math.max(...b.map(Y=>Y.maxY));this.initialBoundingBox={x,y:A,width:N-x,height:H-A}}initializeRotation(d){const b=this.apiService.getBoundingBoxSignal(),A="function"==typeof b?b():b;if(!A)return;this.selectionCenter={x:A.x+A.width/2,y:A.y+A.height/2};const N=this.getPointerPosition(d);this.rotateStartAngle=(0,h.Qu)(this.selectionCenter,N);const H=this.apiService.getSelectedElements();this.initialElementRotations.clear(),this.initialElementStates.clear(),H.forEach(Y=>{this.initialElementRotations.set(Y.id,Y.rotation||0),this.initialElementStates.set(Y.id,{...Y})}),this.apiService.setBoundingBox(null)}checkElementInSelectionBox(d,b){const A=(0,S.lE)(d.type).getBounds(d);return(0,h.n4)(A,b)}getResizeDirection(d){const b=d.split("_")[2];let x=M.OP.N;Object.values(M.OP).includes(b)&&(x=b);const A=this.apiService.getSelectedElements();return A.length>0?(0,h.TP)(x,A[0].rotation||0):x}}class s extends i{constructor(){super(...arguments),this.type=e.p.Text,this.baseCursor=D.x.Text,this.textElement=null,this.textInput=null}get isEditing(){return null!==this.textInput}handlePointerDown(d){if(!this.active)return;if(this.textInput)return void this.finishTextInput();const b=(0,B.e)(d,this.apiService.getElements());if(b&&b.type===E.R.Text)return this.textElement=b,void this.createTextInput(b.x,b.y,b.text);const{x,y:A}=this.getPointerPosition(d),H=A+.8*(this.whiteboardConfig.fontSize||16);this.textElement=this.createTextElement(x,H),this.createTextInput(x,H,"",d)}handlePointerUp(){this.textInput&&(this.textInput.addEventListener("blur",()=>this.finishTextInput()),this.textInput.focus())}createTextElement(d,b){const{snapToGrid:x,gridSize:A}=this.whiteboardConfig;return(0,S.n)(E.R.Text,{x:x?(0,O.Ej)(d,A):d,y:x?(0,O.Ej)(b,A):b,text:"",style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId())}createTextInput(d,b,x="",A){const Y=.8*(this.textElement?.style?.fontSize||16),j=this.apiService.getCanvas().parentElement;if(!j)return void console.error("Cannot find whiteboard container");const Q=j.getBoundingClientRect();let q,le;if(A)q=A.clientX-Q.left-1,le=A.clientY-Q.top-1;else{const ee=this.whiteboardConfig;q=ee.canvasX+(d+ee.x)*ee.zoom-1,le=ee.canvasY+(b+ee.y)*ee.zoom-1-Y*ee.zoom}const V=document.createElement("textarea");V.id="whiteboard-text-input",V.setAttribute("aria-label","Text input"),V.style.position="absolute",V.style.left=`${q}px`,V.style.top=`${le}px`,V.style.fontSize=`${this.textElement?.style?.fontSize||16}px`,V.style.fontFamily=this.textElement?.style?.fontFamily||"Arial",V.style.color=this.textElement?.style?.color||"#000000",V.style.fontWeight=this.textElement?.style?.fontWeight||"normal",V.style.fontStyle=this.textElement?.style?.fontStyle||"normal",V.style.border="1px dashed #000",V.style.background="white",V.style.outline="none",V.style.resize="none",V.style.overflow="hidden",V.style.lineHeight="1.2",V.style.whiteSpace="pre-wrap",V.style.margin="0",V.style.padding="2px",V.style.boxSizing="border-box",V.style.zIndex="10000",V.style.pointerEvents="auto",V.value=x,V.rows=1,V.addEventListener("input",()=>this.handleTextInput(V)),V.addEventListener("keydown",ee=>{(ee.key===g._.ENTER&&ee.ctrlKey||ee.key===g._.ESCAPE)&&(ee.preventDefault(),this.finishTextInput())}),j?j.appendChild(V):document.body.appendChild(V),V.focus(),this.textInput=V,this.handleTextInput(V)}handleTextInput(d){const b=d.value.split("\n"),x=b.reduce((A,N)=>Math.max(A,N.length),0);d.style.width=`${Math.max(x,10)}ch`,d.rows=Math.max(b.length,1),this.textElement&&(this.textElement.text=d.value,this.apiService.updateElements([this.textElement]))}finishTextInput(){if(this.textInput&&this.textElement){this.textInput.value.trim()?this.apiService.elementExists(this.textElement.id)||(this.apiService.addElements([this.textElement]),this.textElement.selectAfterDraw&&this.apiService.selectElements([this.textElement.id])):this.apiService.removeElements([this.textElement]);try{this.textInput.parentElement&&this.textInput.parentElement.removeChild(this.textInput)}catch{}this.textInput=null,this.textElement=null}}getElementStyle(){return{color:this.whiteboardConfig.strokeColor,fontSize:this.whiteboardConfig.fontSize,fontFamily:this.whiteboardConfig.fontFamily,lineJoin:this.whiteboardConfig.lineJoin,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,strokeColor:this.whiteboardConfig.fill,strokeWidth:0}}}var T=v(4438);let k=(()=>{class L{createTool(b,x){switch(b){case e.p.Arrow:return new m(x);case e.p.Ellipse:return new a(x);case e.p.Eraser:return new n(x);case e.p.Hand:return new c(x);case e.p.Image:return new o(x);case e.p.Line:return new p(x);case e.p.Pen:return new l(x);case e.p.Rectangle:return new C(x);case e.p.Select:return new P(x);case e.p.Text:return new s(x);default:throw new Error(`Unknown tool type: ${b}`)}}static{this.\u0275fac=function(x){return new(x||L)}}static{this.\u0275prov=T.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}}return L})()},3312:($,Z,v)=>{v.d(Z,{H:()=>u});var S=v(4438),e=v(8936),E=v(872);const O={[E.p.Hand]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M402-40q-30 0-56-13.5T303-92L48-465l24-23q19-19 45-22t47 12l116 81v-383q0-17 11.5-28.5T320-840q17 0 28.5 11.5T360-800v537L212-367l157 229q5 8 14 13t19 5h278q33 0 56.5-23.5T760-200v-560q0-17 11.5-28.5T800-800q17 0 28.5 11.5T840-760v560q0 66-47 113T680-40H402Zm38-440v-400q0-17 11.5-28.5T480-920q17 0 28.5 11.5T520-880v400h-80Zm160 0v-360q0-17 11.5-28.5T640-880q17 0 28.5 11.5T680-840v360h-80ZM486-300Z"/></svg>',[E.p.Select]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M516-120 402-402 120-516v-56l720-268-268 720h-56Zm26-148 162-436-436 162 196 78 78 196Zm-78-196Z"/></svg>',[E.p.Pen]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/></svg>',[E.p.Line]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M199-199q-9-9-9-21t9-21l520-520q9-9 21-9t21 9q9 9 9 21t-9 21L241-199q-9 9-21 9t-21-9Z"/></svg>',[E.p.Arrow]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="m560-240-56-58 142-142H160v-80h486L504-662l56-58 240 240-240 240Z"/></svg>',[E.p.Rectangle]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M200-200q-33 0-56.5-23.5T120-280v-400q0-33 23.5-56.5T200-760h560q33 0 56.5 23.5T840-680v400q0 33-23.5 56.5T760-200H200Zm0-80h560v-400H200v400Zm0 0v-400 400Z"/></svg>',[E.p.Ellipse]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>',[E.p.Text]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M280-160v-520H80v-120h520v120H400v520H280Zm360 0v-320H520v-120h360v120H760v320H640Z"/></svg>',[E.p.Image]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-480ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h320v80H200v560h560v-320h80v320q0 33-23.5 56.5T760-120H200Zm40-160h480L570-480 450-320l-90-120-120 160Zm440-320v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80Z"/></svg>',[E.p.Eraser]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M690-240h190v80H610l80-80Zm-500 80-85-85q-23-23-23.5-57t22.5-58l440-456q23-24 56.5-24t56.5 23l199 199q23 23 23 57t-23 57L520-160H190Zm296-80 314-322-198-198-442 456 64 64h262Zm-6-240Z"/></svg>'};var D=v(6084),i=v(162),m=v(3452);const a=[{id:"hand",type:E.p.Hand,name:"Hand",description:"Pan and navigate the canvas",icon:O[E.p.Hand],enabled:!0,order:0},{id:"select",type:E.p.Select,name:"Select",description:"Select and manipulate elements",icon:O[E.p.Select],enabled:!0,order:1},{id:"pen",type:E.p.Pen,name:"Pen",description:"Draw freehand lines",icon:O[E.p.Pen],enabled:!0,order:2},{id:"line",type:E.p.Line,name:"Line",description:"Draw straight lines",icon:O[E.p.Line],enabled:!0,order:3},{id:"arrow",type:E.p.Arrow,name:"Arrow",description:"Draw arrow lines",icon:O[E.p.Arrow],enabled:!0,order:4},{id:"rectangle",type:E.p.Rectangle,name:"Rectangle",description:"Draw rectangles",icon:O[E.p.Rectangle],enabled:!0,order:5},{id:"ellipse",type:E.p.Ellipse,name:"Ellipse",description:"Draw ellipses and circles",icon:O[E.p.Ellipse],enabled:!0,order:6},{id:"text",type:E.p.Text,name:"Text",description:"Add text annotations",icon:O[E.p.Text],enabled:!0,order:7},{id:"image",type:E.p.Image,name:"Image",description:"Add images",icon:O[E.p.Image],enabled:!0,order:8},{id:"eraser",type:E.p.Eraser,name:"Eraser",description:"Remove elements",icon:O[E.p.Eraser],enabled:!0,order:9}];let u=(()=>{class n{constructor(){this.eventBusService=(0,S.WQX)(e.W),this.toolFactory=(0,S.WQX)(m.r),this._apiServiceCache=(0,S.vPA)(void 0),this._selectedTool=(0,S.vPA)(E.p.Pen),this._toolConfigs=(0,S.vPA)(new Map),this._currentToolInstance=(0,S.vPA)(null),this._cursor=(0,S.vPA)(D.x.Default),this._temporaryOverrides=(0,S.vPA)([]),this.toolInstanceCache=new Map,this.selectedTool=this._selectedTool.asReadonly(),this.currentTool=this._currentToolInstance.asReadonly(),this.cursor=this._cursor.asReadonly(),this.temporaryOverrides=this._temporaryOverrides.asReadonly(),this.effectiveTool=(0,S.EWP)(()=>{const o=this._temporaryOverrides();return o.length>0?o[o.length-1].tool:this._selectedTool()}),this.availableTools=(0,S.EWP)(()=>{const o=this._toolConfigs();return Array.from(o.values()).filter(p=>p.enabled).sort((p,I)=>(p.order??999)-(I.order??999))}),this.initializeDefaultTools(),(0,S.QZP)(()=>{const o=this.effectiveTool();this._apiServiceCache()&&this.updateCurrentToolInstance(o)},{allowSignalWrites:!0}),(0,S.QZP)(()=>{this._currentToolInstance()&&this.updateCursorForActiveTool()},{allowSignalWrites:!0})}initializeDefaultTools(){const o=new Map;a.forEach(p=>{o.set(p.id,{...p})}),this._toolConfigs.set(o)}updateCurrentToolInstance(o){const p=this._currentToolInstance();p&&p.type!==o&&p.deactivate();const I=this.getToolInstance(o);I.activate(),this._currentToolInstance.set(I),this.hasTemporaryOverride()||this.eventBusService.emit(i.w.ToolChange,o)}updateCursorForActiveTool(){const o=this._currentToolInstance();this._cursor.set(o&&"baseCursor"in o?o.baseCursor:D.x.Default)}getActiveToolType(){return this.effectiveTool()}getActiveToolInstance(){const o=this._currentToolInstance();if(!o)throw new Error("No active tool instance found.");return o}setActiveTool(o){this._selectedTool()!==o&&this._selectedTool.set(o)}isToolActive(o){return this.effectiveTool()===o}getToolInstance(o){if(!Array.from(this._toolConfigs().values()).some(l=>l.type===o))throw new Error(`Tool type '${o}' is not registered.`);if(!this.toolInstanceCache.has(o)){const l=this._apiServiceCache();if(!l)throw new Error("ApiService not set. Call setApiService() first.");const C=this.toolFactory.createTool(o,l);this.toolInstanceCache.set(o,C)}const I=this.toolInstanceCache.get(o);if(!I)throw new Error(`Failed to create or retrieve tool instance for type: ${o}`);return I}getRegisteredToolTypes(){return Array.from(this._toolConfigs().values()).map(o=>o.type).filter((o,p,I)=>I.indexOf(o)===p)}isToolRegistered(o){return Array.from(this._toolConfigs().values()).some(p=>p.type===o)}resetToDefaultTool(){this.setActiveTool(E.p.Pen)}registerTool(o){const p=this._toolConfigs(),I=new Map(p);I.set(o.id,{...o}),this._toolConfigs.set(I)}registerTools(o){const p=this._toolConfigs(),I=new Map(p);o.forEach(l=>{I.set(l.id,{...l})}),this._toolConfigs.set(I)}unregisterTool(o){const p=this._toolConfigs();if(!p.has(o))return!1;const I=p.get(o),l=new Map(p);return l.delete(o),this._toolConfigs.set(l),this._selectedTool()===I?.type&&this.resetToDefaultTool(),!0}getToolConfig(o){return this._toolConfigs().get(o)}getToolConfigs(){return Array.from(this._toolConfigs().values())}setToolEnabled(o,p){const I=this.getToolConfig(o);return!!I&&(this.registerTool({...I,enabled:p}),!p&&this._selectedTool()===I.type&&this.resetToDefaultTool(),!0)}setToolEnabledByType(o,p){const I=Array.from(this._toolConfigs().values()).find(l=>l.type===o);return!!I&&this.setToolEnabled(I.id,p)}setEnabledTools(o){const p=new Set(o),I=this._toolConfigs(),l=new Map;I.forEach((C,g)=>{l.set(g,{...C,enabled:p.has(C.type)})}),this._toolConfigs.set(l),p.has(this._selectedTool())||this.setActiveTool(o[0]||E.p.Pen)}pushTemporaryTool(o,p=`temp-${Date.now()}`){if(this._temporaryOverrides().some(C=>C.reason===p))return;const l={tool:o,reason:p,timestamp:Date.now()};this._temporaryOverrides.update(C=>[...C,l])}popTemporaryTool(o){const p=this._temporaryOverrides();if(0===p.length)return;let I;I=o?p.filter(l=>l.reason!==o):p.slice(0,-1),I.length!==p.length&&this._temporaryOverrides.set(I)}clearTemporaryTools(){this._temporaryOverrides.set([])}hasTemporaryOverride(){return this._temporaryOverrides().length>0}setCursor(o){this._cursor.set(o)}resetCursor(){this.updateCursorForActiveTool()}destroy(){const o=this._currentToolInstance();o&&o.deactivate(),this.toolInstanceCache.clear(),this.clearTemporaryTools()}setApiService(o){this._apiServiceCache.set(o)}static{this.\u0275fac=function(p){return new(p||n)}}static{this.\u0275prov=S.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()},6084:($,Z,v)=>{v.d(Z,{x:()=>S});var S=function(e){return e.Default="default",e.Pointer="pointer",e.None="none",e.ContextMenu="context-menu",e.Help="help",e.Progress="progress",e.Wait="wait",e.Crosshair="crosshair",e.Cell="cell",e.Text="text",e.VerticalText="vertical-text",e.Grab="grab",e.Grabbing="grabbing",e.Move="move",e.AllScroll="all-scroll",e.NResize="n-resize",e.SResize="s-resize",e.EResize="e-resize",e.WResize="w-resize",e.NEResize="ne-resize",e.NWResize="nw-resize",e.SEResize="se-resize",e.SWResize="sw-resize",e.EWResize="ew-resize",e.NSResize="ns-resize",e.NESWResize="nesw-resize",e.NWSEResize="nwse-resize",e.Copy="copy",e.Alias="alias",e.NoDrop="no-drop",e.NotAllowed="not-allowed",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out",e.ColResize="col-resize",e.RowResize="row-resize",e.Pencil="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggZmlsbD0iIzAwMCIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjAuNSIgZD0ibTE2LjMxOCA2LjExLTMuNTM2LTMuNTM1IDEuNDE1LTEuNDE0Yy42My0uNjMgMi4wNzMtLjc1NSAyLjgyOCAwbC43MDcuNzA3Yy43NTUuNzU1LjYzMSAyLjE5OCAwIDIuODI5TDE2LjMxOCA2LjExem0tMS40MTQgMS40MTUtOS45IDkuOS00LjU5NiAxLjA2IDEuMDYtNC41OTYgOS45LTkuOSAzLjUzNiAzLjUzNnoiLz48L3N2Zz4=') 0 24, auto",e.Brush="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNNyAxNGMtMS42NiAwLTMgMS4zNC0zIDMgMCAxLjMxLTEuMTYgMi0yIDIgLjkyIDEuMjIgMi40OSAyIDQgMiAyLjIxIDAgNC0xLjc5IDQtNCAwLTEuNjYtMS4zNC0zLTMtM3ptMTMuNzEtOS4zN2wtMS4zNC0xLjM0YS45OTYuOTk2IDAgMCAwLTEuNDEgMEw5IDEyLjI1IDExLjc1IDE1bDguOTYtOC45NmEuOTk2Ljk5NiAwIDAgMCAwLTEuNDF6Ii8+PC9zdmc+') 0 24, auto",e.Eraser="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTYuMjQgMy41Nmw0Ljk1IDQuOTRjLjc4Ljc5Ljc4IDIuMDUgMCAyLjg0TDEyIDIwLjUzYTQuMDA4IDQuMDA4IDAgMCAxLTUuNjYgMEwyLjgxIDE3Yy0uNzgtLjc5LS43OC0yLjA1IDAtMi44NGwxMC42LTEwLjZjLjc5LS43OCAyLjA1LS43OCAyLjgzIDBNNC4yMiAxNS41OGwzLjU0IDMuNTNjLjc4Ljc5IDIuMDQuNzkgMi44MyAwbDMuNTMtMy41My00Ljk1LTQuOTUtNC45NSA0Ljk1eiIvPjwvc3ZnPg==') 12 12, auto",e.Highlighter="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSI0IiB5PSIxMCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjgiIGZpbGw9IiMwMDAiIG9wYWNpdHk9IjAuNiIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjAuNSIvPjxwYXRoIGQ9Ik0yIDIwaDIwdjNIMnoiIGZpbGw9IiMwMDAiIG9wYWNpdHk9IjAuOCIvPjwvc3ZnPg==') 12 24, auto",e.TextCursor="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNNSA0djNoNS41djEyaDNWN0gxOVY0SDV6Ii8+PC9zdmc+') 12 0, text",e.Shape="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMiIgZmlsbD0iIzAwMCIvPjwvc3ZnPg==') 12 12, crosshair",e.Arrow="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMyAzbDcuMDcgMTYuOTcgMi41MS03LjM5IDcuMzktMi41MUwzIDN6Ii8+PC9zdmc+') 0 0, default",e.Hand="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTMgNnY1aDNMMTIgMTdsLTQtNmgzVjZjMC0xLjEuOS0yIDItMnMyIC5IDIgMnptOCAwdjVoLTJWNmMwLTIuMjEtMS43OS00LTQtNGgtMkMxMC43OSAyIDkgMy43OSA5IDZ2NUg3VjZjMC0zLjMxIDIuNjktNiA2LTZoMmMzLjMxIDAgNiAyLjY5IDYgNnoiLz48L3N2Zz4=') 12 12, grab",e.Rotate="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTIgNnYzbDQtNC00LTR2M2MtNC40MiAwLTggMy41OC04IDggMCAxLjU3LjQ2IDMuMDMgMS4yNCA0LjI2TDYuNyAxNC44Yy0uNDUtLjgzLS43LTEuNzktLjctMi44IDAtMy4zMSAyLjY5LTYgNi02em02Ljc2IDEuNzRMMTcuMyA5LjJjLjQ0Ljg0LjcgMS43OS43IDIuOCAwIDMuMzEtMi42OSA2LTYgNnYtM2wtNCA0IDQgNHYtM2M0LjQyIDAgOC0zLjU4IDgtOCAwLTEuNTctLjQ2LTMuMDMtMS4yNC00LjI2eiIvPjwvc3ZnPg==') 12 12, grab",e.Eyedropper="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMjAuNzEgNS42M2wtMi4zNC0yLjM0Yy0uMzktLjM5LTEuMDItLjM5LTEuNDEgMGwtMy4xMiAzLjEyLTEuOTMtMS45MS0xLjQxIDEuNDEgMS40MiAxLjQyTDMgMTYuMjVWMjFoNC43NWw4LjkyLTguOTIgMS40MiAxLjQyIDEuNDEtMS40MS0xLjkyLTEuOTIgMy4xMy0zLjEyYy4zOS0uMzkuMzktMS4wMiAwLTEuNDJ6Ii8+PC9zdmc+') 0 24, crosshair",e.LaserPointer="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI0IiBmaWxsPSIjMDAwIiBvcGFjaXR5PSIwLjgiLz48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI2IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMC41Ii8+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iOCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAuNSIgb3BhY2l0eT0iMC4zIi8+PC9zdmc+') 12 12, none",e.Image="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiIGZpbGw9IiMwMDAiLz48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNSA5IDkgMTUgNiAxMiAzIDE1IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==') 12 12, crosshair",e.Dot="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIyIiBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMSIvPjwvc3ZnPg==') 10 10, crosshair",e.Plus="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTkgMTNoLTZ2NmgtMnYtNkg1di0yaDZWNWgydjZoNnYyeiIvPjwvc3ZnPg==') 12 12, crosshair",e.Line="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48bGluZSB4MT0iMyIgeTE9IjIxIiB4Mj0iMjEiIHkyPSIzIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PGNpcmNsZSBjeD0iMyIgY3k9IjIxIiByPSIyIiBmaWxsPSIjMDAwIi8+PGNpcmNsZSBjeD0iMjEiIGN5PSIzIiByPSIyIiBmaWxsPSIjMDAwIi8+PC9zdmc+') 12 12, crosshair",e}(S||{})},2262:($,Z,v)=>{v.d(Z,{R:()=>S});var S=function(e){return e.Pen="pen",e.Rectangle="rectangle",e.Ellipse="ellipse",e.Line="line",e.Arrow="arrow",e.Text="text",e.Image="image",e}(S||{})},162:($,Z,v)=>{v.d(Z,{w:()=>S});var S=function(e){return e.Ready="ready",e.Destroyed="destroyed",e.DrawStart="drawStart",e.Drawing="drawing",e.DrawEnd="drawEnd",e.ElementsAdded="elementsAdded",e.ElementsUpdated="elementsUpdated",e.ElementsSelected="elementsSelected",e.ElementsRemoved="elementsRemoved",e.ElementDoubleClicked="elementDoubleClicked",e.Undo="undo",e.Redo="redo",e.Clear="clear",e.DataChange="dataChange",e.Save="save",e.ImageAdded="imageAdded",e.ToolChange="toolChange",e.ConfigChange="configChange",e.ZoomChange="zoomChange",e}(S||{})},4289:($,Z,v)=>{v.d(Z,{B:()=>S});const S=[{value:"normal",label:"Normal",description:"Default blending",category:"normal"},{value:"multiply",label:"Multiply",description:"Darkens by multiplying colors",category:"darken"},{value:"darken",label:"Darken",description:"Keeps darkest colors",category:"darken"},{value:"color-burn",label:"Color Burn",description:"Increases contrast and darkens",category:"darken"},{value:"screen",label:"Screen",description:"Lightens by inverting and multiplying",category:"lighten"},{value:"lighten",label:"Lighten",description:"Keeps lightest colors",category:"lighten"},{value:"color-dodge",label:"Color Dodge",description:"Brightens and reduces contrast",category:"lighten"},{value:"overlay",label:"Overlay",description:"Combines multiply and screen",category:"contrast"},{value:"soft-light",label:"Soft Light",description:"Subtle version of overlay",category:"contrast"},{value:"hard-light",label:"Hard Light",description:"Intense version of overlay",category:"contrast"},{value:"difference",label:"Difference",description:"Subtracts colors",category:"contrast"},{value:"exclusion",label:"Exclusion",description:"Similar to difference but less contrast",category:"contrast"},{value:"hue",label:"Hue",description:"Uses hue of top layer",category:"component"},{value:"saturation",label:"Saturation",description:"Uses saturation of top layer",category:"component"},{value:"color",label:"Color",description:"Uses hue and saturation of top layer",category:"component"},{value:"luminosity",label:"Luminosity",description:"Uses luminosity of top layer",category:"component"}]},3265:($,Z,v)=>{v.d(Z,{Nn:()=>C,Of:()=>E,mY:()=>e});var S=v(6078),e=function(g){return g.Pen="pen",g.Marker="marker",g.Highlighter="highlighter",g.Brush="brush",g.Pencil="pencil",g}(e||{}),E=function(g){return g.ExtraFine="extra-fine",g.Fine="fine",g.Medium="medium",g.Thick="thick",g.ExtraThick="extra-thick",g}(E||{});const O={size:3,thinning:.8,smoothing:.9,streamline:.8,simulatePressure:!0,easing:g=>g<.5?2*g*g:1-Math.pow(-2*g+2,2)/2,start:{cap:!0,taper:.5},end:{cap:!0,taper:.6}},D={size:6,thinning:0,smoothing:.2,streamline:.3,simulatePressure:!1,easing:()=>1,start:{cap:!1,taper:!1},end:{cap:!1,taper:!1}},m={size:14,thinning:.85,smoothing:.95,streamline:.9,simulatePressure:!0,easing:g=>Math.pow(g,1.8),start:{cap:!0,taper:.7},end:{cap:!0,taper:.8}},a={size:1.5,thinning:.6,smoothing:.15,streamline:.1,simulatePressure:!0,easing:g=>Math.min(1,.7*g+.3+.1*Math.sin(20*g)),start:{cap:!0,taper:.1},end:{cap:!0,taper:.2}},u={[E.ExtraFine]:1,[E.Fine]:3,[E.Medium]:6,[E.Thick]:12,[E.ExtraThick]:20},n={[E.ExtraFine]:.5,[E.Fine]:1.5,[E.Medium]:3,[E.Thick]:6,[E.ExtraThick]:10},c={"pen-fine":{id:"pen-fine",name:"Fine Pen",type:e.Pen,thickness:E.Fine,strokeColor:"#000000",strokeWidth:n[E.Fine],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...O,size:u[E.Fine]},display:{description:"Smooth fine pen for detailed drawing",icon:"\u270f\ufe0f"}},"pen-medium":{id:"pen-medium",name:"Medium Pen",type:e.Pen,thickness:E.Medium,strokeColor:"#000000",strokeWidth:n[E.Medium],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...O,size:u[E.Medium]},display:{description:"Standard pen for general use",icon:"\u{1f58a}\ufe0f"}},"pen-thick":{id:"pen-thick",name:"Thick Pen",type:e.Pen,thickness:E.Thick,strokeColor:"#000000",strokeWidth:n[E.Thick],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...O,size:u[E.Thick]},display:{description:"Thick pen for bold strokes",icon:"\u{1f58d}\ufe0f"}},"marker-medium":{id:"marker-medium",name:"Medium Marker",type:e.Marker,thickness:E.Medium,strokeColor:"#2563eb",strokeWidth:n[E.Medium],lineCap:S.$3.Square,lineJoin:S.pP.Miter,strokeOptions:{...D,size:u[E.Medium]},display:{description:"Consistent marker for clean lines",icon:"\u{1f58d}\ufe0f"}},"marker-thick":{id:"marker-thick",name:"Thick Marker",type:e.Marker,thickness:E.Thick,strokeColor:"#dc2626",strokeWidth:n[E.Thick],lineCap:S.$3.Square,lineJoin:S.pP.Miter,strokeOptions:{...D,size:u[E.Thick]},display:{description:"Thick marker for emphasis",icon:"\u{1f58d}\ufe0f"}},"highlighter-medium":{id:"highlighter-medium",name:"Highlighter",type:e.Highlighter,thickness:E.Medium,strokeColor:"#fefc34",strokeWidth:n[E.ExtraThick],lineCap:S.$3.Square,lineJoin:S.pP.Miter,opacity:.4,strokeOptions:{size:18,thinning:.05,smoothing:.1,streamline:.1,simulatePressure:!1,easing:g=>g,start:{cap:!1,taper:!1},end:{cap:!1,taper:!1},size:u[E.ExtraThick]},display:{description:"Translucent highlighter for emphasis",icon:"\u{1f58d}\ufe0f"}},"brush-medium":{id:"brush-medium",name:"Paint Brush",type:e.Brush,thickness:E.Medium,strokeColor:"#059669",strokeWidth:n[E.Thick],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...m,size:u[E.Thick]},display:{description:"Expressive brush with pressure sensitivity",icon:"\u{1f58c}\ufe0f"}},"pencil-fine":{id:"pencil-fine",name:"Pencil",type:e.Pencil,thickness:E.Fine,strokeColor:"#374151",strokeWidth:n[E.Fine],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...a,size:u[E.Fine]},display:{description:"Natural pencil for sketching",icon:"\u270f\ufe0f"}}},o=Object.values(c),p={};Object.values(c).forEach(g=>{p[`${g.type}-${g.thickness}`]=g});const I=c["pen-medium"];function C(g,M=E.Medium){const B=function l(g,M){return p[`${g}-${M}`]}(g,M);return B||o.find(w=>w.type===g)||I}},872:($,Z,v)=>{v.d(Z,{p:()=>S});var S=function(e){return e.Hand="hand",e.Select="select",e.Pen="pen",e.Rectangle="rectangle",e.Image="image",e.Line="line",e.Arrow="arrow",e.Ellipse="ellipse",e.Text="text",e.Eraser="eraser",e}(S||{})},6078:($,Z,v)=>{v.d(Z,{$3:()=>E,OP:()=>D,Yu:()=>e,o8:()=>S,pP:()=>O});var S=function(i){return i.Png="png",i.Jpeg="jpeg",i.Svg="svg",i.Base64="base64",i}(S||{}),e=function(i){return i.Left="left",i.Center="center",i.Right="right",i.Top="top",i.Middle="middle",i.Bottom="bottom",i.DistributeHorizontally="distribute-horizontally",i.DistributeVertically="distribute-vertically",i}(e||{}),E=function(i){return i.Round="round",i.Butt="butt",i.Square="square",i}(E||{}),O=function(i){return i.Round="round",i.Miter="miter",i.Bevel="bevel",i.MiterClip="miter-clip",i}(O||{}),D=function(i){return i.NW="nw",i.N="n",i.NE="ne",i.E="e",i.SE="se",i.S="s",i.SW="sw",i.W="w",i}(D||{})},9820:($,Z,v)=>{v.d(Z,{P:()=>E});var S=v(2173);function E(O){return(0,S.lE)(O.type).getBounds(O)}},6751:($,Z,v)=>{v.d(Z,{e:()=>e,r:()=>E});var S=v(7879);function e(O,D){const i=E(O);if(i){if(i.id===S.Mt)return null;const m=i.getAttribute(S.Bn);return D.find(u=>u.id===m)||null}return null}function E(O){if(!O?.target)return null;let D=O.target;for(;D;){if(D.id===S.wM)return null;if(D.id.includes(S.RZ)||D.id.includes(S.YO)||D.id.includes(S.i$))return D;if(!D.parentNode)break;D=D.parentNode}return null}},2319:($,Z,v)=>{function S(m){if(0===m.length)throw new Error("Cannot calculate bounding box for empty points array");let a=1/0,u=1/0,n=-1/0,c=-1/0;for(const[o,p]of m)a=Math.min(a,o),u=Math.min(u,p),n=Math.max(n,o),c=Math.max(c,p);return{minX:a,minY:u,maxX:n,maxY:c,width:n-a,height:c-u}}function i(m,a,u,n){return m.minX-n<=Math.max(a.x,u.x)&&m.maxX+n>=Math.min(a.x,u.x)&&m.minY-n<=Math.max(a.y,u.y)&&m.maxY+n>=Math.min(a.y,u.y)}v.d(Z,{AJ:()=>S,DB:()=>i})},6212:($,Z,v)=>{function S(D,i){const{zoom:m,x:a,y:u,canvasX:n,canvasY:c,fullScreen:o}=D;return o?{x:i.x/m-a,y:i.y/m-u}:{x:(i.x-n)/m-a,y:(i.y-c)/m-u}}function e(D,i,m,a){const u=Math.PI/4,n=m-D,c=a-i,o=Math.atan2(c,n),p=Math.sqrt(n*n+c*c),I=Math.round(o/u)*u;return{x:D+p*Math.cos(I),y:i+p*Math.sin(I),a:I}}function E(D,i){return Math.round(D/i)*i}v.d(Z,{Ej:()=>E,Jt:()=>e,y1:()=>S})},6042:($,Z,v)=>{v.d(Z,{Em:()=>m,Qu:()=>E,TP:()=>u,ZN:()=>D,d4:()=>i,n0:()=>O,n4:()=>a});var S=v(6078);const e=1e-6;function E(n,c){return Math.atan2(c.y-n.y,c.x-n.x)*(180/Math.PI)}function O(n){return(n%=360)<0?n+360:n}function D(n,c){return Math.abs(n)>Math.abs(c)?{x:n,y:0}:{x:0,y:c}}function i(n,c,o,p){const I=o.x,l=o.y,C=p.x,g=p.y,M=(C-I)**2+(g-l)**2;if(0===M)return Math.sqrt((n-I)**2+(c-l)**2);let B=((n-I)*(C-I)+(c-l)*(g-l))/M;return B=Math.max(0,Math.min(1,B)),Math.sqrt((n-(I+B*(C-I)))**2+(c-(l+B*(g-l)))**2)}function m(n,c,o,p,I=e){const l=(P,s)=>P.x*s.y-P.y*s.x,C=(P,s)=>({x:P.x-s.x,y:P.y-s.y}),g=C(c,n),M=C(p,o),B=C(o,n),h=l(g,M),w=l(B,g);if(Math.abs(h)<I){if(Math.abs(w)>=I)return!1;const P=g.x*g.x+g.y*g.y,s=(B.x*g.x+B.y*g.y)/P,T=C(p,n),k=(T.x*g.x+T.y*g.y)/P;return s>=0&&s<=1||k>=0&&k<=1||s<0&&k>1||s>1&&k<0}const W=w/h,z=l(B,M)/h;return W>=0&&W<=1&&z>=0&&z<=1}function a(n,c){return n.minX<=c.x+c.width&&n.maxX>=c.x&&n.minY<=c.y+c.height&&n.maxY>=c.y}function u(n,c){const o=Math.round(O(c)/45)%8,p=Object.values(S.OP),l=(p.indexOf(n)+o)%8;return p[l]}},2500:($,Z,v)=>{v.d(Z,{L:()=>E,U:()=>O});var S=v(9820);function E(D){if(0===D.length)return null;const i=D.map(c=>function e(D){const i=(0,S.P)(D);if(!D.rotation||0===D.rotation)return i;const m=i.width/2,a=i.height/2,u=[{x:0,y:0},{x:i.width,y:0},{x:i.width,y:i.height},{x:0,y:i.height}],n=(D.rotation||0)*(Math.PI/180),c=Math.cos(n),o=Math.sin(n),I=u.map(w=>{const W=w.x-m,z=w.y-a;return{x:W*c-z*o+m,y:W*o+z*c+a}}).map(w=>({x:w.x+D.x,y:w.y+D.y})),l=I.map(w=>w.x),C=I.map(w=>w.y),g=Math.min(...l),M=Math.min(...C),B=Math.max(...l),h=Math.max(...C);return{minX:g,minY:M,maxX:B,maxY:h,width:B-g,height:h-M}}(c)),m=Math.min(...i.map(c=>c.minX)),a=Math.min(...i.map(c=>c.minY)),u=Math.max(...i.map(c=>c.maxX)),n=Math.max(...i.map(c=>c.maxY));return{minX:m,minY:a,maxX:u,maxY:n,width:u-m,height:n-a}}function O(D,i,m){const a=m*(Math.PI/180),u=Math.cos(a),n=Math.sin(a),c=D.x-i.x,o=D.y-i.y;return{x:i.x+c*u-o*n,y:i.y+c*n+o*u}}},710:($,Z,v)=>{v.d(Z,{l:()=>O});var S=v(4438),e=v(7785),E=v(8936);let O=(()=>{class D{constructor(m,a){this.configService=m,this.eventBusService=a,this.DEFAULT_PAN_BOUNDS={x:-1/0,y:-1/0,width:1/0,height:1/0},this.panBounds=this.DEFAULT_PAN_BOUNDS}getConfig(){return this.configService.getConfig()}pan(m,a){const u=this.getConfig(),{x:n,y:c}=u,I=this.constrainPanPosition(n+m,c+a);this.setCanvasPosition(I.x,I.y)}panTo(m,a){const u=this.constrainPanPosition(m,a);this.setCanvasPosition(u.x,u.y)}setCanvasPosition(m,a){this.configService.updateConfig({x:m,y:a})}getPanPosition(){const m=this.getConfig();return{x:m.x,y:m.y}}resetPan(){this.setCanvasPosition(0,0)}setPanBounds(m){this.panBounds=m}resetPanBounds(){this.panBounds=this.DEFAULT_PAN_BOUNDS}getPanBounds(){return{...this.panBounds}}constrainPanPosition(m,a){return this.panBounds===this.DEFAULT_PAN_BOUNDS?{x:m,y:a}:{x:Math.max(this.panBounds.x,Math.min(this.panBounds.x+this.panBounds.width,m)),y:Math.max(this.panBounds.y,Math.min(this.panBounds.y+this.panBounds.height,a))}}isPositionWithinBounds(m,a){return this.panBounds===this.DEFAULT_PAN_BOUNDS||m>=this.panBounds.x&&m<=this.panBounds.x+this.panBounds.width&&a>=this.panBounds.y&&a<=this.panBounds.y+this.panBounds.height}getDistanceToBounds(){const{x:m,y:a}=this.getPanPosition();return this.panBounds===this.DEFAULT_PAN_BOUNDS?{left:1/0,top:1/0,right:1/0,bottom:1/0}:{left:m-this.panBounds.x,top:a-this.panBounds.y,right:this.panBounds.x+this.panBounds.width-m,bottom:this.panBounds.y+this.panBounds.height-a}}panWithEasing(m,a){this.panTo(m,a)}panWithMomentum(m,a){this.pan(m,a)}validatePanOperation(m,a,u,n){return this.isPositionWithinBounds(m+u,a+n)}applyPanAcceleration(m,a){return{dx:m,dy:a}}onPanChange(m,a){}static{this.\u0275fac=function(a){return new(a||D)(S.KVO(e.w),S.KVO(E.W))}}static{this.\u0275prov=S.jDH({token:D,factory:D.\u0275fac,providedIn:"root"})}}return D})()},4764:($,Z,v)=>{v.d(Z,{T:()=>u});var S=v(4438),e=v(7785),E=v(7879),O=v(162),D=v(525),i=v(6255),m=v(1152),a=v(8936);let u=(()=>{class n{constructor(){this.canvasService=(0,S.WQX)(D.W),this.elementsService=(0,S.WQX)(i.L),this.selectionService=(0,S.WQX)(m.A),this.configService=(0,S.WQX)(e.w),this.eventBusService=(0,S.WQX)(a.W),this.DEFAULT_FIT_MARGIN=.9,this.zoomSubscription=this.eventBusService.on(O.w.ZoomChange).subscribe(()=>{const{center:o,fullScreen:p,zoom:I}=this.getConfig();o&&!p&&this.centerCanvas(I)})}ngOnDestroy(){this.zoomSubscription?.unsubscribe()}emitZoomChangeEvent(){const{zoom:o}=this.getConfig();this.eventBusService.emit(O.w.ZoomChange,{zoom:o})}getConfig(){return this.configService.getConfig()}centerCanvas(o){const{canvasWidth:p,canvasHeight:I}=this.getConfig(),l=this.canvasService.getContainerDimensions(),C=(l.width-p*o)/2,g=(l.height-I*o)/2;return this.configService.updateConfig({canvasX:C,canvasY:g},!1),{x:C,y:g}}zoom(o,p=!0,I=300){if(o<=0)return;const l=Math.round(100*this.clampZoom(o))/100;p?this.animateToTarget(l,I):this.setInstant(l)}zoomIn(o=!0,p=300){const{zoom:I}=this.getConfig(),l=Math.round(100*(I+E.bL))/100;l<=E.nD&&this.zoom(l,o,p)}zoomOut(o=!0,p=300){const{zoom:I}=this.getConfig(),l=Math.round(100*(I-E.bL))/100;l>=E.DQ&&this.zoom(l,o,p)}resetZoom(o=!0,p=300){o?this.animateToTarget(E.aM,p):this.setInstant(E.aM)}getZoomLevel(){return this.getConfig().zoom}getZoomPercentage(){return Math.round(100*this.getConfig().zoom)}zoomToFit(o=this.DEFAULT_FIT_MARGIN,p=!0,I=300){const l=this.elementsService.getElements();0!==l.length?this.zoomToElements(l,o,p,I):this.resetZoom(p,I)}zoomToSelection(o=this.DEFAULT_FIT_MARGIN,p=!0,I=300){const l=this.selectionService.getSelectedElements();0!==l.length&&this.zoomToElements(l,o,p,I)}zoomToElements(o,p=this.DEFAULT_FIT_MARGIN,I=!0,l=300){if(0===o.length)return;const C=this.elementsService.calculateElementsBounds(o);if(!C)return;const{fullScreen:g}=this.getConfig(),M=g?this.canvasService.getContainerDimensions():this.canvasService.getCanvasDimensions(),w=Math.min(M.width*p/C.width,M.height*p/C.height);I?this.animateToTarget(w,l):this.setInstant(w)}zoomToArea(o,p,I,l,C=this.DEFAULT_FIT_MARGIN,g=!0,M=300){const B=this.canvasService.getCanvasDimensions(),W=Math.min(B.width*C/I,B.height*C/l);g?this.animateToTarget(W,M):this.setInstant(W)}getOptimalZoom(o,p,I=this.DEFAULT_FIT_MARGIN){const l=this.canvasService.getCanvasDimensions();return this.clampZoom(Math.min(l.width/o,l.height/p)*I)}clampZoom(o){return Math.max(E.DQ,Math.min(E.nD,o))}isValidZoom(o){return o>=E.DQ&&o<=E.nD}getZoomLimits(){return{min:E.DQ,max:E.nD}}easeInOutCubic(o){return o<.5?4*o*o*o:1-Math.pow(-2*o+2,3)/2}setInstant(o){const{fullScreen:p,center:I}=this.getConfig(),l=this.clampZoom(o);!p&&I&&this.centerCanvas(l),this.configService.updateConfig({zoom:l}),this.emitZoomChangeEvent()}animateToTarget(o,p=300){const{zoom:I,fullScreen:l,center:C}=this.getConfig(),g=this.clampZoom(o);!l&&C&&this.centerCanvas(g);const M=performance.now(),B=h=>{const W=Math.min((h-M)/p,1),z=this.easeInOutCubic(W);this.configService.updateConfig({zoom:I+(g-I)*z}),W<1?requestAnimationFrame(B):this.emitZoomChangeEvent()};requestAnimationFrame(B)}static{this.\u0275fac=function(p){return new(p||n)}}static{this.\u0275prov=S.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()},2604:($,Z,v)=>{v.d(Z,{I:()=>ct});var S=v(177),e=v(4438),E=v(2107),O=v(4446),D=v(525),i=v(7785);let m=(()=>{class f{constructor(t,r,y){this.elementRef=t,this.apiService=r,this._cd=y}ngOnInit(){this.resizeObserver=new ResizeObserver(([t])=>{if(t.target===this.elementRef.nativeElement){const{fullScreen:r,center:y}=this.apiService.getConfig();setTimeout(()=>{r&&this.apiService.fullScreen(),y&&!r&&this.apiService.centerCanvas(),this._cd.detectChanges()},0)}}),this.resizeObserver.observe(this.elementRef.nativeElement)}ngOnDestroy(){this.resizeObserver?.disconnect()}static{this.\u0275fac=function(r){return new(r||f)(e.rXU(e.aKT),e.rXU(E.G),e.rXU(e.gRc))}}static{this.\u0275dir=e.FsC({type:f,selectors:[["","resizeHandler",""]],standalone:!0})}}return f})();var a=v(7879),u=v(162),n=v(872),c=v(6751),o=v(3312),p=v(8936),I=v(6078);let l=(()=>{class f{constructor(){this.configService=(0,e.WQX)(i.w),this.apiService=(0,e.WQX)(E.G)}toggleKeyboardShortcuts(){const t=this.configService.getConfig();this.configService.updateConfigValue("keyboardShortcutsEnabled",!t.keyboardShortcutsEnabled)}handleKeyDown(t){if(this.isInputFocused())return;const r=t.key.toLowerCase();this.handleKeyDownShortcuts(r,t.ctrlKey||t.metaKey,t.shiftKey,t.altKey)&&(t.preventDefault(),t.stopPropagation())}handleKeyUp(t){}isInputFocused(){const t=document.activeElement;return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||"true"===t?.getAttribute("contenteditable")}handleKeyDownShortcuts(t,r,y,R){if(!r&&!y&&!R){if("v"===t)return this.apiService.setActiveTool(n.p.Select),!0;if("d"===t)return this.apiService.setActiveTool(n.p.Pen),!0;if("e"===t)return this.apiService.setActiveTool(n.p.Eraser),!0;if("h"===t)return this.apiService.setActiveTool(n.p.Hand),!0;if("r"===t)return this.apiService.setActiveTool(n.p.Rectangle),!0;if("o"===t)return this.apiService.setActiveTool(n.p.Ellipse),!0;if("a"===t)return this.apiService.setActiveTool(n.p.Arrow),!0;if("l"===t)return this.apiService.setActiveTool(n.p.Line),!0;if("t"===t)return this.apiService.setActiveTool(n.p.Text),!0}return r&&"z"===t&&!y?this.apiService.undo():r&&("y"===t||"z"===t&&y)?this.apiService.redo():r&&"a"===t?(this.apiService.selectAll(),!0):t===a.aR.ESCAPE?(this.apiService.clearSelection(),!0):r&&"c"===t?(this.apiService.copyElements(),!0):r&&"x"===t?(this.apiService.cutElements(),!0):r&&"v"===t?(this.apiService.pasteElements(),!0):r&&"d"===t?(this.apiService.duplicateElements(),!0):t===a.aR.DELETE||t===a.aR.BACKSPACE?(this.apiService.deleteSelectedElements(),!0):r&&"g"===t&&!y?(this.apiService.groupSelectedElements(),!0):r&&"g"===t&&y?(this.apiService.ungroupSelectedElements(),!0):r||y||R||"]"!==t?!R||r||y||"]"!==t?!R||r||y||"["!==t?r||y||R||"["!==t?!y||r||R||"h"!==t?!y||r||R||"v"!==t?!R||r||y||"w"!==t?!R||r||y||"v"!==t?!R||r||y||"s"!==t?!R||r||y||"a"!==t?!R||r||y||"h"!==t?!R||r||y||"d"!==t?r&&"="===t||r&&"+"===t?(this.apiService.zoomIn(),!0):r&&"-"===t?(this.apiService.zoomOut(),!0):!y||r||R||"0"!==t?!y||r||R||"1"!==t?!y||r||R||"2"!==t?r&&"'"===t&&!y?(this.apiService.toggleGrid(),!0):r&&";"===t&&y?(this.apiService.toggleSnapToGrid(),!0):r||y||R||t!==a.aR.ARROW_UP&&t!==a.aR.ARROW_DOWN&&t!==a.aR.ARROW_LEFT&&t!==a.aR.ARROW_RIGHT?!(r||!y||R||t!==a.aR.ARROW_UP&&t!==a.aR.ARROW_DOWN&&t!==a.aR.ARROW_LEFT&&t!==a.aR.ARROW_RIGHT)&&(this.apiService.moveSelectedElements(t===a.aR.ARROW_RIGHT?a.AD.LARGE_STEP:t===a.aR.ARROW_LEFT?-a.AD.LARGE_STEP:0,t===a.aR.ARROW_DOWN?a.AD.LARGE_STEP:t===a.aR.ARROW_UP?-a.AD.LARGE_STEP:0),!0):(this.apiService.moveSelectedElements(t===a.aR.ARROW_RIGHT?a.AD.SMALL_STEP:t===a.aR.ARROW_LEFT?-a.AD.SMALL_STEP:0,t===a.aR.ARROW_DOWN?a.AD.SMALL_STEP:t===a.aR.ARROW_UP?-a.AD.SMALL_STEP:0),!0):(this.apiService.zoomToSelection(),!0):(this.apiService.zoomToFit(),!0):(this.apiService.resetZoom(),!0):(this.apiService.alignElements(I.Yu.Right),!0):(this.apiService.alignElements(I.Yu.Center),!0):(this.apiService.alignElements(I.Yu.Left),!0):(this.apiService.alignElements(I.Yu.Bottom),!0):(this.apiService.alignElements(I.Yu.Middle),!0):(this.apiService.alignElements(I.Yu.Top),!0):(this.apiService.flipVertical(),!0):(this.apiService.flipHorizontal(),!0):(this.apiService.sendToBack(),!0):(this.apiService.sendBackward(),!0):(this.apiService.bringForward(),!0):(this.apiService.bringToFront(),!0)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})();const C={cut:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M3.5 2.5a.5.5 0 0 0-1 0v11a.5.5 0 0 0 1 0v-11Zm9 0a.5.5 0 0 0-1 0v11a.5.5 0 0 0 1 0v-11ZM5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1h.5A1.5 1.5 0 0 1 13 3.5V12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3.5A1.5 1.5 0 0 1 4.5 2H5V1Zm1 0v1h4V1H6Z"/></svg>',copy:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2Zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6ZM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2Z"/></svg>',paste:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 3a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-7Zm-1.5.5A1.5 1.5 0 0 1 4.5 2h7A1.5 1.5 0 0 1 13 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-7A1.5 1.5 0 0 1 3 12.5v-9ZM6 1a1 1 0 0 0-1 1h6a1 1 0 0 0-1-1H6Z"/></svg>',duplicate:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M11 2a2 2 0 0 1 2 2v6.5a.5.5 0 0 1-1 0V4a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h6.5a.5.5 0 0 1 0 1H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7Zm4.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L12.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0Z"/></svg>',"select-all":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13ZM1 3.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5V13a.5.5 0 0 1-.5.5h-13A.5.5 0 0 1 1 13V3.5Z"/></svg>',delete:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/></svg>',order:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 3a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H6a.5.5 0 0 1 0-1h1.5V3.5A.5.5 0 0 1 8 3Zm0 7a.5.5 0 0 1 .5.5V12H10a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 8 10Zm-5-3a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm5 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm5 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"/></svg>',"bring-to-front":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 0a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2Zm6 9v5a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2H9Z"/></svg>',"bring-forward":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 2a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2Zm1 0v4h6V2H2Zm6 6v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1Zm6-6v4a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1Zm-1 0H9v4h5V2Z"/></svg>',"send-backward":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2Zm1 0v4h5V2H1Zm0 6v6a1 1 0 0 1 1 1h6a1 1 0 0 1-1-1V8a1 1 0 0 1-1-1H1Zm8-6v4a1 1 0 0 1 1 1h5a1 1 0 0 1 1-1V2a1 1 0 0 1-1-1H9a1 1 0 0 1 1 1Z"/></svg>',"send-to-back":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2Zm8 7h6a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2V9Z"/></svg>',align:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 14.5 0h-13ZM1 1.5a.5.5 0 0 1 .5-.5H4v3.5H1V1.5ZM5 4.5h6V1H5v3.5ZM12 5h3v6h-3V5Zm-1 6H5V5h6v6Zm-7-6H1v6h3V5Z"/></svg>',"align-left":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 1a.5.5 0 0 0-1 0v14a.5.5 0 0 0 1 0V1Zm3 0a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V1Zm0 7a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V8Z"/></svg>',"align-center":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 1 0v-13A.5.5 0 0 0 8 1ZM2 4.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-1Zm2 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1Z"/></svg>',"align-right":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M14.5 1a.5.5 0 0 1 1 0v14a.5.5 0 0 1-1 0V1Zm-2.5 0a.5.5 0 0 1 .5-.5H5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h7a.5.5 0 0 1-.5-.5V1Zm0 7a.5.5 0 0 1 .5-.5H2a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h10a.5.5 0 0 1-.5-.5V8Z"/></svg>',"align-top":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 0 1 0V1h13v.5a.5.5 0 0 0 1 0V1a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v.5Zm4 1a.5.5 0 0 1 .5.5v10a.5.5 0 0 1-1 0V3a.5.5 0 0 1 .5-.5Zm6 0a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0V3a.5.5 0 0 1 .5-.5Z"/></svg>',"align-middle":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 8a.5.5 0 0 0 .5.5H15a.5.5 0 0 0 0-1H1.5A.5.5 0 0 0 1 8Zm3.5-5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9a.5.5 0 0 1 .5-.5Zm7 0a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9a.5.5 0 0 1 .5-.5Z"/></svg>',"align-bottom":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 14.5a.5.5 0 0 1 1 0V15h13v-.5a.5.5 0 0 1 1 0V15a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-.5Zm4-1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-1 0v10a.5.5 0 0 0 .5.5Zm6 0a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-1 0v7a.5.5 0 0 0 .5.5Z"/></svg>',distribute:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 1 1 0v13a.5.5 0 0 1-1 0v-13Zm14 0a.5.5 0 0 0-1 0v13a.5.5 0 0 0 1 0v-13ZM5 5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V5Z"/></svg>',"distribute-horizontal":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 1 1 0v13a.5.5 0 0 1-1 0v-13Zm14 0a.5.5 0 0 0-1 0v13a.5.5 0 0 0 1 0v-13ZM4 5a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5Zm5 0a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1V5Z"/></svg>',"distribute-vertical":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 1a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Zm0 14a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1h-13ZM5 4a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H5Zm0 5a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H5Z"/></svg>',flip:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-1 0V.5A.5.5 0 0 1 8 0ZM2.5 2A1.5 1.5 0 0 0 1 3.5v9A1.5 1.5 0 0 0 2.5 14h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h4a.5.5 0 0 0 0-1h-4Zm7 0a.5.5 0 0 0 0 1h4a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-4a.5.5 0 0 0 0 1h4a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 2h-4Z"/></svg>',"flip-horizontal":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-1 0V.5A.5.5 0 0 1 8 0ZM2.5 2A1.5 1.5 0 0 0 1 3.5v9A1.5 1.5 0 0 0 2.5 14h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h4a.5.5 0 0 0 0-1h-4Zm7 0a.5.5 0 0 0 0 1h4a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-4a.5.5 0 0 0 0 1h4a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 2h-4Z"/></svg>',"flip-vertical":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M.5 8a.5.5 0 0 0 .5.5h15a.5.5 0 0 0 0-1H1A.5.5 0 0 0 .5 8ZM2 2.5A1.5 1.5 0 0 1 3.5 1h9A1.5 1.5 0 0 1 14 2.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4Zm0 11v-4a.5.5 0 0 1 1 0v4a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 1 0v4a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5Z"/></svg>',group:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 3A1.5 1.5 0 0 0 0 4.5v7A1.5 1.5 0 0 0 1.5 13H7a.5.5 0 0 0 0-1H1.5a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5H7a.5.5 0 0 0 0-1H1.5ZM9 4a.5.5 0 0 0 0 1h5.5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5H9a.5.5 0 0 0 0 1h5.5a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 14.5 3H9Z"/></svg>',ungroup:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 1.5A1.5 1.5 0 0 1 1.5 0h5A1.5 1.5 0 0 1 8 1.5V7H1.5A1.5 1.5 0 0 1 0 5.5v-4Zm8 0V7h6.5A1.5 1.5 0 0 0 16 5.5v-4A1.5 1.5 0 0 0 14.5 0h-5A1.5 1.5 0 0 0 8 1.5Zm-8 8A1.5 1.5 0 0 1 1.5 8H8v6.5A1.5 1.5 0 0 1 6.5 16h-5A1.5 1.5 0 0 1 0 14.5v-5Zm8 0V16h6a1.5 1.5 0 0 0 1.5-1.5v-5A1.5 1.5 0 0 0 14 8H8Z"/></svg>',lock:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z"/></svg>',unlock:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2zM3 8a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H3z"/></svg>',"arrow-right":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>'};let g=(()=>{class f{constructor(t){this.apiService=t,this.contextMenuVisibleSignal=(0,e.vPA)(!1),this.contextMenuPositionSignal=(0,e.vPA)({x:0,y:0}),this.containerBoundsSignal=(0,e.vPA)(null),this.focusedItemIndexSignal=(0,e.vPA)(-1),this.focusedSubmenuIdSignal=(0,e.vPA)(null),this.allMenuItemsCache=(0,e.EWP)(()=>{const r=this.getContextMenuSections()(),y=[];return r.forEach(R=>{R.items.forEach(_=>{y.push(_),_.submenu&&this.focusedSubmenuIdSignal()===_.id&&_.submenu.forEach(X=>{y.push(X)})})}),y})}getContextMenuVisible(){return this.contextMenuVisibleSignal.asReadonly()}getContextMenuPosition(){return this.contextMenuPositionSignal.asReadonly()}getContainerBounds(){return this.containerBoundsSignal.asReadonly()}getFocusedItemIndex(){return this.focusedItemIndexSignal.asReadonly()}getFocusedSubmenuId(){return this.focusedSubmenuIdSignal.asReadonly()}showContextMenu(t,r,y){this.contextMenuPositionSignal.set({x:t,y:r}),this.containerBoundsSignal.set(y||null),this.contextMenuVisibleSignal.set(!0),this.focusedItemIndexSignal.set(-1),this.focusedSubmenuIdSignal.set(null)}hideContextMenu(){this.contextMenuVisibleSignal.set(!1),this.focusedItemIndexSignal.set(-1),this.focusedSubmenuIdSignal.set(null)}getContextMenuSections(){return(0,e.EWP)(()=>{const t=this.apiService.getSelectedElements(),r=t.length>0,y=t.length>1,R=t.length>2,_=this.apiService.getClipboardInfo(),X=null!==_&&_.elementCount>0,G=r&&t.some(te=>te.groupId),K=r&&t.some(te=>te.locked),ae=r&&t.some(te=>!te.locked);return[{id:"clipboard",items:[{id:"cut",label:"Cut",shortcut:"Ctrl+X",enabled:r,visible:r,action:()=>this.apiService.cutElements()},{id:"copy",label:"Copy",shortcut:"Ctrl+C",enabled:r,visible:r,action:()=>this.apiService.copyElements()},{id:"paste",label:"Paste",shortcut:"Ctrl+V",enabled:X,visible:X,action:()=>this.apiService.pasteElements()},{id:"duplicate",label:"Duplicate",shortcut:"Ctrl+D",enabled:r,visible:r,divider:!0,action:()=>this.apiService.duplicateElements()}]},{id:"selection",items:[{id:"select-all",label:"Select All",shortcut:"Ctrl+A",enabled:!0,visible:!0,action:()=>this.apiService.selectAll()},{id:"delete",label:"Delete",shortcut:"Del",enabled:r,visible:r,divider:!0,action:()=>this.apiService.deleteSelectedElements()}]},{id:"arrange",items:[{id:"order",label:"Order",enabled:r,visible:r,submenu:[{id:"bring-to-front",label:"Bring to Front",shortcut:"Ctrl+Shift+]",enabled:!0,visible:!0,action:()=>this.apiService.bringToFront()},{id:"bring-forward",label:"Bring Forward",shortcut:"Ctrl+]",enabled:!0,visible:!0,action:()=>this.apiService.bringForward()},{id:"send-backward",label:"Send Backward",shortcut:"Ctrl+[",enabled:!0,visible:!0,action:()=>this.apiService.sendBackward()},{id:"send-to-back",label:"Send to Back",shortcut:"Ctrl+Shift+[",enabled:!0,visible:!0,action:()=>this.apiService.sendToBack()}]},{id:"transform",label:"Transform",enabled:r,visible:r,submenu:[{id:"align-left",label:"Align Left",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(I.Yu.Left)},{id:"align-center",label:"Align Center",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(I.Yu.Center)},{id:"align-right",label:"Align Right",enabled:!0,visible:!0,divider:!0,action:()=>this.apiService.alignElements(I.Yu.Right)},{id:"align-top",label:"Align Top",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(I.Yu.Top)},{id:"align-middle",label:"Align Middle",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(I.Yu.Middle)},{id:"align-bottom",label:"Align Bottom",enabled:!0,visible:!0,divider:!0,action:()=>this.apiService.alignElements(I.Yu.Bottom)},{id:"distribute-horizontal",label:"Distribute Horizontally",enabled:R,visible:R,action:()=>this.apiService.distributeHorizontally()},{id:"distribute-vertical",label:"Distribute Vertically",enabled:R,visible:R,divider:!0,action:()=>this.apiService.distributeVertically()},{id:"flip-horizontal",label:"Flip Horizontal",enabled:!0,visible:!0,action:()=>this.apiService.flipHorizontal()},{id:"flip-vertical",label:"Flip Vertical",enabled:!0,visible:!0,action:()=>this.apiService.flipVertical()}]}]},{id:"object",items:[{id:"group",label:"Group",shortcut:"Ctrl+G",enabled:y,visible:y,action:()=>this.apiService.groupSelectedElements()},{id:"ungroup",label:"Ungroup",shortcut:"Ctrl+Shift+G",enabled:G,visible:G,action:()=>this.apiService.ungroupSelectedElements()},{id:"lock",label:"Lock",shortcut:"Ctrl+L",enabled:ae,visible:ae,action:()=>this.apiService.lockElements()},{id:"unlock",label:"Unlock",shortcut:"Ctrl+Shift+L",enabled:K,visible:K,action:()=>this.apiService.unlockElements()}]}].map(te=>({...te,items:te.items.filter(ne=>ne.visible)})).filter(te=>te.items.length>0)})}executeAction(t){try{t()}catch(r){console.error("Error executing context menu action:",r)}finally{this.hideContextMenu()}}focusNextItem(){const t=this.allMenuItemsCache(),r=t.filter(ae=>ae.enabled);if(0===r.length)return;const y=this.focusedItemIndexSignal(),R=y>=0?t[y]:null,X=((R?r.indexOf(R):-1)+1)%r.length,K=t.indexOf(r[X]);this.focusedItemIndexSignal.set(K)}focusPreviousItem(){const t=this.allMenuItemsCache(),r=t.filter(ae=>ae.enabled);if(0===r.length)return;const y=this.focusedItemIndexSignal(),R=y>=0?t[y]:null,_=R?r.indexOf(R):-1,K=t.indexOf(r[_<=0?r.length-1:_-1]);this.focusedItemIndexSignal.set(K)}focusFirstItem(){const t=this.allMenuItemsCache(),r=t.filter(_=>_.enabled);if(0===r.length)return;const R=t.indexOf(r[0]);this.focusedItemIndexSignal.set(R)}focusLastItem(){const t=this.allMenuItemsCache(),r=t.filter(_=>_.enabled);if(0===r.length)return;const R=t.indexOf(r[r.length-1]);this.focusedItemIndexSignal.set(R)}openFocusedSubmenu(){const t=this.allMenuItemsCache(),r=this.focusedItemIndexSignal();if(r<0||r>=t.length)return;const y=t[r];y.submenu&&y.enabled&&this.focusedSubmenuIdSignal.set(y.id)}closeFocusedSubmenu(){this.focusedSubmenuIdSignal.set(null)}executeFocusedAction(){const t=this.allMenuItemsCache(),r=this.focusedItemIndexSignal();if(r<0||r>=t.length)return;const y=t[r];y.enabled&&y.action?this.executeAction(y.action):y.submenu&&y.enabled&&this.openFocusedSubmenu()}getIcon(t){return t&&C[t]||""}getAllMenuItems(){return this.allMenuItemsCache()}static{this.\u0275fac=function(r){return new(r||f)(e.KVO(E.G))}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})();var M=v(2262),B=v(2173),h=v(6212);let w=(()=>{class f{constructor(t,r){this.apiService=t,this.configService=r}handleFiles(t){Array.from(t).forEach(r=>{if(r.type.startsWith(a.Vu.IMAGE)){const y=new FileReader;y.onload=R=>{const _=R.target?.result;if(_){const X=(0,B.n)(M.R.Image,{src:_,x:100,y:100,width:200,height:200,zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId());this.apiService.addElements([X])}},y.readAsDataURL(r)}})}handleText(t,r,y=!1){const R=this.configService.getConfig(),{x:_,y:X}=(0,h.y1)(R,{x:r.clientX,y:r.clientY});let G=t,K={color:R.strokeColor,fontSize:R.fontSize,fontFamily:R.fontFamily,fontWeight:"normal",fontStyle:"normal"};if(y){const me=(new DOMParser).parseFromString(t,"text/html");G=(me.body.textContent||"").trim();const te=me.body.firstElementChild;if(te){const ne=window.getComputedStyle(te);K={color:ne.color||K.color,fontSize:parseInt(ne.fontSize)||K.fontSize,fontFamily:ne.fontFamily||K.fontFamily,fontWeight:"bold"===ne.fontWeight||parseInt(ne.fontWeight)>=700?"bold":"normal",fontStyle:"italic"===ne.fontStyle?"italic":"normal"}}}if(G){const ae=(0,B.n)(M.R.Text,{x:_,y:X+.8*K.fontSize,text:G,style:K,zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId());this.apiService.addElements([ae])}}handleElements(t,r){const y=this.configService.getConfig(),R=(0,h.y1)(y,{x:r.clientX,y:r.clientY}),_=t.map(X=>({...X,x:R.x+(X.x||0),y:R.y+(X.y||0),zIndex:this.apiService.getNextZIndex()}));this.apiService.addElements(_)}static{this.\u0275fac=function(r){return new(r||f)(e.KVO(E.G),e.KVO(i.w))}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})(),W=(()=>{class f{constructor(){this.apiService=(0,e.WQX)(E.G)}handleWheel(t){t.preventDefault(),t.ctrlKey?this.handleZoom(t):t.shiftKey?this.handleHorizontalPan(t):this.handleVerticalPan(t)}handleZoom(t){(t.deltaY<0?1:-1)>0?this.apiService.zoomIn():this.apiService.zoomOut()}handleHorizontalPan(t){const r=this.apiService.getConfig();this.apiService.pan(t.deltaY*a.aW/r.zoom,0)}handleVerticalPan(t){const r=this.apiService.getConfig();this.apiService.pan(0,t.deltaY*a.aW/r.zoom)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac})}}return f})(),z=(()=>{class f{constructor(t,r,y,R,_,X,G,K){this.toolsService=t,this.configService=r,this.EventBusService=y,this.keyboardShortcutService=R,this.apiService=_,this.contextMenuService=X,this.dragDropService=G,this.wheelHandlerService=K,this.pointerDownSig=(0,e.vPA)(null),this.pointerMoveSig=(0,e.vPA)(null),this.pointerUpSig=(0,e.vPA)(null),this.isSpaceHeld=!1}onPointerDown(t){if(t.button===a.fh.MIDDLE)return this.toolsService.pushTemporaryTool(n.p.Hand,a.Dr.PAN_MIDDLE),void this.safeGetHandTool()?.handlePointerDown?.(t);t.button!==a.fh.RIGHT&&!this.toolsService.hasTemporaryOverride()&&this.canDraw()&&(this.EventBusService.emit(u.w.DrawStart,t),this.toolsService.getActiveToolInstance()?.handlePointerDown?.(t),t.isDoubleClick&&this.EventBusService.emit(u.w.ElementDoubleClicked,{target:t.target,clientX:t.clientX,clientY:t.clientY}),this.pointerDownSig.set(t))}onPointerMove(t){this.toolsService.hasTemporaryOverride()?this.safeGetHandTool()?.handlePointerMove?.(t):this.canDraw()&&(this.EventBusService.emit(u.w.Drawing,t),this.toolsService.getActiveToolInstance()?.handlePointerMove?.(t),this.pointerMoveSig.set(t))}onPointerUp(t){if(t.button===a.fh.MIDDLE&&this.toolsService.hasTemporaryOverride())return this.safeGetHandTool()?.handlePointerUp?.(t),void this.toolsService.popTemporaryTool(a.Dr.PAN_MIDDLE);this.canDraw()&&(this.EventBusService.emit(u.w.DrawEnd),this.toolsService.getActiveToolInstance()?.handlePointerUp?.(t),this.pointerUpSig.set(t))}onKeyDown(t){if(t.code===a._.SPACE&&!this.isSpaceHeld&&!this.isTextToolEditing())return this.isSpaceHeld=!0,this.toolsService.pushTemporaryTool(n.p.Hand,a.Dr.PAN_SPACE),void t.preventDefault();this.toolsService.getActiveToolInstance()?.handleKeyDown?.(t),this.canUseKeyboardShortcuts()&&this.keyboardShortcutService.handleKeyDown(t)}onKeyUp(t){if(t.code===a._.SPACE&&this.isSpaceHeld&&!this.isTextToolEditing())return this.isSpaceHeld=!1,this.toolsService.popTemporaryTool(a.Dr.PAN_SPACE),void t.preventDefault();this.toolsService.getActiveToolInstance()?.handleKeyUp?.(t),this.canUseKeyboardShortcuts()&&this.keyboardShortcutService.handleKeyUp(t)}onWheel(t){this.canDraw()&&this.wheelHandlerService.handleWheel(t)}onDragOver(t){this.canDraw()&&t.dataTransfer&&(t.dataTransfer.dropEffect=a.c1.COPY)}onDrop(t){if(!this.canDraw())return;const r=t.dataTransfer?.files;if(r&&r.length>0)return void this.dragDropService.handleFiles(r);const y=t.dataTransfer?.getData(a.Wd.HTML);if(y)return void this.dragDropService.handleText(y,t,!0);const R=t.dataTransfer?.getData(a.Wd.PLAIN);if(R)return void this.dragDropService.handleText(R,t,!1);const _=t.dataTransfer?.getData(a.Wd.JSON);if(_)try{const X=JSON.parse(_);Array.isArray(X)&&this.dragDropService.handleElements(X,t)}catch(X){console.warn("Failed to parse dropped JSON:",X)}}onContextMenu(t,r){if(!this.canDraw())return;const y=this.getTargetElementFromPointer(t),R=this.apiService.selectedElements(),_=R.length>0;y?R.some(G=>G.id===y.id)||this.apiService.selectElements(y):_||this.apiService.clearSelection(),this.contextMenuService.showContextMenu(t.clientX,t.clientY,r)}canDraw(){return this.configService.getConfig().drawingEnabled}canUseKeyboardShortcuts(){return this.configService.getConfig().keyboardShortcutsEnabled}isTextToolEditing(){return this.toolsService.getActiveToolType()===n.p.Text&&!0===this.toolsService.getActiveToolInstance()?.isEditing}safeGetHandTool(){try{return this.toolsService.getToolInstance(n.p.Hand)}catch{return null}}getTargetElementFromPointer(t){const r=this.apiService.getElements();return(0,c.e)(t,r)}static{this.\u0275fac=function(r){return new(r||f)(e.KVO(o.H),e.KVO(i.w),e.KVO(p.W),e.KVO(l),e.KVO(E.G),e.KVO(g),e.KVO(w),e.KVO(W))}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})(),P=(()=>{class f{constructor(){this.configService=(0,e.WQX)(i.w),this.svgService=(0,e.WQX)(z),this.elementRef=(0,e.WQX)(e.aKT),this.isHovered=!1,this.lastInteractionTime=0,this.INTERACTION_TIMEOUT=500,this.handleMouseEnter=()=>{this.isHovered=!0,f.activeDirective=this},this.handleMouseLeave=()=>{this.isHovered=!1},this.handleInteraction=()=>{this.lastInteractionTime=Date.now(),f.activeDirective=this}}static{this.activeDirective=null}ngOnInit(){const t=this.elementRef.nativeElement;t.addEventListener("mouseenter",this.handleMouseEnter),t.addEventListener("mouseleave",this.handleMouseLeave),t.addEventListener("pointerdown",this.handleInteraction),t.addEventListener("pointerup",this.handleInteraction)}ngOnDestroy(){const t=this.elementRef.nativeElement;t.removeEventListener("mouseenter",this.handleMouseEnter),t.removeEventListener("mouseleave",this.handleMouseLeave),t.removeEventListener("pointerdown",this.handleInteraction),t.removeEventListener("pointerup",this.handleInteraction),f.activeDirective===this&&(f.activeDirective=null)}isActiveWhiteboard(){const t=Date.now()-this.lastInteractionTime<this.INTERACTION_TIMEOUT;return this.isHovered||t||f.activeDirective===this}onGlobalKeyDown(t){this.configService.getConfig().keyboardShortcutsEnabled&&this.isActiveWhiteboard()&&this.svgService.onKeyDown(t)}onGlobalKeyUp(t){this.configService.getConfig().keyboardShortcutsEnabled&&this.isActiveWhiteboard()&&this.svgService.onKeyUp(t)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275dir=e.FsC({type:f,selectors:[["","globalKeyboard",""]],hostBindings:function(r,y){1&r&&e.bIt("keydown",function(_){return y.onGlobalKeyDown(_)},!1,e.tSv)("keyup",function(_){return y.onGlobalKeyUp(_)},!1,e.tSv)},standalone:!0})}}return f})(),s=(()=>{class f{constructor(t){this.svgService=t,this.elementRef=(0,e.WQX)(e.aKT),this.lastClickTime=0,this.lastClickX=0,this.lastClickY=0,this.DOUBLE_CLICK_THRESHOLD=300,this.DOUBLE_CLICK_DISTANCE=10}onPointerDown(t){if(t.button!==a.fh.RIGHT&&t.preventDefault(),t.currentTarget&&t.currentTarget.setPointerCapture(t.pointerId),t.button===a.fh.RIGHT)return;const r=Date.now(),y=t.clientX,R=t.clientY;if(this.lastClickTime&&r-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(y-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE&&Math.abs(R-this.lastClickY)<this.DOUBLE_CLICK_DISTANCE){const X=this.createPointerInfo(t);return X.isDoubleClick=!0,this.svgService.onPointerDown(X),void(this.lastClickTime=0)}this.lastClickTime=r,this.lastClickX=y,this.lastClickY=R;const _=this.createPointerInfo(t);this.svgService.onPointerDown(_)}onPointerMove(t){if(t.clientX===this.lastX&&t.clientY===this.lastY||(this.lastX=t.clientX,this.lastY=t.clientY,2&t.buttons))return;const r=this.createPointerInfo(t);this.svgService.onPointerMove(r)}onPointerUp(t){if(this.lastX=t.clientX,this.lastY=t.clientY,t.currentTarget&&t.currentTarget.hasPointerCapture(t.pointerId)&&t.currentTarget.releasePointerCapture(t.pointerId),t.button===a.fh.RIGHT)return;const r=this.createPointerInfo(t);this.svgService.onPointerUp(r)}onWheel(t){t.preventDefault(),this.svgService.onWheel(t)}onKeyDown(t){t.preventDefault(),this.svgService.onKeyDown(t)}onKeyUp(t){this.svgService.onKeyUp(t)}onDragOver(t){t.preventDefault(),t.stopPropagation(),this.svgService.onDragOver(t)}onDragEnter(t){t.preventDefault(),t.stopPropagation()}onDrop(t){t.preventDefault(),t.stopPropagation(),this.svgService.onDrop(t)}onContextMenu(t){t.preventDefault();const r=this.createPointerInfo(t),y=t.currentTarget.getBoundingClientRect(),R=this.getPointerPosition(t),_={...r,clientX:y.left+R.x,clientY:y.top+R.y};this.svgService.onContextMenu(_,y)}createPointerInfo(t){const{x:r,y}=this.getPointerPosition(t);return{x:r,y,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,movementX:t.movementX,movementY:t.movementY,pressure:t.pressure,tangentialPressure:t.tangentialPressure,tiltX:t.tiltX,tiltY:t.tiltY,twist:t.twist,width:t.width,height:t.height,pointerType:t.pointerType,pointerId:t.pointerId,isPrimary:t.isPrimary,button:t.button,buttons:t.buttons,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,eventType:t.type,timeStamp:t.timeStamp,target:t.target}}getPointerPosition(t){const r=t.currentTarget.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}static{this.\u0275fac=function(r){return new(r||f)(e.rXU(z))}}static{this.\u0275dir=e.FsC({type:f,selectors:[["","svg",""]],hostBindings:function(r,y){1&r&&e.bIt("pointerdown",function(_){return y.onPointerDown(_)})("pointermove",function(_){return y.onPointerMove(_)})("pointerup",function(_){return y.onPointerUp(_)})("wheel",function(_){return y.onWheel(_)})("keydown",function(_){return y.onKeyDown(_)})("keyup",function(_){return y.onKeyUp(_)})("dragover",function(_){return y.onDragOver(_)})("dragenter",function(_){return y.onDragEnter(_)})("drop",function(_){return y.onDrop(_)})("contextmenu",function(_){return y.onContextMenu(_)})},standalone:!0})}}return f})();var T=v(1152);const k="nw-resize",L="ne-resize",d="ns-resize",b="ew-resize";let U=(()=>{class f{constructor(){this.cornerGrips=["nw","ne","se","sw"],this.sideGrips=["n","s","e","w"]}transform(t,r){if(t.includes("rotate"))return"grab";const y=this.isHorizontalOrientation(r);return this.cornerGrips.includes(t)?this.getCornerCursor(t,y):this.sideGrips.includes(t)?this.getSideCursor(t,y):"default"}isHorizontalOrientation(t){const r=t%180;return r<45||r>135}getCornerCursor(t,r){return"nw"===t||"se"===t?r?k:L:r?L:k}getSideCursor(t,r){return"n"===t||"s"===t?r?d:b:r?b:d}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275pipe=e.EJ8({name:"gripCursor",type:f,pure:!0,standalone:!0})}}return f})(),j=(()=>{class f{transform(t,r){if(t.isDeleting)return.1;let y=(t.opacity||100)/100;if(void 0!==t.style?.opacity&&(y*=t.style.opacity),t.layerId){const R=r.find(_=>_.id===t.layerId);R&&void 0!==R.opacity&&(y*=R.opacity)}return y}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275pipe=e.EJ8({name:"elementOpacity",type:f,pure:!0,standalone:!0})}}return f})();function q(f,F){return[f[0]-F[0],f[1]-F[1]]}function he(f,F){return function ee(f){return f[0]*f[0]+f[1]*f[1]}(q(f,F))}function re(f,F){return Math.hypot(f[1]-F[1],f[0]-F[0])}function de(f,F,t){return function Q(f,F){return[f[0]+F[0],f[1]+F[1]]}(f,function le(f,F){return[f[0]*F,f[1]*F]}(q(F,f),t))}function se(f){return[void 0!==f[0]?f[0]:0,void 0!==f[1]?f[1]:0,void 0!==f[2]?f[2]:1]}function ye(f,F){return Math.abs(f[0]-F[0])<1e-4&&Math.abs(f[1]-F[1])<1e-4}function ue(f){return`${ie(f[0])},${ie(f[1])} `}function oe(f,F){return`${ie((f[0]+F[0])/2)},${ie((f[1]+F[1])/2)} `}function ie(f){return Math.round(1e4*f)/1e4}let _e=(()=>{class f{transform(t,r){if(!t||0===t.length)return"";const y=function Pe(f,F={}){const{streamline:t=.5,size:r=16,simulatePressure:y=!1}=F;if(0===f.length)return[];const R=.15+.85*(1-t);let _=[...f],X=0;if(!y){let J=_[0];for(;J&&!(J[2]>=.025);)_.shift(),J=_[0]}if(!y){let J=_[_.length-1];for(;J&&!(J[2]>=.01);)_.pop(),J=_[_.length-1]}if(0===_.length){const J=f[0];return!J||"number"!=typeof J[0]||"number"!=typeof J[1]||isNaN(J[0])||isNaN(J[1])?[]:[se(J)]}let G=_[1];for(;G&&!(he(G,_[0])>(r/3)**2);)_[0][2]=Math.max(_[0][2],G[2]),_.splice(1,1),G=_[1];const K=_.pop();if(!K)return[];const ae=K;for(G=_[_.length-1];G&&!(he(G,ae)>(r/3)**2);)_.pop(),G=_[_.length-1],X++;_.push(ae);const me=F.last||!F.simulatePressure||_.length>1&&he(_[_.length-1],_[_.length-2])<r**2||X>0;if(2===_.length&&F.simulatePressure){const J=_[1];_=_.slice(0,-1);for(let xe=1;xe<5;xe++){const Oe=de(_[0],J,xe/4);Oe[2]=(_[0][2]+(J[2]-_[0][2]))*xe/4,_.push(Oe)}}const ce=[_[0]];let ve,Le,te=0,ne=ce[0];me&&t>0&&_.push(_[_.length-1]);for(let J=1,xe=_.length;J<xe;J++)ve=!R||F.last&&J===xe-1?_[J]:de(_[J],ne,1-R),!ye(ne,ve)&&(Le=re(ve,ne),te+=Le,!(J<4&&te<r)&&(ne=ve,ce.push(ve)));return ce}(t,r);return function De(f,F=!1){const t=f.length;if(0===t)return"";if(1===t){const _=f[0];if(!_||_.length<2||isNaN(_[0])||isNaN(_[1]))return"";const X=2;return`M ${_[0]} ${_[1]} m -${X}, 0 a ${X},${X} 0 1,0 ${2*X},0 a ${X},${X} 0 1,0 -${2*X},0`}let r=f[0],y=f[1];if(2===t)return`M${ue(r)}L${ue(y)}`;let R="";for(let _=2,X=t-1;_<X;_++)r=f[_],y=f[_+1],R+=oe(r,y);return F?`M${oe(f[0],f[1])}Q${ue(f[1])}${oe(f[1],f[2])}T${R}${oe(f[t-1],f[0])}${oe(f[0],f[1])}Z`:`M${ue(f[0])}Q${ue(f[1])}${oe(f[1],f[2])}${f.length>3?"T":""}${R}L${ue(f[t-1])}`}(y)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275pipe=e.EJ8({name:"pointsToPath",type:f,pure:!0,standalone:!0})}}return f})();const ke=["svgContainer"],Se=(f,F)=>F.id,pe=()=>["n","s","e","w"],Ee=()=>["nw","ne","se","sw"];function we(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"rect",15),e.k0s()),2&f){const t=e.XpG();e.BMQ("transform",t.gridConfig().transform),e.R7$(),e.BMQ("width",t.gridConfig().width+200)("height",t.gridConfig().height+200)}}function ge(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"path",17),e.nI1(2,"pointsToPath"),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("d",e.i5U(2,7,t.points,t.pathOptions))("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function fe(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"image",18),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("height",t.height)("width",t.width)("href",t.src,null,"xlink")("href",t.src)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function Te(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"line"),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)}}function Me(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"line",19),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)("fill",t.style.strokeColor)}}function be(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"rect"),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("rx",t.rx)("width",t.width)("height",t.height)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-linejoin",t.style.lineJoin)}}function Ae(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"ellipse"),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("cx",t.cx)("cy",t.cy)("rx",t.rx)("ry",t.ry)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke",t.style.strokeColor)("fill",t.style.fill)}}function Be(f,F){if(1&f&&(e.qSk(),e.j41(0,"tspan"),e.EFF(1),e.k0s()),2&f){const t=F.$implicit,r=F.$index,y=e.XpG(2).$implicit;e.BMQ("x",0)("dy",0===r?0:1.2*(y.style.fontSize||16)),e.R7$(),e.JRh(t)}}function Ne(f,F){if(1&f&&(e.qSk(),e.j41(0,"g")(1,"text",20),e.Z7z(2,Be,2,3,":svg:tspan",null,e.Vm6),e.k0s()()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("font-size",t.style.fontSize)("font-family",t.style.fontFamily)("fill",t.style.color)("font-style",t.style.fontStyle)("font-weight",t.style.fontWeight)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke",t.style.strokeColor)("stroke-width",t.style.strokeWidth),e.R7$(),e.Dyx(t.text.split("\n"))}}function We(f,F){if(1&f&&(e.qSk(),e.j41(0,"g",16),e.nI1(1,"elementOpacity"),e.DNE(2,ge,3,10)(3,fe,2,9)(4,Te,2,9)(5,Me,2,10)(6,be,2,9)(7,Ae,2,9)(8,Ne,4,11),e.k0s()),2&f){let t;const r=F.$implicit,y=e.XpG();e.xc7("pointer-events",r.isLocked?"none":"auto")("mix-blend-mode",r.blendMode),e.Y8G("id","item_"+r.id),e.BMQ("data-wb-id",r.id)("transform",r.transform)("opacity",e.i5U(1,9,r,y.layers())),e.R7$(2),e.vxM(2,(t=r.type)===y.types.Pen?2:t===y.types.Image?3:t===y.types.Line?4:t===y.types.Arrow?5:t===y.types.Rectangle?6:t===y.types.Ellipse?7:t===y.types.Text?8:-1)}}function He(f,F){if(1&f&&(e.qSk(),e.nrm(0,"rect",13)),2&f){const t=F;e.BMQ("x",t.x)("y",t.y)("width",t.width)("height",t.height)}}function Fe(f,F){if(1&f&&(e.qSk(),e.qex(0),e.nrm(1,"rect",24),e.nI1(2,"gripCursor"),e.bVm()),2&f){const t=F.$implicit,r=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_resize_"+t)("x","n"===t||"s"===t?r.x:"e"===t?r.x+r.width-5:r.x-5)("y","n"===t?r.y-5:"s"===t?r.y+r.height-5:r.y)("width","n"===t||"s"===t?r.width:10)("height","n"===t||"s"===t?10:r.height)("cursor",e.i5U(2,6,t,r.rotation))}}function Ze(f,F){if(1&f&&(e.qSk(),e.qex(0),e.nrm(1,"rect",25),e.nI1(2,"gripCursor"),e.bVm()),2&f){const t=F.$implicit,r=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_resize_"+t)("x",r.x+("ne"===t||"se"===t?r.width:0)-5)("y",r.y+("se"===t||"sw"===t?r.height:0)-5)("cursor",e.i5U(2,4,t,r.rotation))}}function Ye(f,F){if(1&f&&(e.qSk(),e.qex(0),e.nrm(1,"circle",26),e.nI1(2,"gripCursor"),e.bVm()),2&f){const t=F.$implicit,r=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_rotate_"+t)("cx",r.x+("ne"===t||"se"===t?r.width:-20)+10)("cy",r.y+("se"===t||"sw"===t?r.height:-20)+10)("cursor",e.i5U(2,4,"rotate_"+t,r.rotation))}}function Ue(f,F){if(1&f&&(e.qSk(),e.j41(0,"g",14),e.nrm(1,"rect",21),e.DNE(2,Fe,3,9,"ng-container",22)(3,Ze,3,7,"ng-container",22),e.nrm(4,"circle",23),e.DNE(5,Ye,3,7,"ng-container",22),e.k0s()),2&f){const t=F;e.BMQ("transform","rotate("+t.rotation+","+(t.x+t.width/2)+","+(t.y+t.height/2)+")"),e.R7$(),e.BMQ("x",t.x)("y",t.y)("width",t.width)("height",t.height),e.R7$(),e.Y8G("ngForOf",e.lJ4(10,pe)),e.R7$(),e.Y8G("ngForOf",e.lJ4(11,Ee)),e.R7$(),e.BMQ("cx",t.handles.rotateHandle.x)("cy",t.handles.rotateHandle.y),e.R7$(),e.Y8G("ngForOf",e.lJ4(12,Ee))}}let Xe=(()=>{class f{constructor(){this.apiService=(0,e.WQX)(E.G),this.configService=(0,e.WQX)(i.w),this.toolsService=(0,e.WQX)(o.H),this.selectionService=(0,e.WQX)(T.A),this.canvasService=(0,e.WQX)(D.W),this.svgService=(0,e.WQX)(z),this.config=this.configService.getConfigSignal(),this.elements=this.apiService.allElements,this.layers=this.apiService.layers,this.selectedToolSignal=this.toolsService.selectedTool,this.selectionBoxSignal=this.selectionService.getSelectionBoxSignal(),this.boundingBoxSignal=this.selectionService.getBoundingBoxSignal(),this.transform=this.canvasService.getTransform(),this.filteredElements=(0,e.EWP)(()=>{const t=this.layers(),r=this.elements(),R=t.filter(G=>G.visible).map(G=>G.id);if(0===R.length)return[];const _=r.filter(G=>!G.layerId||R.includes(G.layerId));return(G=_,G.slice().sort((K,ae)=>{const me=K.layerId?t.find(ve=>ve.id===K.layerId):void 0,ce=ae.layerId?t.find(ve=>ve.id===ae.layerId):void 0;return 1e3*(me?.zIndex??0)+(K.zIndex??0)-(1e3*(ce?.zIndex??0)+(ae.zIndex??0))})).map(G=>({...G,transform:this.buildTransform(G),isLocked:this.computeIsLocked(G,t),blendMode:this.computeBlendMode(G,t)}));var G}),this.canvasWidth=(0,e.EWP)(()=>this.config().canvasWidth),this.canvasHeight=(0,e.EWP)(()=>this.config().canvasHeight),this.zoom=(0,e.EWP)(()=>this.config().zoom),this.x=(0,e.EWP)(()=>this.config().x),this.y=(0,e.EWP)(()=>this.config().y),this.canvasX=(0,e.EWP)(()=>this.config().canvasX),this.canvasY=(0,e.EWP)(()=>this.config().canvasY),this.gridSize=(0,e.EWP)(()=>this.config().gridSize),this.backgroundColor=(0,e.EWP)(()=>this.config().backgroundColor),this.enableGrid=(0,e.EWP)(()=>this.config().enableGrid),this.fullScreen=(0,e.EWP)(()=>this.config().fullScreen),this.svgDimensions=(0,e.EWP)(()=>{const t=this.fullScreen(),r=this.canvasWidth(),y=this.canvasHeight(),R=this.zoom();return t?{width:"100%",height:"100%"}:{width:r*R+"px",height:y*R+"px"}}),this.svgViewBox=(0,e.EWP)(()=>this.fullScreen()?`0 0 ${this.canvasWidth()/this.zoom()} ${this.canvasHeight()/this.zoom()}`:`0 0 ${this.canvasWidth()} ${this.canvasHeight()}`),this.contentTransform=(0,e.EWP)(()=>`translate(${this.x()}, ${this.y()})`),this.gridConfig=(0,e.EWP)(()=>{const t=this.x(),r=this.y(),y=this.zoom();return{transform:`translate(${t%100}, ${r%100})`,width:(this.canvasWidth()+100)/y,height:(this.canvasHeight()+100)/y}}),this.cursor=(0,e.EWP)(()=>this.toolsService.cursor()),this.types=M.R,this.tools=n.p}buildTransform(t){return`translate(${t.x},${t.y}) rotate(${t.rotation}) scale(${t.scaleX??1},${t.scaleY??1})`}computeIsLocked(t,r){return t.layerId&&r.find(R=>R.id===t.layerId)?.locked||!1}computeBlendMode(t,r){return t.layerId&&r.find(R=>R.id===t.layerId)?.blendMode||"normal"}ngAfterViewInit(){this.apiService.initializeWhiteboard(this.svgContainer.nativeElement)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275cmp=e.VBU({type:f,selectors:[["ng-whiteboard-canvas"]],viewQuery:function(r,y){if(1&r&&e.GBs(ke,5),2&r){let R;e.mGM(R=e.lsd())&&(y.svgContainer=R.first)}},standalone:!0,features:[e.aNF],decls:18,vars:17,consts:[["svgContainer",""],["id","svgroot","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","tabindex","0","svg","","resizeHandler","","globalKeyboard",""],["id","svgcontent"],["id","smallGrid","patternUnits","userSpaceOnUse"],["fill","none","stroke","gray","stroke-width","0.5"],["id","grid","width","100","height","100","patternUnits","userSpaceOnUse"],["width","100","height","100","fill","url(#smallGrid)"],["d","M 100 0 H 0 V 100","fill","none","stroke","gray","stroke-width","2"],["id","arrow","refX","3","refY","3","markerWidth","6","markerHeight","6","stroke","context-stroke","fill","none","orient","auto"],["d","M 0 0 L 3 3 L 0 6"],["width","100%","height","100%"],[2,"pointer-events","all"],["transform-origin","center",1,"wb_element",3,"id","pointer-events","mix-blend-mode"],["stroke","blue","stroke-dasharray","5,5","fill","transparent"],["id","selectorParentGroup"],["x","-100","y","-100","fill","url(#grid)"],["transform-origin","center",1,"wb_element",3,"id"],["fill","none"],["preserveAspectRatio","none"],["marker-end","url(#arrow)"],["text-anchor","start","alignment-baseline","before-edge"],["id","selectorBox","fill","transparent","stroke","dodgerblue","stroke-width","1","cursor","move","pointer-events","all"],[4,"ngFor","ngForOf"],["id","selectorGrip_rotate_n","r","6","fill","white","stroke","green","stroke-width","1","cursor","grab"],["fill","transparent","stroke","transparent","pointer-events","all"],["width","10","height","10","fill","white","stroke","dodgerblue","stroke-width","1"],["r","6","fill","none","stroke","none","stroke-width","1"]],template:function(r,y){if(1&r&&(e.qSk(),e.j41(0,"svg",1,0)(2,"svg",2)(3,"defs")(4,"pattern",3),e.nrm(5,"path",4),e.k0s(),e.j41(6,"pattern",5),e.nrm(7,"rect",6)(8,"path",7),e.k0s(),e.j41(9,"marker",8),e.nrm(10,"path",9),e.k0s()(),e.nrm(11,"rect",10),e.DNE(12,we,2,3,":svg:g"),e.j41(13,"g",11),e.Z7z(14,We,9,12,":svg:g",12,Se),e.DNE(16,He,1,4,":svg:rect",13)(17,Ue,6,13,":svg:g",14),e.k0s()()()),2&r){let R,_;e.HbH("svgroot "+y.selectedToolSignal()),e.xc7("cursor",y.cursor()),e.R7$(2),e.BMQ("width",y.svgDimensions().width)("height",y.svgDimensions().height)("viewBox",y.svgViewBox())("x",y.canvasX())("y",y.canvasY()),e.R7$(2),e.BMQ("width",y.gridSize())("height",y.gridSize()),e.R7$(),e.BMQ("d","M "+y.gridSize()+" 0 H 0 V "+y.gridSize()),e.R7$(6),e.BMQ("fill",y.backgroundColor()),e.R7$(),e.vxM(12,y.enableGrid()?12:-1),e.R7$(),e.BMQ("transform",y.contentTransform()),e.R7$(),e.Dyx(y.filteredElements()),e.R7$(2),e.vxM(16,(R=y.selectionBoxSignal())?16:-1,R),e.R7$(),e.vxM(17,(_=y.boundingBoxSignal())?17:-1,_)}},dependencies:[S.MD,S.Sq,U,j,_e,s,m,P],styles:["[_nghost-%COMP%]{width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]{position:absolute;inset:0;-webkit-user-select:none;user-select:none;outline:none;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit;background-size:cover;background-position:50%;background-repeat:no-repeat;touch-action:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]:focus{outline:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%], [_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .selectorGroup[_ngcontent-%COMP%]{transform-box:fill-box;transform-origin:center}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-family:Arial,Helvetica,sans-serif}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0})}}return f})();const je=["contextMenu"],Re=(f,F)=>F.id;function Ge(f,F){if(1&f&&(e.j41(0,"span",9),e.EFF(1),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.shortcut)}}function Ve(f,F){1&f&&(e.j41(0,"span",10),e.EFF(1,"\u203a"),e.k0s())}function Ke(f,F){if(1&f){const t=e.RV6();e.j41(0,"div",6),e.bIt("click",function(y){const R=e.eBV(t).$implicit,_=e.XpG(2);return e.Njj(_.onItemClick(R,y))})("mouseenter",function(y){const R=e.eBV(t).$implicit,_=e.XpG(2);return e.Njj(_.onItemHover(R,y))})("mouseleave",function(){e.eBV(t);const y=e.XpG(2);return e.Njj(y.onItemLeave())}),e.j41(1,"div",7)(2,"span",8),e.EFF(3),e.k0s(),e.DNE(4,Ge,2,1,"span",9)(5,Ve,2,0,"span",10),e.k0s()()}if(2&f){const t=F.$implicit,r=e.XpG(2);e.AVh("disabled",!t.enabled)("divider-after",t.divider)("has-submenu",t.submenu)("active",r.hoveredItem===t)("focused",r.isFocused(t)),e.BMQ("title",t.shortcut||null),e.R7$(3),e.JRh(t.label),e.R7$(),e.vxM(4,t.shortcut?4:-1),e.R7$(),e.vxM(5,t.submenu?5:-1)}}function $e(f,F){if(1&f&&(e.j41(0,"div",3),e.Z7z(1,Ke,6,14,"div",5,Re),e.k0s()),2&f){const t=F.$implicit;e.R7$(),e.Dyx(t.items)}}function Qe(f,F){if(1&f&&(e.j41(0,"span",9),e.EFF(1),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.shortcut)}}function Je(f,F){if(1&f){const t=e.RV6();e.j41(0,"div",13),e.bIt("click",function(y){const R=e.eBV(t).$implicit,_=e.XpG(2);return e.Njj(_.onItemClick(R,y))}),e.j41(1,"div",7)(2,"span",8),e.EFF(3),e.k0s(),e.DNE(4,Qe,2,1,"span",9),e.k0s()()}if(2&f){const t=F.$implicit,r=e.XpG(2);e.AVh("disabled",!t.enabled)("divider-after",t.divider)("focused",r.isFocused(t)),e.BMQ("title",t.shortcut||null),e.R7$(3),e.JRh(t.label),e.R7$(),e.vxM(4,t.shortcut?4:-1)}}function qe(f,F){if(1&f){const t=e.RV6();e.j41(0,"div",11),e.bIt("mouseenter",function(){e.eBV(t);const y=e.XpG();return e.Njj(y.onSubmenuEnter())})("mouseleave",function(){e.eBV(t);const y=e.XpG();return e.Njj(y.onSubmenuLeave())})("click",function(y){return e.eBV(t),e.Njj(y.stopPropagation())}),e.Z7z(1,Je,5,9,"div",12,Re),e.k0s()}if(2&f){const t=e.XpG();e.xc7("left",t.submenuPosition.left,"px")("top",t.submenuPosition.top,"px"),e.R7$(),e.Dyx(t.hoveredItem.submenu)}}let et=(()=>{class f{constructor(t){this.contextMenuService=t,this.hoveredItem=null,this.submenuPosition={left:0,top:0},this.submenuTimeout=null,this.isVisible=this.contextMenuService.getContextMenuVisible(),this.position=this.contextMenuService.getContextMenuPosition(),this.sections=this.contextMenuService.getContextMenuSections(),this.containerBounds=this.contextMenuService.getContainerBounds(),this.focusedItem=(0,e.EWP)(()=>{const r=this.contextMenuService.getFocusedItemIndex()();return this.contextMenuService.getAllMenuItems()[r]||null})}ngOnInit(){this.position=(0,e.EWP)(()=>{const t=this.contextMenuService.getContextMenuPosition()(),r=this.containerBounds();let y=t.x,R=t.y;return r&&(y=t.x-r.left,R=t.y-r.top),this.adjustPosition(y,R)})}ngOnDestroy(){this.contextMenuService.hideContextMenu(),this.submenuTimeout&&clearTimeout(this.submenuTimeout)}onItemClick(t,r){if(t.enabled){if(t.submenu)return void r.stopPropagation();t.action&&this.contextMenuService.executeAction(t.action)}}onItemHover(t,r){this.submenuTimeout&&(clearTimeout(this.submenuTimeout),this.submenuTimeout=null),t.submenu&&t.enabled?(this.hoveredItem=t,this.calculateSubmenuPosition(r.currentTarget)):this.hoveredItem=null}onItemLeave(){this.submenuTimeout&&clearTimeout(this.submenuTimeout),this.submenuTimeout=setTimeout(()=>{this.hoveredItem=null},100)}onSubmenuEnter(){this.submenuTimeout&&(clearTimeout(this.submenuTimeout),this.submenuTimeout=null)}onSubmenuLeave(){this.submenuTimeout&&clearTimeout(this.submenuTimeout),this.submenuTimeout=setTimeout(()=>{this.hoveredItem=null},100)}calculateSubmenuPosition(t){const r=t.getBoundingClientRect(),y=this.containerBounds();if(!y)return void(this.submenuPosition={left:r.right+4,top:r.top-4});const R=200,X=r.left-y.left,G=r.right-y.left,K=r.top-y.top,me=this.contextMenu?.nativeElement?.getBoundingClientRect(),ce=me?me.top-y.top:4,te=me?me.bottom-y.top:y.height-4;let ne=G+4;const ve=y.width-G-4;ve<R&&X-4>ve&&(ne=X-R-4);let J=K;const ze=32*(this.hoveredItem?.submenu?.length||0)+8;J+ze>te&&(J=te-ze),J<ce&&(J=ce),ne<4&&(ne=4),ne+R>y.width-4&&(ne=y.width-R-4),this.submenuPosition={left:ne,top:J}}onKeyDown(t){if(this.isVisible())switch(t.key){case"Escape":t.preventDefault(),this.contextMenuService.hideContextMenu();break;case"ArrowDown":t.preventDefault(),this.contextMenuService.focusNextItem();break;case"ArrowUp":t.preventDefault(),this.contextMenuService.focusPreviousItem();break;case"ArrowRight":t.preventDefault(),this.contextMenuService.openFocusedSubmenu();break;case"ArrowLeft":t.preventDefault(),this.contextMenuService.closeFocusedSubmenu();break;case"Enter":t.preventDefault(),this.contextMenuService.executeFocusedAction();break;case"Home":t.preventDefault(),this.contextMenuService.focusFirstItem();break;case"End":t.preventDefault(),this.contextMenuService.focusLastItem()}}onDocumentClick(t){this.isVisible()&&this.contextMenu?.nativeElement&&(this.contextMenu.nativeElement.contains(t.target)||this.contextMenuService.hideContextMenu())}adjustPosition(t,r){if(!this.contextMenu?.nativeElement)return{x:t,y:r};const R=this.contextMenu.nativeElement.getBoundingClientRect(),_=this.containerBounds();if(!_)return{x:t,y:r};let X=t,G=r;const K=10;t+R.width>_.width-K&&(X=Math.max(K,t-R.width)),X<K&&(X=K);const me=_.height-r-K,ce=Math.min(R.height,400);if(ce>me){const te=r-K;G=ce<=te?r-ce:te>me?r-Math.min(ce,te):Math.max(K,_.height-ce-K)}return G<K&&(G=K),G+ce>_.height-K&&(G=_.height-ce-K),{x:X,y:G}}isFocused(t){return this.focusedItem()===t}static{this.\u0275fac=function(r){return new(r||f)(e.rXU(g))}}static{this.\u0275cmp=e.VBU({type:f,selectors:[["wb-context-menu"]],viewQuery:function(r,y){if(1&r&&e.GBs(je,7),2&r){let R;e.mGM(R=e.lsd())&&(y.contextMenu=R.first)}},hostBindings:function(r,y){1&r&&e.bIt("keydown",function(_){return y.onKeyDown(_)},!1,e.EBC)("click",function(_){return y.onDocumentClick(_)},!1,e.EBC)},standalone:!0,features:[e.aNF],decls:6,vars:7,consts:[["contextMenu",""],[1,"context-menu",3,"click"],[1,"context-menu-content"],[1,"context-menu-section"],[1,"submenu",3,"left","top"],[1,"context-menu-item",3,"disabled","divider-after","has-submenu","active","focused"],[1,"context-menu-item",3,"click","mouseenter","mouseleave"],[1,"item-content"],[1,"item-label"],[1,"item-shortcut"],[1,"item-arrow"],[1,"submenu",3,"mouseenter","mouseleave","click"],[1,"context-menu-item","submenu-item",3,"disabled","divider-after","focused"],[1,"context-menu-item","submenu-item",3,"click"]],template:function(r,y){if(1&r){const R=e.RV6();e.j41(0,"div",1,0),e.bIt("click",function(X){return e.eBV(R),e.Njj(X.stopPropagation())}),e.j41(2,"div",2),e.Z7z(3,$e,3,0,"div",3,Re),e.k0s()(),e.DNE(5,qe,3,4,"div",4)}2&r&&(e.xc7("left",y.position().x,"px")("top",y.position().y,"px"),e.AVh("visible",y.isVisible()),e.R7$(3),e.Dyx(y.sections()),e.R7$(2),e.vxM(5,y.hoveredItem&&y.hoveredItem.submenu?5:-1))},dependencies:[S.MD],styles:['.context-menu[_ngcontent-%COMP%]{position:absolute;z-index:10000;opacity:0;visibility:hidden;transform:scale(.95);transition:all .1s ease-out;pointer-events:none}.context-menu.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;transform:scale(1);pointer-events:auto}.context-menu-content[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:6px;box-shadow:0 4px 12px #00000026;padding:4px 0;min-width:200px;max-width:300px;max-height:400px;overflow-y:auto;-webkit-user-select:none;user-select:none}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.context-menu-section[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #f0f0f0;margin-bottom:4px;padding-bottom:4px}.context-menu-item[_ngcontent-%COMP%]{padding:8px 16px;cursor:pointer;transition:background-color .1s ease;position:relative}.context-menu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#f5f5f5}.context-menu-item.focused[_ngcontent-%COMP%]:not(.disabled){background-color:#e3f2fd;outline:2px solid #2196f3;outline-offset:-2px}.context-menu-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.context-menu-item.divider-after[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:16px;right:16px;height:1px;background-color:#e0e0e0;margin-bottom:-4px}.item-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.item-label[_ngcontent-%COMP%]{flex:1;font-size:14px;color:#333;font-weight:400}.item-shortcut[_ngcontent-%COMP%]{font-size:12px;color:#666;margin-left:16px;font-family:Monaco,Menlo,Ubuntu Mono,monospace}.item-arrow[_ngcontent-%COMP%]{margin-left:8px;font-size:16px;color:#999}.context-menu-item.has-submenu[_ngcontent-%COMP%]{position:relative}.context-menu-item.has-submenu.active[_ngcontent-%COMP%]{background-color:#f5f5f5}.submenu[_ngcontent-%COMP%]{position:absolute;background:#fff;border:1px solid #e0e0e0;border-radius:6px;box-shadow:0 4px 12px #00000026;padding:4px 0;min-width:200px;max-width:300px;-webkit-user-select:none;user-select:none;z-index:10001;opacity:1;transform:scale(1);transition:opacity .1s ease,transform .1s ease}.submenu-item[_ngcontent-%COMP%]{padding:8px 16px}.submenu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#f5f5f5}.context-menu-item.disabled[_ngcontent-%COMP%]   .item-label[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-shortcut[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-arrow[_ngcontent-%COMP%]{color:#999}@media (prefers-color-scheme: dark){.context-menu-content[_ngcontent-%COMP%], .submenu[_ngcontent-%COMP%]{background:#2a2a2a;border-color:#404040}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#3a3a3a}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#666}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#777}.context-menu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#404040}.context-menu-item.focused[_ngcontent-%COMP%]:not(.disabled){background-color:#1e3a5f;outline:2px solid #1976d2}.context-menu-item.has-submenu.active[_ngcontent-%COMP%]{background-color:#404040}.submenu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#404040}.item-label[_ngcontent-%COMP%]{color:#e0e0e0}.item-shortcut[_ngcontent-%COMP%]{color:#a0a0a0}.item-arrow[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-label[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-shortcut[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-arrow[_ngcontent-%COMP%]{color:#666}.context-menu-section[_ngcontent-%COMP%]:not(:last-child){border-bottom-color:#404040}.context-menu-item.divider-after[_ngcontent-%COMP%]:after{background-color:#404040}}']})}}return f})();var tt=v(6255),nt=v(3437),it=v(875),st=v(1389),ot=v(3909),rt=v(3452),at=v(4764),lt=v(710);let ct=(()=>{class f{constructor(){this.configService=(0,e.WQX)(i.w),this.apiService=(0,e.WQX)(E.G),this.toolsService=(0,e.WQX)(o.H),this.eventBusService=(0,e.WQX)(p.W),this.cd=(0,e.WQX)(e.gRc),this.instanceService=(0,e.WQX)(O.b),this.boardId=crypto.randomUUID(),this.ready=new e.bkB,this.destroyed=new e.bkB,this.drawStart=new e.bkB,this.drawing=new e.bkB,this.drawEnd=new e.bkB,this.elementsAdded=new e.bkB,this.elementsUpdated=new e.bkB,this.elementsSelected=new e.bkB,this.elementsRemoved=new e.bkB,this.elementDoubleClicked=new e.bkB,this.undo=new e.bkB,this.redo=new e.bkB,this.clear=new e.bkB,this.dataChange=new e.bkB,this.save=new e.bkB,this.imageAdded=new e.bkB,this.selectedToolChange=new e.bkB,this.configChange=new e.bkB,this.zoomChange=new e.bkB,this.eventsMap={[u.w.Ready]:this.ready,[u.w.Destroyed]:this.destroyed,[u.w.DrawStart]:this.drawStart,[u.w.Drawing]:this.drawing,[u.w.DrawEnd]:this.drawEnd,[u.w.ElementsAdded]:this.elementsAdded,[u.w.ElementsUpdated]:this.elementsUpdated,[u.w.ElementsSelected]:this.elementsSelected,[u.w.ElementsRemoved]:this.elementsRemoved,[u.w.ElementDoubleClicked]:this.elementDoubleClicked,[u.w.Undo]:this.undo,[u.w.Redo]:this.redo,[u.w.Clear]:this.clear,[u.w.DataChange]:this.dataChange,[u.w.Save]:this.save,[u.w.ImageAdded]:this.imageAdded,[u.w.ToolChange]:this.selectedToolChange,[u.w.ConfigChange]:this.configChange,[u.w.ZoomChange]:this.zoomChange}}set config(t){this.configService.updateConfig(t,!1)}get config(){return this.configService.getConfig()}set data(t){t&&t!==this.apiService.getElements()&&this.apiService.setElements(t)}set selectedTool(t){t&&this.toolsService.getActiveToolType()!==t&&this.toolsService.setActiveTool(t)}ngOnInit(){this.instanceService.register(this.boardId,this.apiService),this.eventsSubscription=this.eventBusService.listen().subscribe(t=>{const r=this.eventsMap[t.type];r&&(void 0!==t.payload?r.emit(t.payload):r.emit(),this.cd.markForCheck())})}ngOnDestroy(){this.instanceService.unregister(this.boardId),this.eventBusService.emit(u.w.Destroyed),this.eventsSubscription&&this.eventsSubscription.unsubscribe()}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275cmp=e.VBU({type:f,selectors:[["ng-whiteboard"]],inputs:{boardId:"boardId",config:"config",data:"data",selectedTool:"selectedTool"},outputs:{ready:"ready",destroyed:"destroyed",drawStart:"drawStart",drawing:"drawing",drawEnd:"drawEnd",elementsAdded:"elementsAdded",elementsUpdated:"elementsUpdated",elementsSelected:"elementsSelected",elementsRemoved:"elementsRemoved",elementDoubleClicked:"elementDoubleClicked",undo:"undo",redo:"redo",clear:"clear",dataChange:"dataChange",save:"save",imageAdded:"imageAdded",selectedToolChange:"selectedToolChange",configChange:"configChange",zoomChange:"zoomChange"},standalone:!0,features:[e.Jv_([z,E.G,tt.L,D.W,st.q,at.T,lt.l,T.A,ot.W,o.H,rt.r,p.W,i.w,l,nt.a,it.k,g,w,W]),e.aNF],decls:3,vars:0,consts:[[2,"width","100%","height","100%","position","relative"]],template:function(r,y){1&r&&(e.j41(0,"div",0),e.nrm(1,"ng-whiteboard-canvas")(2,"wb-context-menu"),e.k0s())},dependencies:[S.MD,Xe,et],styles:["[_nghost-%COMP%]{display:block;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}"],changeDetection:0})}}return f})()},152:($,Z,v)=>{v.d(Z,{B:()=>O});var S=v(3236),e=v(9974),E=v(4360);function O(D,i=S.E){return(0,e.N)((m,a)=>{let u=null,n=null,c=null;const o=()=>{if(u){u.unsubscribe(),u=null;const I=n;n=null,a.next(I)}};function p(){const I=c+D,l=i.now();if(l<I)return u=this.schedule(void 0,I-l),void a.add(u);o()}m.subscribe((0,E._)(a,I=>{n=I,c=i.now(),u||(u=i.schedule(p,D),a.add(u))},()=>{o(),a.complete()},void 0,()=>{n=u=null}))})}},6780:($,Z,v)=>{v.d(Z,{R:()=>D});var S=v(8359);class e extends S.yU{constructor(m,a){super()}schedule(m,a=0){return this}}const E={setInterval(i,m,...a){const{delegate:u}=E;return u?.setInterval?u.setInterval(i,m,...a):setInterval(i,m,...a)},clearInterval(i){const{delegate:m}=E;return(m?.clearInterval||clearInterval)(i)},delegate:void 0};var O=v(7908);class D extends e{constructor(m,a){super(m,a),this.scheduler=m,this.work=a,this.pending=!1}schedule(m,a=0){var u;if(this.closed)return this;this.state=m;const n=this.id,c=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(c,n,a)),this.pending=!0,this.delay=a,this.id=null!==(u=this.id)&&void 0!==u?u:this.requestAsyncId(c,this.id,a),this}requestAsyncId(m,a,u=0){return E.setInterval(m.flush.bind(m,this),u)}recycleAsyncId(m,a,u=0){if(null!=u&&this.delay===u&&!1===this.pending)return a;null!=a&&E.clearInterval(a)}execute(m,a){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const u=this._execute(m,a);if(u)return u;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(m,a){let n,u=!1;try{this.work(m)}catch(c){u=!0,n=c||new Error("Scheduled action threw falsy error")}if(u)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:m,scheduler:a}=this,{actions:u}=a;this.work=this.state=this.scheduler=null,this.pending=!1,(0,O.o)(u,this),null!=m&&(this.id=this.recycleAsyncId(a,m,null)),this.delay=null,super.unsubscribe()}}}},3604:($,Z,v)=>{v.d(Z,{q:()=>E});const S={now:()=>(S.delegate||Date).now(),delegate:void 0};class e{constructor(D,i=e.now){this.schedulerActionCtor=D,this.now=i}schedule(D,i=0,m){return new this.schedulerActionCtor(this,D).schedule(m,i)}}e.now=S.now;class E extends e{constructor(D,i=e.now){super(D,i),this.actions=[],this._active=!1}flush(D){const{actions:i}=this;if(this._active)return void i.push(D);let m;this._active=!0;do{if(m=D.execute(D.state,D.delay))break}while(D=i.shift());if(this._active=!1,m){for(;D=i.shift();)D.unsubscribe();throw m}}}},3236:($,Z,v)=>{v.d(Z,{E:()=>E,b:()=>O});var S=v(6780);const E=new(v(3604).q)(S.R),O=E}}]);