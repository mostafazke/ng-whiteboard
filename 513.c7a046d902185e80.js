"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[513],{5513:(Y_,tr,X)=>{X.r(tr),X.d(tr,{LiveAppModule:()=>J_});var Be=X(6895),nr=X(9430),xe=X(2720);function ir(n,e,t,i,o,s,a){try{var l=n[s](a),c=l.value}catch(u){return void t(u)}l.done?e(c):Promise.resolve(c).then(i,o)}function w(n){return function(){var e=this,t=arguments;return new Promise(function(i,o){var s=n.apply(e,t);function a(c){ir(s,i,o,a,l,"next",c)}function l(c){ir(s,i,o,a,l,"throw",c)}a(void 0)})}}const f=function(n,e){if(!n)throw ze(e)},ze=function(n){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+n)},or=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=63&o|128):55296==(64512&o)&&i+1<n.length&&56320==(64512&n.charCodeAt(i+1))?(o=65536+((1023&o)<<10)+(1023&n.charCodeAt(++i)),e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=63&o|128):(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=63&o|128)}return e},Mn={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let o=0;o<n.length;o+=3){const s=n[o],a=o+1<n.length,l=a?n[o+1]:0,c=o+2<n.length,u=c?n[o+2]:0;let p=(15&l)<<2|u>>6,_=63&u;c||(_=64,a||(p=64)),i.push(t[s>>2],t[(3&s)<<4|l>>4],t[p],t[_])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(or(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):function(n){const e=[];let t=0,i=0;for(;t<n.length;){const o=n[t++];if(o<128)e[i++]=String.fromCharCode(o);else if(o>191&&o<224){const s=n[t++];e[i++]=String.fromCharCode((31&o)<<6|63&s)}else if(o>239&&o<365){const c=((7&o)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(1023&c))}else{const s=n[t++],a=n[t++];e[i++]=String.fromCharCode((15&o)<<12|(63&s)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let o=0;o<n.length;){const s=t[n.charAt(o++)],l=o<n.length?t[n.charAt(o)]:0;++o;const u=o<n.length?t[n.charAt(o)]:64;++o;const d=o<n.length?t[n.charAt(o)]:64;if(++o,null==s||null==l||null==u||null==d)throw Error();i.push(s<<2|l>>4),64!==u&&(i.push(l<<4&240|u>>2),64!==d&&i.push(u<<6&192|d))}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},rr=function(n){const e=or(n);return Mn.encodeByteArray(e,!0)},Zt=function(n){return rr(n).replace(/\./g,"")},Pn=function(n){try{return Mn.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function al(n){return sr(void 0,n)}function sr(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===n&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!ll(t)||(n[t]=sr(n[t],e[t]));return n}function ll(n){return"__proto__"!==n}function ar(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(function Ft(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}())}function lr(){return"object"==typeof indexedDB}function cr(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",o=self.indexedDB.open(i);o.onsuccess=()=>{o.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},o.onupgradeneeded=()=>{t=!1},o.onerror=()=>{var s;e((null===(s=o.error)||void 0===s?void 0:s.message)||"")}}catch(t){e(t)}})}const Ln=()=>{try{return function pl(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;return n?JSON.parse(n):void 0})()||(()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Pn(n[1]);return e&&JSON.parse(e)})()}catch(n){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`)}};class at{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,i))}}}class Ce extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,Ce.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ut.prototype.create)}}class Ut{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},o=`${this.service}/${e}`,s=this.errors[e],a=s?function xl(n,e){return n.replace(Cl,(t,i)=>{const o=e[i];return null!=o?String(o):`<${i}?>`})}(s,i):"Error";return new Ce(o,`${this.serviceName}: ${a} (${o}).`,i)}}const Cl=/\{\$([^}]+)}/g;function lt(n){return JSON.parse(n)}function D(n){return JSON.stringify(n)}const Bt=function(n){let e={},t={},i={},o="";try{const s=n.split(".");e=lt(Pn(s[0])||""),t=lt(Pn(s[1])||""),o=s[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:o}};function te(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function qe(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function ur(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function zt(n,e,t){const i={};for(const o in n)Object.prototype.hasOwnProperty.call(n,o)&&(i[o]=e.call(t,n[o],o,n));return i}function qt(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const o of t){if(!i.includes(o))return!1;const s=n[o],a=e[o];if(dr(s)&&dr(a)){if(!qt(s,a))return!1}else if(s!==a)return!1}for(const o of i)if(!t.includes(o))return!1;return!0}function dr(n){return null!==n&&"object"==typeof n}class Il{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if("string"==typeof e)for(let d=0;d<16;d++)i[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)i[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){const p=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=4294967295&(p<<1|p>>>31)}let u,h,o=this.chain_[0],s=this.chain_[1],a=this.chain_[2],l=this.chain_[3],c=this.chain_[4];for(let d=0;d<80;d++){d<40?d<20?(u=l^s&(a^l),h=1518500249):(u=s^a^l,h=1859775393):d<60?(u=s&a|l&(s|a),h=2400959708):(u=s^a^l,h=3395469782);const p=(o<<5|o>>>27)+u+c+h+i[d]&4294967295;c=l,l=a,a=4294967295&(s<<30|s>>>2),s=o,o=p}this.chain_[0]=this.chain_[0]+o&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const i=t-this.blockSize;let o=0;const s=this.buf_;let a=this.inbuf_;for(;o<t;){if(0===a)for(;o<=i;)this.compress_(e,o),o+=this.blockSize;if("string"==typeof e){for(;o<t;)if(s[a]=e.charCodeAt(o),++a,++o,a===this.blockSize){this.compress_(s),a=0;break}}else for(;o<t;)if(s[a]=e[o],++a,++o,a===this.blockSize){this.compress_(s),a=0;break}}this.inbuf_=a,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let o=this.blockSize-1;o>=56;o--)this.buf_[o]=255&t,t/=256;this.compress_(this.buf_);let i=0;for(let o=0;o<5;o++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[o]>>s&255,++i;return e}}function He(n,e){return`${n} failed: ${e} argument `}const Ht=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};function hr(n,e=1e3,t=2){const i=e*Math.pow(t,n),o=Math.round(.5*i*(Math.random()-.5)*2);return Math.min(144e5,i+o)}function Te(n){return n&&n._delegate?n._delegate:n}class ne{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const Ee="[DEFAULT]";class Ol{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new at;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const o=this.getOrInitializeService({instanceIdentifier:t});o&&i.resolve(o)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),o=null!==(t=e?.optional)&&void 0!==t&&t;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(o)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(o)return null;throw s}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function Fl(n){return"EAGER"===n.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:Ee})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const o=this.normalizeInstanceIdentifier(t);try{const s=this.getOrInitializeService({instanceIdentifier:o});i.resolve(s)}catch{}}}}clearInstance(e=Ee){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return w(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...t.filter(i=>"_delete"in i).map(i=>i._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=Ee){return this.instances.has(e)}getOptions(e=Ee){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const o=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[s,a]of this.instancesDeferred.entries())i===this.normalizeInstanceIdentifier(s)&&a.resolve(o);return o}onInit(e,t){var i;const o=this.normalizeInstanceIdentifier(t),s=null!==(i=this.onInitCallbacks.get(o))&&void 0!==i?i:new Set;s.add(e),this.onInitCallbacks.set(o,s);const a=this.instances.get(o);return a&&e(a,o),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const o of i)try{o(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===Ee?void 0:n),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}var n;return i||null}normalizeInstanceIdentifier(e=Ee){return this.component?this.component.multipleInstances?e:Ee:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class Ul{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new Ol(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Zn=[];var E=(()=>{return(n=E||(E={}))[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",E;var n})();const pr={debug:E.DEBUG,verbose:E.VERBOSE,info:E.INFO,warn:E.WARN,error:E.ERROR,silent:E.SILENT},Bl=E.INFO,zl={[E.DEBUG]:"log",[E.VERBOSE]:"log",[E.INFO]:"info",[E.WARN]:"warn",[E.ERROR]:"error"},ql=(n,e,...t)=>{if(e<n.logLevel)return;const i=(new Date).toISOString(),o=zl[e];if(!o)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[o](`[${i}]  ${n.name}:`,...t)};class Fn{constructor(e){this.name=e,this._logLevel=Bl,this._logHandler=ql,this._userLogHandler=null,Zn.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in E))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?pr[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,E.DEBUG,...e),this._logHandler(this,E.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,E.VERBOSE,...e),this._logHandler(this,E.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,E.INFO,...e),this._logHandler(this,E.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,E.WARN,...e),this._logHandler(this,E.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,E.ERROR,...e),this._logHandler(this,E.ERROR,...e)}}let _r,fr;const gr=new WeakMap,Un=new WeakMap,mr=new WeakMap,Bn=new WeakMap,zn=new WeakMap;let qn={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return Un.get(n);if("objectStoreNames"===e)return n.objectStoreNames||mr.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ce(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function Jl(n){return"function"==typeof n?function jl(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function Gl(){return fr||(fr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(n)?function(...e){return n.apply(Hn(this),e),ce(gr.get(this))}:function(...e){return ce(n.apply(Hn(this),e))}:function(e,...t){const i=n.call(Hn(this),e,...t);return mr.set(i,e.sort?e.sort():[e]),ce(i)}}(n):(n instanceof IDBTransaction&&function $l(n){if(Un.has(n))return;const e=new Promise((t,i)=>{const o=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",a),n.removeEventListener("abort",a)},s=()=>{t(),o()},a=()=>{i(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",s),n.addEventListener("error",a),n.addEventListener("abort",a)});Un.set(n,e)}(n),((n,e)=>e.some(t=>n instanceof t))(n,function Wl(){return _r||(_r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(n,qn):n)}function ce(n){if(n instanceof IDBRequest)return function Vl(n){const e=new Promise((t,i)=>{const o=()=>{n.removeEventListener("success",s),n.removeEventListener("error",a)},s=()=>{t(ce(n.result)),o()},a=()=>{i(n.error),o()};n.addEventListener("success",s),n.addEventListener("error",a)});return e.then(t=>{t instanceof IDBCursor&&gr.set(t,n)}).catch(()=>{}),zn.set(e,n),e}(n);if(Bn.has(n))return Bn.get(n);const e=Jl(n);return e!==n&&(Bn.set(n,e),zn.set(e,n)),e}const Hn=n=>zn.get(n);function vr(n,e,{blocked:t,upgrade:i,blocking:o,terminated:s}={}){const a=indexedDB.open(n,e),l=ce(a);return i&&a.addEventListener("upgradeneeded",c=>{i(ce(a.result),c.oldVersion,c.newVersion,ce(a.transaction))}),t&&a.addEventListener("blocked",()=>t()),l.then(c=>{s&&c.addEventListener("close",()=>s()),o&&c.addEventListener("versionchange",()=>o())}).catch(()=>{}),l}const Kl=["get","getKey","getAll","getAllKeys","count"],Yl=["put","add","delete","clear"],Wn=new Map;function yr(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(Wn.get(e))return Wn.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,o=Yl.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!o&&!Kl.includes(t))return;const s=function(){var a=w(function*(l,...c){const u=this.transaction(l,o?"readwrite":"readonly");let h=u.store;return i&&(h=h.index(c.shift())),(yield Promise.all([h[t](...c),o&&u.done]))[0]});return function(c){return a.apply(this,arguments)}}();return Wn.set(e,s),s}!function Ql(n){qn=n(qn)}(n=>({...n,get:(e,t,i)=>yr(e,t)||n.get(e,t,i),has:(e,t)=>!!yr(e,t)||n.has(e,t)}));class Xl{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function ec(n){return"VERSION"===n.getComponent()?.type}(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}return null}).filter(t=>t).join(" ")}}const Gn="@firebase/app",Ae=new Fn("@firebase/app"),Wt="[DEFAULT]",Ac={[Gn]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},Ie=new Map,Gt=new Map;function Ic(n,e){try{n.container.addComponent(e)}catch(t){Ae.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function ue(n){const e=n.name;if(Gt.has(e))return Ae.debug(`There were multiple attempts to register component ${e}.`),!1;Gt.set(e,n);for(const t of Ie.values())Ic(t,n);return!0}function We(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}const ie=new Ut("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class kc{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new ne("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw ie.create("app-deleted",{appName:this._name})}}function wr(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:Wt,automaticDataCollectionEnabled:!1},e),o=i.name;if("string"!=typeof o||!o)throw ie.create("bad-app-name",{appName:String(o)});if(t||(t=(()=>{var n;return null===(n=Ln())||void 0===n?void 0:n.config})()),!t)throw ie.create("no-options");const s=Ie.get(o);if(s){if(qt(t,s.options)&&qt(i,s.config))return s;throw ie.create("duplicate-app",{appName:o})}const a=new Ul(o);for(const c of Gt.values())a.addComponent(c);const l=new kc(t,i,a);return Ie.set(o,l),l}function xr(n=Wt){const e=Ie.get(n);if(!e&&n===Wt)return wr();if(!e)throw ie.create("no-app",{appName:n});return e}function $(n,e,t){var i;let o=null!==(i=Ac[n])&&void 0!==i?i:n;t&&(o+=`-${t}`);const s=o.match(/\s|\//),a=e.match(/\s|\//);if(s||a){const l=[`Unable to register library "${o}" with version "${e}":`];return s&&l.push(`library name "${o}" contains illegal characters (whitespace or "/")`),s&&a&&l.push("and"),a&&l.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void Ae.warn(l.join(" "))}ue(new ne(`${o}-version`,()=>({library:o,version:e}),"VERSION"))}const ct="firebase-heartbeat-store";let $n=null;function Cr(){return $n||($n=vr("firebase-heartbeat-database",1,{upgrade:(n,e)=>{0===e&&n.createObjectStore(ct)}}).catch(n=>{throw ie.create("idb-open",{originalErrorMessage:n.message})})),$n}function Qn(){return(Qn=w(function*(n){var e;try{return(yield Cr()).transaction(ct).objectStore(ct).get(Er(n))}catch(t){if(t instanceof Ce)Ae.warn(t.message);else{const i=ie.create("idb-get",{originalErrorMessage:null===(e=t)||void 0===e?void 0:e.message});Ae.warn(i.message)}}})).apply(this,arguments)}function Tr(n,e){return jn.apply(this,arguments)}function jn(){return(jn=w(function*(n,e){var t;try{const o=(yield Cr()).transaction(ct,"readwrite");return yield o.objectStore(ct).put(e,Er(n)),o.done}catch(i){if(i instanceof Ce)Ae.warn(i.message);else{const o=ie.create("idb-set",{originalErrorMessage:null===(t=i)||void 0===t?void 0:t.message});Ae.warn(o.message)}}})).apply(this,arguments)}function Er(n){return`${n.name}!${n.options.appId}`}class Oc{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new Fc(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){var e=this;return w(function*(){const i=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ar();if(null===e._heartbeatsCache&&(e._heartbeatsCache=yield e._heartbeatsCachePromise),e._heartbeatsCache.lastSentHeartbeatDate!==o&&!e._heartbeatsCache.heartbeats.some(s=>s.date===o))return e._heartbeatsCache.heartbeats.push({date:o,agent:i}),e._heartbeatsCache.heartbeats=e._heartbeatsCache.heartbeats.filter(s=>{const a=new Date(s.date).valueOf();return Date.now()-a<=2592e6}),e._storage.overwrite(e._heartbeatsCache)})()}getHeartbeatsHeader(){var e=this;return w(function*(){if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null===e._heartbeatsCache||0===e._heartbeatsCache.heartbeats.length)return"";const t=Ar(),{heartbeatsToSend:i,unsentEntries:o}=function Zc(n,e=1024){const t=[];let i=n.slice();for(const o of n){const s=t.find(a=>a.agent===o.agent);if(s){if(s.dates.push(o.date),Ir(t)>e){s.dates.pop();break}}else if(t.push({agent:o.agent,dates:[o.date]}),Ir(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}(e._heartbeatsCache.heartbeats),s=Zt(JSON.stringify({version:2,heartbeats:i}));return e._heartbeatsCache.lastSentHeartbeatDate=t,o.length>0?(e._heartbeatsCache.heartbeats=o,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),s})()}}function Ar(){return(new Date).toISOString().substring(0,10)}class Fc{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return w(function*(){return!!lr()&&cr().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return w(function*(){return(yield e._canUseIndexedDBPromise)&&(yield function Mc(n){return Qn.apply(this,arguments)}(e.app))||{heartbeats:[]}})()}overwrite(e){var t=this;return w(function*(){var i;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return Tr(t.app,{lastSentHeartbeatDate:null!==(i=e.lastSentHeartbeatDate)&&void 0!==i?i:s.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return w(function*(){var i;if(yield t._canUseIndexedDBPromise){const s=yield t.read();return Tr(t.app,{lastSentHeartbeatDate:null!==(i=e.lastSentHeartbeatDate)&&void 0!==i?i:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...e.heartbeats]})}})()}}function Ir(n){return Zt(JSON.stringify({version:2,heartbeats:n})).length}!function Uc(n){ue(new ne("platform-logger",e=>new Xl(e),"PRIVATE")),ue(new ne("heartbeat",e=>new Oc(e),"PRIVATE")),$(Gn,"0.8.4",n),$(Gn,"0.8.4","esm2017"),$("fire-js","")}(""),$("firebase","9.14.0","app");const Sr="@firebase/installations",Jn="0.5.16",Nr=`w:${Jn}`,Rr="FIS_v2",oe=new Ut("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function Dr(n){return n instanceof Ce&&n.code.includes("request-failed")}function Kn({projectId:n}){return`https://firebaseinstallations.googleapis.com/v1/projects/${n}/installations`}function Mr(n){return{token:n.token,requestStatus:2,expiresIn:$c(n.expiresIn),creationTime:Date.now()}}function Yn(n,e){return Xn.apply(this,arguments)}function Xn(){return(Xn=w(function*(n,e){const i=(yield e.json()).error;return oe.create("request-failed",{requestName:n,serverCode:i.code,serverMessage:i.message,serverStatus:i.status})})).apply(this,arguments)}function Pr({apiKey:n}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":n})}function Lr(n,{refreshToken:e}){const t=Pr(n);return t.append("Authorization",function Qc(n){return`${Rr} ${n}`}(e)),t}function ei(n){return ti.apply(this,arguments)}function ti(){return(ti=w(function*(n){const e=yield n();return e.status>=500&&e.status<600?n():e})).apply(this,arguments)}function $c(n){return Number(n.replace("s","000"))}function jc(n,e){return ni.apply(this,arguments)}function ni(){return(ni=w(function*({appConfig:n,heartbeatServiceProvider:e},{fid:t}){const i=Kn(n),o=Pr(n),s=e.getImmediate({optional:!0});if(s){const u=yield s.getHeartbeatsHeader();u&&o.append("x-firebase-client",u)}const l={method:"POST",headers:o,body:JSON.stringify({fid:t,authVersion:Rr,appId:n.appId,sdkVersion:Nr})},c=yield ei(()=>fetch(i,l));if(c.ok){const u=yield c.json();return{fid:u.fid||t,registrationStatus:2,refreshToken:u.refreshToken,authToken:Mr(u.authToken)}}throw yield Yn("Create Installation",c)})).apply(this,arguments)}function Or(n){return new Promise(e=>{setTimeout(e,n)})}const Kc=/^[cdef][\w-]{21}$/;function Yc(){try{const n=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(n),n[0]=112+n[0]%16;const t=function Xc(n){return function Jc(n){return btoa(String.fromCharCode(...n)).replace(/\+/g,"-").replace(/\//g,"_")}(n).substr(0,22)}(n);return Kc.test(t)?t:""}catch{return""}}function Ge(n){return`${n.appName}!${n.appId}`}const Ve=new Map;function Zr(n,e){const t=Ge(n);Fr(t,e),function nu(n,e){const t=function Ur(){return!Se&&"BroadcastChannel"in self&&(Se=new BroadcastChannel("[Firebase] FID Change"),Se.onmessage=n=>{Fr(n.data.key,n.data.fid)}),Se}();t&&t.postMessage({key:n,fid:e}),function Br(){0===Ve.size&&Se&&(Se.close(),Se=null)}()}(t,e)}function Fr(n,e){const t=Ve.get(n);if(t)for(const i of t)i(e)}let Se=null;const ke="firebase-installations-store";let oi=null;function ri(){return oi||(oi=vr("firebase-installations-database",1,{upgrade:(n,e)=>{0===e&&n.createObjectStore(ke)}})),oi}function Vt(n,e){return si.apply(this,arguments)}function si(){return(si=w(function*(n,e){const t=Ge(n),o=(yield ri()).transaction(ke,"readwrite"),s=o.objectStore(ke),a=yield s.get(t);return yield s.put(e,t),yield o.done,(!a||a.fid!==e.fid)&&Zr(n,e.fid),e})).apply(this,arguments)}function ai(n){return li.apply(this,arguments)}function li(){return(li=w(function*(n){const e=Ge(n),i=(yield ri()).transaction(ke,"readwrite");yield i.objectStore(ke).delete(e),yield i.done})).apply(this,arguments)}function ut(n,e){return ci.apply(this,arguments)}function ci(){return(ci=w(function*(n,e){const t=Ge(n),o=(yield ri()).transaction(ke,"readwrite"),s=o.objectStore(ke),a=yield s.get(t),l=e(a);return void 0===l?yield s.delete(t):yield s.put(l,t),yield o.done,l&&(!a||a.fid!==l.fid)&&Zr(n,l.fid),l})).apply(this,arguments)}function ui(n){return di.apply(this,arguments)}function di(){return(di=w(function*(n){let e;const t=yield ut(n.appConfig,i=>{const o=ru(i),s=su(n,o);return e=s.registrationPromise,s.installationEntry});return""===t.fid?{installationEntry:yield e}:{installationEntry:t,registrationPromise:e}})).apply(this,arguments)}function ru(n){return qr(n||{fid:Yc(),registrationStatus:0})}function su(n,e){if(0===e.registrationStatus){if(!navigator.onLine)return{installationEntry:e,registrationPromise:Promise.reject(oe.create("app-offline"))};const t={fid:e.fid,registrationStatus:1,registrationTime:Date.now()},i=function au(n,e){return hi.apply(this,arguments)}(n,t);return{installationEntry:t,registrationPromise:i}}return 1===e.registrationStatus?{installationEntry:e,registrationPromise:lu(n)}:{installationEntry:e}}function hi(){return(hi=w(function*(n,e){try{const t=yield jc(n,e);return Vt(n.appConfig,t)}catch(t){throw Dr(t)&&409===t.customData.serverCode?yield ai(n.appConfig):yield Vt(n.appConfig,{fid:e.fid,registrationStatus:0}),t}})).apply(this,arguments)}function lu(n){return pi.apply(this,arguments)}function pi(){return(pi=w(function*(n){let e=yield zr(n.appConfig);for(;1===e.registrationStatus;)yield Or(100),e=yield zr(n.appConfig);if(0===e.registrationStatus){const{installationEntry:t,registrationPromise:i}=yield ui(n);return i||t}return e})).apply(this,arguments)}function zr(n){return ut(n,e=>{if(!e)throw oe.create("installation-not-found");return qr(e)})}function qr(n){return function cu(n){return 1===n.registrationStatus&&n.registrationTime+1e4<Date.now()}(n)?{fid:n.fid,registrationStatus:0}:n}function uu(n,e){return _i.apply(this,arguments)}function _i(){return(_i=w(function*({appConfig:n,heartbeatServiceProvider:e},t){const i=du(n,t),o=Lr(n,t),s=e.getImmediate({optional:!0});if(s){const u=yield s.getHeartbeatsHeader();u&&o.append("x-firebase-client",u)}const l={method:"POST",headers:o,body:JSON.stringify({installation:{sdkVersion:Nr,appId:n.appId}})},c=yield ei(()=>fetch(i,l));if(c.ok)return Mr(yield c.json());throw yield Yn("Generate Auth Token",c)})).apply(this,arguments)}function du(n,{fid:e}){return`${Kn(n)}/${e}/authTokens:generate`}function fi(n){return gi.apply(this,arguments)}function gi(){return(gi=w(function*(n,e=!1){let t;const i=yield ut(n.appConfig,s=>{if(!Wr(s))throw oe.create("not-registered");const a=s.authToken;if(!e&&_u(a))return s;if(1===a.requestStatus)return t=hu(n,e),s;{if(!navigator.onLine)throw oe.create("app-offline");const l=gu(s);return t=pu(n,l),l}});return t?yield t:i.authToken})).apply(this,arguments)}function hu(n,e){return mi.apply(this,arguments)}function mi(){return(mi=w(function*(n,e){let t=yield Hr(n.appConfig);for(;1===t.authToken.requestStatus;)yield Or(100),t=yield Hr(n.appConfig);const i=t.authToken;return 0===i.requestStatus?fi(n,e):i})).apply(this,arguments)}function Hr(n){return ut(n,e=>{if(!Wr(e))throw oe.create("not-registered");return function mu(n){return 1===n.requestStatus&&n.requestTime+1e4<Date.now()}(e.authToken)?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e})}function pu(n,e){return vi.apply(this,arguments)}function vi(){return(vi=w(function*(n,e){try{const t=yield uu(n,e),i=Object.assign(Object.assign({},e),{authToken:t});return yield Vt(n.appConfig,i),t}catch(t){if(!Dr(t)||401!==t.customData.serverCode&&404!==t.customData.serverCode){const i=Object.assign(Object.assign({},e),{authToken:{requestStatus:0}});yield Vt(n.appConfig,i)}else yield ai(n.appConfig);throw t}})).apply(this,arguments)}function Wr(n){return void 0!==n&&2===n.registrationStatus}function _u(n){return 2===n.requestStatus&&!function fu(n){const e=Date.now();return e<n.creationTime||n.creationTime+n.expiresIn<e+36e5}(n)}function gu(n){const e={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},n),{authToken:e})}function yi(){return(yi=w(function*(n){const e=n,{installationEntry:t,registrationPromise:i}=yield ui(e);return i?i.catch(console.error):fi(e).catch(console.error),t.fid})).apply(this,arguments)}function bi(){return(bi=w(function*(n,e=!1){const t=n;return yield bu(t),(yield fi(t,e)).token})).apply(this,arguments)}function bu(n){return wi.apply(this,arguments)}function wi(){return(wi=w(function*(n){const{registrationPromise:e}=yield ui(n);e&&(yield e)})).apply(this,arguments)}function Ti(n){return oe.create("missing-app-config-values",{valueName:n})}const Gr="installations",Eu=n=>{const e=n.getProvider("app").getImmediate(),t=function Cu(n){if(!n||!n.options)throw Ti("App Configuration");if(!n.name)throw Ti("App Name");const e=["projectId","apiKey","appId"];for(const t of e)if(!n.options[t])throw Ti(t);return{appName:n.name,projectId:n.options.projectId,apiKey:n.options.apiKey,appId:n.options.appId}}(e);return{app:e,appConfig:t,heartbeatServiceProvider:We(e,"heartbeat"),_delete:()=>Promise.resolve()}},Au=n=>{const t=We(n.getProvider("app").getImmediate(),Gr).getImmediate();return{getId:()=>function vu(n){return yi.apply(this,arguments)}(t),getToken:o=>function yu(n){return bi.apply(this,arguments)}(t,o)}};(function Iu(){ue(new ne(Gr,Eu,"PUBLIC")),ue(new ne("installations-internal",Au,"PRIVATE"))})(),$(Sr,Jn),$(Sr,Jn,"esm2017");const $t="analytics",Su="firebase_id",Ru="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Vr="https://www.googletagmanager.com/gtag/js",L=new Fn("@firebase/analytics");function $r(n){return Promise.all(n.map(e=>e.catch(t=>t)))}function Du(n,e){const t=document.createElement("script");t.src=`${Vr}?l=${n}&id=${e}`,t.async=!0,document.head.appendChild(t)}function Pu(n,e,t,i,o,s){return Ei.apply(this,arguments)}function Ei(){return(Ei=w(function*(n,e,t,i,o,s){const a=i[o];try{if(a)yield e[a];else{const c=(yield $r(t)).find(u=>u.measurementId===o);c&&(yield e[c.appId])}}catch(l){L.error(l)}n("config",o,s)})).apply(this,arguments)}function Lu(n,e,t,i,o){return Ai.apply(this,arguments)}function Ai(){return(Ai=w(function*(n,e,t,i,o){try{let s=[];if(o&&o.send_to){let a=o.send_to;Array.isArray(a)||(a=[a]);const l=yield $r(t);for(const c of a){const u=l.find(d=>d.measurementId===c),h=u&&e[u.appId];if(!h){s=[];break}s.push(h)}}0===s.length&&(s=Object.values(e)),yield Promise.all(s),n("event",i,o||{})}catch(s){L.error(s)}})).apply(this,arguments)}function Fu(n){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Vr)&&t.src.includes(n))return t;return null}const U=new Ut("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Qr=new class qu{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function Hu(n){return new Headers({Accept:"application/json","x-goog-api-key":n})}function Wu(n){return Ii.apply(this,arguments)}function Ii(){return(Ii=w(function*(n){var e;const{appId:t,apiKey:i}=n,o={method:"GET",headers:Hu(i)},s=Ru.replace("{app-id}",t),a=yield fetch(s,o);if(200!==a.status&&304!==a.status){let l="";try{const c=yield a.json();null!==(e=c.error)&&void 0!==e&&e.message&&(l=c.error.message)}catch{}throw U.create("config-fetch-failed",{httpStatus:a.status,responseMessage:l})}return a.json()})).apply(this,arguments)}function Gu(n){return Si.apply(this,arguments)}function Si(){return(Si=w(function*(n,e=Qr,t){const{appId:i,apiKey:o,measurementId:s}=n.options;if(!i)throw U.create("no-app-id");if(!o){if(s)return{measurementId:s,appId:i};throw U.create("no-api-key")}const a=e.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},l=new Qu;return setTimeout(w(function*(){l.abort()}),void 0!==t?t:6e4),jr({appId:i,apiKey:o,measurementId:s},a,l,e)})).apply(this,arguments)}function jr(n,e,t){return ki.apply(this,arguments)}function ki(){return(ki=w(function*(n,{throttleEndTimeMillis:e,backoffCount:t},i,o=Qr){var s,a;const{appId:l,measurementId:c}=n;try{yield Vu(i,e)}catch(u){if(c)return L.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null===(s=u)||void 0===s?void 0:s.message}]`),{appId:l,measurementId:c};throw u}try{const u=yield Wu(n);return o.deleteThrottleMetadata(l),u}catch(u){const h=u;if(!$u(h)){if(o.deleteThrottleMetadata(l),c)return L.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${h?.message}]`),{appId:l,measurementId:c};throw u}const d=503===Number(null===(a=h?.customData)||void 0===a?void 0:a.httpStatus)?hr(t,o.intervalMillis,30):hr(t,o.intervalMillis),p={throttleEndTimeMillis:Date.now()+d,backoffCount:t+1};return o.setThrottleMetadata(l,p),L.debug(`Calling attemptFetch again in ${d} millis`),jr(n,p,i,o)}})).apply(this,arguments)}function Vu(n,e){return new Promise((t,i)=>{const o=Math.max(e-Date.now(),0),s=setTimeout(t,o);n.addEventListener(()=>{clearTimeout(s),i(U.create("fetch-throttle",{throttleEndTimeMillis:e}))})})}function $u(n){if(!(n instanceof Ce&&n.customData))return!1;const e=Number(n.customData.httpStatus);return 429===e||500===e||503===e||504===e}class Qu{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach(e=>e())}}let Ni,Oi;function Ri(){return(Ri=w(function*(n,e,t,i,o){if(o&&o.global)n("event",t,i);else{const s=yield e;n("event",t,Object.assign(Object.assign({},i),{send_to:s}))}})).apply(this,arguments)}function Jr(n){Oi=n}function Kr(n){Ni=n}function ed(){return Zi.apply(this,arguments)}function Zi(){return(Zi=w(function*(){var n;if(!lr())return L.warn(U.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{yield cr()}catch(e){return L.warn(U.create("indexeddb-unavailable",{errorInfo:null===(n=e)||void 0===n?void 0:n.toString()}).message),!1}return!0})).apply(this,arguments)}function Fi(){return(Fi=w(function*(n,e,t,i,o,s,a){var l;const c=Gu(n);c.then(_=>{t[_.measurementId]=_.appId,n.options.measurementId&&_.measurementId!==n.options.measurementId&&L.warn(`The measurement ID in the local Firebase config (${n.options.measurementId}) does not match the measurement ID fetched from the server (${_.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)}).catch(_=>L.error(_)),e.push(c);const u=ed().then(_=>{if(_)return i.getId()}),[h,d]=yield Promise.all([c,u]);Fu(s)||Du(s,h.measurementId),Oi&&(o("consent","default",Oi),Jr(void 0)),o("js",new Date);const p=null!==(l=a?.config)&&void 0!==l?l:{};return p.origin="firebase",p.update=!0,null!=d&&(p[Su]=d),o("config",h.measurementId,p),Ni&&(o("set",Ni),Kr(void 0)),h.measurementId})).apply(this,arguments)}class nd{constructor(e){this.app=e}_delete(){return delete re[this.app.options.appId],Promise.resolve()}}let re={},Yr=[];const Xr={};let ts,se,Qt="dataLayer",Ui=!1;function od(n,e,t){!function id(){const n=[];if(function ul(){const n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof n&&void 0!==n.id}()&&n.push("This is a browser extension environment."),function hl(){return!(typeof navigator>"u"||!navigator.cookieEnabled)}()||n.push("Cookies are not available."),n.length>0){const e=n.map((i,o)=>`(${o+1}) ${i}`).join(" "),t=U.create("invalid-analytics-context",{errorInfo:e});L.warn(t.message)}}();const i=n.options.appId;if(!i)throw U.create("no-app-id");if(!n.options.apiKey){if(!n.options.measurementId)throw U.create("no-api-key");L.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${n.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=re[i])throw U.create("already-exists",{id:i});if(!Ui){!function Mu(n){let e=[];Array.isArray(window[n])?e=window[n]:window[n]=e}(Qt);const{wrappedGtag:s,gtagCore:a}=function Zu(n,e,t,i,o){let s=function(...a){window[i].push(arguments)};return window[o]&&"function"==typeof window[o]&&(s=window[o]),window[o]=function Ou(n,e,t,i){function s(){return(s=w(function*(a,l,c){try{"event"===a?yield Lu(n,e,t,l,c):"config"===a?yield Pu(n,e,t,i,l,c):"consent"===a?n("consent","update",c):n("set",l)}catch(u){L.error(u)}})).apply(this,arguments)}return function o(a,l,c){return s.apply(this,arguments)}}(s,n,e,t),{gtagCore:s,wrappedGtag:window[o]}}(re,Yr,Xr,Qt,"gtag");se=s,ts=a,Ui=!0}return re[i]=function td(n,e,t,i,o,s,a){return Fi.apply(this,arguments)}(n,Yr,Xr,e,ts,Qt,t),new nd(n)}const ns="@firebase/analytics";!function ld(){ue(new ne($t,(e,{options:t})=>od(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t),"PUBLIC")),ue(new ne("analytics-internal",function n(e){try{const t=e.getProvider($t).getImmediate();return{logEvent:(i,o,s)=>function ad(n,e,t,i){n=Te(n),function ju(n,e,t,i,o){return Ri.apply(this,arguments)}(se,re[n.app.options.appId],e,t,i).catch(o=>L.error(o))}(t,i,o,s)}}catch(t){throw U.create("interop-component-reg-failed",{reason:t})}},"PRIVATE")),$(ns,"0.8.4"),$(ns,"0.8.4","esm2017")}();const os="@firebase/database",rs="0.13.10";let zi="";class ud{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),D(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:lt(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class dd{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return te(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const ss=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new ud(e)}}catch{}return new dd},Ne=ss("localStorage"),qi=ss("sessionStorage"),$e=new Fn("@firebase/database"),as=function(){let n=1;return function(){return n++}}(),ls=function(n){const e=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let o=n.charCodeAt(i);if(o>=55296&&o<=56319){const s=o-55296;i++,f(i<n.length,"Surrogate pair missing trail surrogate."),o=65536+(s<<10)+(n.charCodeAt(i)-56320)}o<128?e[t++]=o:o<2048?(e[t++]=o>>6|192,e[t++]=63&o|128):o<65536?(e[t++]=o>>12|224,e[t++]=o>>6&63|128,e[t++]=63&o|128):(e[t++]=o>>18|240,e[t++]=o>>12&63|128,e[t++]=o>>6&63|128,e[t++]=63&o|128)}return e}(n),t=new Il;t.update(e);const i=t.digest();return Mn.encodeByteArray(i)},dt=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?e+=dt.apply(null,i):e+="object"==typeof i?D(i):i,e+=" "}return e};let Re=null,cs=!0;const M=function(...n){if(!0===cs&&(cs=!1,null===Re&&!0===qi.get("logging_enabled")&&function(n,e){f(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?($e.logLevel=E.VERBOSE,Re=$e.log.bind($e),e&&qi.set("logging_enabled",!0)):"function"==typeof n?Re=n:(Re=null,qi.remove("logging_enabled"))}(!0)),Re){const e=dt.apply(null,n);Re(e)}},ht=function(n){return function(...e){M(n,...e)}},Hi=function(...n){const e="FIREBASE INTERNAL ERROR: "+dt(...n);$e.error(e)},Q=function(...n){const e=`FIREBASE FATAL ERROR: ${dt(...n)}`;throw $e.error(e),new Error(e)},O=function(...n){const e="FIREBASE WARNING: "+dt(...n);$e.warn(e)},jt=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},ae="[MIN_NAME]",j="[MAX_NAME]",De=function(n,e){if(n===e)return 0;if(n===ae||e===j)return-1;if(e===ae||n===j)return 1;{const t=Jt(n),i=Jt(e);return null!==t?null!==i?t-i==0?n.length-e.length:t-i:-1:null!==i?1:n<e?-1:1}},_d=function(n,e){return n===e?0:n<e?-1:1},pt=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+D(e))},Wi=function(n){if("object"!=typeof n||null===n)return D(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)0!==i&&(t+=","),t+=D(e[i]),t+=":",t+=Wi(n[e[i]]);return t+="}",t},ds=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let o=0;o<t;o+=e)i.push(n.substring(o,o+e>t?t:o+e));return i};function P(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const hs=function(n){f(!jt(n),"Invalid JSON number");const i=1023;let o,s,a,l,c;0===n?(s=0,a=0,o=1/n==-1/0?1:0):(o=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(l=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=l+i,a=Math.round(n*Math.pow(2,52-l)-Math.pow(2,52))):(s=0,a=Math.round(n/Math.pow(2,-1074))));const u=[];for(c=52;c;c-=1)u.push(a%2?1:0),a=Math.floor(a/2);for(c=11;c;c-=1)u.push(s%2?1:0),s=Math.floor(s/2);u.push(o?1:0),u.reverse();const h=u.join("");let d="";for(c=0;c<64;c+=8){let p=parseInt(h.substr(c,8),2).toString(16);1===p.length&&(p="0"+p),d+=p}return d.toLowerCase()},vd=new RegExp("^-?(0*)\\d{1,10}$"),Jt=function(n){if(vd.test(n)){const e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},Qe=function(n){try{n()}catch(e){setTimeout(()=>{throw O("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},_t=function(n,e){const t=setTimeout(n,e);return"number"==typeof t&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class bd{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){O(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class wd{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(o=>this.auth_=o)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(M("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',O(e)}}let ft=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const vs=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,ws="websocket",xs="long_polling";class $i{constructor(e,t,i,o,s=!1,a="",l=!1){this.secure=t,this.namespace=i,this.webSocketOnly=o,this.nodeAdmin=s,this.persistenceKey=a,this.includeNamespaceInQueryParams=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ne.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ne.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Cs(n,e,t){let i;if(f("string"==typeof e,"typeof type must == string"),f("object"==typeof t,"typeof params must == object"),e===ws)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==xs)throw new Error("Unknown connection type: "+e);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function xd(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const o=[];return P(t,(s,a)=>{o.push(s+"="+a)}),i+o.join("&")}class Cd{constructor(){this.counters_={}}incrementCounter(e,t=1){te(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return al(this.counters_)}}const Qi={},ji={};function Ji(n){const e=n.toString();return Qi[e]||(Qi[e]=new Cd),Qi[e]}class Ed{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let o=0;o<i.length;++o)i[o]&&Qe(()=>{this.onMessage_(i[o])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class de{constructor(e,t,i,o,s,a,l){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=o,this.authToken=s,this.transportSessionId=a,this.lastSessionId=l,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=ht(e),this.stats_=Ji(t),this.urlFn=c=>(this.appCheckToken&&(c.ac=this.appCheckToken),Cs(t,xs,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ed(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if("complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Ki((...s)=>{const[a,l,c,u,h]=s;if(this.incrementIncomingBytes_(s),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===a)this.id=l,this.password=c;else{if("close"!==a)throw new Error("Unrecognized command received: "+a);l?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(l,()=>{this.onClosed_()})):this.onClosed_()}},(...s)=>{const[a,l]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(a,l)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&vs.test(location.hostname)&&(i.r="f");const o=this.urlFn(i);this.log_("Connecting via long-poll to "+o),this.scriptTagHolder.addTag(o,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){de.forceAllow_=!0}static forceDisallow(){de.forceDisallow_=!0}static isAvailable(){return!(!de.forceAllow_&&(de.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=D(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=rr(t),o=ds(i,1840);for(let s=0;s<o.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,o.length,o[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=D(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Ki{constructor(e,t,i,o){this.onDisconnect=i,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=as(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Ki.createIFrame_();let s="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(s='<script>document.domain="'+document.domain+'";<\/script>');const a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(l){M("frame writing exception"),l.stack&&M(l.stack),M(l)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||M("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),i="",o=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const a=this.pendingSegs.shift();i=i+"&seg"+o+"="+a.seg+"&ts"+o+"="+a.ts+"&d"+o+"="+a.d,o++}return t+=i,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},o=setTimeout(i,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(o),i()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const o=i.readyState;(!o||"loaded"===o||"complete"===o)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{M("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let Yt=null;typeof MozWebSocket<"u"?Yt=MozWebSocket:typeof WebSocket<"u"&&(Yt=WebSocket);let je=(()=>{class n{constructor(t,i,o,s,a,l,c){this.connId=t,this.applicationId=o,this.appCheckToken=s,this.authToken=a,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=ht(this.connId),this.stats_=Ji(i),this.connURL=n.connectionURL_(i,l,c,s,o),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,o,s,a){const l={v:"5"};return typeof location<"u"&&location.hostname&&vs.test(location.hostname)&&(l.r="f"),i&&(l.s=i),o&&(l.ls=o),s&&(l.ac=s),a&&(l.p=a),Cs(t,ws,l)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ne.set("previous_websocket_failure",!0);try{let o;0,this.mySock=new Yt(this.connURL,[],o)}catch(o){this.log_("Error instantiating WebSocket.");const s=o.message||o.data;return s&&this.log_(s),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=o=>{this.handleIncomingFrame(o)},this.mySock.onerror=o=>{this.log_("WebSocket error.  Closing connection.");const s=o.message||o.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const o=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);o&&o.length>1&&parseFloat(o[1])<4.4&&(t=!0)}return!t&&null!==Yt&&!n.forceDisallow_}static previouslyFailed(){return Ne.isInMemoryStorage||!0===Ne.get("previous_websocket_failure")}markConnectionHealthy(){Ne.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const o=lt(i);this.onMessage(o)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(f(null===this.frames,"We already have a frame buffer"),t.length<=6){const i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const o=this.extractFrameCount_(i);null!==o&&this.appendFrame_(o)}}send(t){this.resetKeepAlive();const i=D(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const o=ds(i,16384);o.length>1&&this.sendString_(String(o.length));for(let s=0;s<o.length;s++)this.sendString_(o[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Ns=(()=>{class n{constructor(t){this.initTransports_(t)}static get ALL_TRANSPORTS(){return[de,je]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(t){const i=je&&je.isAvailable();let o=i&&!je.previouslyFailed();if(t.webSocketOnly&&(i||O("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),o=!0),o)this.transports_=[je];else{const s=this.transports_=[];for(const a of n.ALL_TRANSPORTS)a&&a.isAvailable()&&s.push(a);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class Zs{constructor(e,t,i,o,s,a,l,c,u,h){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=o,this.authToken_=s,this.onMessage_=a,this.onReady_=l,this.onDisconnect_=c,this.onKill_=u,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=ht("c:"+this.id+":"),this.transportManager_=new Ns(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const o=e.healthyTimeout||0;o>0&&(this.healthyTimeout_=_t(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(o)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=pt("t",e),i=pt("d",e);if("c"===t)this.onSecondaryControl_(i);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=pt("t",e),i=pt("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=pt("t",e);if("d"in e){const i=e.d;if("h"===t)this.onHandshake_(i);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let o=0;o<this.pendingDataMessages.length;++o)this.onDataMessage_(this.pendingDataMessages[o]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?Hi("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Hi("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,o=e.h;this.sessionId=e.s,this.repoInfo_.host=o,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&O("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),_t(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):_t(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ne.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class Fs{put(e,t,i,o){}merge(e,t,i,o){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class Us{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let o=0;o<i.length;o++)i[o].callback.apply(i[o].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const o=this.getInitialEvent(e);o&&t.apply(i,o)}off(e,t,i){this.validateEventType_(e);const o=this.listeners_[e]||[];for(let s=0;s<o.length;s++)if(o[s].callback===t&&(!i||i===o[s].context))return void o.splice(s,1)}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Xt extends Us{constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ar()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}static getInstance(){return new Xt}getInitialEvent(e){return f("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class T{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let i=0;for(let o=0;o<this.pieces_.length;o++)this.pieces_[o].length>0&&(this.pieces_[i]=this.pieces_[o],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function C(){return new T("")}function v(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function he(n){return n.pieces_.length-n.pieceNum_}function A(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new T(n.pieces_,e)}function Xi(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function gt(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function qs(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new T(e,0)}function N(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof T)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let o=0;o<i.length;o++)i[o].length>0&&t.push(i[o])}return new T(t,0)}function y(n){return n.pieceNum_>=n.pieces_.length}function Z(n,e){const t=v(n),i=v(e);if(null===t)return e;if(t===i)return Z(A(n),A(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function eo(n,e){if(he(n)!==he(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function q(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(he(n)>he(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class Qd{constructor(e,t){this.errorPrefix_=t,this.parts_=gt(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Ht(this.parts_[i]);Hs(this)}}function Hs(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+Me(n))}function Me(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class to extends Us{constructor(){let e,t;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}static getInstance(){return new to}getInitialEvent(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]}}const mt=1e3;let tn,Pe=(()=>{class n extends Fs{constructor(t,i,o,s,a,l,c,u){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=o,this.onConnectStatus_=s,this.onServerInfoUpdate_=a,this.authTokenProvider_=l,this.appCheckTokenProvider_=c,this.authOverride_=u,this.id=n.nextPersistentConnectionId_++,this.log_=ht("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=mt,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,u)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");to.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Xt.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,o){const s=++this.requestNumber_,a={r:s,a:t,b:i};this.log_(D(a)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(a),o&&(this.requestCBHash_[s]=o)}get(t){this.initConnection_();const i=new at,o={p:t._path.toString(),q:t._queryObject};return this.outstandingGets_.push({action:"g",request:o,onComplete:l=>{const c=l.d;"ok"===l.s?i.resolve(c):i.reject(c)}}),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(t,i,o,s){this.initConnection_();const a=t._queryIdentifier,l=t._path.toString();this.log_("Listen called for "+l+" "+a),this.listens.has(l)||this.listens.set(l,new Map),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(l).has(a),"listen() called twice for same path/queryId.");const c={onComplete:s,hashFn:i,query:t,tag:o};this.listens.get(l).set(a,c),this.connected_&&this.sendListen_(c)}sendGet_(t){const i=this.outstandingGets_[t];this.sendRequest("g",i.request,o=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(o)})}sendListen_(t){const i=t.query,o=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+o+" for "+s);const a={p:o};t.tag&&(a.q=i._queryObject,a.t=t.tag),a.h=t.hashFn(),this.sendRequest("q",a,c=>{const u=c.d,h=c.s;n.warnOnListenWarnings_(u,i),(this.listens.get(o)&&this.listens.get(o).get(s))===t&&(this.log_("listen response",c),"ok"!==h&&this.removeListen_(o,s),t.onComplete&&t.onComplete(h,u))})}static warnOnListenWarnings_(t,i){if(t&&"object"==typeof t&&te(t,"w")){const o=qe(t,"w");if(Array.isArray(o)&&~o.indexOf("no_index")){const s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',a=i._path.toString();O(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${a} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(n){const e=Bt(n).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,i=function(n){const t=Bt(n).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(t)?"auth":"gauth",o={cred:t};null===this.authOverride_?o.noauth=!0:"object"==typeof this.authOverride_&&(o.authvar=this.authOverride_),this.sendRequest(i,o,s=>{const a=s.s,l=s.d||"error";this.authToken_===t&&("ok"===a?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(a,l))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const i=t.s,o=t.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,o)})}unlisten(t,i){const o=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+o+" "+s),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(o,s)&&this.connected_&&this.sendUnlisten_(o,s,t._queryObject,i)}sendUnlisten_(t,i,o,s){this.log_("Unlisten on "+t+" for "+i);const a={p:t};s&&(a.q=o,a.t=s),this.sendRequest("n",a)}onDisconnectPut(t,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:o})}onDisconnectMerge(t,i,o){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,o):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:o})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,o,s){const a={p:i,d:o};this.log_("onDisconnect "+t,a),this.sendRequest(t,a,l=>{s&&setTimeout(()=>{s(l.s,l.d)},Math.floor(0))})}put(t,i,o,s){this.putInternal("p",t,i,o,s)}merge(t,i,o,s){this.putInternal("m",t,i,o,s)}putInternal(t,i,o,s,a){this.initConnection_();const l={p:i,d:o};void 0!==a&&(l.h=a),this.outstandingPuts_.push({action:t,request:l,onComplete:s}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(t){const i=this.outstandingPuts_[t].action,o=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,o,a=>{this.log_(i+" response",a),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),s&&s(a.s,a.d)})}reportStats(t){if(this.connected_){const i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,o=>{"ok"!==o.s&&this.log_("reportStats","Error sending stats: "+o.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+D(t));const i=t.r,o=this.requestCBHash_[i];o&&(delete this.requestCBHash_[i],o(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),"d"===t?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===t?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===t?this.onListenRevoked_(i.p,i.q):"ac"===t?this.onAuthRevoked_(i.s,i.d):"apc"===t?this.onAppCheckRevoked_(i.s,i.d):"sd"===t?this.onSecurityDebugPacket_(i):Hi("Unrecognized action received from server: "+D(t)+"\nAre you using the latest client?")}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=mt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=mt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=mt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=(new Date).getTime()-this.lastConnectionAttemptTime_;let i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return w(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const i=t.onDataMessage_.bind(t),o=t.onReady_.bind(t),s=t.onRealtimeDisconnect_.bind(t),a=t.id+":"+n.nextConnectionId_++,l=t.lastSessionId;let c=!1,u=null;const h=function(){u?u.close():(c=!0,s())};t.realtime_={close:h,sendRequest:function(_){f(u,"sendRequest call when we're not connected not allowed."),u.sendRequest(_)}};const p=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[_,g]=yield Promise.all([t.authTokenProvider_.getToken(p),t.appCheckTokenProvider_.getToken(p)]);c?M("getToken() completed but was canceled"):(M("getToken() completed. Creating connection."),t.authToken_=_&&_.accessToken,t.appCheckToken_=g&&g.token,u=new Zs(a,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,i,o,s,x=>{O(x+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},l))}catch(_){t.log_("Failed to get token: "+_),c||(t.repoInfo_.nodeAdmin&&O(_),h())}}})()}interrupt(t){M("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){M("Resuming connection for reason: "+t),delete this.interruptReasons_[t],ur(this.interruptReasons_)&&(this.reconnectDelay_=mt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const i=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let o;o=i?i.map(a=>Wi(a)).join("$"):"default";const s=this.removeListen_(t,o);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){const o=new T(t).toString();let s;if(this.listens.has(o)){const a=this.listens.get(o);s=a.get(i),a.delete(i),0===a.size&&this.listens.delete(o)}else s=void 0;return s}onAuthRevoked_(t,i){M("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){M("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let i="js";t["sdk."+i+"."+zi.replace(/\./g,"-")]=1,ar()?t["framework.cordova"]=1:function dl(){return"object"==typeof navigator&&"ReactNative"===navigator.product}()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Xt.getInstance().currentlyOnline();return ur(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class b{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new b(e,t)}}class en{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new b(ae,e),o=new b(ae,t);return 0!==this.compare(i,o)}minPost(){return b.MIN}}class Vs extends en{static get __EMPTY_NODE(){return tn}static set __EMPTY_NODE(e){tn=e}compare(e,t){return De(e.name,t.name)}isDefinedOn(e){throw ze("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return b.MIN}maxPost(){return new b(j,tn)}makePost(e,t){return f("string"==typeof e,"KeyIndex indexValue must always be a string."),new b(e,tn)}toString(){return".key"}}const J=new Vs;class nn{constructor(e,t,i,o,s=null){this.isReverse_=o,this.resultGenerator_=s,this.nodeStack_=[];let a=1;for(;!e.isEmpty();)if(a=t?i(e.key,t):1,o&&(a*=-1),a<0)e=this.isReverse_?e.left:e.right;else{if(0===a){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let io,W=(()=>{class n{constructor(t,i,o,s,a){this.key=t,this.value=i,this.color=o??n.RED,this.left=s??F.EMPTY_NODE,this.right=a??F.EMPTY_NODE}copy(t,i,o,s,a){return new n(t??this.key,i??this.value,o??this.color,s??this.left,a??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,o){let s=this;const a=o(t,s.key);return s=a<0?s.copy(null,null,null,s.left.insert(t,i,o),null):0===a?s.copy(null,i,null,null,null):s.copy(null,null,null,null,s.right.insert(t,i,o)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return F.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let o,s;if(o=this,i(t,o.key)<0)!o.left.isEmpty()&&!o.left.isRed_()&&!o.left.left.isRed_()&&(o=o.moveRedLeft_()),o=o.copy(null,null,null,o.left.remove(t,i),null);else{if(o.left.isRed_()&&(o=o.rotateRight_()),!o.right.isEmpty()&&!o.right.isRed_()&&!o.right.left.isRed_()&&(o=o.moveRedRight_()),0===i(t,o.key)){if(o.right.isEmpty())return F.EMPTY_NODE;s=o.right.min_(),o=o.copy(s.key,s.value,null,null,o.right.removeMin_())}o=o.copy(null,null,null,null,o.right.remove(t,i))}return o.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class F{constructor(e,t=F.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new F(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,W.BLACK,null,null))}remove(e){return new F(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,W.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,o=null;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t){if(i.left.isEmpty())return o?o.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(o=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new nn(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new nn(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new nn(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new nn(this.root_,null,this.comparator_,!0,e)}}function nh(n,e){return De(n.name,e.name)}function no(n,e){return De(n,e)}F.EMPTY_NODE=new class th{copy(e,t,i,o,s){return this}insert(e,t,i){return new W(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const $s=function(n){return"number"==typeof n?"number:"+hs(n):"string:"+n},Qs=function(n){if(n.isLeafNode()){const e=n.val();f("string"==typeof e||"number"==typeof e||"object"==typeof e&&te(e,".sv"),"Priority must be a string or number.")}else f(n===io||n.isEmpty(),"priority of unexpected type.");f(n===io||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let js,Js,Ks,Je=(()=>{class n{constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,f(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Qs(this.priorityNode_)}static set __childrenNodeConstructor(t){js=t}static get __childrenNodeConstructor(){return js}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return y(t)?this:".priority"===v(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return".priority"===t?this.updatePriority(i):i.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){const o=v(t);return null===o?i:i.isEmpty()&&".priority"!==o?this:(f(".priority"!==o||1===he(t),".priority must be the last token in a path"),this.updateImmediateChild(o,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(A(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+$s(this.priorityNode_.val())+":");const i=typeof this.value_;t+=i+":",t+="number"===i?hs(this.value_):this.value_,this.lazyHash_=ls(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(f(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const i=typeof t.value_,o=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),a=n.VALUE_TYPE_ORDER.indexOf(o);return f(s>=0,"Unknown leaf type: "+i),f(a>=0,"Unknown leaf type: "+o),s===a?"object"===o?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:a-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){const i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}return!1}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const I=new class sh extends en{compare(e,t){const i=e.node.getPriority(),o=t.node.getPriority(),s=i.compareTo(o);return 0===s?De(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return b.MIN}maxPost(){return new b(j,new Je("[PRIORITY-POST]",Ks))}makePost(e,t){const i=Js(e);return new b(t,new Je("[PRIORITY-POST]",i))}toString(){return".priority"}},ah=Math.log(2);class lh{constructor(e){this.count=parseInt(Math.log(e+1)/ah,10),this.current_=this.count-1;const o=(s=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&o}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const on=function(n,e,t,i){n.sort(e);const o=function(c,u){const h=u-c;let d,p;if(0===h)return null;if(1===h)return d=n[c],p=t?t(d):d,new W(p,d.node,W.BLACK,null,null);{const _=parseInt(h/2,10)+c,g=o(c,_),x=o(_+1,u);return d=n[_],p=t?t(d):d,new W(p,d.node,W.BLACK,g,x)}},l=function(c){let u=null,h=null,d=n.length;const p=function(g,x){const k=d-g,we=d;d-=g;const Rn=o(k+1,we),er=n[k],K_=t?t(er):er;_(new W(K_,er.node,x,null,Rn))},_=function(g){u?(u.left=g,u=g):(h=g,u=g)};for(let g=0;g<c.count;++g){const x=c.nextBitIsOne(),k=Math.pow(2,c.count-(g+1));x?p(k,W.BLACK):(p(k,W.BLACK),p(k,W.RED))}return h}(new lh(n.length));return new F(i||e,l)};let oo;const Ke={};class le{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return f(Ke&&I,"ChildrenNode.ts has not been loaded"),oo=oo||new le({".priority":Ke},{".priority":I}),oo}get(e){const t=qe(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof F?t:null}hasIndex(e){return te(this.indexSet_,e.toString())}addIndex(e,t){f(e!==J,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let o=!1;const s=t.getIterator(b.Wrap);let l,a=s.getNext();for(;a;)o=o||e.isDefinedOn(a.node),i.push(a),a=s.getNext();l=o?on(i,e.getCompare()):Ke;const c=e.toString(),u=Object.assign({},this.indexSet_);u[c]=e;const h=Object.assign({},this.indexes_);return h[c]=l,new le(h,u)}addToIndexes(e,t){const i=zt(this.indexes_,(o,s)=>{const a=qe(this.indexSet_,s);if(f(a,"Missing index implementation for "+s),o===Ke){if(a.isDefinedOn(e.node)){const l=[],c=t.getIterator(b.Wrap);let u=c.getNext();for(;u;)u.name!==e.name&&l.push(u),u=c.getNext();return l.push(e),on(l,a.getCompare())}return Ke}{const l=t.get(e.name);let c=o;return l&&(c=c.remove(new b(e.name,l))),c.insert(e,e.node)}});return new le(i,this.indexSet_)}removeFromIndexes(e,t){const i=zt(this.indexes_,o=>{if(o===Ke)return o;{const s=t.get(e.name);return s?o.remove(new b(e.name,s)):o}});return new le(i,this.indexSet_)}}let vt,m=(()=>{class n{constructor(t,i,o){this.children_=t,this.priorityNode_=i,this.indexMap_=o,this.lazyHash_=null,this.priorityNode_&&Qs(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return vt||(vt=new n(new F(no),null,le.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||vt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const i=this.children_.get(t);return null===i?vt:i}}getChild(t){const i=v(t);return null===i?this:this.getImmediateChild(i).getChild(A(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,i){if(f(i,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(i);{const o=new b(t,i);let s,a;i.isEmpty()?(s=this.children_.remove(t),a=this.indexMap_.removeFromIndexes(o,this.children_)):(s=this.children_.insert(t,i),a=this.indexMap_.addToIndexes(o,this.children_));const l=s.isEmpty()?vt:this.priorityNode_;return new n(s,l,a)}}updateChild(t,i){const o=v(t);if(null===o)return i;{f(".priority"!==v(t)||1===he(t),".priority must be the last token in a path");const s=this.getImmediateChild(o).updateChild(A(t),i);return this.updateImmediateChild(o,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const i={};let o=0,s=0,a=!0;if(this.forEachChild(I,(l,c)=>{i[l]=c.val(t),o++,a&&n.INTEGER_REGEXP_.test(l)?s=Math.max(s,Number(l)):a=!1}),!t&&a&&s<2*o){const l=[];for(const c in i)l[c]=i[c];return l}return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+$s(this.getPriority().val())+":"),this.forEachChild(I,(i,o)=>{const s=o.hash();""!==s&&(t+=":"+i+":"+s)}),this.lazyHash_=""===t?"":ls(t)}return this.lazyHash_}getPredecessorChildName(t,i,o){const s=this.resolveIndex_(o);if(s){const a=s.getPredecessorKey(new b(t,i));return a?a.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const i=this.resolveIndex_(t);if(i){const o=i.minKey();return o&&o.name}return this.children_.minKey()}getFirstChild(t){const i=this.getFirstChildName(t);return i?new b(i,this.children_.get(i)):null}getLastChildName(t){const i=this.resolveIndex_(t);if(i){const o=i.maxKey();return o&&o.name}return this.children_.maxKey()}getLastChild(t){const i=this.getLastChildName(t);return i?new b(i,this.children_.get(i)):null}forEachChild(t,i){const o=this.resolveIndex_(t);return o?o.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){const o=this.resolveIndex_(i);if(o)return o.getIteratorFrom(t,s=>s);{const s=this.children_.getIteratorFrom(t.name,b.Wrap);let a=s.peek();for(;null!=a&&i.compare(a,t)<0;)s.getNext(),a=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){const o=this.resolveIndex_(i);if(o)return o.getReverseIteratorFrom(t,s=>s);{const s=this.children_.getReverseIteratorFrom(t.name,b.Wrap);let a=s.peek();for(;null!=a&&i.compare(a,t)>0;)s.getNext(),a=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===yt?-1:0}withIndex(t){if(t===J||this.indexMap_.hasIndex(t))return this;{const i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===J||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const i=t;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const o=this.getIterator(I),s=i.getIterator(I);let a=o.getNext(),l=s.getNext();for(;a&&l;){if(a.name!==l.name||!a.node.equals(l.node))return!1;a=o.getNext(),l=s.getNext()}return null===a&&null===l}return!1}return!1}}resolveIndex_(t){return t===J?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const yt=new class ch extends m{constructor(){super(new F(no),m.EMPTY_NODE,le.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return m.EMPTY_NODE}isEmpty(){return!1}};function R(n,e=null){if(null===n)return m.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),f(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new Je(n,R(e));if(n instanceof Array){let t=m.EMPTY_NODE;return P(n,(i,o)=>{if(te(n,i)&&"."!==i.substring(0,1)){const s=R(o);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(R(e))}{const t=[];let i=!1;if(P(n,(a,l)=>{if("."!==a.substring(0,1)){const c=R(l);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new b(a,c)))}}),0===t.length)return m.EMPTY_NODE;const s=on(t,nh,a=>a.name,no);if(i){const a=on(t,I.getCompare());return new m(s,R(e),new le({".priority":a},{".priority":I}))}return new m(s,R(e),le.Default)}}Object.defineProperties(b,{MIN:{value:new b(ae,m.EMPTY_NODE)},MAX:{value:new b(j,yt)}}),Vs.__EMPTY_NODE=m.EMPTY_NODE,Je.__childrenNodeConstructor=m,function ih(n){io=n}(yt),function rh(n){Ks=n}(yt),function oh(n){Js=n}(R);class ro extends en{constructor(e){super(),this.indexPath_=e,f(!y(e)&&".priority"!==v(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),o=this.extractChild(t.node),s=i.compareTo(o);return 0===s?De(e.name,t.name):s}makePost(e,t){const i=R(e),o=m.EMPTY_NODE.updateChild(this.indexPath_,i);return new b(t,o)}maxPost(){const e=m.EMPTY_NODE.updateChild(this.indexPath_,yt);return new b(j,e)}toString(){return gt(this.indexPath_,0).join("/")}}const so=new class dh extends en{compare(e,t){const i=e.node.compareTo(t.node);return 0===i?De(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return b.MIN}maxPost(){return b.MAX}makePost(e,t){const i=R(e);return new b(t,i)}toString(){return".value"}};function na(n){return{type:"value",snapshotNode:n}}function Xe(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function bt(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function wt(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class lo{constructor(e){this.index_=e}updateChild(e,t,i,o,s,a){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const l=e.getImmediateChild(t);return l.getChild(o).equals(i.getChild(o))&&l.isEmpty()===i.isEmpty()||(null!=a&&(i.isEmpty()?e.hasChild(t)?a.trackChildChange(bt(t,l)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):l.isEmpty()?a.trackChildChange(Xe(t,i)):a.trackChildChange(wt(t,i,l))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return null!=i&&(e.isLeafNode()||e.forEachChild(I,(o,s)=>{t.hasChild(o)||i.trackChildChange(bt(o,s))}),t.isLeafNode()||t.forEachChild(I,(o,s)=>{if(e.hasChild(o)){const a=e.getImmediateChild(o);a.equals(s)||i.trackChildChange(wt(o,s,a))}else i.trackChildChange(Xe(o,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?m.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class xt{constructor(e){this.indexedFilter_=new lo(e.getIndex()),this.index_=e.getIndex(),this.startPost_=xt.getStartPost_(e),this.endPost_=xt.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,i,o,s,a){return this.matches(new b(t,i))||(i=m.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,o,s,a)}updateFullNode(e,t,i){t.isLeafNode()&&(t=m.EMPTY_NODE);let o=t.withIndex(this.index_);o=o.updatePriority(m.EMPTY_NODE);const s=this;return t.forEachChild(I,(a,l)=>{s.matches(new b(a,l))||(o=o.updateImmediateChild(a,m.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,o,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class _h{constructor(e){this.rangedFilter_=new xt(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,i,o,s,a){return this.rangedFilter_.matches(new b(t,i))||(i=m.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,o,s,a):this.fullLimitUpdateChild_(e,t,i,s,a)}updateFullNode(e,t,i){let o;if(t.isLeafNode()||t.isEmpty())o=m.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let s;o=m.EMPTY_NODE.withIndex(this.index_),s=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let a=0;for(;s.hasNext()&&a<this.limit_;){const l=s.getNext();let c;if(c=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),l)<=0:this.index_.compare(l,this.rangedFilter_.getEndPost())<=0,!c)break;o=o.updateImmediateChild(l.name,l.node),a++}}else{let s,a,l,c;if(o=t.withIndex(this.index_),o=o.updatePriority(m.EMPTY_NODE),this.reverse_){c=o.getReverseIterator(this.index_),s=this.rangedFilter_.getEndPost(),a=this.rangedFilter_.getStartPost();const d=this.index_.getCompare();l=(p,_)=>d(_,p)}else c=o.getIterator(this.index_),s=this.rangedFilter_.getStartPost(),a=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();let u=0,h=!1;for(;c.hasNext();){const d=c.getNext();!h&&l(s,d)<=0&&(h=!0),h&&u<this.limit_&&l(d,a)<=0?u++:o=o.updateImmediateChild(d.name,m.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,o,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,o,s){let a;if(this.reverse_){const d=this.index_.getCompare();a=(p,_)=>d(_,p)}else a=this.index_.getCompare();const l=e;f(l.numChildren()===this.limit_,"");const c=new b(t,i),u=this.reverse_?l.getFirstChild(this.index_):l.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(l.hasChild(t)){const d=l.getImmediateChild(t);let p=o.getChildAfterChild(this.index_,u,this.reverse_);for(;null!=p&&(p.name===t||l.hasChild(p.name));)p=o.getChildAfterChild(this.index_,p,this.reverse_);const _=null==p?1:a(p,c);if(h&&!i.isEmpty()&&_>=0)return s?.trackChildChange(wt(t,i,d)),l.updateImmediateChild(t,i);{s?.trackChildChange(bt(t,d));const x=l.updateImmediateChild(t,m.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(s?.trackChildChange(Xe(p.name,p.node)),x.updateImmediateChild(p.name,p.node)):x}}return i.isEmpty()?e:h&&a(u,c)>=0?(null!=s&&(s.trackChildChange(bt(u.name,u.node)),s.trackChildChange(Xe(t,i))),l.updateImmediateChild(t,i).updateImmediateChild(u.name,m.EMPTY_NODE)):e}}class co{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=I}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:ae}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:j}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===I}copy(){const e=new co;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function ia(n){const e={};if(n.isDefault())return e;let t;return n.index_===I?t="$priority":n.index_===so?t="$value":n.index_===J?t="$key":(f(n.index_ instanceof ro,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=D(t),n.startSet_&&(e.startAt=D(n.indexStartValue_),n.startNameSet_&&(e.startAt+=","+D(n.indexStartName_))),n.endSet_&&(e.endAt=D(n.indexEndValue_),n.endNameSet_&&(e.endAt+=","+D(n.indexEndName_))),n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function oa(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_)),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_)),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==I&&(e.i=n.index_.toString()),e}class sn extends Fs{constructor(e,t,i,o){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=o,this.log_=ht("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,i,o){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const a=sn.getListenId_(e,i),l={};this.listens_[a]=l;const c=ia(e._queryParams);this.restRequest_(s+".json",c,(u,h)=>{let d=h;if(404===u&&(d=null,u=null),null===u&&this.onDataUpdate_(s,d,!1,i),qe(this.listens_,a)===l){let p;p=u?401===u?"permission_denied":"rest_error:"+u:"ok",o(p,null)}})}unlisten(e,t){const i=sn.getListenId_(e,t);delete this.listens_[i]}get(e){const t=ia(e._queryParams),i=e._path.toString(),o=new at;return this.restRequest_(i+".json",t,(s,a)=>{let l=a;404===s&&(l=null,s=null),null===s?(this.onDataUpdate_(i,l,!1,null),o.resolve(l)):o.reject(new Error(l))}),o.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([o,s])=>{o&&o.accessToken&&(t.auth=o.accessToken),s&&s.token&&(t.ac=s.token);const a=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function Al(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(o=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(o))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}(t);this.log_("Sending REST request for "+a);const l=new XMLHttpRequest;l.onreadystatechange=()=>{if(i&&4===l.readyState){this.log_("REST Response for "+a+" received. status:",l.status,"response:",l.responseText);let c=null;if(l.status>=200&&l.status<300){try{c=lt(l.responseText)}catch{O("Failed to parse JSON response for "+a+": "+l.responseText)}i(null,c)}else 401!==l.status&&404!==l.status&&O("Got unsuccessful REST response for "+a+" Status: "+l.status),i(l.status);i=null}},l.open("GET",a,!0),l.send()})}}class bh{constructor(){this.rootNode_=m.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function an(){return{value:null,children:new Map}}function et(n,e,t){if(y(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const i=v(e);n.children.has(i)||n.children.set(i,an()),et(n.children.get(i),e=A(e),t)}}function _o(n,e,t){null!==n.value?t(e,n.value):function wh(n,e){n.children.forEach((t,i)=>{e(i,t)})}(n,(i,o)=>{_o(o,new T(e.toString()+"/"+i),t)})}class xh{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&P(this.last_,(i,o)=>{t[i]=t[i]-o}),this.last_=e,t}}class Eh{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new xh(e);const i=1e4+2e4*Math.random();_t(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;P(e,(o,s)=>{s>0&&te(this.statsToReport_,o)&&(t[o]=s,i=!0)}),i&&this.server_.reportStats(t),_t(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var H=(()=>{return(n=H||(H={}))[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",H;var n})();function mo(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class ln{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=H.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(y(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new T(e));return new ln(C(),t,this.revert)}}return f(v(this.path)===e,"operationForChild called for unrelated child."),new ln(A(this.path),this.affectedTree,this.revert)}}class Ct{constructor(e,t){this.source=e,this.path=t,this.type=H.LISTEN_COMPLETE}operationForChild(e){return y(this.path)?new Ct(this.source,C()):new Ct(this.source,A(this.path))}}class Le{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=H.OVERWRITE}operationForChild(e){return y(this.path)?new Le(this.source,C(),this.snap.getImmediateChild(e)):new Le(this.source,A(this.path),this.snap)}}class tt{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=H.MERGE}operationForChild(e){if(y(this.path)){const t=this.children.subtree(new T(e));return t.isEmpty()?null:t.value?new Le(this.source,C(),t.value):new tt(this.source,C(),t)}return f(v(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new tt(this.source,A(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class pe{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(y(e))return this.isFullyInitialized()&&!this.filtered_;const t=v(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Ah{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function Tt(n,e,t,i,o,s){const a=i.filter(l=>l.type===t);a.sort((l,c)=>function kh(n,e,t){if(null==e.childName||null==t.childName)throw ze("Should only compare child_ events.");const i=new b(e.childName,e.snapshotNode),o=new b(t.childName,t.snapshotNode);return n.index_.compare(i,o)}(n,l,c)),a.forEach(l=>{const c=function Sh(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,l,s);o.forEach(u=>{u.respondsTo(l.type)&&e.push(u.createEvent(c,n.query_))})})}function cn(n,e){return{eventCache:n,serverCache:e}}function Et(n,e,t,i){return cn(new pe(e,t,i),n.serverCache)}function sa(n,e,t,i){return cn(n.eventCache,new pe(e,t,i))}function un(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Oe(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let vo;class S{constructor(e,t=(()=>(vo||(vo=new F(_d)),vo))()){this.value=e,this.children=t}static fromObject(e){let t=new S(null);return P(e,(i,o)=>{t=t.set(new T(i),o)}),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:C(),value:this.value};if(y(e))return null;{const i=v(e),o=this.children.get(i);if(null!==o){const s=o.findRootMostMatchingPathAndValue(A(e),t);return null!=s?{path:N(new T(i),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(y(e))return this;{const t=v(e),i=this.children.get(t);return null!==i?i.subtree(A(e)):new S(null)}}set(e,t){if(y(e))return new S(t,this.children);{const i=v(e),s=(this.children.get(i)||new S(null)).set(A(e),t),a=this.children.insert(i,s);return new S(this.value,a)}}remove(e){if(y(e))return this.children.isEmpty()?new S(null):new S(null,this.children);{const t=v(e),i=this.children.get(t);if(i){const o=i.remove(A(e));let s;return s=o.isEmpty()?this.children.remove(t):this.children.insert(t,o),null===this.value&&s.isEmpty()?new S(null):new S(this.value,s)}return this}}get(e){if(y(e))return this.value;{const t=v(e),i=this.children.get(t);return i?i.get(A(e)):null}}setTree(e,t){if(y(e))return t;{const i=v(e),s=(this.children.get(i)||new S(null)).setTree(A(e),t);let a;return a=s.isEmpty()?this.children.remove(i):this.children.insert(i,s),new S(this.value,a)}}fold(e){return this.fold_(C(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((o,s)=>{i[o]=s.fold_(N(e,o),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,C(),t)}findOnPath_(e,t,i){const o=!!this.value&&i(t,this.value);if(o)return o;if(y(e))return null;{const s=v(e),a=this.children.get(s);return a?a.findOnPath_(A(e),N(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,C(),t)}foreachOnPath_(e,t,i){if(y(e))return this;{this.value&&i(t,this.value);const o=v(e),s=this.children.get(o);return s?s.foreachOnPath_(A(e),N(t,o),i):new S(null)}}foreach(e){this.foreach_(C(),e)}foreach_(e,t){this.children.inorderTraversal((i,o)=>{o.foreach_(N(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class G{constructor(e){this.writeTree_=e}static empty(){return new G(new S(null))}}function At(n,e,t){if(y(e))return new G(new S(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(null!=i){const o=i.path;let s=i.value;const a=Z(o,e);return s=s.updateChild(a,t),new G(n.writeTree_.set(o,s))}{const o=new S(t),s=n.writeTree_.setTree(e,o);return new G(s)}}}function yo(n,e,t){let i=n;return P(t,(o,s)=>{i=At(i,N(e,o),s)}),i}function aa(n,e){if(y(e))return G.empty();{const t=n.writeTree_.setTree(e,new S(null));return new G(t)}}function bo(n,e){return null!=Ze(n,e)}function Ze(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(Z(t.path,e)):null}function la(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(I,(i,o)=>{e.push(new b(i,o))}):n.writeTree_.children.inorderTraversal((i,o)=>{null!=o.value&&e.push(new b(i,o.value))}),e}function _e(n,e){if(y(e))return n;{const t=Ze(n,e);return new G(null!=t?new S(t):n.writeTree_.subtree(e))}}function wo(n){return n.writeTree_.isEmpty()}function nt(n,e){return ca(C(),n.writeTree_,e)}function ca(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((o,s)=>{".priority"===o?(f(null!==s.value,"Priority writes must always be leaf nodes"),i=s.value):t=ca(N(n,o),s,t)}),!t.getChild(n).isEmpty()&&null!==i&&(t=t.updateChild(N(n,".priority"),i)),t}}function dn(n,e){return _a(e,n)}function Lh(n,e){if(n.snap)return q(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&q(N(n.path,t),e))return!0;return!1}function Zh(n){return n.visible}function ua(n,e,t){let i=G.empty();for(let o=0;o<n.length;++o){const s=n[o];if(e(s)){const a=s.path;let l;if(s.snap)q(t,a)?(l=Z(t,a),i=At(i,l,s.snap)):q(a,t)&&(l=Z(a,t),i=At(i,C(),s.snap.getChild(l)));else{if(!s.children)throw ze("WriteRecord should have .snap or .children");if(q(t,a))l=Z(t,a),i=yo(i,l,s.children);else if(q(a,t))if(l=Z(a,t),y(l))i=yo(i,C(),s.children);else{const c=qe(s.children,v(l));if(c){const u=c.getChild(A(l));i=At(i,C(),u)}}}}}return i}function da(n,e,t,i,o){if(i||o){const s=_e(n.visibleWrites,e);return!o&&wo(s)?t:o||null!=t||bo(s,C())?nt(ua(n.allWrites,function(u){return(u.visible||o)&&(!i||!~i.indexOf(u.writeId))&&(q(u.path,e)||q(e,u.path))},e),t||m.EMPTY_NODE):null}{const s=Ze(n.visibleWrites,e);if(null!=s)return s;{const a=_e(n.visibleWrites,e);return wo(a)?t:null!=t||bo(a,C())?nt(a,t||m.EMPTY_NODE):null}}}function hn(n,e,t,i){return da(n.writeTree,n.treePath,e,t,i)}function xo(n,e){return function Fh(n,e,t){let i=m.EMPTY_NODE;const o=Ze(n.visibleWrites,e);if(o)return o.isLeafNode()||o.forEachChild(I,(s,a)=>{i=i.updateImmediateChild(s,a)}),i;if(t){const s=_e(n.visibleWrites,e);return t.forEachChild(I,(a,l)=>{const c=nt(_e(s,new T(a)),l);i=i.updateImmediateChild(a,c)}),la(s).forEach(a=>{i=i.updateImmediateChild(a.name,a.node)}),i}return la(_e(n.visibleWrites,e)).forEach(a=>{i=i.updateImmediateChild(a.name,a.node)}),i}(n.writeTree,n.treePath,e)}function ha(n,e,t,i){return function Uh(n,e,t,i,o){f(i||o,"Either existingEventSnap or existingServerSnap must exist");const s=N(e,t);if(bo(n.visibleWrites,s))return null;{const a=_e(n.visibleWrites,s);return wo(a)?o.getChild(t):nt(a,o.getChild(t))}}(n.writeTree,n.treePath,e,t,i)}function pn(n,e){return function zh(n,e){return Ze(n.visibleWrites,e)}(n.writeTree,N(n.treePath,e))}function Co(n,e,t){return function Bh(n,e,t,i){const o=N(e,t),s=Ze(n.visibleWrites,o);return null!=s?s:i.isCompleteForChild(t)?nt(_e(n.visibleWrites,o),i.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function pa(n,e){return _a(N(n.treePath,e),n.writeTree)}function _a(n,e){return{treePath:n,writeTree:e}}class Gh{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==i,"Only non-priority child changes can be tracked.");const o=this.changeMap.get(i);if(o){const s=o.type;if("child_added"===t&&"child_removed"===s)this.changeMap.set(i,wt(i,e.snapshotNode,o.snapshotNode));else if("child_removed"===t&&"child_added"===s)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===s)this.changeMap.set(i,bt(i,o.oldSnap));else if("child_changed"===t&&"child_added"===s)this.changeMap.set(i,Xe(i,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==s)throw ze("Illegal combination of changes: "+e+" occurred after "+o);this.changeMap.set(i,wt(i,e.snapshotNode,o.oldSnap))}}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}const fa=new class Vh{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}};class To{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=null!=this.optCompleteServerCache_?new pe(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Co(this.writes_,e,i)}}getChildAfterChild(e,t,i){const o=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Oe(this.viewCache_),s=function Wh(n,e,t,i,o,s){return function qh(n,e,t,i,o,s,a){let l;const c=_e(n.visibleWrites,e),u=Ze(c,C());if(null!=u)l=u;else{if(null==t)return[];l=nt(c,t)}if(l=l.withIndex(a),l.isEmpty()||l.isLeafNode())return[];{const h=[],d=a.getCompare(),p=s?l.getReverseIteratorFrom(i,a):l.getIteratorFrom(i,a);let _=p.getNext();for(;_&&h.length<o;)0!==d(_,i)&&h.push(_),_=p.getNext();return h}}(n.writeTree,n.treePath,e,t,i,o,s)}(this.writes_,o,t,1,i,e);return 0===s.length?null:s[0]}}function ga(n,e,t,i,o,s){const a=e.eventCache;if(null!=pn(i,t))return e;{let l,c;if(y(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const u=Oe(e),d=xo(i,u instanceof m?u:m.EMPTY_NODE);l=n.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{const u=hn(i,Oe(e));l=n.filter.updateFullNode(e.eventCache.getNode(),u,s)}else{const u=v(t);if(".priority"===u){f(1===he(t),"Can't have a priority with additional path components");const h=a.getNode();c=e.serverCache.getNode();const d=ha(i,t,h,c);l=null!=d?n.filter.updatePriority(h,d):a.getNode()}else{const h=A(t);let d;if(a.isCompleteForChild(u)){c=e.serverCache.getNode();const p=ha(i,t,a.getNode(),c);d=null!=p?a.getNode().getImmediateChild(u).updateChild(h,p):a.getNode().getImmediateChild(u)}else d=Co(i,u,e.serverCache);l=null!=d?n.filter.updateChild(a.getNode(),u,d,h,o,s):a.getNode()}}return Et(e,l,a.isFullyInitialized()||y(t),n.filter.filtersNodes())}}function _n(n,e,t,i,o,s,a,l){const c=e.serverCache;let u;const h=a?n.filter:n.filter.getIndexedFilter();if(y(t))u=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const _=c.getNode().updateChild(t,i);u=h.updateFullNode(c.getNode(),_,null)}else{const _=v(t);if(!c.isCompleteForPath(t)&&he(t)>1)return e;const g=A(t),k=c.getNode().getImmediateChild(_).updateChild(g,i);u=".priority"===_?h.updatePriority(c.getNode(),k):h.updateChild(c.getNode(),_,k,g,fa,null)}const d=sa(e,u,c.isFullyInitialized()||y(t),h.filtersNodes());return ga(n,d,t,o,new To(o,d,s),l)}function Eo(n,e,t,i,o,s,a){const l=e.eventCache;let c,u;const h=new To(o,e,s);if(y(t))u=n.filter.updateFullNode(e.eventCache.getNode(),i,a),c=Et(e,u,!0,n.filter.filtersNodes());else{const d=v(t);if(".priority"===d)u=n.filter.updatePriority(e.eventCache.getNode(),i),c=Et(e,u,l.isFullyInitialized(),l.isFiltered());else{const p=A(t),_=l.getNode().getImmediateChild(d);let g;if(y(p))g=i;else{const x=h.getCompleteChild(d);g=null!=x?".priority"===Xi(p)&&x.getChild(qs(p)).isEmpty()?x:x.updateChild(p,i):m.EMPTY_NODE}c=_.equals(g)?e:Et(e,n.filter.updateChild(l.getNode(),d,g,p,h,a),l.isFullyInitialized(),n.filter.filtersNodes())}}return c}function ma(n,e){return n.eventCache.isCompleteForChild(e)}function va(n,e,t){return t.foreach((i,o)=>{e=e.updateChild(i,o)}),e}function Ao(n,e,t,i,o,s,a,l){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let u,c=e;u=y(t)?i:new S(null).setTree(t,i);const h=e.serverCache.getNode();return u.children.inorderTraversal((d,p)=>{if(h.hasChild(d)){const g=va(0,e.serverCache.getNode().getImmediateChild(d),p);c=_n(n,c,new T(d),g,o,s,a,l)}}),u.children.inorderTraversal((d,p)=>{const _=!e.serverCache.isCompleteForChild(d)&&null===p.value;if(!h.hasChild(d)&&!_){const x=va(0,e.serverCache.getNode().getImmediateChild(d),p);c=_n(n,c,new T(d),x,o,s,a,l)}}),c}class tp{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,o=new lo(i.getIndex()),s=function fh(n){return n.loadsAllData()?new lo(n.getIndex()):n.hasLimit()?new _h(n):new xt(n)}(i);this.processor_=function $h(n){return{filter:n}}(s);const a=t.serverCache,l=t.eventCache,c=o.updateFullNode(m.EMPTY_NODE,a.getNode(),null),u=s.updateFullNode(m.EMPTY_NODE,l.getNode(),null),h=new pe(c,a.isFullyInitialized(),o.filtersNodes()),d=new pe(u,l.isFullyInitialized(),s.filtersNodes());this.viewCache_=cn(d,h),this.eventGenerator_=new Ah(this.query_)}get query(){return this.query_}}function op(n,e){const t=Oe(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!y(e)&&!t.getImmediateChild(v(e)).isEmpty())?t.getChild(e):null}function ya(n){return 0===n.eventRegistrations_.length}function ba(n,e,t){const i=[];if(t){f(null==e,"A cancel should cancel all event registrations.");const o=n.query._path;n.eventRegistrations_.forEach(s=>{const a=s.createCancelEvent(t,o);a&&i.push(a)})}if(e){let o=[];for(let s=0;s<n.eventRegistrations_.length;++s){const a=n.eventRegistrations_[s];if(a.matches(e)){if(e.hasAnyCallback()){o=o.concat(n.eventRegistrations_.slice(s+1));break}}else o.push(a)}n.eventRegistrations_=o}else n.eventRegistrations_=[];return i}function wa(n,e,t,i){e.type===H.MERGE&&null!==e.source.queryId&&(f(Oe(n.viewCache_),"We should always have a full cache before handling merges"),f(un(n.viewCache_),"Missing event cache, even though we have a server cache"));const o=n.viewCache_,s=function jh(n,e,t,i,o){const s=new Gh;let a,l;if(t.type===H.OVERWRITE){const u=t;u.source.fromUser?a=Eo(n,e,u.path,u.snap,i,o,s):(f(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.serverCache.isFiltered()&&!y(u.path),a=_n(n,e,u.path,u.snap,i,o,l,s))}else if(t.type===H.MERGE){const u=t;u.source.fromUser?a=function Kh(n,e,t,i,o,s,a){let l=e;return i.foreach((c,u)=>{const h=N(t,c);ma(e,v(h))&&(l=Eo(n,l,h,u,o,s,a))}),i.foreach((c,u)=>{const h=N(t,c);ma(e,v(h))||(l=Eo(n,l,h,u,o,s,a))}),l}(n,e,u.path,u.children,i,o,s):(f(u.source.fromServer,"Unknown source."),l=u.source.tagged||e.serverCache.isFiltered(),a=Ao(n,e,u.path,u.children,i,o,l,s))}else if(t.type===H.ACK_USER_WRITE){const u=t;a=u.revert?function ep(n,e,t,i,o,s){let a;if(null!=pn(i,t))return e;{const l=new To(i,e,o),c=e.eventCache.getNode();let u;if(y(t)||".priority"===v(t)){let h;if(e.serverCache.isFullyInitialized())h=hn(i,Oe(e));else{const d=e.serverCache.getNode();f(d instanceof m,"serverChildren would be complete if leaf node"),h=xo(i,d)}u=n.filter.updateFullNode(c,h,s)}else{const h=v(t);let d=Co(i,h,e.serverCache);null==d&&e.serverCache.isCompleteForChild(h)&&(d=c.getImmediateChild(h)),u=null!=d?n.filter.updateChild(c,h,d,A(t),l,s):e.eventCache.getNode().hasChild(h)?n.filter.updateChild(c,h,m.EMPTY_NODE,A(t),l,s):c,u.isEmpty()&&e.serverCache.isFullyInitialized()&&(a=hn(i,Oe(e)),a.isLeafNode()&&(u=n.filter.updateFullNode(u,a,s)))}return a=e.serverCache.isFullyInitialized()||null!=pn(i,C()),Et(e,u,a,n.filter.filtersNodes())}}(n,e,u.path,i,o,s):function Yh(n,e,t,i,o,s,a){if(null!=pn(o,t))return e;const l=e.serverCache.isFiltered(),c=e.serverCache;if(null!=i.value){if(y(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return _n(n,e,t,c.getNode().getChild(t),o,s,l,a);if(y(t)){let u=new S(null);return c.getNode().forEachChild(J,(h,d)=>{u=u.set(new T(h),d)}),Ao(n,e,t,u,o,s,l,a)}return e}{let u=new S(null);return i.foreach((h,d)=>{const p=N(t,h);c.isCompleteForPath(p)&&(u=u.set(h,c.getNode().getChild(p)))}),Ao(n,e,t,u,o,s,l,a)}}(n,e,u.path,u.affectedTree,i,o,s)}else{if(t.type!==H.LISTEN_COMPLETE)throw ze("Unknown operation type: "+t.type);a=function Xh(n,e,t,i,o){const s=e.serverCache;return ga(n,sa(e,s.getNode(),s.isFullyInitialized()||y(t),s.isFiltered()),t,i,fa,o)}(n,e,t.path,i,s)}const c=s.getChanges();return function Jh(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const o=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=un(n);(t.length>0||!n.eventCache.isFullyInitialized()||o&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(na(un(e)))}}(e,a,c),{viewCache:a,changes:c}}(n.processor_,o,e,t,i);return function Qh(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,s.viewCache),f(s.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,xa(n,s.changes,s.viewCache.eventCache.getNode(),null)}function xa(n,e,t,i){return function Ih(n,e,t,i){const o=[],s=[];return e.forEach(a=>{"child_changed"===a.type&&n.index_.indexedValueChanged(a.oldSnap,a.snapshotNode)&&s.push(function ph(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(a.childName,a.snapshotNode))}),Tt(n,o,"child_removed",e,i,t),Tt(n,o,"child_added",e,i,t),Tt(n,o,"child_moved",s,i,t),Tt(n,o,"child_changed",e,i,t),Tt(n,o,"value",e,i,t),o}(n.eventGenerator_,e,t,i?[i]:n.eventRegistrations_)}let fn,mn;class Ca{constructor(){this.views=new Map}}function Io(n,e,t,i){const o=e.source.queryId;if(null!==o){const s=n.views.get(o);return f(null!=s,"SyncTree gave us an op for an invalid query."),wa(s,e,t,i)}{let s=[];for(const a of n.views.values())s=s.concat(wa(a,e,t,i));return s}}function up(n,e,t,i,o,s){const a=function Ta(n,e,t,i,o){const a=n.views.get(e._queryIdentifier);if(!a){let l=hn(t,o?i:null),c=!1;l?c=!0:i instanceof m?(l=xo(t,i),c=!1):(l=m.EMPTY_NODE,c=!1);const u=cn(new pe(l,c,!1),new pe(i,o,!1));return new tp(e,u)}return a}(n,e,i,o,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,a),function rp(n,e){n.eventRegistrations_.push(e)}(a,t),function sp(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(I,(s,a)=>{i.push(Xe(s,a))}),t.isFullyInitialized()&&i.push(na(t.getNode())),xa(n,i,t.getNode(),e)}(a,t)}function Ea(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function fe(n,e){let t=null;for(const i of n.views.values())t=t||op(i,e);return t}function Aa(n,e){return e._queryParams.loadsAllData()?gn(n):n.views.get(e._queryIdentifier)}function Ia(n,e){return null!=Aa(n,e)}function ge(n){return null!=gn(n)}function gn(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let _p=1;class Sa{constructor(e){this.listenProvider_=e,this.syncPointTree_=new S(null),this.pendingWriteTree_=function Hh(){return{visibleWrites:G.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function So(n,e,t,i,o){return function Rh(n,e,t,i,o){f(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:o}),o&&(n.visibleWrites=At(n.visibleWrites,e,t)),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i,o),o?it(n,new Le({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function me(n,e,t=!1){const i=function Mh(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}(n.pendingWriteTree_,e);if(function Ph(n,e){const t=n.allWrites.findIndex(l=>l.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let o=i.visible,s=!1,a=n.allWrites.length-1;for(;o&&a>=0;){const l=n.allWrites[a];l.visible&&(a>=t&&Lh(l,i.path)?o=!1:q(i.path,l.path)&&(s=!0)),a--}return!!o&&(s?(function Oh(n){n.visibleWrites=ua(n.allWrites,Zh,C()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=aa(n.visibleWrites,i.path):P(i.children,c=>{n.visibleWrites=aa(n.visibleWrites,N(i.path,c))}),!0))}(n.pendingWriteTree_,e)){let s=new S(null);return null!=i.snap?s=s.set(C(),!0):P(i.children,a=>{s=s.set(new T(a),!0)}),it(n,new ln(i.path,s,t))}return[]}function It(n,e,t){return it(n,new Le({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function vn(n,e,t,i,o=!1){const s=e._path,a=n.syncPointTree_.get(s);let l=[];if(a&&("default"===e._queryIdentifier||Ia(a,e))){const c=function dp(n,e,t,i){const o=e._queryIdentifier,s=[];let a=[];const l=ge(n);if("default"===o)for(const[c,u]of n.views.entries())a=a.concat(ba(u,t,i)),ya(u)&&(n.views.delete(c),u.query._queryParams.loadsAllData()||s.push(u.query));else{const c=n.views.get(o);c&&(a=a.concat(ba(c,t,i)),ya(c)&&(n.views.delete(o),c.query._queryParams.loadsAllData()||s.push(c.query)))}return l&&!ge(n)&&s.push(new(function lp(){return f(fn,"Reference.ts has not been loaded"),fn}())(e._repo,e._path)),{removed:s,events:a}}(a,e,t,i);(function cp(n){return 0===n.views.size})(a)&&(n.syncPointTree_=n.syncPointTree_.remove(s));const u=c.removed;if(l=c.events,!o){const h=-1!==u.findIndex(p=>p._queryParams.loadsAllData()),d=n.syncPointTree_.findOnPath(s,(p,_)=>ge(_));if(h&&!d){const p=n.syncPointTree_.subtree(s);if(!p.isEmpty()){const _=function wp(n){return n.fold((e,t,i)=>{if(t&&ge(t))return[gn(t)];{let o=[];return t&&(o=Ea(t)),P(i,(s,a)=>{o=o.concat(a)}),o}})}(p);for(let g=0;g<_.length;++g){const x=_[g],k=x.query,we=Da(n,x);n.listenProvider_.startListening(kt(k),St(n,k),we.hashFn,we.onComplete)}}}!d&&u.length>0&&!i&&(h?n.listenProvider_.stopListening(kt(e),null):u.forEach(p=>{const _=n.queryToTagMap.get(bn(p));n.listenProvider_.stopListening(kt(p),_)}))}!function xp(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const o=bn(i),s=n.queryToTagMap.get(o);n.queryToTagMap.delete(o),n.tagToQueryMap.delete(s)}}}(n,u)}return l}function ko(n,e,t,i=!1){const o=e._path;let s=null,a=!1;n.syncPointTree_.foreachOnPath(o,(p,_)=>{const g=Z(p,o);s=s||fe(_,g),a=a||ge(_)});let c,l=n.syncPointTree_.get(o);l?(a=a||ge(l),s=s||fe(l,C())):(l=new Ca,n.syncPointTree_=n.syncPointTree_.set(o,l)),null!=s?c=!0:(c=!1,s=m.EMPTY_NODE,n.syncPointTree_.subtree(o).foreachChild((_,g)=>{const x=fe(g,C());x&&(s=s.updateImmediateChild(_,x))}));const u=Ia(l,e);if(!u&&!e._queryParams.loadsAllData()){const p=bn(e);f(!n.queryToTagMap.has(p),"View does not exist, but we have a tag");const _=function Cp(){return _p++}();n.queryToTagMap.set(p,_),n.tagToQueryMap.set(_,p)}let d=up(l,e,t,dn(n.pendingWriteTree_,o),s,c);if(!u&&!a&&!i){const p=Aa(l,e);d=d.concat(function Tp(n,e,t){const i=e._path,o=St(n,e),s=Da(n,t),a=n.listenProvider_.startListening(kt(e),o,s.hashFn,s.onComplete),l=n.syncPointTree_.subtree(i);if(o)f(!ge(l.value),"If we're adding a query, it shouldn't be shadowed");else{const c=l.fold((u,h,d)=>{if(!y(u)&&h&&ge(h))return[gn(h).query];{let p=[];return h&&(p=p.concat(Ea(h).map(_=>_.query))),P(d,(_,g)=>{p=p.concat(g)}),p}});for(let u=0;u<c.length;++u){const h=c[u];n.listenProvider_.stopListening(kt(h),St(n,h))}}return a}(n,e,p))}return d}function yn(n,e,t){const o=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(a,l)=>{const u=fe(l,Z(a,e));if(u)return u});return da(o,e,s,t,!0)}function it(n,e){return Na(e,n.syncPointTree_,null,dn(n.pendingWriteTree_,C()))}function Na(n,e,t,i){if(y(n.path))return Ra(n,e,t,i);{const o=e.get(C());null==t&&null!=o&&(t=fe(o,C()));let s=[];const a=v(n.path),l=n.operationForChild(a),c=e.children.get(a);if(c&&l){const u=t?t.getImmediateChild(a):null,h=pa(i,a);s=s.concat(Na(l,c,u,h))}return o&&(s=s.concat(Io(o,n,i,t))),s}}function Ra(n,e,t,i){const o=e.get(C());null==t&&null!=o&&(t=fe(o,C()));let s=[];return e.children.inorderTraversal((a,l)=>{const c=t?t.getImmediateChild(a):null,u=pa(i,a),h=n.operationForChild(a);h&&(s=s.concat(Ra(h,l,c,u)))}),o&&(s=s.concat(Io(o,n,i,t))),s}function Da(n,e){const t=e.query,i=St(n,t);return{hashFn:()=>(function np(n){return n.viewCache_.serverCache.getNode()}(e)||m.EMPTY_NODE).hash(),onComplete:o=>{if("ok"===o)return i?function vp(n,e,t){const i=No(n,t);if(i){const o=Ro(i),s=o.path,a=o.queryId,l=Z(s,e);return Do(n,s,new Ct(mo(a),l))}return[]}(n,t._path,i):function mp(n,e){return it(n,new Ct({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(n,t._path);{const s=function md(n,e){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}(o,t);return vn(n,t,null,s)}}}}function St(n,e){const t=bn(e);return n.queryToTagMap.get(t)}function bn(n){return n._path.toString()+"$"+n._queryIdentifier}function No(n,e){return n.tagToQueryMap.get(e)}function Ro(n){const e=n.indexOf("$");return f(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new T(n.substr(0,e))}}function Do(n,e,t){const i=n.syncPointTree_.get(e);return f(i,"Missing sync point for query tag that we're tracking"),Io(i,t,dn(n.pendingWriteTree_,e),null)}function kt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function pp(){return f(mn,"Reference.ts has not been loaded"),mn}())(n._repo,n._path):n}class Mo{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Mo(t)}node(){return this.node_}}class Po{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=N(this.path_,e);return new Po(this.syncTree_,t)}node(){return yn(this.syncTree_,this.path_)}}const Ma=function(n,e,t){return n&&"object"==typeof n?(f(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?Ap(n[".sv"],e,t):"object"==typeof n[".sv"]?Ip(n[".sv"],e):void f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},Ap=function(n,e,t){if("timestamp"===n)return t.timestamp;f(!1,"Unexpected server value: "+n)},Ip=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&f(!1,"Unexpected increment value: "+i);const o=e.node();if(f(null!==o&&typeof o<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return i;const a=o.getValue();return"number"!=typeof a?i:a+i},Lo=function(n,e,t){return Oo(n,new Mo(e),t)};function Oo(n,e,t){const i=n.getPriority().val(),o=Ma(i,e.getImmediateChild(".priority"),t);let s;if(n.isLeafNode()){const a=n,l=Ma(a.getValue(),e,t);return l!==a.getValue()||o!==a.getPriority().val()?new Je(l,R(o)):n}{const a=n;return s=a,o!==a.getPriority().val()&&(s=s.updatePriority(new Je(o))),a.forEachChild(I,(l,c)=>{const u=Oo(c,e.getImmediateChild(l),t);u!==c&&(s=s.updateImmediateChild(l,u))}),s}}class Zo{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function wn(n,e){let t=e instanceof T?e:new T(e),i=n,o=v(t);for(;null!==o;){const s=qe(i.node.children,o)||{children:{},childCount:0};i=new Zo(o,i,s),t=A(t),o=v(t)}return i}function Fe(n){return n.node.value}function Fo(n,e){n.node.value=e,Uo(n)}function La(n){return n.node.childCount>0}function xn(n,e){P(n.node.children,(t,i)=>{e(new Zo(t,n,i))})}function Oa(n,e,t,i){t&&!i&&e(n),xn(n,o=>{Oa(o,e,!0,i)}),t&&i&&e(n)}function Nt(n){return new T(null===n.parent?n.name:Nt(n.parent)+"/"+n.name)}function Uo(n){null!==n.parent&&function Np(n,e,t){const i=function Sp(n){return void 0===Fe(n)&&!La(n)}(t),o=te(n.node.children,e);i&&o?(delete n.node.children[e],n.node.childCount--,Uo(n)):!i&&!o&&(n.node.children[e]=t.node,n.node.childCount++,Uo(n))}(n.parent,n.name,n)}const Rp=/[\[\].#$\/\u0000-\u001F\u007F]/,Dp=/[\[\].#$\u0000-\u001F\u007F]/,Bo=10485760,Cn=function(n){return"string"==typeof n&&0!==n.length&&!Rp.test(n)},Za=function(n){return"string"==typeof n&&0!==n.length&&!Dp.test(n)},Dt=function(n,e,t){const i=t instanceof T?new Qd(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+Me(i));if("function"==typeof e)throw new Error(n+"contains a function "+Me(i)+" with contents = "+e.toString());if(jt(e))throw new Error(n+"contains "+e.toString()+" "+Me(i));if("string"==typeof e&&e.length>Bo/3&&Ht(e)>Bo)throw new Error(n+"contains a string greater than "+Bo+" utf8 bytes "+Me(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let o=!1,s=!1;if(P(e,(a,l)=>{if(".value"===a)o=!0;else if(".priority"!==a&&".sv"!==a&&(s=!0,!Cn(a)))throw new Error(n+" contains an invalid key ("+a+") "+Me(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function jd(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Ht(e),Hs(n)})(i,a),Dt(n,l,i),function Jd(n){const e=n.parts_.pop();n.byteLength_-=Ht(e),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),o&&s)throw new Error(n+' contains ".value" child '+Me(i)+" in addition to actual children.")}},qo=function(n,e,t,i){if(!(i&&void 0===t||Za(t)))throw new Error(He(n,e)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')};class Op{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function Tn(n,e){let t=null;for(let i=0;i<e.length;i++){const o=e[i],s=o.getPath();null!==t&&!eo(s,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:s}),t.events.push(o)}t&&n.eventLists_.push(t)}function Ba(n,e,t){Tn(n,t),za(n,i=>eo(i,e))}function B(n,e,t){Tn(n,t),za(n,i=>q(i,e)||q(e,i))}function za(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const o=n.eventLists_[i];o&&(e(o.path)?(Zp(n.eventLists_[i]),n.eventLists_[i]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function Zp(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const i=t.getEventRunner();Re&&M("event: "+t.toString()),Qe(i)}}}class Up{constructor(e,t,i,o){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=o,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Op,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=an(),this.transactionQueueTree_=new Zo,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function Ha(n){const t=n.infoData_.getNode(new T(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Pt(n){return function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n}({timestamp:Ha(n)})}function Wa(n,e,t,i,o){n.dataUpdateCount++;const s=new T(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let a=[];if(o)if(i){const c=zt(t,u=>R(u));a=function yp(n,e,t,i){const o=No(n,i);if(o){const s=Ro(o),a=s.path,l=s.queryId,c=Z(a,e),u=S.fromObject(t);return Do(n,a,new tt(mo(l),c,u))}return[]}(n.serverSyncTree_,s,c,o)}else{const c=R(t);a=function ka(n,e,t,i){const o=No(n,i);if(null!=o){const s=Ro(o),a=s.path,l=s.queryId,c=Z(a,e);return Do(n,a,new Le(mo(l),c,t))}return[]}(n.serverSyncTree_,s,c,o)}else if(i){const c=zt(t,u=>R(u));a=function gp(n,e,t){const i=S.fromObject(t);return it(n,new tt({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(n.serverSyncTree_,s,c)}else{const c=R(t);a=It(n.serverSyncTree_,s,c)}let l=s;a.length>0&&(l=rt(n,s)),B(n.eventQueue_,l,a)}function Ga(n,e){Ho(n,"connected",e),!1===e&&function Wp(n){ot(n,"onDisconnectEvents");const e=Pt(n),t=an();_o(n.onDisconnect_,C(),(o,s)=>{const a=function(n,e,t,i){return Oo(e,new Po(t,n),i)}(o,s,n.serverSyncTree_,e);et(t,o,a)});let i=[];_o(t,C(),(o,s)=>{i=i.concat(It(n.serverSyncTree_,o,s));const a=$o(n,o);rt(n,a)}),n.onDisconnect_=an(),B(n.eventQueue_,C(),i)}(n)}function Ho(n,e,t){const i=new T("/.info/"+e),o=R(t);n.infoData_.updateSnapshot(i,o);const s=It(n.infoSyncTree_,i,o);B(n.eventQueue_,i,s)}function En(n){return n.nextWriteId_++}function Wo(n,e,t,i,o){ot(n,"set",{path:e.toString(),value:t,priority:i});const s=Pt(n),a=R(t,i),l=yn(n.serverSyncTree_,e),c=Lo(a,l,s),u=En(n),h=So(n.serverSyncTree_,e,c,u,!0);Tn(n.eventQueue_,h),n.server_.put(e.toString(),a.val(!0),(p,_)=>{const g="ok"===p;g||O("set at "+e+" failed: "+p);const x=me(n.serverSyncTree_,u,!g);B(n.eventQueue_,e,x),function ve(n,e,t,i){e&&Qe(()=>{if("ok"===t)e(null);else{const o=(t||"error").toUpperCase();let s=o;i&&(s+=": "+i);const a=new Error(s);a.code=o,e(a)}})}(0,o,p,_)});const d=$o(n,e);rt(n,d),B(n.eventQueue_,d,[])}function Go(n,e,t){let i;i=".info"===v(e._path)?vn(n.infoSyncTree_,e,t):vn(n.serverSyncTree_,e,t),Ba(n.eventQueue_,e._path,i)}function ot(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),M(t,...e)}function Vo(n,e,t){return yn(n.serverSyncTree_,e,t)||m.EMPTY_NODE}function An(n,e=n.transactionQueueTree_){if(e||In(n,e),Fe(e)){const t=ja(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(o=>0===o.status)&&function Kp(n,e,t){const i=t.map(u=>u.currentWriteId),o=Vo(n,e,i);let s=o;const a=o.hash();for(let u=0;u<t.length;u++){const h=t[u];f(0===h.status,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;const d=Z(e,h.path);s=s.updateChild(d,h.currentOutputSnapshotRaw)}const l=s.val(!0),c=e;n.server_.put(c.toString(),l,u=>{ot(n,"transaction put response",{path:c.toString(),status:u});let h=[];if("ok"===u){const d=[];for(let p=0;p<t.length;p++)t[p].status=2,h=h.concat(me(n.serverSyncTree_,t[p].currentWriteId)),t[p].onComplete&&d.push(()=>t[p].onComplete(null,!0,t[p].currentOutputSnapshotResolved)),t[p].unwatcher();In(n,wn(n.transactionQueueTree_,e)),An(n,n.transactionQueueTree_),B(n.eventQueue_,e,h);for(let p=0;p<d.length;p++)Qe(d[p])}else{if("datastale"===u)for(let d=0;d<t.length;d++)t[d].status=3===t[d].status?4:0;else{O("transaction at "+c.toString()+" failed: "+u);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=u}rt(n,e)}},a)}(n,Nt(e),t)}else La(e)&&xn(e,t=>{An(n,t)})}function rt(n,e){const t=Qa(n,e),i=Nt(t);return function Yp(n,e,t){if(0===e.length)return;const i=[];let o=[];const a=e.filter(l=>0===l.status).map(l=>l.currentWriteId);for(let l=0;l<e.length;l++){const c=e[l],u=Z(t,c.path);let d,h=!1;if(f(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===c.status)h=!0,d=c.abortReason,o=o.concat(me(n.serverSyncTree_,c.currentWriteId,!0));else if(0===c.status)if(c.retryCount>=25)h=!0,d="maxretry",o=o.concat(me(n.serverSyncTree_,c.currentWriteId,!0));else{const p=Vo(n,c.path,a);c.currentInputSnapshot=p;const _=e[l].update(p.val());if(void 0!==_){Dt("transaction failed: Data returned ",_,c.path);let g=R(_);"object"==typeof _&&null!=_&&te(_,".priority")||(g=g.updatePriority(p.getPriority()));const k=c.currentWriteId,we=Pt(n),Rn=Lo(g,p,we);c.currentOutputSnapshotRaw=g,c.currentOutputSnapshotResolved=Rn,c.currentWriteId=En(n),a.splice(a.indexOf(k),1),o=o.concat(So(n.serverSyncTree_,c.path,Rn,c.currentWriteId,c.applyLocally)),o=o.concat(me(n.serverSyncTree_,k,!0))}else h=!0,d="nodata",o=o.concat(me(n.serverSyncTree_,c.currentWriteId,!0))}B(n.eventQueue_,t,o),o=[],h&&(e[l].status=2,setTimeout(e[l].unwatcher,Math.floor(0)),e[l].onComplete&&i.push("nodata"===d?()=>e[l].onComplete(null,!1,e[l].currentInputSnapshot):()=>e[l].onComplete(new Error(d),!1,null)))}In(n,n.transactionQueueTree_);for(let l=0;l<i.length;l++)Qe(i[l]);An(n,n.transactionQueueTree_)}(n,ja(n,t),i),i}function Qa(n,e){let t,i=n.transactionQueueTree_;for(t=v(e);null!==t&&void 0===Fe(i);)i=wn(i,t),t=v(e=A(e));return i}function ja(n,e){const t=[];return Ja(n,e,t),t.sort((i,o)=>i.order-o.order),t}function Ja(n,e,t){const i=Fe(e);if(i)for(let o=0;o<i.length;o++)t.push(i[o]);xn(e,o=>{Ja(n,o,t)})}function In(n,e){const t=Fe(e);if(t){let i=0;for(let o=0;o<t.length;o++)2!==t[o].status&&(t[i]=t[o],i++);t.length=i,Fo(e,t.length>0?t:void 0)}xn(e,i=>{In(n,i)})}function $o(n,e){const t=Nt(Qa(n,e)),i=wn(n.transactionQueueTree_,e);return function kp(n,e,t){let i=t?n:n.parent;for(;null!==i;){if(e(i))return!0;i=i.parent}}(i,o=>{Qo(n,o)}),Qo(n,i),Oa(i,o=>{Qo(n,o)}),t}function Qo(n,e){const t=Fe(e);if(t){const i=[];let o=[],s=-1;for(let a=0;a<t.length;a++)3===t[a].status||(1===t[a].status?(f(s===a-1,"All SENT items should be at beginning of queue."),s=a,t[a].status=3,t[a].abortReason="set"):(f(0===t[a].status,"Unexpected transaction status in abort"),t[a].unwatcher(),o=o.concat(me(n.serverSyncTree_,t[a].currentWriteId,!0)),t[a].onComplete&&i.push(t[a].onComplete.bind(null,new Error("set"),!1,null))));-1===s?Fo(e,void 0):t.length=s+1,B(n.eventQueue_,Nt(e),o);for(let a=0;a<i.length;a++)Qe(i[a])}}const jo=function(n,e){const t=t_(n),i=t.namespace;return"firebase.com"===t.domain&&Q(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==t.domain&&Q("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&O("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new $i(t.host,t.secure,i,"ws"===t.scheme||"wss"===t.scheme,e,"",i!==t.subdomain),path:new T(t.pathString)}},t_=function(n){let e="",t="",i="",o="",s="",a=!0,l="https",c=443;if("string"==typeof n){let u=n.indexOf("//");u>=0&&(l=n.substring(0,u-1),n=n.substring(u+2));let h=n.indexOf("/");-1===h&&(h=n.length);let d=n.indexOf("?");-1===d&&(d=n.length),e=n.substring(0,Math.min(h,d)),h<d&&(o=function Xp(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let o=t[i];try{o=decodeURIComponent(o.replace(/\+/g," "))}catch{}e+="/"+o}return e}(n.substring(h,d)));const p=function e_(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const i=t.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):O(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,d)));u=e.indexOf(":"),u>=0?(a="https"===l||"wss"===l,c=parseInt(e.substring(u+1),10)):u=e.length;const _=e.slice(0,u);if("localhost"===_.toLowerCase())t="localhost";else if(_.split(".").length<=2)t=_;else{const g=e.indexOf(".");i=e.substring(0,g).toLowerCase(),t=e.substring(g+1),s=i}"ns"in p&&(s=p.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:a,scheme:l,pathString:o,namespace:s}};class Ka{constructor(e,t,i,o){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=o}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+D(this.snapshot.exportVal())}}class Ya{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Jo{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class z{constructor(e,t,i,o){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=o}get key(){return y(this._path)?null:Xi(this._path)}get ref(){return new V(this._repo,this._path)}get _queryIdentifier(){const e=oa(this._queryParams),t=Wi(e);return"{}"===t?"default":t}get _queryObject(){return oa(this._queryParams)}isEqual(e){if(!((e=Te(e))instanceof z))return!1;const t=this._repo===e._repo,i=eo(this._path,e._path);return t&&i&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function Vd(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}class V extends z{constructor(e,t){super(e,t,new co,!1)}get parent(){const e=qs(this._path);return null===e?null:new V(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Ue{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new T(e),i=st(this.ref,e);return new Ue(this._node.getChild(t),i,I)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,o)=>e(new Ue(o,st(this.ref,i),I)))}hasChild(e){const t=new T(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Ko(n,e){return(n=Te(n))._checkNotDeleted("ref"),void 0!==e?st(n._root,e):n._root}function st(n,e){return null===v((n=Te(n))._path)?(t=e,t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),qo("child","path",t,!1)):qo("child","path",e,!1),new V(n._repo,N(n._path,e));var t}function Yo(n,e){(function(n,e){if(".info"===v(e))throw new Error(n+" failed = Can't modify data under /.info/")})("set",(n=Te(n))._path),function(n,e,t,i){i&&void 0===e||Dt(He(n,"value"),e,t)}("set",e,n._path,!1);const t=new at;return Wo(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}class Lt{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const i=t._queryParams.getIndex();return new Ka("value",this,new Ue(e.snapshotNode,new V(t._repo,t._path),i))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ya(this,e,t):null}matches(e){return e instanceof Lt&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class Nn{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Ya(this,e,t):null}createEvent(e,t){f(null!=e.childName,"Child events should have a childName.");const i=st(new V(t._repo,t._path),e.childName),o=t._queryParams.getIndex();return new Ka(e.type,this,new Ue(e.snapshotNode,i,o),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof Nn&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function Xa(n,e,t,i){return function Ot(n,e,t,i,o){let s;if("object"==typeof i&&(s=void 0,o=i),"function"==typeof i&&(s=i),o&&o.onlyOnce){const c=t,u=(h,d)=>{Go(n._repo,n,l),c(h,d)};u.userCallback=t.userCallback,u.context=t.context,t=u}const a=new Jo(t,s||void 0),l="value"===e?new Lt(a):new Nn(e,a);return function Qp(n,e,t){let i;i=".info"===v(e._path)?ko(n.infoSyncTree_,e,t):ko(n.serverSyncTree_,e,t),Ba(n.eventQueue_,e._path,i)}(n._repo,n,l),()=>Go(n._repo,n,l)}(n,"value",e,t,i)}(function ap(n){f(!fn,"__referenceConstructor has already been defined"),fn=n})(V),function hp(n){f(!mn,"__referenceConstructor has already been defined"),mn=n}(V);const Xo={};function __(n,e,t,i,o){let s=i||n.options.databaseURL;void 0===s&&(n.options.projectId||Q("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),M("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let c,u,a=jo(s,o),l=a.repoInfo;typeof process<"u"&&process.env&&(u=process.env.FIREBASE_DATABASE_EMULATOR_HOST),u?(c=!0,s=`http://${u}?ns=${l.namespace}`,a=jo(s,o),l=a.repoInfo):c=!a.repoInfo.secure;const h=o&&c?new ft(ft.OWNER):new wd(n.name,n.options,e);(function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Cn(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Za(n)}(t))throw new Error(He(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",a),y(a.path)||Q("Database URL must point to the root of a Firebase Database (not including a child path).");const d=function g_(n,e,t,i){let o=Xo[e.name];o||(o={},Xo[e.name]=o);let s=o[n.toURLString()];return s&&Q("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new Up(n,false,t,i),o[n.toURLString()]=s,s}(l,n,h,new bd(n.name,t));return new v_(d,n)}class v_{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function Bp(n,e,t){if(n.stats_=Ji(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new sn(n.repoInfo_,(i,o,s,a)=>{Wa(n,i,o,s,a)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Ga(n,!0),0);else{if(typeof t<"u"&&null!==t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{D(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Pe(n.repoInfo_,e,(i,o,s,a)=>{Wa(n,i,o,s,a)},i=>{Ga(n,i)},i=>{!function zp(n,e){P(e,(t,i)=>{Ho(n,t,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function Td(n,e){const t=n.toString();return ji[t]||(ji[t]=e()),ji[t]}(n.repoInfo_,()=>new Eh(n.stats_,n.server_)),n.infoData_=new bh,n.infoSyncTree_=new Sa({startListening:(i,o,s,a)=>{let l=[];const c=n.infoData_.getNode(i._path);return c.isEmpty()||(l=It(n.infoSyncTree_,i._path,c),setTimeout(()=>{a("ok")},0)),l},stopListening:()=>{}}),Ho(n,"connected",!1),n.serverSyncTree_=new Sa({startListening:(i,o,s,a)=>(n.server_.listen(i,s,o,(l,c)=>{const u=a(l,c);B(n.eventQueue_,i._path,u)}),[]),stopListening:(i,o)=>{n.server_.unlisten(i,o)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new V(this._repo,C())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function f_(n,e){const t=Xo[e];(!t||t[n.key]!==n)&&Q(`Database ${e}(${n.repoInfo_}) has already been deleted.`),function $a(n){n.persistentConnection_&&n.persistentConnection_.interrupt("repo_interrupt")}(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&Q("Cannot call "+e+" on a deleted database.")}}function ol(n=xr(),e){const t=We(n,"database").getImmediate({identifier:e}),i=(n=>{const e=(n=>{var e,t;return null===(t=null===(e=Ln())||void 0===e?void 0:e.emulatorHosts)||void 0===t?void 0:t[n]})(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),i]:[e.substring(0,t),i]})("database");return i&&function y_(n,e,t,i={}){(n=Te(n))._checkNotDeleted("useEmulator"),n._instanceStarted&&Q("Cannot call useEmulator() after instance has already been initialized.");const o=n._repoInternal;let s;if(o.repoInfo_.nodeAdmin)i.mockUserToken&&Q('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new ft(ft.OWNER);else if(i.mockUserToken){const a="string"==typeof i.mockUserToken?i.mockUserToken:function bl(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i=e||"demo-project",o=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const a=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:o,exp:o+3600,auth_time:o,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[Zt(JSON.stringify({alg:"none",type:"JWT"})),Zt(JSON.stringify(a)),""].join(".")}(i.mockUserToken,n.app.options.projectId);s=new ft(a)}!function p_(n,e,t,i){n.repoInfo_=new $i(`${e}:${t}`,!1,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams),i&&(n.authTokenProvider_=i)}(o,e,t,s)}(t,...i),t}Pe.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},Pe.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function b_(n){(function cd(n){zi=n})("9.14.0"),ue(new ne("database",(e,{instanceIdentifier:t})=>__(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),$(os,rs,n),$(os,rs,"esm2017")}();var be=X(578),r=X(1571),C_=X(3597),rl=X(4818);const T_=["workarea"];function E_(n,e){if(1&n){const t=r.EpF();r.ynx(0),r.TgZ(1,"div",122)(2,"h4"),r._uU(3,"Path"),r.qZA(),r.TgZ(4,"div",96)(5,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement,"x"))}),r.TgZ(6,"input",123,124),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement,"x",+o.value))}),r.qZA(),r.TgZ(8,"span"),r._uU(9,"X"),r.qZA()(),r.TgZ(10,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement,"y"))}),r.TgZ(11,"input",123,125),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement,"y",+o.value))}),r.qZA(),r.TgZ(13,"span"),r._uU(14,"Y"),r.qZA()()()(),r.BQk()}if(2&n){const t=r.oxw(2);r.xp6(6),r.Q6J("value",t.selectedElement.x),r.xp6(5),r.Q6J("value",t.selectedElement.y)}}function A_(n,e){if(1&n){const t=r.EpF();r.ynx(0),r.TgZ(1,"div",126)(2,"h4"),r._uU(3,"Rectangle"),r.qZA(),r.TgZ(4,"div",96)(5,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement,"x"))}),r.TgZ(6,"input",123,127),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement,"x",+o.value))}),r.qZA(),r.TgZ(8,"span"),r._uU(9,"X"),r.qZA()(),r.TgZ(10,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement,"y"))}),r.TgZ(11,"input",123,128),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement,"y",+o.value))}),r.qZA(),r.TgZ(13,"span"),r._uU(14,"Y"),r.qZA()(),r.TgZ(15,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"width"))}),r.TgZ(16,"input",123,129),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"width",+o.value))}),r.qZA(),r.TgZ(18,"span",100),r._uU(19,"Width"),r.qZA()(),r.TgZ(20,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(22),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"height"))}),r.TgZ(21,"input",123,130),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(22),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"height",+o.value))}),r.qZA(),r.TgZ(23,"span",100),r._uU(24,"Height"),r.qZA()()()(),r.BQk()}if(2&n){const t=r.oxw(2);r.xp6(6),r.Q6J("value",t.selectedElement.x),r.xp6(5),r.Q6J("value",t.selectedElement.y),r.xp6(5),r.Q6J("value",t.selectedElement.options.width),r.xp6(5),r.Q6J("value",t.selectedElement.options.height)}}function I_(n,e){if(1&n){const t=r.EpF();r.ynx(0),r.TgZ(1,"div",131)(2,"h4"),r._uU(3,"Image"),r.qZA(),r.TgZ(4,"div",96)(5,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement,"x"))}),r.TgZ(6,"input",132,133),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement,"x",+o.value))}),r.qZA(),r.TgZ(8,"span"),r._uU(9,"X"),r.qZA()(),r.TgZ(10,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement,"y"))}),r.TgZ(11,"input",134,135),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement,"y",+o.value))}),r.qZA(),r.TgZ(13,"span"),r._uU(14,"Y"),r.qZA()(),r.TgZ(15,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"width"))}),r.TgZ(16,"input",123,136),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"width",+o.value))}),r.qZA(),r.TgZ(18,"span",100),r._uU(19,"Width"),r.qZA()(),r.TgZ(20,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(22),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"height"))}),r.TgZ(21,"input",123,137),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(22),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"height",+o.value))}),r.qZA(),r.TgZ(23,"span",100),r._uU(24,"Height"),r.qZA()()()(),r.BQk()}if(2&n){const t=r.oxw(2);r.xp6(6),r.Q6J("value",t.selectedElement.x),r.xp6(5),r.Q6J("value",t.selectedElement.y),r.xp6(5),r.Q6J("value",t.selectedElement.options.width),r.xp6(5),r.Q6J("value",t.selectedElement.options.height)}}function S_(n,e){if(1&n){const t=r.EpF();r.ynx(0),r.TgZ(1,"div",138)(2,"h4"),r._uU(3,"Ellipse"),r.qZA(),r.TgZ(4,"div",96)(5,"label",139),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"cx"))}),r.TgZ(6,"input",140,141),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"cx",+o.value))}),r.qZA(),r.TgZ(8,"span"),r._uU(9,"X"),r.qZA()(),r.TgZ(10,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"cy"))}),r.TgZ(11,"input",142,143),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"cy",+o.value))}),r.qZA(),r.TgZ(13,"span"),r._uU(14,"Y"),r.qZA()(),r.TgZ(15,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"rx"))}),r.TgZ(16,"input",144,145),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"rx",+o.value))}),r.qZA(),r.TgZ(18,"span"),r._uU(19,"Radius X"),r.qZA()(),r.TgZ(20,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(22),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"ry"))}),r.TgZ(21,"input",146,147),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(22),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"ry",+o.value))}),r.qZA(),r.TgZ(23,"span"),r._uU(24,"Radius Y"),r.qZA()()()(),r.BQk()}if(2&n){const t=r.oxw(2);r.xp6(6),r.Q6J("value",t.selectedElement.options.cx),r.xp6(5),r.Q6J("value",t.selectedElement.options.cy),r.xp6(5),r.Q6J("value",t.selectedElement.options.rx),r.xp6(5),r.Q6J("value",t.selectedElement.options.ry)}}function k_(n,e){if(1&n){const t=r.EpF();r.ynx(0),r.TgZ(1,"div",148)(2,"h4"),r._uU(3,"Line"),r.qZA(),r.TgZ(4,"div",96)(5,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"x1"))}),r.TgZ(6,"input",149,150),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"x1",+o.value))}),r.qZA(),r.TgZ(8,"span"),r._uU(9,"Start X"),r.qZA()(),r.TgZ(10,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"y1"))}),r.TgZ(11,"input",151,152),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"y1",+o.value))}),r.qZA(),r.TgZ(13,"span"),r._uU(14,"Start Y"),r.qZA()(),r.TgZ(15,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"x2"))}),r.TgZ(16,"input",153,154),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"x2",+o.value))}),r.qZA(),r.TgZ(18,"span"),r._uU(19,"End X"),r.qZA()(),r.TgZ(20,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(22),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"y2"))}),r.TgZ(21,"input",155,156),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(22),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"y2",+o.value))}),r.qZA(),r.TgZ(23,"span"),r._uU(24,"End Y"),r.qZA()()()(),r.BQk()}if(2&n){const t=r.oxw(2);r.xp6(6),r.Q6J("value",t.selectedElement.options.x1),r.xp6(5),r.Q6J("value",t.selectedElement.options.y1),r.xp6(5),r.Q6J("value",t.selectedElement.options.x2),r.xp6(5),r.Q6J("value",t.selectedElement.options.y2)}}function N_(n,e){if(1&n){const t=r.EpF();r.ynx(0),r.TgZ(1,"div",157)(2,"h4"),r._uU(3,"Text"),r.qZA(),r.TgZ(4,"div",96)(5,"label",158)(6,"input",159,160),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(7),s=r.oxw(2);return r.KtG(s.selectedElement.value=o.value)}),r.qZA(),r.TgZ(8,"span"),r._uU(9,"Content"),r.qZA()(),r.TgZ(10,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement,"x"))}),r.TgZ(11,"input",161,162),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement,"x",+o.value))}),r.qZA(),r.TgZ(13,"span"),r._uU(14,"X"),r.qZA()(),r.TgZ(15,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement,"y"))}),r.TgZ(16,"input",163,164),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(17),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement,"y",+o.value))}),r.qZA(),r.TgZ(18,"span"),r._uU(19,"Y"),r.qZA()(),r.TgZ(20,"div",165)(21,"span"),r._uU(22,"Font"),r.qZA(),r.TgZ(23,"div",166),r._uU(24),r.qZA(),r._UZ(25,"div",118)(26,"input",167),r.TgZ(27,"select",168,169),r.NdJ("change",function(){r.CHM(t);const o=r.MAs(28),s=r.oxw(2);return r.KtG(s.selectedElement.options.fontFamily=o.value)}),r.TgZ(29,"option",170),r._uU(30,"Arial"),r.qZA(),r.TgZ(31,"option",171),r._uU(32,"Arial Black"),r.qZA(),r.TgZ(33,"option",172),r._uU(34,"Comic Sans MS"),r.qZA(),r.TgZ(35,"option",173),r._uU(36,"Courier New"),r.qZA(),r.TgZ(37,"option",174),r._uU(38,"Georgia"),r.qZA(),r.TgZ(39,"option",175),r._uU(40,"Impact"),r.qZA(),r.TgZ(41,"option",176),r._uU(42,"Lucida Console"),r.qZA(),r.TgZ(43,"option",177),r._uU(44,"Lucida Sans Unicode"),r.qZA(),r.TgZ(45,"option",178),r._uU(46,"Monospace"),r.qZA(),r.TgZ(47,"option",179),r._uU(48,"Palatino Linotype"),r.qZA(),r.TgZ(49,"option",180),r._uU(50,"Sans-serif"),r.qZA(),r.TgZ(51,"option",181),r._uU(52,"Serif"),r.qZA(),r.TgZ(53,"option",182),r._uU(54,"Tahoma"),r.qZA(),r.TgZ(55,"option",183),r._uU(56,"Times New Roman"),r.qZA(),r.TgZ(57,"option",184),r._uU(58,"Trebuchet MS"),r.qZA(),r.TgZ(59,"option",185),r._uU(60,"Verdana"),r.qZA()()(),r.TgZ(61,"div",186)(62,"span"),r._uU(63,"Font Style"),r.qZA(),r.TgZ(64,"div",187),r.NdJ("click",function(){r.CHM(t);const o=r.oxw(2);return r.KtG(o.toggleFontWeight())}),r._uU(65,"B"),r.qZA(),r.TgZ(66,"div",188),r.NdJ("click",function(){r.CHM(t);const o=r.oxw(2);return r.KtG(o.toggleFontStyle())}),r._uU(67,"i "),r.qZA()(),r.TgZ(68,"label",189),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(70),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"fontSize"))}),r.TgZ(69,"input",190,191),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(70),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"fontSize",+o.value))}),r.qZA(),r.TgZ(71,"span",192),r._uU(72,"Font Size"),r.qZA()()()(),r.BQk()}if(2&n){const t=r.oxw(2);r.xp6(6),r.Q6J("value",t.selectedElement.value),r.xp6(5),r.Q6J("value",t.selectedElement.x),r.xp6(5),r.Q6J("value",t.selectedElement.y),r.xp6(7),r.Udp("font-family",t.selectedElement.options.fontFamily),r.xp6(1),r.hij(" ",t.selectedElement.options.fontFamily,""),r.xp6(3),r.Q6J("value",t.selectedElement.options.fontFamily),r.xp6(37),r.ekj("active","bold"===t.selectedElement.options.fontWeight),r.xp6(2),r.ekj("active","italic"===t.selectedElement.options.fontStyle),r.xp6(3),r.Q6J("value",t.selectedElement.options.fontSize)}}function R_(n,e){if(1&n){const t=r.EpF();r.ynx(0),r.TgZ(1,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(3),s=r.oxw(2);return r.KtG(s.onDragDown(o,s.selectedElement.options,"rx"))}),r.TgZ(2,"input",193,194),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(3),s=r.oxw(2);return r.KtG(s.setNumberValue(s.selectedElement.options,"rx",+o.value))}),r.qZA(),r.TgZ(4,"span",100),r._uU(5,"Roundness"),r.qZA(),r._UZ(6,"div",195),r.qZA(),r.BQk()}if(2&n){const t=r.oxw(2);r.xp6(2),r.Q6J("value",t.selectedElement.options.rx)}}function D_(n,e){1&n&&(r.ynx(0),r._uU(1,"\xb7\xb7\xb7"),r.BQk())}function M_(n,e){1&n&&(r.ynx(0),r._uU(1,"- -"),r.BQk())}function P_(n,e){1&n&&(r.ynx(0),r._uU(1,"-\xb7-"),r.BQk())}function L_(n,e){1&n&&(r.ynx(0),r._uU(1,"-\xb7\xb7-"),r.BQk())}function O_(n,e){1&n&&(r.ynx(0),r._uU(1,"\u2014"),r.BQk())}function Z_(n,e){1&n&&r.GkF(0)}function F_(n,e){if(1&n&&(r.ynx(0),r.YNc(1,Z_,1,0,"ng-container",196),r.BQk()),2&n){r.oxw(2);const t=r.MAs(47);r.xp6(1),r.Q6J("ngTemplateOutlet",t)}}function U_(n,e){if(1&n){const t=r.EpF();r.ynx(0)(1,93),r.YNc(2,E_,15,2,"ng-container",94),r.YNc(3,A_,25,4,"ng-container",94),r.YNc(4,I_,25,4,"ng-container",94),r.YNc(5,S_,25,4,"ng-container",94),r.YNc(6,k_,25,4,"ng-container",94),r.YNc(7,N_,73,12,"ng-container",94),r.TgZ(8,"div",95)(9,"div",96)(10,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw();return r.KtG(s.onDragDown(o,s.selectedElement,"rotation"))}),r.TgZ(11,"input",98,99),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(12),s=r.oxw();return r.KtG(s.setNumberValue(s.selectedElement,"rotation",+o.value))}),r.qZA(),r.TgZ(13,"span",100),r._uU(14,"Rotation"),r.qZA(),r.TgZ(15,"div",101),r._UZ(16,"div",102),r.qZA()(),r.TgZ(17,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(19),s=r.oxw();return r.KtG(s.onDragDown(o,s.selectedElement,"opacity"))}),r.TgZ(18,"input",103,104),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(19),s=r.oxw();return r.KtG(s.setNumberValue(s.selectedElement,"opacity",+o.value))}),r.qZA(),r.TgZ(20,"span",105),r._uU(21,"Opacity"),r.qZA()(),r.YNc(22,R_,7,1,"ng-container",94),r.qZA()(),r.TgZ(23,"div",106)(24,"h4"),r._uU(25,"Stroke"),r.qZA(),r.TgZ(26,"div",96)(27,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(29),s=r.oxw();return r.KtG(s.onDragDown(o,s.selectedElement.options,"strokeWidth"))}),r.TgZ(28,"input",107,108),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(29),s=r.oxw();return r.KtG(s.setNumberValue(s.selectedElement.options,"strokeWidth",+o.value))}),r.qZA(),r.TgZ(30,"span",100),r._uU(31,"Width"),r.qZA(),r._UZ(32,"div",109),r.qZA(),r.TgZ(33,"div",110)(34,"span"),r._uU(35,"Dash"),r.qZA(),r.TgZ(36,"select",111,112),r.NdJ("change",function(){r.CHM(t);const o=r.MAs(37),s=r.oxw();return r.KtG(s.selectedElement.options.dasharray=o.value)}),r.TgZ(38,"option",113),r._uU(39,"\u2014"),r.qZA(),r.TgZ(40,"option",114),r._uU(41,"\xb7\xb7\xb7"),r.qZA(),r.TgZ(42,"option",115),r._uU(43,"- -"),r.qZA(),r.TgZ(44,"option",116),r._uU(45,"-\xb7-"),r.qZA(),r.TgZ(46,"option",117),r._uU(47,"-\xb7\xb7-"),r.qZA()(),r._UZ(48,"div",118),r.TgZ(49,"label",119),r.ynx(50,93),r.YNc(51,D_,2,0,"ng-container",94),r.YNc(52,M_,2,0,"ng-container",94),r.YNc(53,P_,2,0,"ng-container",94),r.YNc(54,L_,2,0,"ng-container",94),r.YNc(55,O_,2,0,"ng-container",120),r.BQk(),r.qZA()(),r.TgZ(56,"label",121)(57,"span",100),r._uU(58,"Stroke Join"),r.qZA()(),r.TgZ(59,"label",121)(60,"span",100),r._uU(61,"Stroke Cap"),r.qZA()()()(),r.YNc(62,F_,2,1,"ng-container",120),r.BQk()()}if(2&n){const t=r.oxw();r.xp6(1),r.Q6J("ngSwitch",t.selectedElement.type),r.xp6(1),r.Q6J("ngSwitchCase",t.elementTypeEnum.BRUSH),r.xp6(1),r.Q6J("ngSwitchCase",t.elementTypeEnum.RECT),r.xp6(1),r.Q6J("ngSwitchCase",t.elementTypeEnum.IMAGE),r.xp6(1),r.Q6J("ngSwitchCase",t.elementTypeEnum.ELLIPSE),r.xp6(1),r.Q6J("ngSwitchCase",t.elementTypeEnum.LINE),r.xp6(1),r.Q6J("ngSwitchCase",t.elementTypeEnum.TEXT),r.xp6(4),r.Q6J("value",t.selectedElement.rotation),r.xp6(4),r.Akn("transform: rotate("+t.selectedElement.rotation+"deg);"),r.xp6(3),r.Q6J("value",t.selectedElement.opacity),r.xp6(4),r.Q6J("ngSwitchCase",t.elementTypeEnum.RECT),r.xp6(6),r.Q6J("value",t.selectedElement.options.strokeWidth),r.xp6(8),r.Q6J("value",t.selectedElement.options.dasharray),r.xp6(14),r.Q6J("ngSwitch",t.selectedElement.options.dasharray),r.xp6(1),r.Q6J("ngSwitchCase","2,2"),r.xp6(1),r.Q6J("ngSwitchCase","5,5"),r.xp6(1),r.Q6J("ngSwitchCase","5,2,2,2"),r.xp6(1),r.Q6J("ngSwitchCase","5,2,2,2,2,2")}}function B_(n,e){1&n&&r.GkF(0)}function z_(n,e){if(1&n&&(r.ynx(0),r.YNc(1,B_,1,0,"ng-container",196),r.BQk()),2&n){r.oxw();const t=r.MAs(47);r.xp6(1),r.Q6J("ngTemplateOutlet",t)}}function q_(n,e){1&n&&(r.ynx(0),r._uU(1,"\xb7\xb7\xb7"),r.BQk())}function H_(n,e){1&n&&(r.ynx(0),r._uU(1,"- -"),r.BQk())}function W_(n,e){1&n&&(r.ynx(0),r._uU(1,"-\xb7-"),r.BQk())}function G_(n,e){1&n&&(r.ynx(0),r._uU(1,"-\xb7\xb7-"),r.BQk())}function V_(n,e){1&n&&(r.ynx(0),r._uU(1,"\u2014"),r.BQk())}function $_(n,e){if(1&n){const t=r.EpF();r.TgZ(0,"div",197)(1,"h4"),r._uU(2,"Whiteboard"),r.qZA(),r.TgZ(3,"div",96)(4,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(6),s=r.oxw();return r.KtG(s.onDragDown(o,s.options,"canvasWidth"))}),r.TgZ(5,"input",198,199),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(6),s=r.oxw();return s.setNumberValue(s.options,"canvasWidth",+o.value),r.KtG(s.updateOptions())}),r.qZA(),r.TgZ(7,"span",100),r._uU(8,"Width"),r.qZA()(),r.TgZ(9,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(11),s=r.oxw();return r.KtG(s.onDragDown(o,s.options,"canvasHeight"))}),r.TgZ(10,"input",198,200),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(11),s=r.oxw();return s.setNumberValue(s.options,"canvasHeight",+o.value),r.KtG(s.updateOptions())}),r.qZA(),r.TgZ(12,"span",100),r._uU(13,"Height"),r.qZA()(),r.TgZ(14,"label",201)(15,"span"),r._uU(16,"Color"),r.qZA(),r.TgZ(17,"div",202)(18,"div",203),r.NdJ("change",function(o){r.CHM(t);const s=r.oxw();return r.KtG(s.options.backgroundColor=o)}),r.TgZ(19,"div",61),r._UZ(20,"div",204),r.TgZ(21,"div",205),r.O4$(),r.TgZ(22,"svg",206),r._UZ(23,"rect",207),r.qZA()()()()()(),r.kcU(),r.TgZ(24,"div",208)(25,"span"),r._uU(26,"Sizes"),r.qZA(),r.TgZ(27,"select",209,210),r.NdJ("change",function(){r.CHM(t);const o=r.MAs(28),s=r.oxw();return r.KtG(s.setSizeResolution(o.value))}),r.TgZ(29,"option",211),r._uU(30,"Custom"),r.qZA(),r.TgZ(31,"option",212),r._uU(32,"Fit to Content"),r.qZA(),r.TgZ(33,"optgroup",213)(34,"option",214),r._uU(35,"Twitter Post (1012 \xd7 506)"),r.qZA(),r.TgZ(36,"option",215),r._uU(37,"Twitter Header (1500 \xd7 500)"),r.qZA(),r.TgZ(38,"option",216),r._uU(39,"Facebook Post (1200 \xd7 630)"),r.qZA(),r.TgZ(40,"option",217),r._uU(41,"Facebook Cover (820 \xd7 312)"),r.qZA(),r.TgZ(42,"option",218),r._uU(43,"Instagram Post (1080 \xd7 1080)"),r.qZA(),r.TgZ(44,"option",219),r._uU(45,"Instagram Story (1080 \xd7 1920)"),r.qZA(),r.TgZ(46,"option",220),r._uU(47,"Dribble Shot (400 \xd7 300)"),r.qZA(),r.TgZ(48,"option",221),r._uU(49,"Dribble Shot HD (800 \xd7 600)"),r.qZA(),r.TgZ(50,"option",222),r._uU(51,"LinkedIn Cover (1584 \xd7 396)"),r.qZA()(),r.TgZ(52,"optgroup",223)(53,"option",224),r._uU(54,"16:9 (1920 \xd7 1080)"),r.qZA(),r.TgZ(55,"option",225),r._uU(56,"4:3 (1024 \xd7 768)"),r.qZA()(),r.TgZ(57,"optgroup",226)(58,"option",227),r._uU(59,"Desktop (1140 \xd7 1024)"),r.qZA(),r.TgZ(60,"option",228),r._uU(61,"MacBook (834 \xd7 1194)"),r.qZA(),r.TgZ(62,"option",229),r._uU(63,"MacBook Pro (1024 \xd7 1366)"),r.qZA(),r.TgZ(64,"option",230),r._uU(65,"Surface Book (1440 \xd7 990)"),r.qZA(),r.TgZ(66,"option",231),r._uU(67,"iMac (1368 \xd7 912)"),r.qZA()(),r.TgZ(68,"optgroup",232)(69,"option",233),r._uU(70,"iPad Mini (768 \xd7 1024)"),r.qZA(),r.TgZ(71,"option",228),r._uU(72,'iPad Pro 11" (834 \xd7 1194)'),r.qZA(),r.TgZ(73,"option",229),r._uU(74,'iPad Pro 12.9" (1024 \xd7 1366)'),r.qZA(),r.TgZ(75,"option",230),r._uU(76,"Surface Pro 3 (1440 \xd7 990)"),r.qZA(),r.TgZ(77,"option",231),r._uU(78,"Surface Pro 4 (1368 \xd7 912)"),r.qZA()(),r.TgZ(79,"optgroup",234)(80,"option",235),r._uU(81,"iPhone 11 ProMax (414 \xd7 896)"),r.qZA(),r.TgZ(82,"option",236),r._uU(83,"iPhone 11 Pro / X (375 \xd7 812)"),r.qZA(),r.TgZ(84,"option",237),r._uU(85,"iPhone 8 Plus (414 \xd7 736)"),r.qZA(),r.TgZ(86,"option",238),r._uU(87,"iPhone 8 (375 \xd7 667)"),r.qZA(),r.TgZ(88,"option",239),r._uU(89,"Google Pixel 2 (411 \xd7 731)"),r.qZA(),r.TgZ(90,"option",240),r._uU(91,"Google Pixel XL (411 \xd7 823)"),r.qZA(),r.TgZ(92,"option",241),r._uU(93,"Android (360 \xd7 640)"),r.qZA()(),r.TgZ(94,"optgroup",242)(95,"option",243),r._uU(96,"A4 (595 \xd7 842)"),r.qZA(),r.TgZ(97,"option",244),r._uU(98,"A5 (420 \xd7 595)"),r.qZA(),r.TgZ(99,"option",245),r._uU(100,"A6 (297 \xd7 420)"),r.qZA(),r.TgZ(101,"option",246),r._uU(102,"Letter (612 \xd7 792) "),r.qZA(),r.TgZ(103,"option",247),r._uU(104,"Tabloid (792 \xd7 1224)"),r.qZA()()(),r._UZ(105,"div",118),r.TgZ(106,"label",248),r._uU(107),r.qZA()()(),r.TgZ(108,"div",106)(109,"h4"),r._uU(110,"Stroke"),r.qZA(),r.TgZ(111,"div",96)(112,"label",97),r.NdJ("mousedown",function(){r.CHM(t);const o=r.MAs(114),s=r.oxw();return r.KtG(s.onDragDown(o,s.options,"strokeWidth"))}),r.TgZ(113,"input",107,108),r.NdJ("input",function(){r.CHM(t);const o=r.MAs(114),s=r.oxw();return r.KtG(s.setNumberValue(s.options,"strokeWidth",+o.value))}),r.qZA(),r.TgZ(115,"span",100),r._uU(116,"Width"),r.qZA(),r._UZ(117,"div",109),r.qZA(),r.TgZ(118,"div",110)(119,"span"),r._uU(120,"Dash"),r.qZA(),r.TgZ(121,"select",111,112),r.NdJ("change",function(){r.CHM(t);const o=r.MAs(122),s=r.oxw();return s.options.dasharray=o.value,r.KtG(s.updateOptions())}),r.TgZ(123,"option",113),r._uU(124,"\u2014"),r.qZA(),r.TgZ(125,"option",114),r._uU(126,"\xb7\xb7\xb7"),r.qZA(),r.TgZ(127,"option",115),r._uU(128,"- -"),r.qZA(),r.TgZ(129,"option",116),r._uU(130,"-\xb7-"),r.qZA(),r.TgZ(131,"option",117),r._uU(132,"-\xb7\xb7-"),r.qZA()(),r._UZ(133,"div",118),r.TgZ(134,"label",119),r.ynx(135,93),r.YNc(136,q_,2,0,"ng-container",94),r.YNc(137,H_,2,0,"ng-container",94),r.YNc(138,W_,2,0,"ng-container",94),r.YNc(139,G_,2,0,"ng-container",94),r.YNc(140,V_,2,0,"ng-container",120),r.BQk(),r.qZA()(),r.TgZ(141,"label",121)(142,"span",100),r._uU(143,"Stroke Join"),r.qZA()(),r.TgZ(144,"label",121)(145,"span",100),r._uU(146,"Stroke Cap"),r.qZA()()()()()}if(2&n){const t=r.MAs(28),i=r.oxw();r.xp6(5),r.Q6J("value",i.options.canvasWidth),r.xp6(5),r.Q6J("value",i.options.canvasHeight),r.xp6(13),r.uIk("fill",i.options.backgroundColor),r.xp6(84),r.Oqu(t.value),r.xp6(6),r.Q6J("value",i.options.strokeWidth),r.xp6(8),r.Q6J("value",i.options.dasharray),r.xp6(14),r.Q6J("ngSwitch",i.options.dasharray),r.xp6(1),r.Q6J("ngSwitchCase","2,2"),r.xp6(1),r.Q6J("ngSwitchCase","5,5"),r.xp6(1),r.Q6J("ngSwitchCase","5,2,2,2"),r.xp6(1),r.Q6J("ngSwitchCase","5,2,2,2,2,2")}}const Q_=[{path:"",component:(()=>{class n{constructor(t){this._whiteboardService=t,this.data=[],this.toolsEnum=xe.e9,this.elementTypeEnum=xe.DQ,this.selectedTool=xe.e9.BRUSH,this.options={strokeColor:"#ec407a",strokeWidth:5,fill:"#000",backgroundColor:"#fff",canvasHeight:600,canvasWidth:800},this.formatTypes=xe.a5,this.outerWidth=1200,this.outerHeight=750,this.zoom=1,this.x=0,this.y=0,this.loading=!1}ngOnInit(){const t=wr({apiKey:be.N.apiKey,authDomain:be.N.authDomain,projectId:be.N.projectId,storageBucket:be.N.storageBucket,messagingSenderId:be.N.messagingSenderId,appId:be.N.appId,measurementId:be.N.measurementId,databaseURL:be.N.databaseURL});!function rd(n=xr()){const e=We(n=Te(n),$t);return e.isInitialized()?e.getImmediate():function sd(n,e={}){const t=We(n,$t);if(t.isInitialized()){const o=t.getImmediate();if(qt(e,t.getOptions()))return o;throw U.create("already-initialized")}return t.initialize({options:e})}(n)}(t);const o=Ko(ol(t),"data/");this.loading=!0,Xa(o,s=>{this.loading=!1;const a=s.val();this.data=a||[]})}ngAfterViewInit(){setTimeout(()=>{this.calculateSize()},0)}onDataChange(t){this.loading||(this.data=t,Yo(Ko(ol(),"data/"),t))}calculateSize(){const t=this.workarea.nativeElement,i={w:this.options.canvasWidth,h:this.options.canvasHeight};let o=t.clientWidth,s=t.clientHeight;const a=o,l=s,c=this.zoom;o=Math.max(a,i.w*c*2),s=Math.max(l,i.h*c*2);const h=o/2-a/2,d=s/2-l/2;this.outerWidth=o,this.outerHeight=s,this.updateSize(i.w,i.h),setTimeout(()=>{t.scrollLeft=h,t.scrollTop=d},0)}updateSize(t,i){this.options.canvasWidth=t,this.options.canvasHeight=i;const o=this.zoom,l=this.outerWidth/2-t*o/2,c=this.outerHeight/2-i*o/2;setTimeout(()=>{this.x=l,this.y=c},0)}zoomWheel(t){const i=t;(i.altKey||i.ctrlKey)&&(t.preventDefault(),this.setZoom(Math.trunc(100*this.zoom-i.deltaY/100*(i.altKey?10:5))))}setZoom(t){const i=this.zoom;let o=+t/100;o<.001&&(o=.1);const s={w:this.options.canvasWidth,h:this.options.canvasHeight};let a=null;null!=a&&window.cancelAnimationFrame(a);const l=Date.now(),u=o-i,h=()=>{let p=(Date.now()-l)/500;p=Math.pow(p-1,3)+1,this.zoom=i+u*p,this.updateSize(s.w,s.h),p<1&&p>-.9?a=requestAnimationFrame(h):(this.zoom=o,this.updateSize(s.w,s.h))};h()}setSizeResolution(t){let i=this.options.canvasWidth,o=this.options.canvasHeight;console.log(t);const s=[];if(s[0]=parseInt(t.split("x")[0]),s[1]=parseInt(t.split("x")[1]),"Custom"==t)return;"content"==t&&(s[0]=100,s[1]=100);const a=s[0]-i,l=s[1]-o;let c=null;null!=c&&window.cancelAnimationFrame(c);const u=Date.now(),d=()=>{let _=(Date.now()-u)/500;_=Math.pow(_-1,3)+1,i=parseInt((s[0]-a+_*a).toFixed(0)),o=parseInt((s[1]-l+_*l).toFixed(0)),this.updateSize(i,o),_<1&&_>-.9?c=requestAnimationFrame(d):this.updateSize(i,o)};d()}onDragDown(t,i,o){const s=t.min?parseInt(t.min,10):null,a=t.max?parseInt(t.max,10):null,l=parseInt(t.step,10);let c=200;s&&a&&(c=a-s>0?(a-s)/l:200);const u=c/70*l;let h=0,d=parseInt(t.value,10);const p=g=>{0===h&&(h=g.pageY);const x=-1*(g.pageY-h);h=g.pageY;let k=x*u*1;k.toFixed(l<1?1:0),k=Math.floor(Number(d)+Number(k)),null!==a&&(k=Math.min(k,a)),null!==s&&(k=Math.max(k,s)),d=k,i[o]=d,t.value=d.toString()},_=()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",p),document.addEventListener("mouseup",_)}setNumberValue(t,i,o){isNaN(o)||(t[i]=o)}toggleFontWeight(){this.selectedElement.options.fontWeight="normal"===this.selectedElement.options.fontWeight?"bold":"normal"}toggleFontStyle(){this.selectedElement.options.fontStyle="normal"===this.selectedElement.options.fontStyle?"italic":"normal"}newDocument(){this._whiteboardService.erase()}saveAs(t){this._whiteboardService.save(t)}addImage(t){if(t){const i=t.files;if(i){const o=new FileReader;o.onload=s=>{this._whiteboardService.addImage(s.target.result)},o.readAsDataURL(i[0])}}}undo(){this._whiteboardService.undo()}redo(){this._whiteboardService.redo()}colorChange(t,i){this.selectedElement?this.selectedElement.options[t]=i:(this.options[t]=i,this.updateOptions())}swapColors(){[this.options.fill,this.options.strokeColor]=[this.options.strokeColor,this.options.fill],this.updateOptions()}updateOptions(){this.options=Object.assign({},this.options)}}return n.\u0275fac=function(t){return new(t||n)(r.Y36(xe.vK))},n.\u0275cmp=r.Xpm({type:n,selectors:[["app-whiteboard-live-app"]],viewQuery:function(t,i){if(1&t&&r.Gf(T_,5),2&t){let o;r.iGM(o=r.CRH())&&(i.workarea=o.first)}},features:[r._Bn([xe.vK])],decls:130,vars:38,consts:[[1,"editor"],["id","rulers"],["id","ruler_corner"],["id","ruler_x"],["id","ruler_y"],["id","workarea",1,"select",2,"overflow","scroll",3,"mousewheel"],["workarea",""],["id","svgcanvas"],[3,"data","selectedTool","options","strokeWidth","zoom","canvasHeight","canvasWidth","x","y","fullScreen","strokeColor","fill","backgroundColor","dataChange","selectElement","toolChanged"],["whiteboard",""],["id","menu_bar",1,"active"],[1,"menu"],["title","New document",1,"menu_title",3,"click"],["viewBox","0 0 16 16","width","20","height","20"],["fill","#565a66","d","m9.5 1.1l3.4 3.5l.1.4v2h-1V6H8V2H3v11h4v1H2.5l-.5-.5v-12l.5-.5h6.7l.3.1zM9 2v3h2.9L9 2zm4 14h-1v-3H9v-1h3V9h1v3h3v1h-3v3z"],["title","Save Board",1,"menu_title"],["viewBox","0 0 20 20","width","20","height","20"],["d","M12.984 12.656l2.625-2.578 1.406 1.406-5.016 5.016-5.016-5.016 1.406-1.406 2.625 2.578v-9.656h1.969v9.656zM18.984 12h2.016v6.984q0 0.797-0.609 1.406t-1.406 0.609h-13.969q-0.797 0-1.406-0.609t-0.609-1.406v-6.984h2.016v6.984h13.969v-6.984z","fill","#565a66"],["id","file_menu",1,"menu_list","inverted-undo"],[1,"menu_item",3,"click"],["title","Add image",1,"menu_title"],["fill","#565a66","d","M4 5h13v7h2V5c0-1.103-.897-2-2-2H4c-1.103 0-2 .897-2 2v12c0 1.103.897 2 2 2h8v-2H4V5z"],["fill","#565a66","d","m8 11l-3 4h11l-4-6l-3 4z"],["fill","#565a66","d","M19 14h-2v3h-3v2h3v3h2v-3h3v-2h-3z"],["type","file",1,"file-input",3,"change"],["title","Undo",1,"menu_title",3,"click"],["fill","#565a66","d","M9 10h6c1.654 0 3 1.346 3 3s-1.346 3-3 3h-3v2h3c2.757 0 5-2.243 5-5s-2.243-5-5-5H9V5L4 9l5 4v-3z"],["title","Redo",1,"menu_title",3,"click"],["fill","#565a66","d","M9 18h3v-2H9c-1.654 0-3-1.346-3-3s1.346-3 3-3h6v3l5-4l-5-4v3H9c-2.757 0-5 2.243-5 5s2.243 5 5 5z"],["id","panels",1,"tools_panel"],[4,"ngIf"],["main_context_panel",""],["id","tools_left",1,"tools_panel"],["title","Select Tool",1,"tool_button",3,"click"],["viewBox","0 0 24 24","width","24","height","24"],["d","M17.15 20.76l-2.94 1.5-3.68-6-4.41 3V1.24l12.5 12.01-4.41 1.5 2.94 6z"],["title","Brush Tool",1,"tool_button",3,"click"],["xmlns","http://www.w3.org/2000/svg","height","24","viewBox","0 0 24 24","width","24",2,"transform","scale(-1, 1)"],["d","M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"],["title","Image Tool",1,"tool_button",3,"click"],["xmlns","http://www.w3.org/2000/svg","height","24","viewBox","0 0 24 24","width","24"],["d","M0 0h24v24H0z","fill","none"],["d","M17 7l-5 5 5 5V7zm-2 9.17L12.83 12 15 9.83 17.17 12 15 14.17zM3 3v18h18V3H3zm16 16H5V5h14v14z"],["title","Line Tool",1,"tool_button",3,"click"],["viewBox","0 0 27 27","xmlns","http://www.w3.org/2000/svg","width","24","height","24"],["d","M 3 1 L 26 24 L 24 26 L 1 3 L 3 1 Z"],["title","Square/Rect Tool",1,"tool_button",3,"click"],["d","M 0 8 L 0 24 L 24 24 L 25 8 L 0 8 Z"],["title","Ellipse/Circle Tool",1,"tool_button",3,"click"],["cx","13","cy","13","rx","13","ry","9"],["title","Text Tool",1,"tool_button",3,"click"],["xmlns","http://www.w3.org/2000/svg","height","24","viewBox","2 2 20 20","width","27","height","27"],["d","M5 4v3h5.5v12h3V7H19V4z"],["title","Eraser Tool",1,"tool_button",3,"click"],["d","M19 13H5v-2h14v2z"],["id","color_tools"],["id","tool_switch","title","Switch stroke and fill colors [X]",3,"click"],["xmlns","http://www.w3.org/2000/svg","viewBox","0 0 11 11"],["d","M3.01 2A6 6 0 019 8h1.83l-2.91 2.91L5 8h2a4 4 0 00-3.99-4v1.93L.1 3.02 3.01.1V2z"],["id","tool_fill","ngx-colors-trigger","",1,"color_tool","active",3,"change"],["title","Change fill color",1,"icon_label"],[1,"color_block"],["id","fill_bg"],["id","fill_color",1,"color_block"],["xmlns","http://www.w3.org/2000/svg","width","100%"],["width","100%","height","100%","opacity","1"],["id","tool_stroke","ngx-colors-trigger","",1,"color_tool",3,"change"],["title","Change stroke color",1,"icon_label"],["id","stroke_bg"],["id","stroke_color","title","Change stroke color",1,"color_block"],["id","tools_bottom",1,"tools_panel"],["id","zoom_select",3,"change"],["zoomSelect",""],["value","6"],["value","12"],["value","16"],["value","25"],["value","50"],["value","75"],["value","100","selected","selected"],["value","150"],["value","200"],["value","300"],["value","400"],["value","600"],["value","800"],["value","1600"],["id","zoom_panel","title","Change zoom level",1,"toolset"],["id","zoom_label",1,"select-input"],["id","zoomLabel",1,"zoom_tool","icon_label"],["xmlns","http://www.w3.org/2000/svg","height","24","viewBox","2 2 20 20","width","27"],["d","M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"],["id","zoom","type","text","readonly","readonly",3,"value"],[3,"ngSwitch"],[4,"ngSwitchCase"],["id","selected_panel",1,"context_panel",2,"display","block"],[1,"draginputs"],[1,"draginput",3,"mousedown"],["step","2","min","-180","max","180","type","text",1,"attr_changer",3,"value","input"],["angle",""],[1,"icon_label"],["id","tool_angle_indicator",1,"angle"],["id","tool_angle_indicator_cursor",1,"angle-cursor"],["step","5","min","0","max","100","type","text",1,"attr_changer",3,"value","input"],["group_opacity",""],["id","group_opacityLabel",1,"icon_label"],["id","stroke_panel",1,"context_panel",2,"display","block"],["size","2","value","1","data-attr","stroke-width","min","0","max","99","step","1",3,"value","input"],["stroke_width",""],[1,"draginput_cursor",2,"top","68.9394px"],[1,"stroke_tool","draginput"],["id","stroke_style",3,"value","change"],["dasharray",""],["selected","selected","value","none"],["value","2,2"],["value","5,5"],["value","5,2,2,2"],["value","5,2,2,2,2,2"],[1,"caret"],["id","stroke_style_label"],[4,"ngSwitchDefault"],[2,"display","none"],["id","path_panel",1,"context_panel","clearfix",2,"display","block"],["type","text","min","","max","","step","1",1,"attr_changer",3,"value","input"],["path_x",""],["path_y",""],["id","rect_panel",1,"context_panel",2,"display","block"],["rect_x",""],["rect_y",""],["rect_width",""],["rect_height",""],["id","image_panel",1,"context_panel","clearfix",2,"display","block"],["title","Change X coordinate","type","text","min","","max","","step","1",1,"attr_changer",3,"value","input"],["image_x",""],["title","Change Y coordinate","type","text","min","","max","","step","1",1,"attr_changer",3,"value","input"],["image_y",""],["image_width",""],["image_height",""],["id","ellipse_panel",1,"context_panel",2,"display","block"],["id","tool_ellipse_cx",1,"draginput",3,"mousedown"],["title","Change ellipse's cx coordinate","type","text","min","","max","","step","1",1,"attr_changer",3,"value","input"],["ellipse_cx",""],["title","Change ellipse's cy coordinate","type","text","min","","max","","step","1",1,"attr_changer",3,"value","input"],["ellipse_cy",""],["title","Change ellipse's x radius","type","text","min","","max","","step","1",1,"attr_changer",3,"value","input"],["ellipse_rx",""],["title","Change ellipse's y radius","type","text","min","","max","","step","1",1,"attr_changer",3,"value","input"],["ellipse_ry",""],["id","line_panel",1,"context_panel","clearfix",2,"display","block"],["type","text","min","","max","","step","1","title","Change line's starting x coordinate",1,"attr_changer",3,"value","input"],["line_x1",""],["type","text","min","","max","","step","1","title","Change line's starting y coordinate",1,"attr_changer",3,"value","input"],["line_y1",""],["type","text","min","","max","","step","1","title","Change line's ending x coordinate",1,"attr_changer",3,"value","input"],["line_x2",""],["type","text","min","","max","","step","1","title","Change line's ending y coordinate",1,"attr_changer",3,"value","input"],["line_y2",""],["id","text_panel",1,"context_panel",2,"display","block"],["data-title","Change Content",1,"draginput","twocol","textcontent"],["id","text","type","text",3,"value","input"],["text",""],["type","text","min","","max","","step","1","title","Change text x coordinate",1,"attr_changer",3,"value","input"],["text_x",""],["type","text","min","","max","","step","1","title","Change text y coordinate",1,"attr_changer",3,"value","input"],["text_y",""],["id","tool_font_family",1,"toolset","draginput","twocol"],["id","preview_font"],["id","font_family","data-title","Change Font Family","size","12","type","hidden"],["id","font_family_dropdown",3,"value","change"],["font_family",""],["value","Arial"],["value","Arial Black"],["value","Comic Sans MS"],["value","Courier New"],["value","Georgia"],["value","Impact"],["value","Lucida Console"],["value","Lucida Sans Unicode"],["value","monospace","selected",""],["value","Palatino Linotype"],["value","sans-serif","selected",""],["value","serif","selected",""],["value","Tahoma"],["value","Times New Roman"],["value","Trebuchet MS"],["value","Verdana"],[1,"draginput","font_style"],["id","tool_bold","data-title","Bold Text [B]",3,"click"],["id","tool_italic","data-title","Italic Text [I]",3,"click"],["id","tool_font_size","data-title","Change Font Size",1,"draginput",3,"mousedown"],["type","text","min","0","max","","step","1","title","Change text font size",1,"attr_changer",3,"value","input"],["font_size",""],["id","font_sizeLabel",1,"icon_label"],["type","text","step","5","min","0","max","100",1,"attr_changer",3,"value","input"],["rect_rx",""],[1,"draginput_cursor",2,"top","70px"],[4,"ngTemplateOutlet"],["id","canvas_panel",1,"context_panel"],["type","text","min","10","max","","step","1","pattern","[0-9]*",3,"value","input"],["canvas_width",""],["canvas_height",""],["data-title","Change canvas color",1,"draginput"],["id","color_canvas_tools"],["id","tool_canvas","ngx-colors-trigger","",1,"color_tool","active",3,"change"],["id","canvas_bg"],["id","canvas_color"],["xmlns","http://www.w3.org/2000/svg","width","60.5"],["width","100%","height","100%"],[1,"draginput"],[3,"change"],["resolution",""],["id","selectedPredefined","selected","selected"],["id","fitToContent","value","content"],["label","Social Media"],["value","1012x506"],["value","1500x500"],["value","1200x630"],["value","820x312"],["value","1080x1080"],["value","1080x1920"],["value","400x300"],["value","800x600"],["value","1584x396"],["label","Presentation"],["value","1920x1080"],["value","1024x768"],["label","Desktop"],["value","1140x1024"],["value","834x1194"],["value","1024x1366"],["value","1440x990"],["value","1368x912"],["label","Tablet"],["value","768x1024"],["label","Phone"],["value","414x896"],["value","375x812"],["value","414x736"],["value","375x667"],["value","411x731"],["value","411x823"],["value","360x640"],["label","Paper"],["value","595x842"],["value","420x595"],["value","297x420"],["value","612x792"],["value","792x1224"],["id","resolution_label"]],template:function(t,i){if(1&t){const o=r.EpF();r.TgZ(0,"div",0)(1,"div",1),r._UZ(2,"div",2)(3,"div",3)(4,"div",4),r.qZA(),r.TgZ(5,"div",5,6),r.NdJ("mousewheel",function(a){return i.zoomWheel(a)}),r.TgZ(7,"div",7)(8,"ng-whiteboard",8,9),r.NdJ("dataChange",function(a){return i.onDataChange(a)})("selectElement",function(a){return i.selectedElement=a})("toolChanged",function(a){return i.selectedTool=a}),r.qZA()()(),r.TgZ(10,"div",10)(11,"div",11)(12,"div",12),r.NdJ("click",function(){return i.newDocument()}),r.O4$(),r.TgZ(13,"svg",13),r._UZ(14,"path",14),r.qZA()()(),r.kcU(),r.TgZ(15,"div",11)(16,"div",15),r.O4$(),r.TgZ(17,"svg",16),r._UZ(18,"path",17),r.qZA()(),r.kcU(),r.TgZ(19,"div",18)(20,"div",19),r.NdJ("click",function(){return i.saveAs(i.formatTypes.Png)}),r._uU(21,"Save as PNG"),r.qZA(),r.TgZ(22,"div",19),r.NdJ("click",function(){return i.saveAs(i.formatTypes.Jpeg)}),r._uU(23,"Save as JPEG"),r.qZA(),r.TgZ(24,"div",19),r.NdJ("click",function(){return i.saveAs(i.formatTypes.Svg)}),r._uU(25,"Save as SVG"),r.qZA(),r.TgZ(26,"div",19),r.NdJ("click",function(){return i.saveAs(i.formatTypes.Base64)}),r._uU(27,"Copy Base-64"),r.qZA()()(),r.TgZ(28,"div",11)(29,"label",20),r.O4$(),r.TgZ(30,"svg",16),r._UZ(31,"path",21)(32,"path",22)(33,"path",23),r.qZA(),r.kcU(),r.TgZ(34,"input",24),r.NdJ("change",function(a){return i.addImage(a.target)}),r.qZA()()(),r.TgZ(35,"div",11)(36,"div",25),r.NdJ("click",function(){return i.undo()}),r.O4$(),r.TgZ(37,"svg",16),r._UZ(38,"path",26),r.qZA()()(),r.kcU(),r.TgZ(39,"div",11)(40,"div",27),r.NdJ("click",function(){return i.redo()}),r.O4$(),r.TgZ(41,"svg",16),r._UZ(42,"path",28),r.qZA()()()(),r.kcU(),r.TgZ(43,"div",29),r.YNc(44,U_,63,19,"ng-container",30),r.YNc(45,z_,2,1,"ng-container",30),r.YNc(46,$_,147,11,"ng-template",null,31,r.W1O),r.qZA(),r.TgZ(48,"div",32)(49,"div",33),r.NdJ("click",function(){return i.selectedTool=i.toolsEnum.SELECT}),r.O4$(),r.TgZ(50,"svg",34),r._UZ(51,"path",35),r.qZA()(),r.kcU(),r.TgZ(52,"div",36),r.NdJ("click",function(){return i.selectedTool=i.toolsEnum.BRUSH}),r.O4$(),r.TgZ(53,"svg",37),r._UZ(54,"path",38),r.qZA()(),r.kcU(),r.TgZ(55,"div",39),r.NdJ("click",function(){return i.selectedTool=i.toolsEnum.IMAGE}),r.O4$(),r.TgZ(56,"svg",40),r._UZ(57,"path",41)(58,"path",42),r.qZA()(),r.kcU(),r.TgZ(59,"div",43),r.NdJ("click",function(){return i.selectedTool=i.toolsEnum.LINE}),r.O4$(),r.TgZ(60,"svg",44),r._UZ(61,"path",45),r.qZA()(),r.kcU(),r.TgZ(62,"div",46),r.NdJ("click",function(){return i.selectedTool=i.toolsEnum.RECT}),r.O4$(),r.TgZ(63,"svg",44),r._UZ(64,"path",47),r.qZA()(),r.kcU(),r.TgZ(65,"div",48),r.NdJ("click",function(){return i.selectedTool=i.toolsEnum.ELLIPSE}),r.O4$(),r.TgZ(66,"svg",44),r._UZ(67,"ellipse",49),r.qZA()(),r.kcU(),r.TgZ(68,"div",50),r.NdJ("click",function(){return i.selectedTool=i.toolsEnum.TEXT}),r.O4$(),r.TgZ(69,"svg",51),r._UZ(70,"path",52),r.qZA()(),r.kcU(),r.TgZ(71,"div",53),r.NdJ("click",function(){return i.selectedTool=i.toolsEnum.ERASER}),r.O4$(),r.TgZ(72,"svg",40),r._UZ(73,"path",41)(74,"path",54),r.qZA()(),r.kcU(),r.TgZ(75,"div",55)(76,"div",56),r.NdJ("click",function(){return i.swapColors()}),r.O4$(),r.TgZ(77,"svg",57),r._UZ(78,"path",58),r.qZA()(),r.kcU(),r.TgZ(79,"div",59),r.NdJ("change",function(a){return i.colorChange("fill",a)}),r._UZ(80,"label",60),r.TgZ(81,"div",61),r._UZ(82,"div",62),r.TgZ(83,"div",63),r.O4$(),r.TgZ(84,"svg",64),r._UZ(85,"rect",65),r.qZA()()()(),r.kcU(),r.TgZ(86,"div",66),r.NdJ("change",function(a){return i.colorChange("strokeColor",a)}),r._UZ(87,"label",67),r.TgZ(88,"div",61),r._UZ(89,"div",68),r.TgZ(90,"div",69),r.O4$(),r.TgZ(91,"svg",64),r._UZ(92,"rect",65),r.qZA()()()()()(),r.kcU(),r.TgZ(93,"div",70)(94,"select",71,72),r.NdJ("change",function(){r.CHM(o);const a=r.MAs(95);return r.KtG(i.setZoom(a.value))}),r.TgZ(96,"option",73),r._uU(97,"6%"),r.qZA(),r.TgZ(98,"option",74),r._uU(99,"12%"),r.qZA(),r.TgZ(100,"option",75),r._uU(101,"16%"),r.qZA(),r.TgZ(102,"option",76),r._uU(103,"25%"),r.qZA(),r.TgZ(104,"option",77),r._uU(105,"50%"),r.qZA(),r.TgZ(106,"option",78),r._uU(107,"75%"),r.qZA(),r.TgZ(108,"option",79),r._uU(109,"100%"),r.qZA(),r.TgZ(110,"option",80),r._uU(111,"150%"),r.qZA(),r.TgZ(112,"option",81),r._uU(113,"200%"),r.qZA(),r.TgZ(114,"option",82),r._uU(115,"300%"),r.qZA(),r.TgZ(116,"option",83),r._uU(117,"400%"),r.qZA(),r.TgZ(118,"option",84),r._uU(119,"600%"),r.qZA(),r.TgZ(120,"option",85),r._uU(121,"800%"),r.qZA(),r.TgZ(122,"option",86),r._uU(123,"1600%"),r.qZA()(),r.TgZ(124,"div",87)(125,"div",88)(126,"span",89),r.O4$(),r.TgZ(127,"svg",90),r._UZ(128,"path",91),r.qZA()(),r.kcU(),r._UZ(129,"input",92),r.qZA()()()()}2&t&&(r.xp6(7),r.Udp("width",i.outerWidth,"px")("height",i.outerHeight,"px"),r.xp6(1),r.Q6J("data",i.data)("selectedTool",i.selectedTool)("options",i.options)("strokeWidth",i.options.strokeWidth)("zoom",i.zoom)("canvasHeight",i.options.canvasHeight)("canvasWidth",i.options.canvasWidth)("x",i.x)("y",i.y)("fullScreen",!1)("strokeColor",i.options.strokeColor)("fill",i.options.fill)("backgroundColor",i.options.backgroundColor),r.xp6(36),r.Q6J("ngIf",i.selectedElement),r.xp6(1),r.Q6J("ngIf",!i.selectedElement),r.xp6(4),r.ekj("active",i.selectedTool===i.toolsEnum.SELECT),r.xp6(3),r.ekj("active",i.selectedTool===i.toolsEnum.BRUSH),r.xp6(3),r.ekj("active",i.selectedTool===i.toolsEnum.IMAGE),r.xp6(4),r.ekj("active",i.selectedTool===i.toolsEnum.LINE),r.xp6(3),r.ekj("active",i.selectedTool===i.toolsEnum.RECT),r.xp6(3),r.ekj("active",i.selectedTool===i.toolsEnum.ELLIPSE),r.xp6(3),r.ekj("active",i.selectedTool===i.toolsEnum.TEXT),r.xp6(3),r.ekj("active",i.selectedTool===i.toolsEnum.ERASER),r.xp6(14),r.uIk("fill",i.options.fill),r.xp6(7),r.uIk("fill",i.options.strokeColor),r.xp6(37),r.Q6J("value",100*i.zoom+"%"))},dependencies:[Be.O5,Be.tP,Be.RF,Be.n9,Be.ED,C_.v,rl.u_],styles:['@charset "UTF-8";.demo{width:100%;height:768px;border:2px dashed #ccc;background:#fff;overflow:hidden;position:relative}.editor{--z0: #111827;--z1: #1e2433;--a1: #421f24;--b1: #45322a;--c1: #1c3b3b;--z2: #2b313f;--z3: #393e4c;--z4: #474c59;--z5: #565a66;--z6: #656974;--z7: #747782;--a7: #d4100b;--z8: #848790;--z9: #94969f;--z10: #a4a6ae;--z12: #c5c7cc;--z13: #d6d8db;--z14: #e7e9eb;--z15: #f9fafb;--d0: #152239;--d1: #1a3050;--d4: #1e5a9d;--d6: #1779d4;--d7: #0b89f0;--d8: #3797ff;--d9: #62a3ff;--d13: #c3d4fd;--d14: #d7e2fd;--d15: #eaeffc;-webkit-font-smoothing:antialiased;--shadow-bg: 0 var(--x2) var(--x4) var(--z0);--shadow: 0 var(--x1) var(--x8) rgba(0, 0, 0, .4);--accent1: var(--d1);--accent4: var(--d4);--accent6: var(--d6);--accent7: var(--d7);--accent8: var(--d8);--accent9: var(--d9);--accent13: var(--d13);--accent14: var(--d14);--accent15: var(--d15);--x1: 4px;--x2: 8px;--x3: 12px;--x4: 16px;--x5: 20px;--x6: 24px;--x7: 28px;--x8: 32px;--x9: 36px;--x10: 40px;--x12: 48px;--x13: 52px;--x16: 64px;--mono-font: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;--panel-width: calc(var(--x10) * 2 * 2 + var(--x1));--transition-duration: .2s;--transition: all var(--transition-duration) ease}.editor{background:var(--z1);font:14px/120% -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none;margin:0;padding:0}::selection{background:#000;color:#fff}::-moz-selection{background:#000;color:#fff}.editor{overscroll-behavior-x:none;overflow:hidden;width:100%;height:100%}::-webkit-scrollbar{width:var(--x1);height:var(--x1);background:transparent;position:absolute}::-webkit-scrollbar-track{border-radius:10px;background:transparent}::-webkit-scrollbar-thumb{border-radius:10px;background:var(--z3)}::-webkit-scrollbar-corner{background:transparent}input[type=submit],input[type=button],button{background:var(--accent7);color:var(--z15);border-radius:var(--x1);padding:var(--x2) var(--x4);border:none;line-height:140%;font-size:16px;font-weight:550;cursor:pointer}input[type=submit]:hover,input[type=button]:hover,button:hover{background:var(--accent9)}input[type=submit]:active,input[type=button]:active,button:active{box-shadow:0 0 0 var(--x1) var(--accent14);outline:none}input[type=submit]:focus,input[type=button]:focus,button:focus{outline:none}button.cancel,input.Cancel,input.cancel,input.jGraduate_Cancel,button.cancel{-webkit-appearance:none;background-color:var(--z12);color:var(--z3);margin:0}#canvas_panel{display:block}#tool_bold span,#tool_italic span{position:absolute;width:100%;height:100%;top:0;left:0;background:#ccc;opacity:0}#tools_bottom{position:absolute;left:var(--x12);right:0;bottom:0;height:var(--x10);overflow:visible}.clearfix:before,.clearfix:after{content:"";display:table}.clearfix:after{clear:both}#color_canvas_tools,#fill_bg,#stroke_bg{background:var(--z15) url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAMAQMAAABsu86kAAAAA3NCSVQICAjb4U/gAAAABlBMVEXu7u7///8o06qaAAAACXBIWXMAAAsSAAALEgHS3X78AAAAFXRFWHRDcmVhdGlvbiBUaW1lADcvMjIvMTL7FNdCAAAAHHRFWHRTb2Z0d2FyZQBBZG9iZSBGaXJld29ya3MgQ1M1cbXjNgAAABFJREFUCJljYP7AgIb+MKAhAM8/C5vWL6zSAAAAAElFTkSuQmCC) top left repeat}#color_canvas_tools{width:60px;height:40px;margin:23px 5px 5px;position:relative;overflow:hidden}#color_canvas_tools{display:block}#stroke_style_label{font-size:30px;margin-top:33px;letter-spacing:-1px}.stroke_tool .caret{top:60%}.draginputs{display:flex;flex-direction:row;justify-content:flex-start;flex-wrap:wrap}.draginput{background-color:var(--z2);border-radius:var(--x1);width:calc(50% - var(--x2));height:calc(var(--x9) * 2);display:block;position:relative;margin:0 var(--x2) var(--x2) 0;overflow:hidden;transition:var(--transition);box-shadow:none}.dragging .draginput{pointer-events:none}.dragging .draginput.active{pointer-events:all;box-shadow:none}.draginput:hover{background-color:var(--z3);transition:none;box-shadow:var(--shadow-bg)}.draginput:hover span,.draginput.active span{color:var(--z15)}.draginput:hover input,.draginput.active input{color:var(--accent8)}.draginput.active,.draginput.active:hover{background-color:var(--z0)}.draginput.active:hover{transition:none}.draginput .caret{border:solid transparent 5px;border-top-color:var(--z9);position:absolute;width:0;height:0;right:5px;margin-top:-2px;top:50%}.draginput label{margin:28px 10px 0 5px;font-size:14px;color:var(--z15);font-weight:700}.draginput label#resolution_label,.draginput label#seg_type_label{font:700 12px/110% sans-serif;position:absolute;left:auto;right:10px;z-index:0;text-align:right}.draginput label#seg_type_label{margin-top:40px}.draginput label#seg_type_label .caret{top:66%}.draginput label#resolution_label .pull{position:relative;left:-15px}.draginput label#resolution_label span{right:-13px;left:auto;font-size:16px;top:2px;font-weight:700;color:#fff}.draginput input{border:none;background:transparent;font:24px/normal sans-serif;text-align:center;color:var(--accent7);padding:30px 0 16px;width:100%;height:24px;position:relative;z-index:2}.draginput input::selection{background:var(--accent9)}.draginput.text-input input,.draginput.text-input input:hover,.draginput.text-input input:active{cursor:text}.draginput.text-input input{text-align:left;text-indent:var(--x2)}.draginput.textcontent input{cursor:text;text-align:left;text-indent:var(--x2)}.draginput.textcontent input,.draginput.textcontent input:hover,.draginput.textcontent input:active{cursor:text}.draginput input,.draginput input:hover,.draginput input:active{cursor:grab;cursor:-moz-grab}.draginput input[type=checkbox],.draginput input[type=checkbox]:hover,.draginput input[type=checkbox]:active{cursor:pointer}.draginput input:invalid{color:var(--a7)}.draginput span{font:12px/130% sans-serif;color:var(--z8);display:block;position:absolute;top:5px;left:5px;text-align:left;white-space:nowrap;z-index:1}.draginput select{-webkit-appearance:none;opacity:0;display:block;position:absolute;height:100%;width:100%;margin:0;z-index:1;top:0;left:0;cursor:pointer}.draginput:hover .draginput_cursor{border-color:var(--accent6)}.draginput_cursor{position:absolute;top:50%;width:100%;border-top:solid var(--accent4) 1px;z-index:0}.draginput input[readonly=readonly]{-webkit-appearance:none;-webkit-touch-callout:none;-webkit-user-select:none;user-select:none}.draginput input:focus{background:var(--accent7);color:var(--accent15);outline:none;box-shadow:0 0 5px 2px var(--accent7)}.draginput input:focus+span{z-index:10;color:var(--z15)}.draginput .push_bottom{bottom:0;position:absolute}.draginput .angle{width:var(--x12);height:var(--x12);border-radius:var(--x12);background-color:var(--z3);position:absolute;bottom:var(--x1);left:14px}.editor.dragging .draginput .angle{background-color:var(--z1)}.draginput:hover .angle{background:var(--z4)}.draginput .angle-cursor{width:4px;height:25px;border-top:solid var(--accent7) 3px;position:absolute;margin:0 0 0 23px;transform-origin:50% 0}#menu_bar{padding:0 0 0 var(--x12);position:relative;z-index:2;height:var(--x8);display:flex}#menu_bar .menu:hover .menu_list{display:block}.menu{position:relative;z-index:5;color:var(--z3);display:inline-block}.menu_title{cursor:pointer;display:inline-block;z-index:10;color:var(--z15);position:relative;line-height:var(--x8);padding:0 var(--x3);vertical-align:top}.menu .menu_title:hover{background:var(--z2)}.menu_list .separator{margin:var(--x1) 0;border-top:solid var(--z14) 1px}.menu_list{position:absolute;left:0;top:var(--x8);white-space:nowrap;background:var(--z15);padding:var(--x2) 0;border-radius:0 var(--x2) var(--x2) var(--x2);box-shadow:var(--shadow)}#menu_bar.active .menu.open .menu_title{background:var(--z15);color:var(--z1)}.menu .menu_list{display:none;position:absolute}.menu_list .menu_item{position:relative;overflow:hidden;line-height:var(--x6);padding:var(--x1) var(--x16) var(--x1) var(--x6);cursor:pointer;color:var(--z3)}.file-input{-webkit-appearance:none;position:absolute;opacity:0;cursor:pointer;left:0;right:0;top:0;bottom:0;display:block;background:red;z-index:100}.menu_list .menu_item.tool_button{background:transparent;border:none;margin:0;padding:var(--x1) var(--x16) var(--x1) var(--x6);height:auto;width:auto}.menu_list .menu_item.push_button_pressed:before{content:"\\2714";position:absolute;display:block;left:6px;top:var(--x1)}.menu_list .menu_item:hover,.menu_list .menu_item.push_button_pressed:hover{background:var(--accent15);color:#000}.menu_list .menu_item.disabled:hover,.menu_list .menu_item.push_button_pressed.disabled:hover{background:transparent;color:var(--z3)}.menu_list .menu_item.push_button_pressed{background:transparent;border:none;width:auto;height:auto;margin:0}.menu_list .menu_item span{display:block;position:absolute;right:var(--x2);padding:0 var(--x2);background:var(--z14);top:50%;transform:translateY(-50%);text-align:center;font-size:12px;line-height:var(--x6);border-radius:var(--x1);font-weight:600}.menu_list .menu_item:not(.disabled):hover span{background:var(--accent13)}.menu-right button:hover svg{fill:var(--z12)}.menu-right svg{fill:var(--z5)}#logo svg{pointer-events:none;margin-top:var(--x2);fill:var(--z7)}#logo svg path:last-child{fill:var(--z13)}#logo:hover svg{fill:var(--z9)}#logo svg path:last-child{fill:var(--z15)}#rulers>div{position:absolute;background:var(--z2);z-index:1;overflow:hidden;-webkit-font-smoothing:none}#rulers #ruler_corner{top:var(--x8);left:var(--x12);width:var(--x4);height:var(--x4);z-index:2;border-radius:var(--x2) 0 0 0}#ruler_x{height:var(--x4);top:var(--x8);left:var(--x12);right:calc(var(--panel-width) + var(--x4));overflow:hidden;border-radius:var(--x2)}#ruler_y{width:var(--x4);top:var(--x8);left:var(--x12);bottom:var(--x10);overflow:hidden;border-radius:var(--x2)}#ruler_x>div,#ruler_y>div{overflow:hidden}#stroke_color:after{content:"";position:absolute;display:block;left:var(--x1);right:var(--x1);top:var(--x1);bottom:var(--x1);background:var(--z1);box-shadow:0 0 0 1px var(--z13)}#tool_switch{cursor:pointer;width:11px;height:11px;position:absolute;top:-5px;right:0;cursor:nwse-resize}#tool_switch svg{fill:var(--z6)}#tool_switch:hover svg{fill:var(--z15)}.color_block{width:var(--x5);height:var(--x5);overflow:hidden;border:solid var(--z12) 1px;cursor:pointer}.color_block svg{width:22px;height:22px}#tool_stroke .color_block>div{position:absolute;bottom:0;right:0}#color_tools{position:relative;width:48px;height:48px;margin:12px 6px 0}#color_tools{width:auto;height:auto}#tool_fill{position:absolute;top:0;left:0;z-index:1}#tool_stroke{top:14px;left:14px}#tool_fill,#tool_stroke,#tool_canvas{box-shadow:0 0 0 1px var(--z0);position:absolute}#tool_canvas .color_block{width:58px;height:38px}#tool_canvas .color_block svg{width:auto;height:auto}#shape_cats>div{padding:0 var(--x4);background:var(--z14);color:var(--z6);height:var(--x7);line-height:var(--x7);transition:background-color .1s ease}#svgcanvas{background-color:var(--z2);display:block;width:100%;height:100%}#workarea{display:block;position:absolute;top:var(--x8);left:var(--x12);bottom:var(--x10);right:calc(var(--panel-width) + var(--x4));background-color:var(--z2);overflow:auto;align-items:center;justify-content:center;transition:transform .5s cubic-bezier(.13,.66,.24,.92);border-radius:var(--x2);box-shadow:var(--shadow-bg)}#tools_left{position:absolute;border-right:none;width:var(--x12);top:var(--x8);bottom:0;left:0;z-index:4}.tool_button{height:var(--x12);width:var(--x12);cursor:pointer;line-height:60px;text-align:center;transform:scale(.8)}.tool_button:hover{transform:scale(1)}.tool_button:hover svg{fill:var(--z13)}.tool_button.active{transform:scale(1.4)}.tool_button svg{vertical-align:center;fill:var(--z5)}.tool_button.active svg{fill:var(--accent8)}.tool_button.active svg{fill:var(--accent7)}.tool_button.disabled svg{background-color:#aaa;cursor:not-allowed;fill:var(--z3);pointer-events:none}#tool_rect svg{position:relative;top:-1px;left:1px}#tool_ellipse svg{position:relative;top:2px;left:1px}.select-input{margin:var(--x2) 0;position:relative}.select-input:after{content:"\\2193";font-weight:700;position:absolute;right:var(--x6);top:50%;color:var(--z7);transform:translateY(-50%)}.select-input select{-webkit-appearance:none;background-color:var(--z3);color:var(--z14);height:var(--x8);display:block;width:calc(100% - var(--x2));padding:0 var(--x4);border:none;border-radius:var(--x1)}.select-input select:focus{outline:none;box-shadow:0 0 0 1px var(--accent7)}#panels{position:absolute;box-sizing:border-box;width:var(--panel-width);right:var(--x1);top:var(--x5);bottom:0;border-bottom:none;overflow:auto;padding:0}.context_panel{display:none}.context_panel h4{color:var(--z15);font-weight:400;margin:0;padding:10px 0 5px}.context_panel label{display:block;color:var(--z13);white-space:nowrap}#align_tools{display:none}.align_buttons{margin-bottom:var(--x2)}.align_button,.align_button *{transition:var(--transition)}.align_button:hover,.align_button:hover *{transition:none}.align_button{float:left;height:var(--x13);width:var(--x13);line-height:var(--x16);text-align:center;cursor:pointer;position:relative}.align_button:hover{background-color:var(--z0);border-color:var(--z3)}.align_button svg{fill:var(--z10)}.align_button:hover svg{fill:var(--z15);transition:none}.align_button:nth-child(1){border-radius:var(--x1) 0 0 0}.align_button:nth-child(3){border-radius:0 var(--x1) 0 0}.align_button:nth-child(4){border-radius:0 0 0 var(--x1)}.align_button:nth-child(6){border-radius:0 0 var(--x1) 0}.align_buttons .push_button{display:block;float:left}#tool_bold,#tool_italic{font:700 20px/35px serif;text-align:center;position:absolute;padding:0;color:var(--z13);background:transparent;border:none;margin:0;width:50%;top:var(--x8);line-height:var(--x10);bottom:0;border-top:solid var(--z1) 2px;cursor:pointer}#tool_bold{right:0}#tool_italic{border-right:solid var(--z1) 2px;line-height:var(--x9);left:0;font-weight:700;font-style:italic;font-size:24px}#tool_bold:hover,#tool_italic:hover{color:var(--z15);background-color:var(--z3)}#tool_bold.disabled,#tool_italic.disabled{opacity:1;color:var(--z4);pointer-events:none}#tool_bold.active,#tool_italic.active{color:#50a0ff}#preview_font{color:var(--z15);font-size:2em;line-height:80px;padding:0 var(--x2);white-space:nowrap}#preview_font+.caret{right:var(--x2)}.draginput:hover #preview_font:after{border-right-color:var(--z3);background:linear-gradient(to right,rgba(0,0,0,0),var(--z3))}#preview_font:after{content:"";position:absolute;right:0;top:3px;bottom:3px;width:15px;border-right:solid var(--z2) 10px;background:linear-gradient(to right,rgba(0,0,0,0),var(--z2))}#zoom_panel,#zoom_select{padding:var(--x2) 0;right:calc(var(--panel-width) + var(--x2));position:absolute;cursor:pointer;width:100px}#zoom_label:after{content:""}#zoom_select{opacity:0;z-index:100}#zoom_select:hover+div{opacity:1}#zoom_label{position:absolute;background:transparent;width:100%;margin:0}#zoom_panel .caret{margin-top:-5px}#zoom_label img,#zoom_label svg{width:var(--x4);height:var(--x4)}#zoomLabel{width:var(--x4);height:var(--x4);cursor:pointer}#zoomLabel svg{fill:var(--z10);position:relative;top:2px}#zoom_label input{-webkit-appearance:none;color:var(--z10);font-size:13px;height:auto;width:var(--x12);padding:0;cursor:default;position:absolute;background:transparent;border:none;top:2px;left:var(--x6);pointer-events:none}#zoom_label select{-webkit-appearance:none;position:absolute;top:0;left:0;bottom:0;right:0}#zoom_label span{top:0;left:0}\n'],encapsulation:3}),n})()}];let j_=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({imports:[nr.Bz.forChild(Q_),nr.Bz]}),n})(),J_=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=r.oAB({type:n}),n.\u0275inj=r.cJS({imports:[Be.ez,j_,xe.ZK,rl.To]}),n})()}}]);