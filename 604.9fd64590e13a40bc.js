"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[604],{2107:($,F,y)=>{y.d(F,{G:()=>f});var S=y(4523),e=y(4438),E=y(7785),k=y(8936),D=y(525),i=y(6255),u=y(3437),h=y(710),m=y(1152),n=y(3312),a=y(875),o=y(4764),g=y(6078),C=y(162),r=y(1389),I=y(3909);let f=(()=>{class w{constructor(){this.elementsService=(0,e.WQX)(i.L),this.canvasService=(0,e.WQX)(D.W),this.selectionService=(0,e.WQX)(m.A),this.toolsService=(0,e.WQX)(n.H),this.ioService=(0,e.WQX)(r.q),this.historyService=(0,e.WQX)(a.k),this.zoomService=(0,e.WQX)(o.T),this.panService=(0,e.WQX)(h.l),this.layerService=(0,e.WQX)(u.a),this.configService=(0,e.WQX)(E.w),this.clipboardService=(0,e.WQX)(I.W),this.eventBusService=(0,e.WQX)(k.W),this.elements=this.elementsService.elements,this.draftElements=this.elementsService.draftElements,this.allElements=this.elementsService.allElements,this.selectedElements=this.selectionService.getSelectedElementsSignal(),this.config=(0,e.EWP)(()=>this.configService.getConfig()),this.elementsCount=this.elementsService.elementsCount,this.hasElements=this.elementsService.hasElements,this.selectedTool=this.toolsService.selectedTool,this.availableTools=this.toolsService.availableTools,this.layers=this.layerService.layers,this.activeLayerId=this.layerService.activeLayerId,this.activeLayer=this.layerService.activeLayer}setElements(l){this.elementsService.setElements(l)}getElements(){return this.elementsService.getElements()}addElements(l){this.elementsService.addElements(l)}updateElements(l){const b=l.map(T=>({...T,id:T.id}));this.elementsService.updateElements(b)}removeElements(l){this.elementsService.removeElements(l)}clear(){this.elementsService.clear()}clearAll(){this.elementsService.clear(),this.selectionService.clearSelection()}addElement(l){this.addElements([l])}updateElement(l){this.updateElements([l])}removeElementsByIds(l){this.elementsService.removeElementsByIds(l)}getElementById(l){return this.elementsService.getElementById(l)}getElementsByIds(l){return this.elementsService.getElementsByIds(l)}getNextZIndex(){return this.elementsService.getNextZIndex()}getAllElements(){return this.elementsService.getElements()}getDraftElements(){return this.elementsService.getDraftElements()}addDraftElements(l){this.elementsService.addDraftElements(l)}updateDraftElements(l){this.elementsService.updateDraftElements(l)}removeDraftElements(l){this.elementsService.removeDraftElements(l)}commitDraftElements(){this.elementsService.commitDraftElements()}elementExists(l){return this.elementsService.elementExists(l)}selectElements(l,b=!1){this.selectionService.selectElements(l,b)}deselectElement(l){this.selectionService.deselectElement(l)}toggleSelection(l){this.selectionService.toggleSelection(l)}clearSelection(){this.selectionService.clearSelection()}selectAll(){this.selectionService.selectAll()}getSelectedElements(){return this.selectionService.getSelectedElements()}updateSelectedElements(l){this.selectionService.updateSelectedElements(l)}removeSelectedElements(){this.selectionService.removeSelectedElements()}isSelected(l){return this.selectionService.isSelected(l)}clearSelectionBox(){this.selectionService.clearSelectionBox()}transformSelectedElements(l){this.selectionService.transformSelectedElements(l)}setSelectionBox(l){this.selectionService.setSelectionBox(l)}updateBoundingBox(){this.selectionService.updateBoundingBox()}getBoundingBox(){return this.selectionService.getBoundingBox()}setBoundingBox(l){this.selectionService.setBoundingBox(l)}getClipboardInfo(){return this.clipboardService.getClipboardInfo()}copyElements(){this.selectionService.copyElements()}cutElements(){this.selectionService.cutElements()}pasteElements(){this.selectionService.pasteElements()}duplicateElements(){this.selectionService.duplicateElements()}deleteSelectedElements(){this.selectionService.deleteSelectedElements()}bringToFront(){this.selectionService.bringToFront()}bringForward(){this.selectionService.bringForward()}sendBackward(){this.selectionService.sendBackward()}sendToBack(){this.selectionService.sendToBack()}groupSelectedElements(){this.selectionService.groupSelectedElements()}ungroupSelectedElements(){this.selectionService.ungroupSelectedElements()}lockElements(){this.selectionService.lockElements()}unlockElements(){this.selectionService.unlockElements()}alignElements(l){this.selectionService.alignElements(l)}distributeHorizontally(){this.selectionService.distributeHorizontally()}distributeVertically(){this.selectionService.distributeVertically()}flipHorizontal(){this.selectionService.flipHorizontal()}flipVertical(){this.selectionService.flipVertical()}moveSelectedElements(l,b){this.selectionService.moveSelectedElements(l,b)}rotateSelectedElements(l){this.selectionService.rotateSelectedElements(l)}scaleSelectedElements(l){this.selectionService.scaleSelectedElements(l)}initializeWhiteboard(l){this.canvasService.initializeCanvas(l),this.toolsService.setApiService(this)}getCanvas(){return this.canvasService.getCanvas()}setCanvasDimensions(l,b){this.canvasService.setCanvasDimensions(l,b)}centerCanvas(){this.canvasService.centerCanvas()}fullScreen(){this.canvasService.fullScreen()}exitFullScreen(l,b){this.canvasService.exitFullScreen(l,b)}resetCanvas(){this.canvasService.resetCanvas()}setZoom(l){this.zoomService.zoom(l)}zoomIn(){this.zoomService.zoomIn()}zoomOut(){this.zoomService.zoomOut()}resetZoom(){this.zoomService.resetZoom()}zoomToFit(){this.zoomService.zoomToFit()}zoomToSelection(){this.zoomService.zoomToSelection()}pan(l,b){this.panService.pan(l,b)}panTo(l,b){this.panService.panTo(l,b)}resetPan(){this.panService.resetPan()}save(l=g.o8.Base64,b="whiteboard"){var T=this;return(0,S.A)(function*(){return T.ioService.save(l,b)})()}addImage(l){this.ioService.addImage(l)}importImageFile(l,b,T){var B=this;return(0,S.A)(function*(){return B.ioService.importImageFile(l,b,T)})()}exportData(){return this.ioService.exportData()}importData(l){this.ioService.importData(l)}exportAsPNG(l="whiteboard"){var b=this;return(0,S.A)(function*(){return b.ioService.exportAsPng(l)})()}exportAsSVG(l="whiteboard"){var b=this;return(0,S.A)(function*(){return b.ioService.exportAsSvg(l)})()}exportAsJSON(l="whiteboard"){const b=this.ioService.exportData(),T=new Blob([b],{type:"application/json"}),B=URL.createObjectURL(T),P=document.createElement("a");P.href=B,P.download=`${l}.json`,P.click(),URL.revokeObjectURL(B)}undo(){const l=this.historyService.undo();return!!l&&(this.elementsService.setElements(l),this.selectionService.clearSelection(),this.eventBusService.emit(C.w.Undo,void 0),!0)}redo(){const l=this.historyService.redo();return!!l&&(this.elementsService.setElements(l),this.selectionService.clearSelection(),this.eventBusService.emit(C.w.Redo,void 0),!0)}getCanUndoSignal(){return this.historyService.getCanUndoSignal()}getCanRedoSignal(){return this.historyService.getCanRedoSignal()}clearHistory(){this.historyService.clearHistory()}recordElementCreation(l,b){this.historyService.recordElementCreation(l,b)}recordElementUpdate(l,b){this.historyService.recordElementUpdate(l,b)}recordElementDeletion(l,b){this.historyService.recordElementDeletion(l,b)}recordClear(l,b){this.historyService.recordClear(l,b)}recordChange(l,b,T){this.historyService.recordChange(l,b,T)}getConfig(){return this.configService.getConfig()}updateConfig(l){this.configService.updateConfig(l)}updateConfigValue(l,b){this.configService.updateConfigValue(l,b)}addLayer(l){return this.layerService.addLayer(l)}removeLayer(l){return this.layerService.removeLayer(l)}setActiveLayer(l){return this.layerService.setActiveLayer(l)}getActiveLayerId(){return this.layerService.getActiveLayerId()}toggleLayerVisibility(l){return this.layerService.toggleLayerVisibility(l)}toggleLayerLock(l){return this.layerService.toggleLayerLock(l)}renameLayer(l,b){return this.layerService.renameLayer(l,b)}setLayerOpacity(l,b){return this.layerService.setLayerOpacity(l,b)}setLayerBlendMode(l,b){return this.layerService.setLayerBlendMode(l,b)}moveLayerUp(l){return this.layerService.moveLayerUp(l)}moveLayerDown(l){return this.layerService.moveLayerDown(l)}reorderLayersByIndex(l,b){return this.layerService.reorderLayersByIndex(l,b)}toggleGrid(){this.canvasService.toggleGrid()}toggleSnapToGrid(){this.canvasService.toggleSnapToGrid()}setGridSize(l){this.canvasService.setGridSize(l)}setActiveTool(l){this.toolsService.setActiveTool(l)}getActiveTool(){return this.toolsService.getActiveToolType()}setToolEnabled(l,b){return this.toolsService.setToolEnabledByType(l,b)}setEnabledTools(l){this.toolsService.setEnabledTools(l)}setCursor(l){this.toolsService.setCursor(l)}resetCursor(){this.toolsService.resetCursor()}screenToCanvas(l,b){return this.canvasService.screenToCanvas(l,b)}canvasToScreen(l,b){return this.canvasService.canvasToScreen(l,b)}getSelectionBoxSignal(){return this.selectionService.getSelectionBoxSignal()}getBoundingBoxSignal(){return this.selectionService.getBoundingBoxSignal()}static{this.\u0275fac=function(b){return new(b||w)}}static{this.\u0275prov=e.jDH({token:w,factory:w.\u0275fac})}}return w})()},525:($,F,y)=>{y.d(F,{W:()=>D});var S=y(4438),e=y(162),E=y(7785),k=y(8936);let D=(()=>{class i{constructor(h,m,n){this.configService=h,this.eventBusService=m,this.svgContainer=null,this.transform=(0,S.EWP)(()=>{const{zoom:a,x:o,y:g}=this.getConfig();return`translate(${o}, ${g}) scale(${a})`}),this.renderer=n.createRenderer(null,null)}initializeCanvas(h){this.svgContainer=h;const{fullScreen:m,center:n}=this.getConfig();!m&&n&&setTimeout(()=>{this.centerCanvas()},0),this.eventBusService.emit(e.w.Ready)}getCanvas(){if(!this.svgContainer)throw new Error("SVG container not initialized");return this.svgContainer}isCanvasInitialized(){return null!==this.svgContainer}getConfig(){return this.configService.getConfig()}setCanvasDimensions(h,m){this.configService.updateConfig({canvasWidth:h,canvasHeight:m})}setCanvasPosition(h,m){this.configService.updateConfig({x:h,y:m})}getCanvasDimensions(){const h=this.getConfig();return{width:h.canvasWidth,height:h.canvasHeight}}getCanvasPosition(){const h=this.getConfig();return{x:h.x,y:h.y}}getContainerDimensions(){return this.svgContainer?{width:this.svgContainer.clientWidth||0,height:this.svgContainer.clientHeight||0}:{width:0,height:0}}fullScreen(){const{width:h,height:m}=this.getContainerDimensions();this.setCanvasDimensions(h,m),this.configService.updateConfig({fullScreen:!0}),this.centerCanvas()}exitFullScreen(h=800,m=600){this.setCanvasDimensions(h,m),this.configService.updateConfig({fullScreen:!1,zoom:1}),this.centerCanvas()}centerCanvas(){const{fullScreen:h}=this.getConfig();if(h)this.configService.updateConfig({x:0,y:0,canvasX:0,canvasY:0});else{const{canvasWidth:m,canvasHeight:n,zoom:a,center:o}=this.getConfig(),{width:g,height:C}=this.getContainerDimensions();this.configService.updateConfig({x:o?m/2:0,y:o?n/2:0,canvasX:(g-m*a)/2,canvasY:(C-n*a)/2})}}resetCanvas(){this.configService.updateConfig({x:0,y:0,zoom:1,canvasX:0,canvasY:0})}toggleGrid(){const{enableGrid:h}=this.getConfig();this.configService.updateConfig({enableGrid:!h})}setGridVisible(h){this.configService.updateConfig({enableGrid:h})}setGridSize(h){this.configService.updateConfig({gridSize:h})}toggleSnapToGrid(){const{snapToGrid:h}=this.getConfig();this.configService.updateConfig({snapToGrid:!h})}getTransform(){return this.transform}getTransformString(){return this.transform()}screenToCanvas(h,m){const{zoom:n,x:a,y:o}=this.getConfig();return{x:(h-a)/n,y:(m-o)/n}}canvasToScreen(h,m){const{zoom:n,x:a,y:o}=this.getConfig();return{x:h*n+a,y:m*n+o}}getVisibleBounds(){const{zoom:h,x:m,y:n}=this.getConfig(),{width:a,height:o}=this.getContainerDimensions();return{left:-m/h,top:-n/h,right:(-m+a)/h,bottom:(-n+o)/h}}isPointVisible(h,m){const n=this.getVisibleBounds();return h>=n.left&&h<=n.right&&m>=n.top&&m<=n.bottom}isRectVisible(h,m,n,a){const o=this.getVisibleBounds();return!(h+n<o.left||h>o.right||m+a<o.top||m>o.bottom)}getCanvasDimensionsProvider(){return()=>this.getCanvasDimensions()}getContainerDimensionsProvider(){return()=>this.getContainerDimensions()}transformCoordinates(h,m){return{x:h,y:m}}validateZoom(h){return Math.max(.1,Math.min(10,h))}static{this.\u0275fac=function(m){return new(m||i)(S.KVO(E.w),S.KVO(k.W),S.KVO(S._9s))}}static{this.\u0275prov=S.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},4446:($,F,y)=>{y.d(F,{b:()=>E});var S=y(4438),e=y(2107);let E=(()=>{class k{constructor(){this.instances=new Map,this._activeId=(0,S.vPA)(null),this.activeId=this._activeId.asReadonly(),this._registryVersion=(0,S.vPA)(0),this.registryVersion=this._registryVersion.asReadonly()}register(i,u){if(!i||0===i.trim().length)throw new Error("Whiteboard instance ID cannot be empty.");if(!(u instanceof e.G))throw new Error("Instance must be an ApiService instance.");this.instances.set(i,u),this._registryVersion.update(h=>h+1)}unregister(i){const u=this.instances.delete(i);return u&&(this._activeId()===i&&this._activeId.set(null),this._registryVersion.update(h=>h+1)),u}getInstance(i){return this.instances.get(i)}hasInstance(i){return this.instances.has(i)}getAllInstanceIds(){return Array.from(this.instances.keys())}getInstanceCount(){return this.instances.size}setActive(i){if(!this.hasInstance(i))throw new Error(`Whiteboard with ID "${i}" not found in registry. Cannot set as active.`);this._activeId.set(i)}clearActive(){this._activeId.set(null)}getActiveInstance(){const i=this._activeId();return i?this.instances.get(i):void 0}clearAll(){this.instances.clear(),this._activeId.set(null),this._registryVersion.update(i=>i+1)}static{this.\u0275fac=function(u){return new(u||k)}}static{this.\u0275prov=S.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}}return k})()},7785:($,F,y)=>{y.d(F,{w:()=>i});var S=y(4438),e=y(6078),E=y(3265),k=y(162),D=y(8936);let i=(()=>{class u{constructor(m){this.eventBusService=m,this.config=(0,S.vPA)({drawingEnabled:!0,canvasWidth:800,canvasHeight:600,fullScreen:!0,center:!0,canvasX:0,canvasY:0,strokeColor:"#333333",strokeWidth:2,backgroundColor:"#F8F9FA",lineJoin:e.pP.Round,lineCap:e.$3.Round,fill:"transparent",zoom:1,x:0,y:0,fontFamily:"sans-serif",fontSize:24,dasharray:"",dashoffset:0,enableGrid:!1,gridSize:10,snapToGrid:!0,keyboardShortcutsEnabled:!0,penType:E.mY.Pen}),this.editorConfig=(0,S.vPA)({title:"Whiteboard",enableEditor:!0,showTitle:!0,showZoom:!0,showLayers:!0,showTools:!0,showGrid:!0,showBackground:!0,showStroke:!0,showFill:!0,showOpacity:!0,showFont:!0,showDash:!0,showEraser:!0,showUndo:!0,showRedo:!0,showClear:!0,showSave:!0,showLoad:!1,showExport:!0,showImport:!1,showShare:!1,showSettings:!1,showHelp:!1,showAbout:!1,showFeedback:!1,showSupport:!1,showContact:!1,showPrivacy:!1,showTerms:!1,showLicense:!1,showAttribution:!1,showCredits:!1,showChangelog:!1,showReleaseNotes:!1,showRoadmap:!1,showBlog:!1,showForum:!1,showCommunity:!1,showEvents:!1,showWebinars:!1,showWorkshops:!1,showTutorials:!1,showDocumentation:!1,showAPI:!1,showSDK:!1,showCLI:!1,showPlugins:!1,showExtensions:!1,showIntegrations:!1,showAddons:!1,showThemes:!1,showTemplates:!1,showSnippets:!1,showExamples:!0,showDemos:!0,showSamples:!1,showShowcases:!1,showPortfolios:!1,showCaseStudies:!1,showSuccessStories:!1,showTestimonials:!1,showReviews:!1,showRatings:!1,showComparisons:!1,showAlternatives:!1,showInsights:!1})}getConfig(){return this.config()}getConfigSignal(){return this.config.asReadonly()}getEditorConfig(){return this.editorConfig()}getEditorConfigSignal(){return this.editorConfig.asReadonly()}updateConfig(m,n=!0){if(this.config.update(o=>({...o,...m})),"zoom"in m){const o=this.config();this.eventBusService.emit(k.w.ZoomChange,{zoom:o.zoom})}n&&this.eventBusService.emit(k.w.ConfigChange,this.config())}isConfigDifferent(m,n){return this.config()[m]!==n}updateConfigValue(m,n){this.config.update(a=>({...a,[m]:n})),this.eventBusService.emit(k.w.ConfigChange,this.config())}updateEditorConfigValue(m,n){this.editorConfig.update(a=>({...a,[m]:n}))}checkAndUpdateConfig(m,n){this.isConfigDifferent(m,n)&&this.updateConfigValue(m,n)}getConfigValue(m){return this.config()[m]}setConfigValue(m,n){this.config.update(a=>({...a,[m]:n})),this.eventBusService.emit(k.w.ConfigChange,this.config())}getConfigKeys(){return Object.keys(this.config())}getConfigValues(){return Object.values(this.config())}static{this.\u0275fac=function(n){return new(n||u)(S.KVO(D.W))}}static{this.\u0275prov=S.jDH({token:u,factory:u.\u0275fac,providedIn:"root"})}}return u})()},7879:($,F,y)=>{y.d(F,{Be:()=>u,Bn:()=>m,DQ:()=>o,Mt:()=>S,RZ:()=>E,Sb:()=>i,YO:()=>D,aM:()=>C,aW:()=>r,bL:()=>a,i$:()=>k,nD:()=>g,wM:()=>e});const S="selectorGroup",e="svgroot",E="item_",k="selectorBox",D="selectorGrip_",i="selectorGrip_resize",u="selectorGrip_rotate",m="data-wb-id",a=.25,o=.1,g=5,C=1,r=.5},2173:($,F,y)=>{y.d(F,{n:()=>B,lE:()=>l});var S=y(2262),e=y(6078);const E={strokeWidth:2,strokeColor:"#000000",fill:"#000000",lineJoin:e.pP.Round,lineCap:e.$3.Round,dasharray:"",dashoffset:0},k={...E,fontSize:14,fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal",color:"#000000"};function D(){return Math.random().toString(36).substring(2).padEnd(12,"0").substring(0,12)}var i=y(6042);function u(P,c,R,N){const A=[[{x:P.minX,y:P.minY},{x:P.maxX,y:P.minY}],[{x:P.maxX,y:P.minY},{x:P.maxX,y:P.maxY}],[{x:P.maxX,y:P.maxY},{x:P.minX,y:P.maxY}],[{x:P.minX,y:P.maxY},{x:P.minX,y:P.minY}]];for(const[d,M]of A)if((0,i.Em)(c,R,d,M,N))return!0;return!1}function m(P,c,R,N,A,d,M){const x={x:P,y:c},L={x:R,y:N};return(0,i.d4)(A.x,A.y,x,L)<=M||(0,i.d4)(d.x,d.y,x,L)<=M}var r=y(2319);const O={[S.R.Arrow]:new class a{create(c){return{type:S.R.Arrow,id:D(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...c,style:{...E,...c.style}}}resize(c,R,N,A){return R.includes(e.OP.N)&&(c.y2+=A),R.includes(e.OP.S)&&(c.y1+=A),R.includes(e.OP.W)&&(c.x1+=N),R.includes(e.OP.E)&&(c.x2+=N),c}getBounds(c){const R=c.x1+c.x,N=c.y1+c.y,A=c.x2+c.x,d=c.y2+c.y;return{minX:Math.min(R,A),minY:Math.min(N,d),maxX:Math.max(R,A),maxY:Math.max(N,d),width:Math.abs(A-R),height:Math.abs(d-N)}}hitTest(c,R,N,A){const{x1:d,y1:M,x2:x,y2:L}=c;return m(d,M,x,L,R,N,A)}},[S.R.Ellipse]:new class o{create(c){return{type:S.R.Ellipse,id:D(),x:0,y:0,cx:0,cy:0,rx:1,ry:1,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...c,style:{...E,...c.style}}}resize(c,R,N,A){if(R.includes(e.OP.N)){const d=c.ry-A/2;d>0&&(c.ry=d,c.cy+=A/2)}if(R.includes(e.OP.S)){const d=c.ry+A/2;d>0&&(c.ry=d,c.cy+=A/2)}if(R.includes(e.OP.W)){const d=c.rx-N/2;d>0&&(c.rx=d,c.cx+=N/2)}if(R.includes(e.OP.E)){const d=c.rx+N/2;d>0&&(c.rx=d,c.cx+=N/2)}return c}getBounds(c){const R=c.cx+c.x,N=c.cy+c.y;return{minX:R-c.rx,minY:N-c.ry,maxX:R+c.rx,maxY:N+c.ry,width:2*c.rx,height:2*c.ry}}hitTest(c,R,N,A){const{cx:d,cy:M,rx:x,ry:L}=c;return function h(P,c,R,N,A,d,M){return(0,i.d4)(P,c,A,d)<=Math.max(R,N)+M}(d,M,x,L,R,N,A)}},[S.R.Image]:new class g{create(c){return{type:S.R.Image,id:D(),x:0,y:0,width:1,height:1,src:"",rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...c,style:{...E,...c.style}}}resize(c,R,N,A){if(R.includes(e.OP.N)){const d=c.height-A;d>0&&(c.y+=A,c.height=d)}if(R.includes(e.OP.S)){const d=c.height+A;d>0&&(c.height=d)}if(R.includes(e.OP.W)){const d=c.width-N;d>0&&(c.x+=N,c.width=d)}if(R.includes(e.OP.E)){const d=c.width+N;d>0&&(c.width=d)}return c}getBounds(c){return{minX:c.x,minY:c.y,maxX:c.x+c.width,maxY:c.y+c.height,width:c.width,height:c.height}}hitTest(c,R,N,A){return u(this.getBounds(c),R,N,A)}},[S.R.Line]:new class C{create(c){return{type:S.R.Line,id:D(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...c,style:{...E,...c.style}}}resize(c,R,N,A){return R.includes(e.OP.N)&&(c.y1+=A),R.includes(e.OP.S)&&(c.y2+=A),R.includes(e.OP.W)&&(c.x1+=N),R.includes(e.OP.E)&&(c.x2+=N),c}getBounds(c){const R=c.x1+c.x,N=c.y1+c.y,A=c.x2+c.x,d=c.y2+c.y;return{minX:Math.min(R,A),minY:Math.min(N,d),maxX:Math.max(R,A),maxY:Math.max(N,d),width:Math.abs(A-R),height:Math.abs(d-N)}}hitTest(c,R,N,A){const{x1:d,y1:M,x2:x,y2:L}=c;return m(d,M,x,L,R,N,A)}},[S.R.Pen]:new class I{create(c){return{type:S.R.Pen,id:D(),x:0,y:0,points:[],rotation:0,opacity:100,zIndex:1,selectAfterDraw:!1,...c,style:{...E,...c.style}}}resize(c,R,N,A){const d=(0,r.AJ)(c.points),{points:M,position:x}=this.getScaleFactors(R,d,N,A),L=d.minX+d.width/2,W=d.minY+d.height/2,[H,Y]=M;return d.width*H<10||d.height*Y<10||(c.x+=x.x,c.y+=x.y,c.points=c.points.map(X=>[L+(X[0]-L)*H,W+(X[1]-W)*Y])),c}getScaleFactors(c,R,N,A){const d=[1,1],M={x:0,y:0};return c.includes("w")&&(d[0]=(R.width-N)/R.width,M.x+=N/2),c.includes("n")&&(d[1]=(R.height-A)/R.height,M.y+=A/2),c.includes("e")&&(d[0]=(R.width+N)/R.width,M.x+=N/2),c.includes("s")&&(d[1]=(R.height+A)/R.height,M.y+=A/2),{points:d,position:M}}getBounds(c){const{minX:R,minY:N,maxX:A,maxY:d,width:M,height:x}=(0,r.AJ)(c.points);return{minX:R+c.x,minY:N+c.y,maxX:A+c.x,maxY:d+c.y,width:M,height:x}}hitTest(c,R,N,A){return function n(P,c,R,N){for(let A=0;A<P.length-1;A++){const d={x:P[A][0],y:P[A][1]},M={x:P[A+1][0],y:P[A+1][1]};if((0,i.d4)(c.x,c.y,d,M)<=N||(0,i.d4)(R.x,R.y,d,M)<=N)return!0}return!1}(c.points,R,N,A)}},[S.R.Rectangle]:new class f{create(c){return{type:S.R.Rectangle,id:D(),x:0,y:0,width:1,height:1,rx:5,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...c,style:{...E,...c.style}}}resize(c,R,N,A){if(R.includes(e.OP.N)){const d=c.height-A;d>0&&(c.y+=A,c.height=d)}if(R.includes(e.OP.S)){const d=c.height+A;d>0&&(c.height=d)}if(R.includes(e.OP.W)){const d=c.width-N;d>0&&(c.x+=N,c.width=d)}if(R.includes(e.OP.E)){const d=c.width+N;d>0&&(c.width=d)}return c}getBounds(c){return{minX:c.x,minY:c.y,maxX:c.x+c.width,maxY:c.y+c.height,width:c.width,height:c.height}}hitTest(c,R,N,A){return u(this.getBounds(c),R,N,A)}},[S.R.Text]:new class w{create(c){return{type:S.R.Text,id:D(),x:0,y:0,text:"",rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,scaleX:1,scaleY:1,...c,style:{...k,...c.style}}}resize(c,R,N,A){const x=.016*N,L=.016*A;switch(R){case e.OP.NW:c.x+=N,c.y+=A,c.scaleX=Math.max(.1,c.scaleX-x),c.scaleY=Math.max(.1,c.scaleY-L);break;case e.OP.N:c.y+=A,c.scaleY=Math.max(.1,c.scaleY-L);break;case e.OP.NE:c.y+=A,c.scaleX=Math.max(.1,c.scaleX+x),c.scaleY=Math.max(.1,c.scaleY-L);break;case e.OP.E:c.scaleX=Math.max(.1,c.scaleX+x);break;case e.OP.SE:c.scaleX=Math.max(.1,c.scaleX+x),c.scaleY=Math.max(.1,c.scaleY+L);break;case e.OP.S:c.scaleY=Math.max(.1,c.scaleY+L);break;case e.OP.SW:c.x+=N,c.scaleX=Math.max(.1,c.scaleX-x),c.scaleY=Math.max(.1,c.scaleY+L);break;case e.OP.W:c.x+=N,c.scaleX=Math.max(.1,c.scaleX-x)}return c}getBounds(c){const{text:R,x:N,y:A,scaleX:d,scaleY:M,style:x}=c,L=x.fontSize??k.fontSize??16,W=1.2*L,H=.6*L,Y=R.split("\n"),j=H*Y.reduce((le,G)=>Math.max(le,G.length),0)*d||L*d,Q=W*Y.length*M||L*M,q=.8*L*M;return{minX:N,minY:A-q,maxX:N+j,maxY:A-q+Q,width:j,height:Q}}hitTest(c,R,N,A){return u(this.getBounds(c),R,N,A)}}};function l(P){return O[P]}let b=null;function B(P,c,R){const A={...c,layerId:R||(b?b():"")};return O[P].create(A)}},6255:($,F,y)=>{y.d(F,{L:()=>u});var S=y(875),e=y(4438),E=y(162),k=y(9820),D=y(3437),i=y(8936);let u=(()=>{class h{constructor(n){this.eventBus=n,this.historyService=(0,e.WQX)(S.k),this.layerManagement=(0,e.WQX)(D.a),this._elements=(0,e.vPA)([]),this._draftElements=(0,e.vPA)([]),this._maxZIndex=(0,e.vPA)(0),this._locks=(0,e.vPA)(new Map),this.elements=this._elements.asReadonly(),this.draftElements=this._draftElements.asReadonly(),this.allElements=(0,e.EWP)(()=>[...this._elements(),...this._draftElements()]),this.elementsCount=(0,e.EWP)(()=>this._elements().length),this.hasElements=(0,e.EWP)(()=>this.elementsCount()>0),this.elementTypes=(0,e.EWP)(()=>{const a=this._elements().map(o=>o.type);return[...new Set(a)]}),this.elementsByType=(0,e.EWP)(()=>{const a=this._elements(),o=new Map;return a.forEach(g=>{const C=g.type;o.has(C)||o.set(C,[]);const r=o.get(C);r&&r.push(g)}),o}),this.maxZIndex=(0,e.EWP)(()=>this._maxZIndex()),this.elementsByZIndex=(0,e.EWP)(()=>[...this._elements()].sort((a,o)=>(a.zIndex||0)-(o.zIndex||0))),this.lockedElements=(0,e.EWP)(()=>this._elements().filter(a=>!0===a.locked)),this.unlockedElements=(0,e.EWP)(()=>this._elements().filter(a=>!0!==a.locked)),this.lockedElementsCount=(0,e.EWP)(()=>this.lockedElements().length),this.hasLockedElements=(0,e.EWP)(()=>this.lockedElementsCount()>0),this.lockStats=(0,e.EWP)(()=>{const a=this.elementsCount(),o=this.lockedElementsCount();return{total:a,locked:o,unlocked:a-o,lockPercentage:a>0?Math.round(o/a*100):0,allLocked:a>0&&o===a,noneLocked:0===o}}),this.locks=this._locks.asReadonly()}getElements(){return[...this._elements()]}getDraftElements(){return[...this._draftElements()]}getAllElements(){return this.allElements()}addElements(n){if(!n?.length)return;const a=this.layerManagement.getActiveLayerId(),o=n.map(r=>({...r,zIndex:r.zIndex??this.getNextZIndex(),layerId:r.layerId??a}));this.updateMaxZIndex(o);const g=this._elements(),C=[...g,...o];this._elements.set(C),o.forEach(r=>{r.layerId&&this.layerManagement.assignElementToLayer(r.id,r.layerId)}),this.historyService.recordElementCreation(g,C),this.eventBus.emit(E.w.ElementsAdded,o),this.eventBus.emit(E.w.DataChange,C)}updateElements(n,a=!1){if(!n?.length)return;const o=this._elements(),g=new Map(n.map(I=>[I.id,I])),C=[],r=o.map(I=>{const f=g.get(I.id);if(!f)return I;if(!a&&I.locked&&!this.isLockOperation(f))return console.warn(`Attempted to modify locked element: ${I.id}`),I;if(!a&&I.layerId){const O=this.layerManagement.getElementLayer(I.id);if(O?.locked)return console.warn(`Attempted to modify element on locked layer: ${O.name}`),I}const w={...I,...f};return null!=w.zIndex&&this._maxZIndex.update(O=>Math.max(O,w.zIndex)),C.push(w),w});this._elements.set(r),C.length>0&&this.historyService.recordElementUpdate(o,r),C.length>0&&(this.eventBus.emit(E.w.ElementsUpdated,C),this.eventBus.emit(E.w.DataChange,r))}removeElementsByIds(n,a=!1){if(!n?.length)return;const o=new Set(n),g=this._elements(),C=g.filter(f=>{if(!o.has(f.id))return!1;if(!a&&f.locked)return console.warn(`Attempted to remove locked element: ${f.id}`),!1;if(!a&&f.layerId){const w=this.layerManagement.getElementLayer(f.id);if(w?.locked)return console.warn(`Attempted to remove element from locked layer: ${w.name}`),!1}return!0});if(0===C.length)return;const r=new Set(C.map(f=>f.id)),I=g.filter(f=>!r.has(f.id));this._elements.set(I),C.forEach(f=>{this.layerManagement.removeElementFromAllLayers(f.id)}),this.historyService.recordElementDeletion(g,I),this.eventBus.emit(E.w.ElementsRemoved,C),this.eventBus.emit(E.w.DataChange,I)}removeElements(n,a=!1){const o=n.map(g=>g.id);this.removeElementsByIds(o,a)}clear(){const n=this._elements();this._elements.set([]),this._maxZIndex.set(0),n.forEach(a=>{this.layerManagement.removeElementFromAllLayers(a.id)}),this.historyService.recordClear(n,[]),this.eventBus.emit(E.w.DataChange,[])}setElements(n){const a=n.map(o=>({...o,zIndex:o.zIndex??this.getNextZIndex()}));this.updateMaxZIndex(a),this._elements.set([...a]),this.eventBus.emit(E.w.DataChange,a)}addDraftElements(n){if(!n?.length)return;const a=this.layerManagement.activeLayer();if(a?.locked)return void console.warn(`Cannot draw on locked layer: ${a.name}`);const o=n.map(r=>({...r,zIndex:r.zIndex??this.getNextZIndex()}));this.updateMaxZIndex(o);const C=[...this._draftElements(),...o];this._draftElements.set(C)}updateDraftElements(n){if(!n?.length)return;const a=this._draftElements(),o=new Map(n.map(r=>[r.id,r])),g=[],C=a.map(r=>{const I=o.get(r.id);if(I){const f={...r,...I};return g.push(f),f}return r});this._draftElements.set(C)}removeDraftElements(n){if(!n?.length)return;const a=new Set(n),g=this._draftElements().filter(C=>!a.has(C.id));this._draftElements.set(g)}clearDraftElements(){this._draftElements.set([])}commitDraftElements(n){const a=this._draftElements(),o=n?a.filter(r=>n.includes(r.id)):a;if(0===o.length)return[];const g=this.layerManagement.activeLayer();if(g?.locked)return console.warn(`Cannot commit elements to locked layer: ${g.name}`),this._draftElements.set([]),[];this.addElements(o);const C=n?a.filter(r=>!n.includes(r.id)):[];return this._draftElements.set(C),o}getNextZIndex(){return this._maxZIndex.update(n=>n+1),this._maxZIndex()}bringToFront(n,a=!1){if(!n?.length)return;const o=this.getNextZIndex(),g=n.map(C=>({id:C,zIndex:o}));this.updateElements(g,a)}sendToBack(n,a=!1){if(!n?.length)return;const o=n.map(g=>({id:g,zIndex:0}));this.updateElements(o,a)}lockElements(n){if(!n?.length)return;const a={timestamp:Date.now(),reason:"User locked"},o=this._locks(),g=new Map(o),C=n.map(r=>(g.set(r,a),{id:r,locked:!0}));this._locks.set(g),this.updateElements(C,!0)}unlockElements(n){if(!n?.length)return;const a=this._locks(),o=new Map(a),g=n.map(C=>(o.delete(C),{id:C,locked:!1}));this._locks.set(o),this.updateElements(g,!0)}toggleElementsLock(n){if(!n?.length)return;const a=[],o=[];n.forEach(g=>{const C=this.getElementById(g);C&&(C.locked?o.push(g):a.push(g))}),a.length>0&&this.lockElements(a),o.length>0&&this.unlockElements(o)}lockAllElements(){const n=this._elements().map(a=>a.id);this.lockElements(n)}unlockAllElements(){const n=this._elements().map(a=>a.id);this.unlockElements(n)}isElementLocked(n){return!!this.getElementById(n)?.locked}getLockedElementIds(){return this.lockedElements().map(n=>n.id)}getUnlockedElementIds(){return this.unlockedElements().map(n=>n.id)}moveToLayer(n,a,o=!1){if(!n?.length)return;const g=n.map(C=>({id:C,layerId:a}));this.updateElements(g,o)}getElementsByLayer(n){return this._elements().filter(a=>a.layerId===n)}getElementById(n){return this._elements().find(o=>o.id===n)||this._draftElements().find(o=>o.id===n)}getElementsByIds(n){const a=new Set(n);return this.allElements().filter(g=>a.has(g.id))}getElementsByType(n){return this._elements().filter(a=>a.type===n)}searchElements(n){let a=this._elements();if(n.type&&(a=a.filter(o=>o.type===n.type)),n.layerId&&(a=a.filter(o=>o.layerId===n.layerId)),void 0!==n.locked&&(a=a.filter(o=>!!o.locked===n.locked)),n.textContent){const o=n.textContent.toLowerCase();a=a.filter(g=>(g.text||g.content||"").toLowerCase().includes(o))}if(n.zIndexRange){const{min:o,max:g}=n.zIndexRange;a=a.filter(C=>{const r=C.zIndex||0;return r>=o&&r<=g})}return n.bounds&&(a=this.findElementsInBounds(n.bounds).filter(o=>a.some(g=>g.id===o.id))),a}findElementsByText(n){return this.searchElements({textContent:n})}getElementsInRadius(n,a,o){return this._elements().filter(g=>{const C=g.x-n,r=g.y-a;return Math.sqrt(C*C+r*r)<=o})}getNearestElement(n,a){const o=this._elements();if(0===o.length)return;let g=o[0],C=this.getDistanceToElement(n,a,g);for(let r=1;r<o.length;r++){const I=this.getDistanceToElement(n,a,o[r]);I<C&&(C=I,g=o[r])}return g}createSnapshot(){return{elements:[...this._elements()],draftElements:[...this._draftElements()],maxZIndex:this._maxZIndex(),timestamp:Date.now()}}restoreSnapshot(n){this._elements.set([...n.elements]),this._draftElements.set([...n.draftElements]),this._maxZIndex.set(n.maxZIndex)}findElementsInBounds(n){return this._elements().filter(a=>a.x<n.x+n.width&&a.x+(a.width||50)>n.x&&a.y<n.y+n.height&&a.y+(a.height||50)>n.y)}calculateElementsBounds(n){if(0===n.length)return null;const a=n.map(k.P),o=Math.min(...a.map(w=>w.minX)),g=Math.min(...a.map(w=>w.minY)),I=Math.max(...a.map(w=>w.maxX))-o,f=Math.max(...a.map(w=>w.maxY))-g;return{x:o,y:g,width:I,height:f,centerX:o+I/2,centerY:g+f/2}}getElementsCount(){return this.elementsCount()}getElementTypes(){return this.elementTypes()}normalizeZIndices(){const n=[...this._elements()].sort((o,g)=>(o.zIndex||0)-(g.zIndex||0)),a=n.map((o,g)=>({id:o.id,zIndex:g+1}));this._maxZIndex.set(n.length),this.updateElements(a,!0)}addElement(n){this.addElements([n])}updateElement(n,a=!1){this.updateElements([n],a)}removeElement(n,a=!1){this.removeElementsByIds([n.id],a)}elementExists(n){return void 0!==this.getElementById(n)}getElementsByZIndexRange(n,a){return this._elements().filter(o=>{const g=o.zIndex||0;return g>=n&&g<=a})}getElementsByProperty(n,a){return this._elements().filter(o=>o[n]===a)}lockElement(n){this.lockElements([n])}unlockElement(n){this.unlockElements([n])}toggleElementLock(n){this.toggleElementsLock([n])}getModifiableElements(){return this.unlockedElements()}hasLockedElementsInSelection(n){return n.some(a=>this.isElementLocked(a))}filterUnlockedElements(n){return n.filter(a=>!this.isElementLocked(a))}getModifiableElementsFromIds(n){const a=this.filterUnlockedElements(n);return this.getElementsByIds(a)}safeUpdateElements(n){const a=[],o=[],g=n.filter(C=>this.isElementLocked(C.id)?(a.push(C.id),!1):(o.push(C.id),!0));return g.length>0&&this.updateElements(g,!1),{updated:o,locked:a}}isLockOperation(n){return"locked"in n}updateMaxZIndex(n){const a=Math.max(...n.map(o=>o.zIndex||0));this._maxZIndex.update(o=>Math.max(o,a))}getDistanceToElement(n,a,o){const f=n-(o.x+(o.width||50)/2),w=a-(o.y+(o.height||50)/2);return Math.sqrt(f*f+w*w)}static{this.\u0275fac=function(a){return new(a||h)(e.KVO(i.W))}}static{this.\u0275prov=e.jDH({token:h,factory:h.\u0275fac,providedIn:"root"})}}return h})()},3437:($,F,y)=>{y.d(F,{a:()=>E});var S=y(4438),e=y(4289);let E=(()=>{class k{constructor(){this._layers=(0,S.vPA)([]),this._activeLayerId=(0,S.vPA)(""),this.layers=this._layers.asReadonly(),this.activeLayerId=this._activeLayerId.asReadonly(),this.activeLayer=(0,S.EWP)(()=>{const i=this._layers(),u=this._activeLayerId();return i.find(h=>h.id===u)||i[0]}),this.sortedLayers=(0,S.EWP)(()=>[...this._layers()].sort((i,u)=>i.zIndex-u.zIndex)),this.visibleLayers=(0,S.EWP)(()=>this._layers().filter(i=>i.visible)),this.unlockedLayers=(0,S.EWP)(()=>this._layers().filter(i=>!i.locked)),this.initializeDefaultLayer()}addLayer(i){const u=this._layers(),h=Math.max(...u.map(o=>o.zIndex),0)+1,m=u.length+1,n={id:this.generateLayerId(),name:i||`Layer ${m}`,visible:!0,locked:!1,zIndex:h,elements:[],opacity:1,blendMode:"normal"},a=u.map(o=>({...o,visible:!1}));return this._layers.set([...a,n]),this.setActiveLayer(n.id),n}removeLayer(i){const u=this._layers();if(u.length<=1)return console.warn("Cannot delete the last remaining layer"),!1;if(!u.find(n=>n.id===i))return console.warn(`Layer with id ${i} not found`),!1;const m=u.filter(n=>n.id!==i);if(this._layers.set(m),this._activeLayerId()===i){const n=m[Math.max(0,m.length-1)];this.setActiveLayer(n.id)}return!0}renameLayer(i,u){const h=this._layers(),m=h.findIndex(a=>a.id===i);if(-1===m)return console.warn(`Layer with id ${i} not found`),!1;if(h[m].locked)return console.warn(`Cannot rename locked layer: ${h[m].name}`),!1;const n=[...h];return n[m]={...n[m],name:u.trim()||`Layer ${m+1}`},this._layers.set(n),!0}reorderLayer(i,u){const h=this._layers(),m=h.findIndex(a=>a.id===i);if(-1===m)return console.warn(`Layer with id ${i} not found`),!1;if(h[m].locked)return console.warn(`Cannot reorder locked layer: ${h[m].name}`),!1;const n=[...h];return n[m]={...n[m],zIndex:u},this._layers.set(n),!0}moveLayerUp(i){const u=this.sortedLayers(),h=u.findIndex(a=>a.id===i);if(-1===h||h===u.length-1)return!1;const m=u[h];if(m.locked)return console.warn(`Cannot move locked layer: ${m.name}`),!1;const n=u[h+1];return this.reorderLayer(m.id,n.zIndex)&&this.reorderLayer(n.id,m.zIndex)}moveLayerDown(i){const u=this.sortedLayers(),h=u.findIndex(a=>a.id===i);if(-1===h||0===h)return!1;const m=u[h];if(m.locked)return console.warn(`Cannot move locked layer: ${m.name}`),!1;const n=u[h-1];return this.reorderLayer(m.id,n.zIndex)&&this.reorderLayer(n.id,m.zIndex)}reorderLayersByIndex(i,u){const h=this._layers();if(i===u)return!1;if(i<0||i>=h.length||u<0||u>=h.length)return console.warn("Invalid layer indices for reordering"),!1;const m=h[i];if(m.locked)return console.warn(`Cannot reorder locked layer: ${m.name}`),!1;const n=[...h];n.splice(i,1),n.splice(u,0,m);const a=n.map((o,g)=>({...o,zIndex:n.length-1-g}));return this._layers.set(a),!0}toggleLayerVisibility(i){return this.updateLayerProperty(i,"visible",u=>!u)}toggleLayerLock(i){return this._layers().find(m=>m.id===i)?this.updateLayerProperty(i,"locked",m=>!m):(console.warn(`Layer with id ${i} not found`),!1)}setLayerOpacity(i,u){const m=this._layers().find(a=>a.id===i);if(!m)return console.warn(`Layer with id ${i} not found`),!1;if(m.locked)return console.warn(`Cannot change opacity of locked layer: ${m.name}`),!1;const n=Math.max(0,Math.min(1,u));return this.updateLayerProperty(i,"opacity",()=>n)}setLayerBlendMode(i,u){const m=this._layers().find(a=>a.id===i);return m?m.locked?(console.warn(`Cannot change blend mode of locked layer: ${m.name}`),!1):e.B.map(a=>a.value).includes(u)?this.updateLayerProperty(i,"blendMode",()=>u):(console.warn(`Invalid blend mode: ${u}. Using 'normal' instead.`),this.updateLayerProperty(i,"blendMode",()=>"normal")):(console.warn(`Layer with id ${i} not found`),!1)}setActiveLayer(i){const u=this._layers();if(!u.find(n=>n.id===i))return console.warn(`Layer with id ${i} not found`),!1;const m=u.map(n=>({...n,visible:n.id===i}));return this._layers.set(m),this._activeLayerId.set(i),!0}getActiveLayerId(){return this._activeLayerId()}isActiveLayerValid(){const i=this.activeLayer();return!!i&&i.visible&&!i.locked}getActiveLayerIssues(){const i=this.activeLayer();if(!i)return["No active layer"];const u=[];return i.visible||u.push("Active layer is hidden"),i.locked&&u.push("Active layer is locked"),u}assignElementToActiveLayer(i){const u=this._activeLayerId();return this.assignElementToLayer(i,u)}assignElementToLayer(i,u){const h=this._layers(),m=h.findIndex(C=>C.id===u);if(-1===m)return console.warn(`Layer with id ${u} not found`),!1;if(h[m].locked)return console.warn(`Cannot assign elements to locked layer: ${h[m].name}`),!1;this.removeElementFromAllLayers(i);const n=this._layers(),a=n.findIndex(C=>C.id===u),o=[...n],g=[...o[a].elements];return g.includes(i)||(g.push(i),o[a]={...o[a],elements:g},this._layers.set(o)),!0}removeElementFromAllLayers(i){const h=this._layers().map(m=>({...m,elements:m.elements.filter(n=>n!==i)}));this._layers.set(h)}getElementLayer(i){return this._layers().find(h=>h.elements.includes(i))||null}getVisibleElements(i){const u=this.visibleLayers(),h=new Set(u.flatMap(m=>m.elements));return i.filter(m=>h.has(m.id))}getEditableElements(i){const u=this.unlockedLayers(),h=new Set(u.flatMap(m=>m.elements));return i.filter(m=>h.has(m.id))}getSortedElements(i){const u=this.sortedLayers(),h=new Map;return u.forEach(m=>{m.elements.forEach(n=>{h.set(n,m.zIndex)})}),i.sort((m,n)=>(h.get(m.id)??0)-(h.get(n.id)??0))}exportLayerState(){return{layers:this._layers(),activeLayerId:this._activeLayerId()}}importLayerState(i){if(!i.layers||0===i.layers.length)return console.warn("Invalid layer state provided"),void this.initializeDefaultLayer();this._layers.set(i.layers);const u=i.layers.find(h=>h.id===i.activeLayerId);this._activeLayerId.set(u?i.activeLayerId:i.layers[0].id)}reset(){this.initializeDefaultLayer()}initializeDefaultLayer(){const i={id:"default",name:"Layer 1",visible:!0,locked:!1,zIndex:0,elements:[],opacity:1,blendMode:"normal"};this._layers.set([i]),this._activeLayerId.set(i.id)}generateLayerId(){return`layer-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}updateLayerProperty(i,u,h){const m=this._layers(),n=m.findIndex(g=>g.id===i);if(-1===n)return console.warn(`Layer with id ${i} not found`),!1;const a=[...m];return a[n]={...a[n],[u]:h(a[n][u])},this._layers.set(a),!0}static{this.\u0275fac=function(u){return new(u||k)}}static{this.\u0275prov=S.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}}return k})()},1152:($,F,y)=>{y.d(F,{A:()=>o});var S=y(4438),e=y(872),E=y(6078),k=y(162),D=y(9820),i=y(2500),u=y(8936),h=y(3909),m=y(6255),n=y(3312),a=y(525);let o=(()=>{class g{constructor(r,I,f,w,O){this.eventBus=r,this.clipboardService=I,this.elementsService=f,this.toolsService=w,this.canvasService=O,this.OFFSET_INCREMENT=20,this.selectedElementIdsSignal=(0,S.vPA)(new Set),this.selectionBoxSignal=(0,S.vPA)({x:0,y:0,width:0,height:0,visible:!1}),this.boundingBoxSignal=(0,S.vPA)(null),this.selectedIdsSignal=(0,S.EWP)(()=>Array.from(this.selectedElementIdsSignal())),this.hasSelectionSignal=(0,S.EWP)(()=>this.selectedElementIdsSignal().size>0),this.initializeDataProviders()}initializeDataProviders(){this.getElementsFn=()=>this.elementsService.getElements(),this.updateElementsFn=r=>this.elementsService.updateElements(r),this.removeElementsFn=(r,I)=>this.elementsService.removeElements(r,I)}cutElements(){const r=this.getSelectedElements();0!==r.length&&(this.clipboardService.cut(r),this.deleteSelectedElements())}copyElements(){const r=this.getSelectedElements();0!==r.length&&this.clipboardService.copy(r)}pasteElements(){const r=this.clipboardService.paste();r.length>0&&this.selectElements(r)}duplicateElements(){const r=this.getSelectedElements();if(0===r.length)return;const I=this.clipboardService.duplicateElements(r);I.length>0&&this.selectElements(I)}deleteSelectedElements(){const r=this.getSelectedElements();0===r.length||!this.removeElementsFn||(this.removeElementsFn(r,!0),this.clearSelection(),this.eventBus.emit(k.w.ElementsRemoved,r),this.eventBus.emit(k.w.DataChange,this.elementsService.getElements()))}getSelectedIds(){return this.selectedIdsSignal()}getSelectedElements(){if(!this.getElementsFn)return console.warn("Element data provider not set"),[];const r=this.getSelectedIds();return this.getElementsFn().filter(I=>r.includes(I.id))}getSelectedElementsSignal(){return(0,S.EWP)(()=>this.getSelectedElements())}isSelected(r){const I="string"==typeof r?r:r.id;return this.selectedElementIdsSignal().has(I)}getSelectionCount(){return this.selectedElementIdsSignal().size}hasSelection(){return this.getSelectionCount()>0}selectElements(r,I=!1){const w=(Array.isArray(r)?r:[r]).map(B=>"string"==typeof B?B:B.id),O=this.expandSelectionToIncludeGroups(w),l=Array.from(this.selectedElementIdsSignal()),b=I?[...new Set([...l,...O])]:O;this.selectedElementIdsSignal.set(new Set(b)),b.length>0&&this.toolsService.setActiveTool(e.p.Select);const T=this.getSelectedElements();this.updateBoundingBoxFromElements(T),this.eventBus.emit(k.w.ElementsSelected,T)}deselectElement(r){const I="string"==typeof r?r:r.id,f=new Set(this.selectedElementIdsSignal());if(f.has(I)){this.expandSelectionToIncludeGroups([I]).forEach(l=>{f.delete(l)}),this.selectedElementIdsSignal.set(f),this.updateBoundingBox();const O=this.getSelectedElements();this.eventBus.emit(k.w.ElementsSelected,O)}}toggleSelection(r){const I="string"==typeof r?r:r.id,f=new Set(this.selectedElementIdsSignal()),w=f.has(I),O=this.expandSelectionToIncludeGroups([I]);w?O.forEach(b=>{f.delete(b)}):(O.forEach(b=>{f.add(b)}),this.toolsService.setActiveTool(e.p.Select)),this.selectedElementIdsSignal.set(f),this.updateBoundingBox();const l=this.getSelectedElements();this.eventBus.emit(k.w.ElementsSelected,l)}clearSelection(){this.selectedElementIdsSignal.set(new Set),this.clearBoundingBox(),this.eventBus.emit(k.w.ElementsSelected,[])}selectAll(){if(!this.getElementsFn)return void console.warn("Element data provider not set");const r=this.getElementsFn(),I=new Set(r.map(f=>f.id));this.selectedElementIdsSignal.set(I),r.length>0&&this.toolsService.setActiveTool(e.p.Select),this.updateBoundingBox(),this.eventBus.emit(k.w.ElementsSelected,r)}selectElementsInArea(r){if(!this.getElementsFn)return void console.warn("Element data provider not set");const I=this.getElementsFn(),f=[];I.forEach(w=>{const O=(0,D.P)(w);!(O.maxX<r.x||O.minX>r.x+r.width||O.maxY<r.y||O.minY>r.y+r.height)&&f.push(w.id)}),f.length>0&&this.selectElements(f)}setSelectionBox(r){this.selectionBoxSignal.set(r)}getSelectionBox(){return this.selectionBoxSignal()}getSelectionBoxSignal(){return this.selectionBoxSignal.asReadonly()}clearSelectionBox(){this.selectionBoxSignal.set({x:0,y:0,width:0,height:0,visible:!1})}updateBoundingBox(){const r=this.getSelectedElements();this.updateBoundingBoxFromElements(r)}getBoundingBox(){return this.boundingBoxSignal()}getBoundingBoxSignal(){return this.boundingBoxSignal.asReadonly()}clearBoundingBox(){this.boundingBoxSignal.set(null)}setBoundingBox(r){this.boundingBoxSignal.set(r)}expandSelectionToIncludeGroups(r){if(!this.getElementsFn)return r;const I=this.getElementsFn(),f=I.filter(l=>r.includes(l.id)),w=new Set(f.map(l=>l.groupId).filter(l=>null!=l));return 0===w.size?r:I.filter(l=>r.includes(l.id)||l.groupId&&w.has(l.groupId)).map(l=>l.id)}calculateBoundingBox(r){let I,f=0;if(1===r.length){const R=r[0];f=R.rotation||0,I=(0,D.P)(R)}else{const R=(0,i.L)(r);if(!R)throw new Error("Cannot calculate bounding box for empty element list");I=R,f=0}const{minX:w,minY:O,maxX:l,maxY:b,width:T,height:B}=I;return{x:w,y:O,width:T,height:B,handles:{topLeft:{x:w,y:O},topRight:{x:l,y:O},bottomLeft:{x:w,y:b},bottomRight:{x:l,y:b},rotateHandle:{x:w+T/2,y:O-20}},rotation:f}}updateBoundingBoxFromElements(r){r&&0!==r.length?this.boundingBoxSignal.set(this.calculateBoundingBox(r)):this.clearBoundingBox()}updateSelectedElements(r,I){const f=this.getSelectedElements();if(0===f.length)return;const w=I||this.updateElementsFn;if(!w)return;w(f.map(b=>({...r,id:b.id})),!0),this.updateBoundingBox();const l=this.getSelectedElements();this.eventBus.emit(k.w.ElementsSelected,l)}transformSelectedElements(r,I){const f=this.getSelectedElements();if(0===f.length)return;const w=I||this.updateElementsFn;if(!w)return;w(r(f).map(T=>({...T,id:T.id})),!0),this.updateBoundingBox();const b=this.getSelectedElements();this.eventBus.emit(k.w.ElementsSelected,b)}getSelectionBounds(){const r=this.getSelectedElements();if(0===r.length)return null;const I=r.map(D.P);return{minX:Math.min(...I.map(f=>f.minX)),minY:Math.min(...I.map(f=>f.minY)),maxX:Math.max(...I.map(f=>f.maxX)),maxY:Math.max(...I.map(f=>f.maxY))}}selectionContainsType(r){return this.getSelectedElements().some(I=>I.type===r)}getSelectedElementTypes(){const r=this.getSelectedElements().map(I=>I.type);return[...new Set(r)]}removeSelectedElements(){const r=this.getSelectedElements();0!==r.length&&this.removeElementsFn&&(this.removeElementsFn(r,!0),this.clearSelection())}bringToFront(){const r=this.getSelectedElements();if(0===r.length||!this.getElementsFn||!this.updateElementsFn)return;const I=this.getElementsFn(),f=Math.max(...I.map(O=>O.zIndex||0)),w=r.map((O,l)=>({id:O.id,zIndex:f+l+1}));this.updateElementsFn(w)}bringForward(){const r=this.getSelectedElements();if(0===r.length||!this.getElementsFn||!this.updateElementsFn)return;const f=[...this.getElementsFn()].sort((O,l)=>(O.zIndex||0)-(l.zIndex||0)),w=[];r.forEach(O=>{let b=f.findIndex(T=>T.id===O.id)+1;for(;b<f.length&&r.some(T=>T.id===f[b].id);)b++;if(b<f.length){const T=f[b];w.push({id:O.id,zIndex:T.zIndex}),w.push({id:T.id,zIndex:O.zIndex})}}),w.length>0&&this.updateElementsFn(w)}sendBackward(){const r=this.getSelectedElements();if(0===r.length||!this.getElementsFn||!this.updateElementsFn)return;const f=[...this.getElementsFn()].sort((O,l)=>(O.zIndex||0)-(l.zIndex||0)),w=[];r.forEach(O=>{let b=f.findIndex(T=>T.id===O.id)-1;for(;b>=0&&r.some(T=>T.id===f[b].id);)b--;if(b>=0){const T=f[b];w.push({id:O.id,zIndex:T.zIndex}),w.push({id:T.id,zIndex:O.zIndex})}}),w.length>0&&this.updateElementsFn(w)}sendToBack(){const r=this.getSelectedElements();if(0===r.length||!this.getElementsFn||!this.updateElementsFn)return;const I=r.map((l,b)=>({id:l.id,zIndex:b+1}));this.updateElementsFn(I);const O=this.getElementsFn().filter(l=>!r.some(b=>b.id===l.id)).map((l,b)=>({id:l.id,zIndex:r.length+b+1}));O.length>0&&this.updateElementsFn(O)}groupSelectedElements(){const r=this.getSelectedElements();if(r.length<2||!this.updateElementsFn)return;const I=`group_${Date.now()}`,f=r.map(w=>({id:w.id,groupId:I}));this.updateElementsFn(f)}ungroupSelectedElements(){const r=this.getSelectedElements();if(0===r.length||!this.getElementsFn||!this.updateElementsFn)return;const I=r.filter(b=>null!=b.groupId);if(0===I.length)return;const f=[...new Set(I.map(b=>b.groupId).filter(Boolean))],l=this.getElementsFn().filter(b=>null!=b.groupId&&f.includes(b.groupId)).map(b=>({id:b.id,groupId:void 0}));this.updateElementsFn(l)}lockElements(){const r=this.getSelectedElements();if(0===r.length||!this.updateElementsFn)return;const I=r.map(f=>({id:f.id,locked:!0}));this.updateElementsFn(I)}unlockElements(){const r=this.getSelectedElements();if(0===r.length||!this.updateElementsFn)return;const I=r.map(f=>({id:f.id,locked:!1}));this.updateElementsFn(I)}alignElements(r){const I=this.getSelectedElements();if(0===I.length)return;if(!this.updateElementsFn)return void console.warn("Update elements function not available");const f=this.calculateAlignmentUpdates(I,r);f.length>0&&(this.updateElementsFn(f,!0),this.updateBoundingBox())}distributeHorizontally(){this.alignElements(E.Yu.DistributeHorizontally)}distributeVertically(){this.alignElements(E.Yu.DistributeVertically)}calculateAlignmentUpdates(r,I){if(0===r.length)return[];const f=[],w=r.map(O=>({element:O,bounds:(0,D.P)(O)}));if(1===r.length){const O=this.canvasService.getVisibleBounds(),l=w[0].bounds,b=w[0].element;switch(I){case E.Yu.Left:{const T=O.left-l.minX;0!==T&&f.push({id:b.id,x:b.x+T});break}case E.Yu.Center:{const P=(O.left+O.right)/2-(l.minX+l.width/2);0!==P&&f.push({id:b.id,x:b.x+P});break}case E.Yu.Right:{const T=O.right-l.maxX;0!==T&&f.push({id:b.id,x:b.x+T});break}case E.Yu.Top:{const T=O.top-l.minY;0!==T&&f.push({id:b.id,y:b.y+T});break}case E.Yu.Middle:{const P=(O.top+O.bottom)/2-(l.minY+l.height/2);0!==P&&f.push({id:b.id,y:b.y+P});break}case E.Yu.Bottom:{const T=O.bottom-l.maxY;0!==T&&f.push({id:b.id,y:b.y+T});break}default:return console.warn("Unsupported alignment type for single element:",I),[]}return f}switch(I){case E.Yu.Left:{const O=Math.min(...w.map(l=>l.bounds.minX));w.forEach(({element:l,bounds:b})=>{const T=O-b.minX;0!==T&&f.push({id:l.id,x:l.x+T})});break}case E.Yu.Center:{const O=w.reduce((l,b)=>l+(b.bounds.minX+b.bounds.width/2),0)/w.length;w.forEach(({element:l,bounds:b})=>{const B=O-(b.minX+b.width/2);0!==B&&f.push({id:l.id,x:l.x+B})});break}case E.Yu.Right:{const O=Math.max(...w.map(l=>l.bounds.maxX));w.forEach(({element:l,bounds:b})=>{const T=O-b.maxX;0!==T&&f.push({id:l.id,x:l.x+T})});break}case E.Yu.Top:{const O=Math.min(...w.map(l=>l.bounds.minY));w.forEach(({element:l,bounds:b})=>{const T=O-b.minY;0!==T&&f.push({id:l.id,y:l.y+T})});break}case E.Yu.Middle:{const O=w.reduce((l,b)=>l+(b.bounds.minY+b.bounds.height/2),0)/w.length;w.forEach(({element:l,bounds:b})=>{const B=O-(b.minY+b.height/2);0!==B&&f.push({id:l.id,y:l.y+B})});break}case E.Yu.Bottom:{const O=Math.max(...w.map(l=>l.bounds.maxY));w.forEach(({element:l,bounds:b})=>{const T=O-b.maxY;0!==T&&f.push({id:l.id,y:l.y+T})});break}case E.Yu.DistributeHorizontally:{if(r.length<3)return[];const O=w.sort((N,A)=>N.bounds.minX-A.bounds.minX),l=O[0].bounds.minX,c=(O[O.length-1].bounds.maxX-l-O.reduce((N,A)=>N+A.bounds.width,0))/(O.length-1);let R=l;O.forEach(({element:N,bounds:A},d)=>{if(0===d)R+=A.width;else{if(d===O.length-1)return;{R+=c;const M=R-A.minX;0!==M&&f.push({id:N.id,x:N.x+M}),R+=A.width}}});break}case E.Yu.DistributeVertically:{if(r.length<3)return[];const O=w.sort((N,A)=>N.bounds.minY-A.bounds.minY),l=O[0].bounds.minY,c=(O[O.length-1].bounds.maxY-l-O.reduce((N,A)=>N+A.bounds.height,0))/(O.length-1);let R=l;O.forEach(({element:N,bounds:A},d)=>{if(0===d)R+=A.height;else{if(d===O.length-1)return;{R+=c;const M=R-A.minY;0!==M&&f.push({id:N.id,y:N.y+M}),R+=A.height}}});break}default:return console.warn("Unsupported alignment type:",I),[]}return f}flipHorizontal(){const r=this.getSelectedElements();if(0===r.length||!this.updateElementsFn)return;const I=r.map(f=>({id:f.id,scaleX:-(f.scaleX??1)}));this.updateElementsFn(I,!0),this.updateBoundingBox()}flipVertical(){const r=this.getSelectedElements();if(0===r.length||!this.updateElementsFn)return;const I=r.map(f=>({id:f.id,scaleY:-(f.scaleY??1)}));this.updateElementsFn(I,!0),this.updateBoundingBox()}moveSelectedElements(r,I){const f=this.getSelectedElements();if(0===f.length||!this.updateElementsFn)return;const w=f.map(O=>({id:O.id,x:O.x+r,y:O.y+I}));this.updateElementsFn(w,!0),this.updateBoundingBox()}rotateSelectedElements(r){const I=this.getSelectedElements();if(0===I.length||!this.updateElementsFn)return;const f=I.map(w=>({id:w.id,rotation:(w.rotation||0)+r}));this.updateElementsFn(f,!0),this.updateBoundingBox()}scaleSelectedElements(r){const I=this.getSelectedElements();if(0===I.length||!this.updateElementsFn)return;const f=I.map(w=>{const O={id:w.id};return"width"in w&&void 0!==w.width&&(O.width=w.width*r),"height"in w&&void 0!==w.height&&(O.height=w.height*r),void 0!==w.style?.strokeWidth&&(O.style={...w.style,strokeWidth:w.style.strokeWidth*r}),"rx"in w&&void 0!==w.rx&&(O.rx=w.rx*r),"ry"in w&&void 0!==w.ry&&(O.ry=w.ry*r),O}).filter(w=>Object.keys(w).length>1);f.length>0&&(this.updateElementsFn(f,!0),this.updateBoundingBox())}static{this.\u0275fac=function(I){return new(I||g)(S.KVO(u.W),S.KVO(h.W),S.KVO(m.L),S.KVO(n.H),S.KVO(a.W))}}static{this.\u0275prov=S.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},8936:($,F,y)=>{y.d(F,{W:()=>o});var S=y(4438),e=y(1413),E=y(5964),k=y(6354),D=y(152),i=y(3669),u=y(9974),h=y(4360);function n(g,C){return g===C}var a=y(162);let o=(()=>{class g{constructor(){this.eventSubject=new e.B,this.eventSignals={[a.w.Ready]:(0,S.vPA)(void 0),[a.w.Destroyed]:(0,S.vPA)(void 0),[a.w.DrawStart]:(0,S.vPA)(void 0),[a.w.Drawing]:(0,S.vPA)(void 0),[a.w.DrawEnd]:(0,S.vPA)(void 0),[a.w.ElementsAdded]:(0,S.vPA)(void 0),[a.w.ElementsUpdated]:(0,S.vPA)(void 0),[a.w.ElementsSelected]:(0,S.vPA)(void 0),[a.w.ElementsRemoved]:(0,S.vPA)(void 0),[a.w.ElementDoubleClicked]:(0,S.vPA)(void 0),[a.w.Undo]:(0,S.vPA)(void 0),[a.w.Redo]:(0,S.vPA)(void 0),[a.w.Clear]:(0,S.vPA)(void 0),[a.w.DataChange]:(0,S.vPA)(void 0),[a.w.Save]:(0,S.vPA)(void 0),[a.w.ImageAdded]:(0,S.vPA)(void 0),[a.w.ToolChange]:(0,S.vPA)(void 0),[a.w.ConfigChange]:(0,S.vPA)(void 0),[a.w.ZoomChange]:(0,S.vPA)(void 0)},this.lastEventInternal=(0,S.vPA)(void 0),this.lastEvent=this.lastEventInternal.asReadonly(),this.defaultDebounceConfigs={[a.w.ElementsAdded]:{debounceTime:100,distinctUntilChanged:!0},[a.w.Drawing]:{debounceTime:16,distinctUntilChanged:!1}}}ngOnDestroy(){this.destroy()}emit(r,I){const f={type:r,payload:I,timestamp:Date.now()};this.eventSubject.next(f),(0,S.O8t)(()=>{this.eventSignals[r].set(f.payload),this.lastEventInternal.set(f)})}listen(){return this.eventSubject.asObservable()}getEventSignal(r){return this.eventSignals[r].asReadonly()}getAllEventsSignal(){return this.lastEvent}on(r,I){let f=this.eventSubject.pipe((0,E.p)(O=>O.type===r),(0,k.T)(O=>O.payload));const w=I||this.defaultDebounceConfigs[r];return w?(w.debounceTime>0&&(f=f.pipe((0,D.B)(w.debounceTime))),w.distinctUntilChanged&&(f=f.pipe(function m(g,C=i.D){return g=g??n,(0,u.N)((r,I)=>{let f,w=!0;r.subscribe((0,h._)(I,O=>{const l=C(O);(w||!g(f,l))&&(w=!1,f=l,I.next(O))}))})}(w.comparator))),f):f}listenToMultiple(r){return this.eventSubject.pipe((0,E.p)(I=>r.includes(I.type)),(0,k.T)(I=>({type:I.type,payload:I.payload,timestamp:I.timestamp})))}destroy(){this.eventSubject.complete()}static{this.\u0275fac=function(I){return new(I||g)}}static{this.\u0275prov=S.jDH({token:g,factory:g.\u0275fac,providedIn:"root"})}}return g})()},875:($,F,y)=>{y.d(F,{k:()=>e});var S=y(4438);let e=(()=>{class E{constructor(){this.undoStack=[],this.redoStack=[],this.MAX_HISTORY=50,this.canUndoSignal=(0,S.vPA)(!1),this.canRedoSignal=(0,S.vPA)(!1),this.undoDescriptionSignal=(0,S.vPA)(void 0),this.redoDescriptionSignal=(0,S.vPA)(void 0),this.batching=!1,this.batchDepth=0,this.batchBeforeSnapshot=null,this.batchDescription="Batch operation",this.pendingBatchAfter=null}getCanUndoSignal(){return this.canUndoSignal.asReadonly()}getCanRedoSignal(){return this.canRedoSignal.asReadonly()}getUndoDescriptionSignal(){return this.undoDescriptionSignal.asReadonly()}getRedoDescriptionSignal(){return this.redoDescriptionSignal.asReadonly()}recordChange(D,i,u){this.batching||this.snapshotsEqual(D,i)||this.pushHistory({before:this.cloneElements(D),after:this.cloneElements(i),description:u,timestamp:Date.now()})}recordElementCreation(D,i){this.recordChange(D,i,"Create element")}recordElementUpdate(D,i){this.recordChange(D,i,"Update element")}recordElementDeletion(D,i){this.recordChange(D,i,"Delete element")}recordClear(D,i){this.recordChange(D,i,"Clear whiteboard")}startBatch(D,i){return 0===this.batchDepth&&(this.batchBeforeSnapshot=this.cloneElements(i),this.batchDescription=D,this.batching=!0),this.batchDepth++,{execute:()=>this.finishBatchCommit(),clear:()=>this.cancelBatch()}}completeBatch(D){this.batching&&(this.pendingBatchAfter=this.cloneElements(D))}finishBatchCommit(){if(this.batchDepth=Math.max(0,this.batchDepth-1),this.batchDepth>0)return;if(!this.batching||!this.batchBeforeSnapshot)return void this.resetBatchState();const D=this.pendingBatchAfter??this.batchBeforeSnapshot;this.snapshotsEqual(this.batchBeforeSnapshot,D)||this.pushHistory({before:this.batchBeforeSnapshot,after:D,description:this.batchDescription,timestamp:Date.now()}),this.resetBatchState()}cancelBatch(){this.batchDepth=0,this.resetBatchState()}resetBatchState(){this.batching=!1,this.batchBeforeSnapshot=null,this.batchDescription="Batch operation"}undo(){return this.performUndo()}redo(){return this.performRedo()}clearHistory(){this.undoStack=[],this.redoStack=[],this.updateSignals()}performUndo(){if(0===this.undoStack.length)return null;const D=this.undoStack.pop();return D?(this.redoStack.push(D),this.updateSignals(),this.cloneElements(D.before)):null}performRedo(){if(0===this.redoStack.length)return null;const D=this.redoStack.pop();return D?(this.undoStack.push(D),this.updateSignals(),this.cloneElements(D.after)):null}pushHistory(D){this.undoStack.push(D),this.undoStack.length>this.MAX_HISTORY&&this.undoStack.shift(),this.redoStack=[],this.updateSignals()}updateSignals(){this.canUndoSignal.set(this.undoStack.length>0),this.canRedoSignal.set(this.redoStack.length>0),this.undoDescriptionSignal.set(this.undoStack[this.undoStack.length-1]?.description),this.redoDescriptionSignal.set(this.redoStack[this.redoStack.length-1]?.description)}cloneElements(D){return D.map(i=>{const u={...i},h=i.points;return Array.isArray(h)&&(u.points=h.map(m=>[...m])),u})}snapshotsEqual(D,i){if(D.length!==i.length)return!1;const u=new Map(D.map(h=>[h.id,h]));for(const h of i){const m=u.get(h.id);if(!m||JSON.stringify(m)!==JSON.stringify(h))return!1}return!0}static{this.\u0275fac=function(i){return new(i||E)}}static{this.\u0275prov=S.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()},3909:($,F,y)=>{y.d(F,{W:()=>E});var S=y(4438),e=y(6255);let E=(()=>{class k{constructor(i){this.elementsService=i,this.CLIPBOARD_KEY="whiteboard-clipboard",this.OFFSET_INCREMENT=20}copy(i){if(0===i.length)return;const u={elements:i,timestamp:Date.now()};try{localStorage.setItem(this.CLIPBOARD_KEY,JSON.stringify(u))}catch(h){console.error("Failed to copy elements to clipboard:",h)}}cut(i){this.copy(i)}paste(){const i=this.getData();if(!i?.elements.length)return[];const u=this.duplicateElementsWithOffset(i.elements,this.OFFSET_INCREMENT,this.OFFSET_INCREMENT);return this.elementsService.addElements(u),u}clear(){try{localStorage.removeItem(this.CLIPBOARD_KEY)}catch(i){console.error("Failed to clear clipboard:",i)}}hasData(){const i=this.getData();return null!==i&&i.elements.length>0}getData(){try{const i=localStorage.getItem(this.CLIPBOARD_KEY);return i?JSON.parse(i):null}catch(i){return console.error("Failed to read clipboard data:",i),null}}duplicateElements(i,u=this.OFFSET_INCREMENT,h=this.OFFSET_INCREMENT){if(0===i.length)return[];const m=this.duplicateElementsWithOffset(i,u,h);return this.elementsService.addElements(m),m}createDuplicates(i,u=this.OFFSET_INCREMENT,h=this.OFFSET_INCREMENT){return this.duplicateElementsWithOffset(i,u,h)}getClipboardInfo(){const i=this.getData();return i?{elementCount:i.elements.length,timestamp:i.timestamp}:null}isDataFresh(i=3e5){const u=this.getData();return!!u&&Date.now()-u.timestamp<=i}getClipboardElementTypes(){const i=this.getData();if(!i)return[];const u=i.elements.map(h=>h.type);return[...new Set(u)]}duplicateElementsWithOffset(i,u,h){return i.map(m=>({...m,id:`${m.id}_copy_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x:m.x+u,y:m.y+h}))}static{this.\u0275fac=function(u){return new(u||k)(S.KVO(e.L))}}static{this.\u0275prov=S.jDH({token:k,factory:k.\u0275fac,providedIn:"root"})}}return k})()},1389:($,F,y)=>{y.d(F,{q:()=>O});var S=y(4523),e=y(2173),E=y(2262),k=y(6078),D=y(162),n=y(4438),a=y(6255),o=y(525),g=y(4764),C=y(710),r=y(8936),I=y(1152),f=y(3437),w=y(7785);let O=(()=>{class l{constructor(T,B,P,c,R,N,A,d){this.elementsService=T,this.canvasService=B,this.zoomService=P,this.panService=c,this.eventBusService=R,this.selectionService=N,this.layerManagementService=A,this.configService=d}addImage(T){const B=new Image;B.onload=()=>{const{canvasHeight:P}=this.canvasService.getConfig(),R=B.height,A=R>P?P-40:R;let M=T.x||0,x=T.y||0;M<0&&(M=0),x<0&&(x=0);const L=(0,e.n)(E.R.Image,{src:T.image,width:A===P-40?B.width/B.height*(P-40):B.width,height:A,x:M,y:x,zIndex:this.elementsService.getNextZIndex()});this.elementsService.addElements([L]),L.selectAfterDraw&&this.selectionService.selectElements([L.id]),this.eventBusService.emit(D.w.ImageAdded,L.src)},B.onerror=()=>{console.error("Failed to load image")},B.src=T.image}importImageFile(T,B,P){return new Promise((c,R)=>{if(!T.type.startsWith("image/"))return void R(new Error("Invalid file type. Only images are supported."));const N=new FileReader;N.onload=A=>{const d=A.target?.result;d?(this.addImage({image:d,x:B,y:P}),c()):R(new Error("Failed to read file"))},N.onerror=()=>{R(new Error("Failed to read file"))},N.readAsDataURL(T)})}importImageFromUrl(T,B,P){var c=this;return(0,S.A)(function*(){try{const N=yield(yield fetch(T)).blob();return new Promise((A,d)=>{const M=new FileReader;M.onload=x=>{const L=x.target?.result;L?(c.addImage({image:L,x:B,y:P}),A()):d(new Error("Failed to process URL"))},M.onerror=()=>{d(new Error("Failed to process URL"))},M.readAsDataURL(N)})}catch(R){throw new Error(`Failed to load image from URL: ${R}`)}})()}save(T=k.o8.Base64,B="New board"){var P=this;return(0,S.A)(function*(){const R=P.canvasService.getCanvas().getElementById("svgcontent");if(!R)throw new Error("SVG content not found");const N=P.prepareSvgForExport(R),A=(new XMLSerializer).serializeToString(N),{canvasWidth:d,canvasHeight:M}=P.canvasService.getConfig();try{const x=yield function m(l,b,T,B=k.o8.Png){return new Promise((P,c)=>{const R=document.createElement("canvas");R.width=b,R.height=T;const N=R.getContext("2d"),A=new Image,d=encodeURIComponent(l);A.src=`data:image/svg+xml;charset=utf-8,${d}`,A.onload=()=>{N.drawImage(A,0,0,b,T);const M=R.toDataURL(`image/${B}`);P(M)},A.onerror=M=>{c(M)}})}(A,d,M,T);switch(T){case k.o8.Base64:P.eventBusService.emit(D.w.Save,x);break;case k.o8.Svg:{const L="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(A)));P.downloadFile(L,B,"svg"),P.eventBusService.emit(D.w.Save,L);break}default:P.downloadFile(x,B,P.getFileExtension(T)),P.eventBusService.emit(D.w.Save,x)}return x}catch(x){throw console.error("Failed to save whiteboard:",x),x}})()}exportAsPng(T="whiteboard"){var B=this;return(0,S.A)(function*(){return B.save(k.o8.Png,T)})()}exportAsJpeg(T="whiteboard"){var B=this;return(0,S.A)(function*(){return B.save(k.o8.Jpeg,T)})()}exportAsSvg(T="whiteboard"){var B=this;return(0,S.A)(function*(){return B.save(k.o8.Svg,T)})()}exportAsBase64(){var T=this;return(0,S.A)(function*(){return T.save(k.o8.Base64)})()}exportData(){const T=this.elementsService.getElements(),B=this.canvasService.getConfig(),P=this.layerManagementService.exportLayerState(),c=this.configService.getEditorConfig(),R={version:"1.0",timestamp:(new Date).toISOString(),elements:T,layers:P,canvas:{width:B.canvasWidth,height:B.canvasHeight,backgroundColor:B.backgroundColor,fullScreen:B.fullScreen,center:B.center},viewport:{zoom:B.zoom,x:B.x,y:B.y,canvasX:B.canvasX,canvasY:B.canvasY},drawing:{strokeColor:B.strokeColor,strokeWidth:B.strokeWidth,fill:B.fill,lineJoin:B.lineJoin,lineCap:B.lineCap,dasharray:B.dasharray,dashoffset:B.dashoffset,penType:B.penType},grid:{enabled:B.enableGrid,size:B.gridSize,snapToGrid:B.snapToGrid},text:{fontFamily:B.fontFamily,fontSize:B.fontSize},editor:c,settings:{drawingEnabled:B.drawingEnabled,keyboardShortcutsEnabled:B.keyboardShortcutsEnabled}};return JSON.stringify(R,null,2)}exportDataAsFile(T="whiteboard-export"){const B=this.exportData(),P="data:application/json;charset=utf-8,"+encodeURIComponent(B);this.downloadFile(P,T,"json"),this.eventBusService.emit(D.w.Save,B)}importData(T){try{const B=JSON.parse(T);if(!B.elements||!Array.isArray(B.elements))throw new Error("Invalid data format: elements array not found");if(this.elementsService.clear(),B.layers&&this.layerManagementService.importLayerState(B.layers),this.elementsService.setElements(B.elements),B.canvas){const{canvas:P}=B;P.width&&P.height&&this.canvasService.setCanvasDimensions(P.width,P.height),void 0!==P.backgroundColor&&this.configService.updateConfig({backgroundColor:P.backgroundColor},!1),void 0!==P.fullScreen&&this.configService.updateConfig({fullScreen:P.fullScreen},!1),void 0!==P.center&&this.configService.updateConfig({center:P.center},!1)}if(B.viewport){const{viewport:P}=B;void 0!==P.zoom&&this.zoomService.zoom(P.zoom),void 0!==P.x&&void 0!==P.y&&this.panService.panTo(P.x,P.y),void 0!==P.canvasX&&void 0!==P.canvasY&&this.configService.updateConfig({canvasX:P.canvasX,canvasY:P.canvasY},!1)}if(B.drawing){const{drawing:P}=B,c={};void 0!==P.strokeColor&&(c.strokeColor=P.strokeColor),void 0!==P.strokeWidth&&(c.strokeWidth=P.strokeWidth),void 0!==P.fill&&(c.fill=P.fill),void 0!==P.lineJoin&&(c.lineJoin=P.lineJoin),void 0!==P.lineCap&&(c.lineCap=P.lineCap),void 0!==P.dasharray&&(c.dasharray=P.dasharray),void 0!==P.dashoffset&&(c.dashoffset=P.dashoffset),void 0!==P.penType&&(c.penType=P.penType),this.configService.updateConfig(c,!1)}if(B.grid){const{grid:P}=B,c={};void 0!==P.enabled&&(c.enableGrid=P.enabled),void 0!==P.size&&(c.gridSize=P.size),void 0!==P.snapToGrid&&(c.snapToGrid=P.snapToGrid),this.configService.updateConfig(c,!1)}if(B.text){const{text:P}=B,c={};void 0!==P.fontFamily&&(c.fontFamily=P.fontFamily),void 0!==P.fontSize&&(c.fontSize=P.fontSize),this.configService.updateConfig(c,!1)}if(B.editor&&Object.keys(B.editor).forEach(c=>{this.configService.updateEditorConfigValue(c,B.editor[c])}),B.settings){const{settings:P}=B,c={};void 0!==P.drawingEnabled&&(c.drawingEnabled=P.drawingEnabled),void 0!==P.keyboardShortcutsEnabled&&(c.keyboardShortcutsEnabled=P.keyboardShortcutsEnabled),this.configService.updateConfig(c,!1)}this.configService.updateConfig({},!0),this.eventBusService.emit(D.w.ElementsAdded,B.elements)}catch(B){throw console.error("Failed to import data:",B),new Error(`Failed to import data: ${B}`)}}importDataFromFile(T){return new Promise((B,P)=>{if(!T.type.includes("json"))return void P(new Error("Invalid file type. Only JSON files are supported."));const c=new FileReader;c.onload=R=>{const N=R.target?.result;if(N&&"string"==typeof N)try{this.importData(N),B()}catch(A){P(A)}else P(new Error("Failed to read file"))},c.onerror=()=>{P(new Error("Failed to read file"))},c.readAsText(T)})}downloadFile(T,B,P){!function i(l,b){const T=document.createElement("a");T.href=l,T.setAttribute("visibility","hidden"),T.download=b||"new white-board",document.body.appendChild(T),T.click(),document.body.removeChild(T)}(T,`${B}.${P}`)}getFileExtension(T){switch(T){case k.o8.Png:return"png";case k.o8.Jpeg:return"jpg";case k.o8.Svg:return"svg";case k.o8.Base64:return"txt";default:return"png"}}prepareSvgForExport(T){const B=T.cloneNode(!0),P=B.querySelector("#selectorParentGroup");P&&P.remove();const c=B.querySelector("#contentBackground");return c&&c.removeAttribute("opacity"),B.setAttribute("x","0"),B.setAttribute("y","0"),B}importMultipleImages(T,B=50){var P=this;return(0,S.A)(function*(){const c=[];let R=0,N=0;for(let A=0;A<T.length;A++)c.push(P.importImageFile(T[A],R,N)),R+=200+B,R>800&&(R=0,N+=200+B);yield Promise.all(c)})()}processImage(T){return T}static{this.\u0275fac=function(B){return new(B||l)(n.KVO(a.L),n.KVO(o.W),n.KVO(g.T),n.KVO(C.l),n.KVO(r.W),n.KVO(I.A),n.KVO(f.a),n.KVO(w.w))}}static{this.\u0275prov=n.jDH({token:l,factory:l.\u0275fac,providedIn:"root"})}}return l})()},3452:($,F,y)=>{y.d(F,{r:()=>N});var S=y(2173),e=y(872),E=y(2262),k=y(6212),D=y(6084);class i{constructor(d){this.apiService=d,this.active=!1,this.baseCursor=D.x.Default}get whiteboardConfig(){return this.apiService?.getConfig()}getPointerPosition({x:d,y:M}){return(0,k.y1)(this.apiService.getConfig(),{x:d,y:M})}activate(){this.active=!0,this.onActivate?.()}deactivate(){this.active=!1,this.onDeactivate?.()}setCursor(d){this.apiService.setCursor(d)}resetCursor(){this.apiService.resetCursor()}get isActive(){return this.active}}class u extends i{constructor(){super(...arguments),this.type=e.p.Arrow,this.baseCursor=D.x.Crosshair,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(d){if(!this.active)return;const M=this.getPointerPosition(d);let{x,y:L}=M;const{snapToGrid:W}=this.whiteboardConfig;if(W){const{gridSize:H}=this.whiteboardConfig;x=(0,k.Ej)(x,H),L=(0,k.Ej)(L,H)}this.startPoint={x,y:L},this.lastX=x,this.lastY=L,this.element=(0,S.n)(E.R.Arrow,{x1:x,y1:L,x2:x,y2:L,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element)return;const M=this.getPointerPosition(d);let x=M.x,L=M.y;const{snapToGrid:W}=this.whiteboardConfig;if(W){const{gridSize:H}=this.whiteboardConfig;x=(0,k.Ej)(x,H),L=(0,k.Ej)(L,H)}if(d.shiftKey){const H=this.element.x1,Y=this.element.y1,{x:X,y:j}=(0,k.Jt)(H,Y,x,L);x=X,L=j}(Math.abs(x-this.lastX)>this.MIN_LENGTH||Math.abs(L-this.lastY)>this.MIN_LENGTH)&&(this.apiService.updateDraftElements([{id:this.element.id,x2:x,y2:L}]),this.lastX=x,this.lastY=L)}handlePointerUp(){if(this.active){if(this.element&&this.startPoint){const d=this.element;this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.startPoint=null,this.element=null}this.lastX=0,this.lastY=0}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class h extends i{constructor(){super(...arguments),this.type=e.p.Ellipse,this.baseCursor=D.x.Crosshair,this.element=null,this.startPoint=null}handlePointerDown(d){if(!this.active)return;let{x:M,y:x}=this.getPointerPosition(d);const{snapToGrid:L}=this.whiteboardConfig;if(L){const{gridSize:W}=this.whiteboardConfig;M=(0,k.Ej)(M,W),x=(0,k.Ej)(x,W)}this.startPoint={x:M,y:x},this.element=(0,S.n)(E.R.Ellipse,{cx:M,cy:x,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element||!this.startPoint)return;const{x:M,y:x}=this.getPointerPosition(d),{x:L,y:W}=this.startPoint;let H,Y,X,j;d.altKey?(H=L,Y=W,X=Math.abs(M-H),j=d.shiftKey?X:Math.abs(x-Y)):(H=(L+M)/2,Y=(W+x)/2,X=Math.abs(L-M)/2,j=d.shiftKey?X:Math.abs(W-x)/2,d.shiftKey&&(Y=x>W?W+X:W-X)),this.apiService.updateDraftElements([{id:this.element.id,rx:X,ry:j,cx:H,cy:Y}])}handlePointerUp(){if(this.active&&this.element&&this.startPoint){const d=this.element;this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.startPoint=null,this.element=null}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var m=y(2319);class n extends i{constructor(){super(...arguments),this.type=e.p.Eraser,this.baseCursor=D.x.Eraser,this.isErasing=!1,this.hoveredElementIds=new Set,this.lastPosition=null}handlePointerDown(d){if(!this.active)return;this.hoveredElementIds.clear();const M=this.getPointerPosition(d);this.isErasing=!0,this.eraseElementsAt(M,M),this.lastPosition=M}handlePointerMove(d){if(!this.active||!this.isErasing||!this.lastPosition)return;const M=this.getPointerPosition(d);this.eraseElementsAt(this.lastPosition,M,d.altKey),this.lastPosition=M}handlePointerUp(){if(this.active){if(this.hoveredElementIds.size>0){const d=Array.from(this.hoveredElementIds),M=this.expandToIncludeGroups(d),x=this.apiService.getElements().filter(L=>M.includes(L.id));x.forEach(L=>{L.isDeleting=!1}),this.apiService.updateElements(x),this.apiService.removeElements(x)}this.hoveredElementIds.clear(),this.isErasing=!1,this.lastPosition=null}}eraseElementsAt(d,M,x=!1){const L=this.apiService.getElements(),W=this.apiService.getConfig()?.zoom||1,H=Math.hypot(M.x-d.x,M.y-d.y),j=10/W+H*(.5*Math.log2(H+1));for(const Q of L){const q=(0,S.lE)(Q.type).getBounds(Q);if((0,m.DB)(q,d,M,j)&&this.isPointInElement(Q,d,M,j)){x&&this.expandToIncludeGroups([Q.id]).forEach(he=>{this.hoveredElementIds.delete(he);const re=L.find(de=>de.id===he);re&&(re.isDeleting=!1)}),!x&&!this.hoveredElementIds.has(Q.id)&&this.expandToIncludeGroups([Q.id]).forEach(he=>{this.hoveredElementIds.add(he);const re=L.find(de=>de.id===he);re&&(re.isDeleting=!0)});const le=this.expandToIncludeGroups([Q.id]),G=L.filter(ee=>le.includes(ee.id));this.apiService.updateElements(G)}}}isPointInElement(d,M,x,L){return(0,S.lE)(d.type).hitTest(d,M,x,L)}expandToIncludeGroups(d){const M=this.apiService.getElements(),x=M.filter(H=>d.includes(H.id)),L=new Set(x.map(H=>H.groupId).filter(H=>null!=H));return 0===L.size?d:M.filter(H=>d.includes(H.id)||H.groupId&&L.has(H.groupId)).map(H=>H.id)}}class a extends i{constructor(){super(...arguments),this.type=e.p.Hand,this.baseCursor=D.x.Grab,this.isDragging=!1,this.startX=0,this.startY=0}handlePointerDown(d){this.isDragging=!0,this.startX=d.clientX,this.startY=d.clientY,this.setCursor(D.x.Grabbing)}handlePointerMove(d){if(!this.isDragging)return;const{zoom:M}=this.whiteboardConfig;this.apiService.pan((d.clientX-this.startX)/M,(d.clientY-this.startY)/M),this.startX=d.clientX,this.startY=d.clientY}handlePointerUp(){this.isDragging=!1,this.resetCursor()}}class o extends i{constructor(){super(...arguments),this.type=e.p.Image,this.baseCursor=D.x.Image}handlePointerDown(d){const{x:M,y:x}=this.getPointerPosition(d),L=document.createElement("input");L.type="file",L.accept="image/*",L.onchange=W=>{const H=W.target.files;if(H){const Y=new FileReader;Y.onload=X=>{this.apiService.addImage({image:X.target.result,x:M,y:x})},Y.readAsDataURL(H[0])}},L.click()}}class g extends i{constructor(){super(...arguments),this.type=e.p.Line,this.baseCursor=D.x.Crosshair,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(d){if(!this.active)return;let{x:M,y:x}=this.getPointerPosition(d);const{snapToGrid:L}=this.whiteboardConfig;if(L){const{gridSize:W}=this.whiteboardConfig;M=(0,k.Ej)(M,W),x=(0,k.Ej)(x,W)}this.startPoint={x:M,y:x},this.lastX=M,this.lastY=x,this.element=(0,S.n)(E.R.Line,{x1:M,y1:x,x2:M,y2:x,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element)return;const M=this.getPointerPosition(d);let x=M.x,L=M.y;const{snapToGrid:W}=this.whiteboardConfig;if(W){const{gridSize:H}=this.whiteboardConfig;x=(0,k.Ej)(x,H),L=(0,k.Ej)(L,H)}if(d.shiftKey){const H=this.element.x1,Y=this.element.y1,{x:X,y:j}=(0,k.Jt)(H,Y,x,L);[x,L]=[X,j]}(Math.abs(x-this.lastX)>this.MIN_LENGTH||Math.abs(L-this.lastY)>this.MIN_LENGTH)&&(this.apiService.updateDraftElements([{id:this.element.id,x2:x,y2:L}]),this.lastX=x,this.lastY=L)}handlePointerUp(){if(this.active){if(this.element&&this.startPoint){const d=this.element;this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.startPoint=null,this.element=null}this.lastX=0,this.lastY=0}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var C=y(3265);class r extends i{constructor(d){super(d),this.type=e.p.Pen,this.baseCursor=D.x.Crosshair,this.element=null}getCurrentPathOptions(){const x=(0,C.Nn)(this.whiteboardConfig.penType,C.Of.Medium).strokeOptions;return{smoothing:x.smoothing||.5,streamline:x.streamline||.5,thinning:x.thinning||.5,simulatePressure:void 0===x.simulatePressure||x.simulatePressure,size:x.size||16,easing:x.easing||(L=>L<.5?2*L*L:1-Math.pow(-2*L+2,2)/2),start:x.start||{cap:!0,taper:.3},end:x.end||{cap:!0,taper:.4}}}handlePointerDown(d){if(!this.active)return;const M=this.getPointerPosition(d),x=this.getCurrentPathOptions();this.element=(0,S.n)(E.R.Pen,{points:[[M.x,M.y]],pathOptions:x,isComplete:!1,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element)return;const{x:M,y:x}=this.getPointerPosition(d),L=[...this.element.points,[M,x]];this.element.points=L,this.apiService.updateDraftElements([{id:this.element.id,points:L}])}handlePointerUp(){if(this.active&&this.element){const d=this.element;this.apiService.updateDraftElements([{id:d.id,isComplete:!0}]),this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.element=null}}getElementStyle(){const M=(0,C.Nn)(this.whiteboardConfig.penType,C.Of.Medium);return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,lineJoin:this.whiteboardConfig.lineJoin,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,opacity:M.opacity}}}class I extends i{constructor(){super(...arguments),this.type=e.p.Rectangle,this.baseCursor=D.x.Crosshair,this.element=null,this.startPoint=null}handlePointerDown(d){if(!this.active)return;let{x:M,y:x}=this.getPointerPosition(d);const{snapToGrid:L}=this.whiteboardConfig;if(L){const{gridSize:W}=this.whiteboardConfig;M=(0,k.Ej)(M,W),x=(0,k.Ej)(x,W)}this.startPoint={x:M,y:x},this.element=(0,S.n)(E.R.Rectangle,{x:M,y:x,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(d){if(!this.active||!this.element||!this.startPoint)return;const{x:M,y:x}=this.getPointerPosition(d),L=this.startPoint.x,W=this.startPoint.y;let H=Math.abs(M-L),Y=Math.abs(x-W),X=null,j=null;d.shiftKey?(H=Y=Math.max(H,Y),X=L<M?L:L-H,j=W<x?W:W-Y):(X=Math.min(L,M),j=Math.min(W,x)),d.altKey&&(H*=2,Y*=2,X=L-H/2,j=W-Y/2);const{snapToGrid:Q}=this.whiteboardConfig;if(Q){const{gridSize:q}=this.whiteboardConfig;H=(0,k.Ej)(H,q),Y=(0,k.Ej)(Y,q),X=(0,k.Ej)(X,q),j=(0,k.Ej)(j,q)}this.apiService.updateDraftElements([{id:this.element.id,width:H,height:Y,x:X,y:j}])}handlePointerUp(){if(this.active&&this.element&&this.startPoint){const d=this.element;this.apiService.commitDraftElements(),d.selectAfterDraw&&this.apiService.selectElements([d.id]),this.startPoint=null,this.element=null}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineJoin:this.whiteboardConfig.lineJoin,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var f=y(7879),w=y(6078),O=y(6751),l=y(6042),b=y(2500),T=y(9820),B=function(A){return A[A.None=0]="None",A[A.Select=1]="Select",A[A.Move=2]="Move",A[A.Resize=3]="Resize",A[A.Rotate=4]="Rotate",A[A.BoxSelect=5]="BoxSelect",A}(B||{});class P extends i{constructor(){super(...arguments),this.type=e.p.Select,this.baseCursor=D.x.Default,this.currentAction=B.None,this.startPoint=null,this.currentHandle=null,this.rotateStartAngle=null,this.selectionCenter=null,this.initialBoundingBox=null,this.initialElementRotations=new Map,this.initialElementStates=new Map,this.rafId=null,this.pendingPointerEvent=null}getCurrentAction(){return this.currentAction}getStartPoint(){return this.startPoint}getCurrentHandle(){return this.currentHandle}onDeactivate(){this.apiService.clearSelection()}handlePointerDown(d){const M=(0,O.r)(d),x=M?.id??"";if(this.startPoint=this.getPointerPosition(d),x.includes(f.RZ)){const L=M?.getAttribute(f.Bn)??null;this.handleElementSelect(L,d.shiftKey),this.currentAction=B.Move}else x.includes(f.Sb)?(this.currentHandle=this.getResizeDirection(x),this.initializeResize(),this.currentAction=B.Resize):x.includes(f.Be)?(this.initializeRotation(d),this.currentAction=B.Rotate):x.includes(f.i$)?this.currentAction=B.Move:(this.initializeBoxSelect(d),this.currentAction=B.BoxSelect)}handlePointerMove(d){this.pendingPointerEvent=d,null===this.rafId&&(this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.pendingPointerEvent||!this.startPoint)return;const M=this.pendingPointerEvent,x=this.getPointerPosition(M);switch(this.currentAction){case B.Move:this.handleMove(x,M.shiftKey);break;case B.Resize:this.handleResize(x,M.shiftKey);break;case B.Rotate:this.handleRotate(x,M.ctrlKey);break;case B.BoxSelect:this.handleBoxSelect(x,M.shiftKey)}}))}handlePointerUp(){null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pendingPointerEvent=null,this.currentAction===B.BoxSelect&&this.apiService.clearSelectionBox(),this.currentAction===B.Rotate&&(this.initialElementRotations.clear(),this.apiService.updateBoundingBox()),this.initialElementStates.clear(),this.currentAction=B.None,this.startPoint=null,this.currentHandle=null,this.rotateStartAngle=null,this.selectionCenter=null,this.initialBoundingBox=null}handleElementSelect(d,M){if(!d)return;const x=this.apiService.getElementById(d);x&&(x.locked||(M?this.apiService.toggleSelection(x):this.apiService.selectElements([x])))}handleMove(d,M){if(!this.startPoint)return;const x=d.x-this.startPoint.x,L=d.y-this.startPoint.y;let W=x,H=L;if(M){const Y=(0,l.ZN)(x,L);W=Y.x,H=Y.y}this.apiService.transformSelectedElements(Y=>Y.map(X=>X.locked?X:{...X,x:X.x+W,y:X.y+H})),this.startPoint=d}handleResize(d,M){if(!this.startPoint||null===this.currentHandle||!this.initialBoundingBox)return;const x=this.currentHandle,L=this.apiService.getSelectedElements();if(!L.length)return;if(1===L.length){const re=L[0];if(!this.initialElementStates.get(re.id))return;const se=d.x-this.startPoint.x,ye=d.y-this.startPoint.y;let Ie=se,Ce=ye;if(re.rotation&&0!==re.rotation){const ue=-re.rotation*Math.PI/180,oe=Math.cos(ue),ie=Math.sin(ue);Ie=se*oe-ye*ie,Ce=se*ie+ye*oe}let Pe=Ie,De=Ce;if(M){const ue=(0,l.ZN)(Ie,Ce);Pe=ue.x,De=ue.y}return void this.apiService.transformSelectedElements(ue=>ue.map(oe=>{if(oe.locked)return oe;const ie=this.initialElementStates.get(oe.id);if(!ie)return oe;let _e=null;if(ie.rotation&&0!==ie.rotation){const Ee=ie.width||2*ie.rx||0,we=ie.height||2*ie.ry||0;let ge=0,fe=0;fe=x.includes(w.OP.N)?we:x.includes(w.OP.S)?0:we/2,ge=x.includes(w.OP.W)?Ee:x.includes(w.OP.E)?0:Ee/2;const Te=ie.rotation*Math.PI/180,Me=Math.cos(Te),be=Math.sin(Te);_e={x:ie.x+(ge*Me-fe*be),y:ie.y+(ge*be+fe*Me)}}const Se=(0,S.lE)(ie.type).resize({...ie},x,Pe,De);if(ie.rotation&&0!==ie.rotation&&_e){const Ee=Se.width||2*Se.rx||0,we=Se.height||2*Se.ry||0;let ge=0,fe=0;fe=x.includes(w.OP.N)?we:x.includes(w.OP.S)?0:we/2,ge=x.includes(w.OP.W)?Ee:x.includes(w.OP.E)?0:Ee/2;const Me=(Se.rotation??0)*Math.PI/180,be=Math.cos(Me),Be=Math.sin(Me),Ae={x:Se.x+(ge*be-fe*Be),y:Se.y+(ge*Be+fe*be)};Se.x+=_e.x-Ae.x,Se.y+=_e.y-Ae.y}return Se}))}const W=this.initialBoundingBox,H=d.x-this.startPoint.x,Y=d.y-this.startPoint.y;let X,j,Q,q;switch(x){case w.OP.N:X=W.x,j=W.y+W.height,Q=W.width,q=W.height-Y;break;case w.OP.S:X=W.x,j=W.y,Q=W.width,q=W.height+Y;break;case w.OP.E:X=W.x,j=W.y,Q=W.width+H,q=W.height;break;case w.OP.W:X=W.x+W.width,j=W.y,Q=W.width-H,q=W.height;break;case w.OP.NE:X=W.x,j=W.y+W.height,Q=W.width+H,q=W.height-Y;break;case w.OP.NW:X=W.x+W.width,j=W.y+W.height,Q=W.width-H,q=W.height-Y;break;case w.OP.SE:X=W.x,j=W.y,Q=W.width+H,q=W.height+Y;break;case w.OP.SW:X=W.x+W.width,j=W.y,Q=W.width-H,q=W.height+Y;break;default:return}if(Q<=0||q<=0)return;const le=Q/W.width,G=q/W.height;let ee=le,he=G;if(M){const re=Math.min(Math.abs(le),Math.abs(G))*Math.sign(le)*Math.sign(G);ee=re,he=re}this.apiService.transformSelectedElements(re=>re.map(de=>{if(de.locked)return de;const se=this.initialElementStates.get(de.id);if(!se)return de;const De=X+(se.x-X)*ee,ue=j+(se.y-j)*he,oe={...de,x:De,y:ue};if("width"in se&&void 0!==se.width&&(oe.width=se.width*Math.abs(ee)),"height"in se&&void 0!==se.height&&(oe.height=se.height*Math.abs(he)),se.style?.strokeWidth){const ie=(Math.abs(ee)+Math.abs(he))/2;oe.style={...de.style,strokeWidth:se.style.strokeWidth*ie}}return oe.rotation=se.rotation,oe}))}handleRotate(d,M){if(!this.startPoint||!this.selectionCenter||null===this.rotateStartAngle)return;const x=this.apiService.getSelectedElements();if(0===x.length)return;let W=(0,l.Qu)(this.selectionCenter,d)-this.rotateStartAngle;if(W>180&&(W-=360),W<-180&&(W+=360),M&&(W=15*Math.round(W/15)),x.length>1){const H=this.selectionCenter;this.apiService.transformSelectedElements(Y=>Y.map(X=>{if(X.locked)return X;const j=this.initialElementStates.get(X.id);if(!j)return X;const Q=this.initialElementRotations.get(X.id)??j.rotation??0,le=(0,S.lE)(j.type).getBounds(j),G={x:(le.minX+le.maxX)/2,y:(le.minY+le.maxY)/2},ee=(0,b.U)(G,H,W),de=ee.x-(G.x-j.x),se=ee.y-(G.y-j.y),ye=(0,l.n0)(Q+W);return{...X,x:de,y:se,rotation:ye}}))}else{const H=x[0];let X=(this.initialElementRotations.get(H.id)??H.rotation??0)+W;X=(0,l.n0)(X),this.apiService.transformSelectedElements(j=>j.map(Q=>Q.locked?Q:{...Q,rotation:X}))}}handleBoxSelect(d,M){if(!this.startPoint)return;const x={x:Math.min(this.startPoint.x,d.x),y:Math.min(this.startPoint.y,d.y),width:Math.abs(d.x-this.startPoint.x),height:Math.abs(d.y-this.startPoint.y),visible:!0};this.apiService.setSelectionBox(x);const W=this.apiService.getElements().filter(H=>this.checkElementInSelectionBox(H,x)&&!H.locked);this.apiService.selectElements(W,M),this.apiService.updateBoundingBox()}initializeBoxSelect(d){d.shiftKey||this.apiService.clearSelection();const{x:M,y:x}=this.getPointerPosition(d);this.apiService.setSelectionBox({x:M,y:x,width:0,height:0,visible:!0})}initializeResize(){const d=this.apiService.getSelectedElements();if(0===d.length)return;this.initialElementStates.clear(),d.forEach(Y=>{this.initialElementStates.set(Y.id,{...Y})});const M=d.map(Y=>(0,T.P)(Y)),x=Math.min(...M.map(Y=>Y.minX)),L=Math.min(...M.map(Y=>Y.minY)),W=Math.max(...M.map(Y=>Y.maxX)),H=Math.max(...M.map(Y=>Y.maxY));this.initialBoundingBox={x,y:L,width:W-x,height:H-L}}initializeRotation(d){const M=this.apiService.getBoundingBoxSignal(),L="function"==typeof M?M():M;if(!L)return;this.selectionCenter={x:L.x+L.width/2,y:L.y+L.height/2};const W=this.getPointerPosition(d);this.rotateStartAngle=(0,l.Qu)(this.selectionCenter,W);const H=this.apiService.getSelectedElements();this.initialElementRotations.clear(),this.initialElementStates.clear(),H.forEach(Y=>{this.initialElementRotations.set(Y.id,Y.rotation||0),this.initialElementStates.set(Y.id,{...Y})}),this.apiService.setBoundingBox(null)}checkElementInSelectionBox(d,M){const L=(0,S.lE)(d.type).getBounds(d);return(0,l.n4)(L,M)}getResizeDirection(d){const M=d.split("_")[2];let x=w.OP.N;Object.values(w.OP).includes(M)&&(x=M);const L=this.apiService.getSelectedElements();return L.length>0?(0,l.TP)(x,L[0].rotation||0):x}}class c extends i{constructor(){super(...arguments),this.type=e.p.Text,this.baseCursor=D.x.Text,this.textElement=null,this.textInput=null}handlePointerDown(d){if(!this.active)return;if(this.textInput)return void this.finishTextInput();const M=(0,O.e)(d,this.apiService.getElements());if(M&&M.type===E.R.Text)return this.textElement=M,void this.createTextInput(M.x,M.y,M.text);const{x,y:L}=this.getPointerPosition(d),H=L+.8*(this.whiteboardConfig.fontSize||16);this.textElement=this.createTextElement(x,H),this.createTextInput(x,H,"",d)}handlePointerUp(){this.textInput&&(this.textInput.addEventListener("blur",()=>this.finishTextInput()),this.textInput.focus())}createTextElement(d,M){const{snapToGrid:x,gridSize:L}=this.whiteboardConfig;return(0,S.n)(E.R.Text,{x:x?(0,k.Ej)(d,L):d,y:x?(0,k.Ej)(M,L):M,text:"",style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId())}createTextInput(d,M,x="",L){const Y=.8*(this.textElement?.style?.fontSize||16),j=this.apiService.getCanvas().parentElement;if(!j)return void console.error("Cannot find whiteboard container");const Q=j.getBoundingClientRect();let q,le;if(L)q=L.clientX-Q.left-1,le=L.clientY-Q.top-1;else{const ee=this.whiteboardConfig;q=ee.canvasX+(d+ee.x)*ee.zoom-1,le=ee.canvasY+(M+ee.y)*ee.zoom-1-Y*ee.zoom}const G=document.createElement("textarea");G.id="whiteboard-text-input",G.setAttribute("aria-label","Text input"),G.style.position="absolute",G.style.left=`${q}px`,G.style.top=`${le}px`,G.style.fontSize=`${this.textElement?.style?.fontSize||16}px`,G.style.fontFamily=this.textElement?.style?.fontFamily||"Arial",G.style.color=this.textElement?.style?.color||"#000000",G.style.fontWeight=this.textElement?.style?.fontWeight||"normal",G.style.fontStyle=this.textElement?.style?.fontStyle||"normal",G.style.border="1px dashed #000",G.style.background="white",G.style.outline="none",G.style.resize="none",G.style.overflow="hidden",G.style.lineHeight="1.2",G.style.whiteSpace="pre-wrap",G.style.margin="0",G.style.padding="2px",G.style.boxSizing="border-box",G.style.zIndex="10000",G.style.pointerEvents="auto",G.value=x,G.rows=1,G.addEventListener("input",()=>this.handleTextInput(G)),G.addEventListener("keydown",ee=>{("Enter"===ee.key&&ee.ctrlKey||"Escape"===ee.key)&&(ee.preventDefault(),this.finishTextInput())}),j?j.appendChild(G):document.body.appendChild(G),G.focus(),this.textInput=G,this.handleTextInput(G)}handleTextInput(d){const M=d.value.split("\n"),x=M.reduce((L,W)=>Math.max(L,W.length),0);d.style.width=`${Math.max(x,10)}ch`,d.rows=Math.max(M.length,1),this.textElement&&(this.textElement.text=d.value,this.apiService.updateElements([this.textElement]))}finishTextInput(){if(this.textInput&&this.textElement){this.textInput.value.trim()?this.apiService.elementExists(this.textElement.id)||(this.apiService.addElements([this.textElement]),this.textElement.selectAfterDraw&&this.apiService.selectElements([this.textElement.id])):this.apiService.removeElements([this.textElement]);try{this.textInput.parentElement&&this.textInput.parentElement.removeChild(this.textInput)}catch{}this.textInput=null,this.textElement=null}}getElementStyle(){return{color:this.whiteboardConfig.strokeColor,fontSize:this.whiteboardConfig.fontSize,fontFamily:this.whiteboardConfig.fontFamily,lineJoin:this.whiteboardConfig.lineJoin,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,strokeColor:this.whiteboardConfig.fill,strokeWidth:0}}}var R=y(4438);let N=(()=>{class A{createTool(M,x){switch(M){case e.p.Arrow:return new u(x);case e.p.Ellipse:return new h(x);case e.p.Eraser:return new n(x);case e.p.Hand:return new a(x);case e.p.Image:return new o(x);case e.p.Line:return new g(x);case e.p.Pen:return new r(x);case e.p.Rectangle:return new I(x);case e.p.Select:return new P(x);case e.p.Text:return new c(x);default:throw new Error(`Unknown tool type: ${M}`)}}static{this.\u0275fac=function(x){return new(x||A)}}static{this.\u0275prov=R.jDH({token:A,factory:A.\u0275fac,providedIn:"root"})}}return A})()},3312:($,F,y)=>{y.d(F,{H:()=>m});var S=y(4438),e=y(8936),E=y(872);const k={[E.p.Hand]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M402-40q-30 0-56-13.5T303-92L48-465l24-23q19-19 45-22t47 12l116 81v-383q0-17 11.5-28.5T320-840q17 0 28.5 11.5T360-800v537L212-367l157 229q5 8 14 13t19 5h278q33 0 56.5-23.5T760-200v-560q0-17 11.5-28.5T800-800q17 0 28.5 11.5T840-760v560q0 66-47 113T680-40H402Zm38-440v-400q0-17 11.5-28.5T480-920q17 0 28.5 11.5T520-880v400h-80Zm160 0v-360q0-17 11.5-28.5T640-880q17 0 28.5 11.5T680-840v360h-80ZM486-300Z"/></svg>',[E.p.Select]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M516-120 402-402 120-516v-56l720-268-268 720h-56Zm26-148 162-436-436 162 196 78 78 196Zm-78-196Z"/></svg>',[E.p.Pen]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/></svg>',[E.p.Line]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M199-199q-9-9-9-21t9-21l520-520q9-9 21-9t21 9q9 9 9 21t-9 21L241-199q-9 9-21 9t-21-9Z"/></svg>',[E.p.Arrow]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="m560-240-56-58 142-142H160v-80h486L504-662l56-58 240 240-240 240Z"/></svg>',[E.p.Rectangle]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M200-200q-33 0-56.5-23.5T120-280v-400q0-33 23.5-56.5T200-760h560q33 0 56.5 23.5T840-680v400q0 33-23.5 56.5T760-200H200Zm0-80h560v-400H200v400Zm0 0v-400 400Z"/></svg>',[E.p.Ellipse]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>',[E.p.Text]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M280-160v-520H80v-120h520v120H400v520H280Zm360 0v-320H520v-120h360v120H760v320H640Z"/></svg>',[E.p.Image]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-480ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h320v80H200v560h560v-320h80v320q0 33-23.5 56.5T760-120H200Zm40-160h480L570-480 450-320l-90-120-120 160Zm440-320v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80Z"/></svg>',[E.p.Eraser]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M690-240h190v80H610l80-80Zm-500 80-85-85q-23-23-23.5-57t22.5-58l440-456q23-24 56.5-24t56.5 23l199 199q23 23 23 57t-23 57L520-160H190Zm296-80 314-322-198-198-442 456 64 64h262Zm-6-240Z"/></svg>'};var D=y(6084),i=y(162),u=y(3452);const h=[{id:"hand",type:E.p.Hand,name:"Hand",description:"Pan and navigate the canvas",icon:k[E.p.Hand],enabled:!0,order:0},{id:"select",type:E.p.Select,name:"Select",description:"Select and manipulate elements",icon:k[E.p.Select],enabled:!0,order:1},{id:"pen",type:E.p.Pen,name:"Pen",description:"Draw freehand lines",icon:k[E.p.Pen],enabled:!0,order:2},{id:"line",type:E.p.Line,name:"Line",description:"Draw straight lines",icon:k[E.p.Line],enabled:!0,order:3},{id:"arrow",type:E.p.Arrow,name:"Arrow",description:"Draw arrow lines",icon:k[E.p.Arrow],enabled:!0,order:4},{id:"rectangle",type:E.p.Rectangle,name:"Rectangle",description:"Draw rectangles",icon:k[E.p.Rectangle],enabled:!0,order:5},{id:"ellipse",type:E.p.Ellipse,name:"Ellipse",description:"Draw ellipses and circles",icon:k[E.p.Ellipse],enabled:!0,order:6},{id:"text",type:E.p.Text,name:"Text",description:"Add text annotations",icon:k[E.p.Text],enabled:!0,order:7},{id:"image",type:E.p.Image,name:"Image",description:"Add images",icon:k[E.p.Image],enabled:!0,order:8},{id:"eraser",type:E.p.Eraser,name:"Eraser",description:"Remove elements",icon:k[E.p.Eraser],enabled:!0,order:9}];let m=(()=>{class n{constructor(){this.eventBusService=(0,S.WQX)(e.W),this.toolFactory=(0,S.WQX)(u.r),this._apiServiceCache=(0,S.vPA)(void 0),this._selectedTool=(0,S.vPA)(E.p.Pen),this._toolConfigs=(0,S.vPA)(new Map),this._currentToolInstance=(0,S.vPA)(null),this._cursor=(0,S.vPA)(D.x.Default),this._temporaryOverrides=(0,S.vPA)([]),this.toolInstanceCache=new Map,this.selectedTool=this._selectedTool.asReadonly(),this.currentTool=this._currentToolInstance.asReadonly(),this.cursor=this._cursor.asReadonly(),this.temporaryOverrides=this._temporaryOverrides.asReadonly(),this.effectiveTool=(0,S.EWP)(()=>{const o=this._temporaryOverrides();return o.length>0?o[o.length-1].tool:this._selectedTool()}),this.availableTools=(0,S.EWP)(()=>{const o=this._toolConfigs();return Array.from(o.values()).filter(g=>g.enabled).sort((g,C)=>(g.order??999)-(C.order??999))}),this.initializeDefaultTools(),(0,S.QZP)(()=>{const o=this.effectiveTool();this._apiServiceCache()&&this.updateCurrentToolInstance(o)},{allowSignalWrites:!0}),(0,S.QZP)(()=>{this._currentToolInstance()&&this.updateCursorForActiveTool()},{allowSignalWrites:!0})}initializeDefaultTools(){const o=new Map;h.forEach(g=>{o.set(g.id,{...g})}),this._toolConfigs.set(o)}updateCurrentToolInstance(o){const g=this._currentToolInstance();g&&g.type!==o&&g.deactivate();const C=this.getToolInstance(o);C.activate(),this._currentToolInstance.set(C),this.hasTemporaryOverride()||this.eventBusService.emit(i.w.ToolChange,o)}updateCursorForActiveTool(){const o=this._currentToolInstance();this._cursor.set(o&&"baseCursor"in o?o.baseCursor:D.x.Default)}getActiveToolType(){return this.effectiveTool()}getActiveToolInstance(){const o=this._currentToolInstance();if(!o)throw new Error("No active tool instance found.");return o}setActiveTool(o){this._selectedTool()!==o&&this._selectedTool.set(o)}isToolActive(o){return this.effectiveTool()===o}getToolInstance(o){if(!Array.from(this._toolConfigs().values()).some(r=>r.type===o))throw new Error(`Tool type '${o}' is not registered.`);if(!this.toolInstanceCache.has(o)){const r=this._apiServiceCache();if(!r)throw new Error("ApiService not set. Call setApiService() first.");const I=this.toolFactory.createTool(o,r);this.toolInstanceCache.set(o,I)}const C=this.toolInstanceCache.get(o);if(!C)throw new Error(`Failed to create or retrieve tool instance for type: ${o}`);return C}getRegisteredToolTypes(){return Array.from(this._toolConfigs().values()).map(o=>o.type).filter((o,g,C)=>C.indexOf(o)===g)}isToolRegistered(o){return Array.from(this._toolConfigs().values()).some(g=>g.type===o)}resetToDefaultTool(){this.setActiveTool(E.p.Pen)}registerTool(o){const g=this._toolConfigs(),C=new Map(g);C.set(o.id,{...o}),this._toolConfigs.set(C)}registerTools(o){const g=this._toolConfigs(),C=new Map(g);o.forEach(r=>{C.set(r.id,{...r})}),this._toolConfigs.set(C)}unregisterTool(o){const g=this._toolConfigs();if(!g.has(o))return!1;const C=g.get(o),r=new Map(g);return r.delete(o),this._toolConfigs.set(r),this._selectedTool()===C?.type&&this.resetToDefaultTool(),!0}getToolConfig(o){return this._toolConfigs().get(o)}getToolConfigs(){return Array.from(this._toolConfigs().values())}setToolEnabled(o,g){const C=this.getToolConfig(o);return!!C&&(this.registerTool({...C,enabled:g}),!g&&this._selectedTool()===C.type&&this.resetToDefaultTool(),!0)}setToolEnabledByType(o,g){const C=Array.from(this._toolConfigs().values()).find(r=>r.type===o);return!!C&&this.setToolEnabled(C.id,g)}setEnabledTools(o){const g=new Set(o),C=this._toolConfigs(),r=new Map;C.forEach((I,f)=>{r.set(f,{...I,enabled:g.has(I.type)})}),this._toolConfigs.set(r),g.has(this._selectedTool())||this.setActiveTool(o[0]||E.p.Pen)}pushTemporaryTool(o,g=`temp-${Date.now()}`){if(this._temporaryOverrides().some(I=>I.reason===g))return;const r={tool:o,reason:g,timestamp:Date.now()};this._temporaryOverrides.update(I=>[...I,r])}popTemporaryTool(o){const g=this._temporaryOverrides();if(0===g.length)return;let C;C=o?g.filter(r=>r.reason!==o):g.slice(0,-1),C.length!==g.length&&this._temporaryOverrides.set(C)}clearTemporaryTools(){this._temporaryOverrides.set([])}hasTemporaryOverride(){return this._temporaryOverrides().length>0}setCursor(o){this._cursor.set(o)}resetCursor(){this.updateCursorForActiveTool()}destroy(){const o=this._currentToolInstance();o&&o.deactivate(),this.toolInstanceCache.clear(),this.clearTemporaryTools()}setApiService(o){this._apiServiceCache.set(o)}static{this.\u0275fac=function(g){return new(g||n)}}static{this.\u0275prov=S.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()},6084:($,F,y)=>{y.d(F,{x:()=>S});var S=function(e){return e.Default="default",e.Pointer="pointer",e.None="none",e.ContextMenu="context-menu",e.Help="help",e.Progress="progress",e.Wait="wait",e.Crosshair="crosshair",e.Cell="cell",e.Text="text",e.VerticalText="vertical-text",e.Grab="grab",e.Grabbing="grabbing",e.Move="move",e.AllScroll="all-scroll",e.NResize="n-resize",e.SResize="s-resize",e.EResize="e-resize",e.WResize="w-resize",e.NEResize="ne-resize",e.NWResize="nw-resize",e.SEResize="se-resize",e.SWResize="sw-resize",e.EWResize="ew-resize",e.NSResize="ns-resize",e.NESWResize="nesw-resize",e.NWSEResize="nwse-resize",e.Copy="copy",e.Alias="alias",e.NoDrop="no-drop",e.NotAllowed="not-allowed",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out",e.ColResize="col-resize",e.RowResize="row-resize",e.Pencil="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggZmlsbD0iIzAwMCIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjAuNSIgZD0ibTE2LjMxOCA2LjExLTMuNTM2LTMuNTM1IDEuNDE1LTEuNDE0Yy42My0uNjMgMi4wNzMtLjc1NSAyLjgyOCAwbC43MDcuNzA3Yy43NTUuNzU1LjYzMSAyLjE5OCAwIDIuODI5TDE2LjMxOCA2LjExem0tMS40MTQgMS40MTUtOS45IDkuOS00LjU5NiAxLjA2IDEuMDYtNC41OTYgOS45LTkuOSAzLjUzNiAzLjUzNnoiLz48L3N2Zz4=') 0 24, auto",e.Brush="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNNyAxNGMtMS42NiAwLTMgMS4zNC0zIDMgMCAxLjMxLTEuMTYgMi0yIDIgLjkyIDEuMjIgMi40OSAyIDQgMiAyLjIxIDAgNC0xLjc5IDQtNCAwLTEuNjYtMS4zNC0zLTMtM3ptMTMuNzEtOS4zN2wtMS4zNC0xLjM0YS45OTYuOTk2IDAgMCAwLTEuNDEgMEw5IDEyLjI1IDExLjc1IDE1bDguOTYtOC45NmEuOTk2Ljk5NiAwIDAgMCAwLTEuNDF6Ii8+PC9zdmc+') 0 24, auto",e.Eraser="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTYuMjQgMy41Nmw0Ljk1IDQuOTRjLjc4Ljc5Ljc4IDIuMDUgMCAyLjg0TDEyIDIwLjUzYTQuMDA4IDQuMDA4IDAgMCAxLTUuNjYgMEwyLjgxIDE3Yy0uNzgtLjc5LS43OC0yLjA1IDAtMi44NGwxMC42LTEwLjZjLjc5LS43OCAyLjA1LS43OCAyLjgzIDBNNC4yMiAxNS41OGwzLjU0IDMuNTNjLjc4Ljc5IDIuMDQuNzkgMi44MyAwbDMuNTMtMy41My00Ljk1LTQuOTUtNC45NSA0Ljk1eiIvPjwvc3ZnPg==') 12 12, auto",e.Highlighter="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSI0IiB5PSIxMCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjgiIGZpbGw9IiMwMDAiIG9wYWNpdHk9IjAuNiIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjAuNSIvPjxwYXRoIGQ9Ik0yIDIwaDIwdjNIMnoiIGZpbGw9IiMwMDAiIG9wYWNpdHk9IjAuOCIvPjwvc3ZnPg==') 12 24, auto",e.TextCursor="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNNSA0djNoNS41djEyaDNWN0gxOVY0SDV6Ii8+PC9zdmc+') 12 0, text",e.Shape="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMiIgZmlsbD0iIzAwMCIvPjwvc3ZnPg==') 12 12, crosshair",e.Arrow="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMyAzbDcuMDcgMTYuOTcgMi41MS03LjM5IDcuMzktMi41MUwzIDN6Ii8+PC9zdmc+') 0 0, default",e.Hand="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTMgNnY1aDNMMTIgMTdsLTQtNmgzVjZjMC0xLjEuOS0yIDItMnMyIC5IDIgMnptOCAwdjVoLTJWNmMwLTIuMjEtMS43OS00LTQtNGgtMkMxMC43OSAyIDkgMy43OSA5IDZ2NUg3VjZjMC0zLjMxIDIuNjktNiA2LTZoMmMzLjMxIDAgNiAyLjY5IDYgNnoiLz48L3N2Zz4=') 12 12, grab",e.Rotate="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTIgNnYzbDQtNC00LTR2M2MtNC40MiAwLTggMy41OC04IDggMCAxLjU3LjQ2IDMuMDMgMS4yNCA0LjI2TDYuNyAxNC44Yy0uNDUtLjgzLS43LTEuNzktLjctMi44IDAtMy4zMSAyLjY5LTYgNi02em02Ljc2IDEuNzRMMTcuMyA5LjJjLjQ0Ljg0LjcgMS43OS43IDIuOCAwIDMuMzEtMi42OSA2LTYgNnYtM2wtNCA0IDQgNHYtM2M0LjQyIDAgOC0zLjU4IDgtOCAwLTEuNTctLjQ2LTMuMDMtMS4yNC00LjI2eiIvPjwvc3ZnPg==') 12 12, grab",e.Eyedropper="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMjAuNzEgNS42M2wtMi4zNC0yLjM0Yy0uMzktLjM5LTEuMDItLjM5LTEuNDEgMGwtMy4xMiAzLjEyLTEuOTMtMS45MS0xLjQxIDEuNDEgMS40MiAxLjQyTDMgMTYuMjVWMjFoNC43NWw4LjkyLTguOTIgMS40MiAxLjQyIDEuNDEtMS40MS0xLjkyLTEuOTIgMy4xMy0zLjEyYy4zOS0uMzkuMzktMS4wMiAwLTEuNDJ6Ii8+PC9zdmc+') 0 24, crosshair",e.LaserPointer="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI0IiBmaWxsPSIjMDAwIiBvcGFjaXR5PSIwLjgiLz48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI2IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMC41Ii8+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iOCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAuNSIgb3BhY2l0eT0iMC4zIi8+PC9zdmc+') 12 12, none",e.Image="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiIGZpbGw9IiMwMDAiLz48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNSA5IDkgMTUgNiAxMiAzIDE1IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==') 12 12, crosshair",e.Dot="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIyIiBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMSIvPjwvc3ZnPg==') 10 10, crosshair",e.Plus="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTkgMTNoLTZ2NmgtMnYtNkg1di0yaDZWNWgydjZoNnYyeiIvPjwvc3ZnPg==') 12 12, crosshair",e.Line="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48bGluZSB4MT0iMyIgeTE9IjIxIiB4Mj0iMjEiIHkyPSIzIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PGNpcmNsZSBjeD0iMyIgY3k9IjIxIiByPSIyIiBmaWxsPSIjMDAwIi8+PGNpcmNsZSBjeD0iMjEiIGN5PSIzIiByPSIyIiBmaWxsPSIjMDAwIi8+PC9zdmc+') 12 12, crosshair",e}(S||{})},2262:($,F,y)=>{y.d(F,{R:()=>S});var S=function(e){return e.Pen="pen",e.Rectangle="rectangle",e.Ellipse="ellipse",e.Line="line",e.Arrow="arrow",e.Text="text",e.Image="image",e}(S||{})},162:($,F,y)=>{y.d(F,{w:()=>S});var S=function(e){return e.Ready="ready",e.Destroyed="destroyed",e.DrawStart="drawStart",e.Drawing="drawing",e.DrawEnd="drawEnd",e.ElementsAdded="elementsAdded",e.ElementsUpdated="elementsUpdated",e.ElementsSelected="elementsSelected",e.ElementsRemoved="elementsRemoved",e.ElementDoubleClicked="elementDoubleClicked",e.Undo="undo",e.Redo="redo",e.Clear="clear",e.DataChange="dataChange",e.Save="save",e.ImageAdded="imageAdded",e.ToolChange="toolChange",e.ConfigChange="configChange",e.ZoomChange="zoomChange",e}(S||{})},4289:($,F,y)=>{y.d(F,{B:()=>S});const S=[{value:"normal",label:"Normal",description:"Default blending",category:"normal"},{value:"multiply",label:"Multiply",description:"Darkens by multiplying colors",category:"darken"},{value:"darken",label:"Darken",description:"Keeps darkest colors",category:"darken"},{value:"color-burn",label:"Color Burn",description:"Increases contrast and darkens",category:"darken"},{value:"screen",label:"Screen",description:"Lightens by inverting and multiplying",category:"lighten"},{value:"lighten",label:"Lighten",description:"Keeps lightest colors",category:"lighten"},{value:"color-dodge",label:"Color Dodge",description:"Brightens and reduces contrast",category:"lighten"},{value:"overlay",label:"Overlay",description:"Combines multiply and screen",category:"contrast"},{value:"soft-light",label:"Soft Light",description:"Subtle version of overlay",category:"contrast"},{value:"hard-light",label:"Hard Light",description:"Intense version of overlay",category:"contrast"},{value:"difference",label:"Difference",description:"Subtracts colors",category:"contrast"},{value:"exclusion",label:"Exclusion",description:"Similar to difference but less contrast",category:"contrast"},{value:"hue",label:"Hue",description:"Uses hue of top layer",category:"component"},{value:"saturation",label:"Saturation",description:"Uses saturation of top layer",category:"component"},{value:"color",label:"Color",description:"Uses hue and saturation of top layer",category:"component"},{value:"luminosity",label:"Luminosity",description:"Uses luminosity of top layer",category:"component"}]},3265:($,F,y)=>{y.d(F,{Nn:()=>I,Of:()=>E,mY:()=>e});var S=y(6078),e=function(f){return f.Pen="pen",f.Marker="marker",f.Highlighter="highlighter",f.Brush="brush",f.Pencil="pencil",f}(e||{}),E=function(f){return f.ExtraFine="extra-fine",f.Fine="fine",f.Medium="medium",f.Thick="thick",f.ExtraThick="extra-thick",f}(E||{});const k={size:3,thinning:.8,smoothing:.9,streamline:.8,simulatePressure:!0,easing:f=>f<.5?2*f*f:1-Math.pow(-2*f+2,2)/2,start:{cap:!0,taper:.5},end:{cap:!0,taper:.6}},D={size:6,thinning:0,smoothing:.2,streamline:.3,simulatePressure:!1,easing:()=>1,start:{cap:!1,taper:!1},end:{cap:!1,taper:!1}},u={size:14,thinning:.85,smoothing:.95,streamline:.9,simulatePressure:!0,easing:f=>Math.pow(f,1.8),start:{cap:!0,taper:.7},end:{cap:!0,taper:.8}},h={size:1.5,thinning:.6,smoothing:.15,streamline:.1,simulatePressure:!0,easing:f=>Math.min(1,.7*f+.3+.1*Math.sin(20*f)),start:{cap:!0,taper:.1},end:{cap:!0,taper:.2}},m={[E.ExtraFine]:1,[E.Fine]:3,[E.Medium]:6,[E.Thick]:12,[E.ExtraThick]:20},n={[E.ExtraFine]:.5,[E.Fine]:1.5,[E.Medium]:3,[E.Thick]:6,[E.ExtraThick]:10},a={"pen-fine":{id:"pen-fine",name:"Fine Pen",type:e.Pen,thickness:E.Fine,strokeColor:"#000000",strokeWidth:n[E.Fine],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...k,size:m[E.Fine]},display:{description:"Smooth fine pen for detailed drawing",icon:"\u270f\ufe0f"}},"pen-medium":{id:"pen-medium",name:"Medium Pen",type:e.Pen,thickness:E.Medium,strokeColor:"#000000",strokeWidth:n[E.Medium],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...k,size:m[E.Medium]},display:{description:"Standard pen for general use",icon:"\u{1f58a}\ufe0f"}},"pen-thick":{id:"pen-thick",name:"Thick Pen",type:e.Pen,thickness:E.Thick,strokeColor:"#000000",strokeWidth:n[E.Thick],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...k,size:m[E.Thick]},display:{description:"Thick pen for bold strokes",icon:"\u{1f58d}\ufe0f"}},"marker-medium":{id:"marker-medium",name:"Medium Marker",type:e.Marker,thickness:E.Medium,strokeColor:"#2563eb",strokeWidth:n[E.Medium],lineCap:S.$3.Square,lineJoin:S.pP.Miter,strokeOptions:{...D,size:m[E.Medium]},display:{description:"Consistent marker for clean lines",icon:"\u{1f58d}\ufe0f"}},"marker-thick":{id:"marker-thick",name:"Thick Marker",type:e.Marker,thickness:E.Thick,strokeColor:"#dc2626",strokeWidth:n[E.Thick],lineCap:S.$3.Square,lineJoin:S.pP.Miter,strokeOptions:{...D,size:m[E.Thick]},display:{description:"Thick marker for emphasis",icon:"\u{1f58d}\ufe0f"}},"highlighter-medium":{id:"highlighter-medium",name:"Highlighter",type:e.Highlighter,thickness:E.Medium,strokeColor:"#fefc34",strokeWidth:n[E.ExtraThick],lineCap:S.$3.Square,lineJoin:S.pP.Miter,opacity:.4,strokeOptions:{size:18,thinning:.05,smoothing:.1,streamline:.1,simulatePressure:!1,easing:f=>f,start:{cap:!1,taper:!1},end:{cap:!1,taper:!1},size:m[E.ExtraThick]},display:{description:"Translucent highlighter for emphasis",icon:"\u{1f58d}\ufe0f"}},"brush-medium":{id:"brush-medium",name:"Paint Brush",type:e.Brush,thickness:E.Medium,strokeColor:"#059669",strokeWidth:n[E.Thick],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...u,size:m[E.Thick]},display:{description:"Expressive brush with pressure sensitivity",icon:"\u{1f58c}\ufe0f"}},"pencil-fine":{id:"pencil-fine",name:"Pencil",type:e.Pencil,thickness:E.Fine,strokeColor:"#374151",strokeWidth:n[E.Fine],lineCap:S.$3.Round,lineJoin:S.pP.Round,strokeOptions:{...h,size:m[E.Fine]},display:{description:"Natural pencil for sketching",icon:"\u270f\ufe0f"}}},o=Object.values(a),g={};Object.values(a).forEach(f=>{g[`${f.type}-${f.thickness}`]=f});const C=a["pen-medium"];function I(f,w=E.Medium){const O=function r(f,w){return g[`${f}-${w}`]}(f,w);return O||o.find(b=>b.type===f)||C}},872:($,F,y)=>{y.d(F,{p:()=>S});var S=function(e){return e.Hand="hand",e.Select="select",e.Pen="pen",e.Rectangle="rectangle",e.Image="image",e.Line="line",e.Arrow="arrow",e.Ellipse="ellipse",e.Text="text",e.Eraser="eraser",e}(S||{})},6078:($,F,y)=>{y.d(F,{$3:()=>E,OP:()=>D,Yu:()=>e,o8:()=>S,pP:()=>k});var S=function(i){return i.Png="png",i.Jpeg="jpeg",i.Svg="svg",i.Base64="base64",i}(S||{}),e=function(i){return i.Left="left",i.Center="center",i.Right="right",i.Top="top",i.Middle="middle",i.Bottom="bottom",i.DistributeHorizontally="distribute-horizontally",i.DistributeVertically="distribute-vertically",i}(e||{}),E=function(i){return i.Round="round",i.Butt="butt",i.Square="square",i}(E||{}),k=function(i){return i.Round="round",i.Miter="miter",i.Bevel="bevel",i.MiterClip="miter-clip",i}(k||{}),D=function(i){return i.NW="nw",i.N="n",i.NE="ne",i.E="e",i.SE="se",i.S="s",i.SW="sw",i.W="w",i}(D||{})},9820:($,F,y)=>{y.d(F,{P:()=>E});var S=y(2173);function E(k){return(0,S.lE)(k.type).getBounds(k)}},6751:($,F,y)=>{y.d(F,{e:()=>e,r:()=>E});var S=y(7879);function e(k,D){const i=E(k);if(i){if(i.id===S.Mt)return null;const u=i.getAttribute(S.Bn);return D.find(m=>m.id===u)||null}return null}function E(k){if(!k?.target)return null;let D=k.target;for(;D;){if(D.id===S.wM)return null;if(D.id.includes(S.RZ)||D.id.includes(S.YO)||D.id.includes(S.i$))return D;if(!D.parentNode)break;D=D.parentNode}return null}},2319:($,F,y)=>{function S(u){if(0===u.length)throw new Error("Cannot calculate bounding box for empty points array");let h=1/0,m=1/0,n=-1/0,a=-1/0;for(const[o,g]of u)h=Math.min(h,o),m=Math.min(m,g),n=Math.max(n,o),a=Math.max(a,g);return{minX:h,minY:m,maxX:n,maxY:a,width:n-h,height:a-m}}function i(u,h,m,n){return u.minX-n<=Math.max(h.x,m.x)&&u.maxX+n>=Math.min(h.x,m.x)&&u.minY-n<=Math.max(h.y,m.y)&&u.maxY+n>=Math.min(h.y,m.y)}y.d(F,{AJ:()=>S,DB:()=>i})},6212:($,F,y)=>{function S(D,i){const{zoom:u,x:h,y:m,canvasX:n,canvasY:a,fullScreen:o}=D;return o?{x:i.x/u-h,y:i.y/u-m}:{x:(i.x-n)/u-h,y:(i.y-a)/u-m}}function e(D,i,u,h){const m=Math.PI/4,n=u-D,a=h-i,o=Math.atan2(a,n),g=Math.sqrt(n*n+a*a),C=Math.round(o/m)*m;return{x:D+g*Math.cos(C),y:i+g*Math.sin(C),a:C}}function E(D,i){return Math.round(D/i)*i}y.d(F,{Ej:()=>E,Jt:()=>e,y1:()=>S})},6042:($,F,y)=>{y.d(F,{Em:()=>u,Qu:()=>E,TP:()=>m,ZN:()=>D,d4:()=>i,n0:()=>k,n4:()=>h});var S=y(6078);const e=1e-6;function E(n,a){return Math.atan2(a.y-n.y,a.x-n.x)*(180/Math.PI)}function k(n){return(n%=360)<0?n+360:n}function D(n,a){return Math.abs(n)>Math.abs(a)?{x:n,y:0}:{x:0,y:a}}function i(n,a,o,g){const C=o.x,r=o.y,I=g.x,f=g.y,w=(I-C)**2+(f-r)**2;if(0===w)return Math.sqrt((n-C)**2+(a-r)**2);let O=((n-C)*(I-C)+(a-r)*(f-r))/w;return O=Math.max(0,Math.min(1,O)),Math.sqrt((n-(C+O*(I-C)))**2+(a-(r+O*(f-r)))**2)}function u(n,a,o,g,C=e){const r=(P,c)=>P.x*c.y-P.y*c.x,I=(P,c)=>({x:P.x-c.x,y:P.y-c.y}),f=I(a,n),w=I(g,o),O=I(o,n),l=r(f,w),b=r(O,f);if(Math.abs(l)<C){if(Math.abs(b)>=C)return!1;const P=f.x*f.x+f.y*f.y,c=(O.x*f.x+O.y*f.y)/P,R=I(g,n),N=(R.x*f.x+R.y*f.y)/P;return c>=0&&c<=1||N>=0&&N<=1||c<0&&N>1||c>1&&N<0}const T=b/l,B=r(O,w)/l;return T>=0&&T<=1&&B>=0&&B<=1}function h(n,a){return n.minX<=a.x+a.width&&n.maxX>=a.x&&n.minY<=a.y+a.height&&n.maxY>=a.y}function m(n,a){const o=Math.round(k(a)/45)%8,g=Object.values(S.OP),r=(g.indexOf(n)+o)%8;return g[r]}},2500:($,F,y)=>{y.d(F,{L:()=>E,U:()=>k});var S=y(9820);function E(D){if(0===D.length)return null;const i=D.map(a=>function e(D){const i=(0,S.P)(D);if(!D.rotation||0===D.rotation)return i;const u=i.width/2,h=i.height/2,m=[{x:0,y:0},{x:i.width,y:0},{x:i.width,y:i.height},{x:0,y:i.height}],n=(D.rotation||0)*(Math.PI/180),a=Math.cos(n),o=Math.sin(n),C=m.map(b=>{const T=b.x-u,B=b.y-h;return{x:T*a-B*o+u,y:T*o+B*a+h}}).map(b=>({x:b.x+D.x,y:b.y+D.y})),r=C.map(b=>b.x),I=C.map(b=>b.y),f=Math.min(...r),w=Math.min(...I),O=Math.max(...r),l=Math.max(...I);return{minX:f,minY:w,maxX:O,maxY:l,width:O-f,height:l-w}}(a)),u=Math.min(...i.map(a=>a.minX)),h=Math.min(...i.map(a=>a.minY)),m=Math.max(...i.map(a=>a.maxX)),n=Math.max(...i.map(a=>a.maxY));return{minX:u,minY:h,maxX:m,maxY:n,width:m-u,height:n-h}}function k(D,i,u){const h=u*(Math.PI/180),m=Math.cos(h),n=Math.sin(h),a=D.x-i.x,o=D.y-i.y;return{x:i.x+a*m-o*n,y:i.y+a*n+o*m}}},710:($,F,y)=>{y.d(F,{l:()=>k});var S=y(4438),e=y(7785),E=y(8936);let k=(()=>{class D{constructor(u,h){this.configService=u,this.eventBusService=h,this.DEFAULT_PAN_BOUNDS={x:-1/0,y:-1/0,width:1/0,height:1/0},this.panBounds=this.DEFAULT_PAN_BOUNDS}getConfig(){return this.configService.getConfig()}pan(u,h){const m=this.getConfig(),{x:n,y:a}=m,C=this.constrainPanPosition(n+u,a+h);this.setCanvasPosition(C.x,C.y)}panTo(u,h){const m=this.constrainPanPosition(u,h);this.setCanvasPosition(m.x,m.y)}setCanvasPosition(u,h){this.configService.updateConfig({x:u,y:h})}getPanPosition(){const u=this.getConfig();return{x:u.x,y:u.y}}resetPan(){this.setCanvasPosition(0,0)}setPanBounds(u){this.panBounds=u}resetPanBounds(){this.panBounds=this.DEFAULT_PAN_BOUNDS}getPanBounds(){return{...this.panBounds}}constrainPanPosition(u,h){return this.panBounds===this.DEFAULT_PAN_BOUNDS?{x:u,y:h}:{x:Math.max(this.panBounds.x,Math.min(this.panBounds.x+this.panBounds.width,u)),y:Math.max(this.panBounds.y,Math.min(this.panBounds.y+this.panBounds.height,h))}}isPositionWithinBounds(u,h){return this.panBounds===this.DEFAULT_PAN_BOUNDS||u>=this.panBounds.x&&u<=this.panBounds.x+this.panBounds.width&&h>=this.panBounds.y&&h<=this.panBounds.y+this.panBounds.height}getDistanceToBounds(){const{x:u,y:h}=this.getPanPosition();return this.panBounds===this.DEFAULT_PAN_BOUNDS?{left:1/0,top:1/0,right:1/0,bottom:1/0}:{left:u-this.panBounds.x,top:h-this.panBounds.y,right:this.panBounds.x+this.panBounds.width-u,bottom:this.panBounds.y+this.panBounds.height-h}}panWithEasing(u,h){this.panTo(u,h)}panWithMomentum(u,h){this.pan(u,h)}validatePanOperation(u,h,m,n){return this.isPositionWithinBounds(u+m,h+n)}applyPanAcceleration(u,h){return{dx:u,dy:h}}onPanChange(u,h){}static{this.\u0275fac=function(h){return new(h||D)(S.KVO(e.w),S.KVO(E.W))}}static{this.\u0275prov=S.jDH({token:D,factory:D.\u0275fac,providedIn:"root"})}}return D})()},4764:($,F,y)=>{y.d(F,{T:()=>m});var S=y(4438),e=y(7785),E=y(7879),k=y(162),D=y(525),i=y(6255),u=y(1152),h=y(8936);let m=(()=>{class n{constructor(){this.canvasService=(0,S.WQX)(D.W),this.elementsService=(0,S.WQX)(i.L),this.selectionService=(0,S.WQX)(u.A),this.configService=(0,S.WQX)(e.w),this.eventBusService=(0,S.WQX)(h.W),this.DEFAULT_FIT_MARGIN=.9,this.zoomSubscription=this.eventBusService.on(k.w.ZoomChange).subscribe(()=>{const{center:o,fullScreen:g,zoom:C}=this.getConfig();o&&!g&&this.centerCanvas(C)})}ngOnDestroy(){this.zoomSubscription?.unsubscribe()}emitZoomChangeEvent(){const{zoom:o}=this.getConfig();this.eventBusService.emit(k.w.ZoomChange,{zoom:o})}getConfig(){return this.configService.getConfig()}centerCanvas(o){const{canvasWidth:g,canvasHeight:C}=this.getConfig(),r=this.canvasService.getContainerDimensions(),I=(r.width-g*o)/2,f=(r.height-C*o)/2;return this.configService.updateConfig({canvasX:I,canvasY:f},!1),{x:I,y:f}}zoom(o,g=!0,C=300){if(o<=0)return;const r=Math.round(100*this.clampZoom(o))/100;g?this.animateToTarget(r,C):this.setInstant(r)}zoomIn(o=!0,g=300){const{zoom:C}=this.getConfig(),r=Math.round(100*(C+E.bL))/100;r<=E.nD&&this.zoom(r,o,g)}zoomOut(o=!0,g=300){const{zoom:C}=this.getConfig(),r=Math.round(100*(C-E.bL))/100;r>=E.DQ&&this.zoom(r,o,g)}resetZoom(o=!0,g=300){o?this.animateToTarget(E.aM,g):this.setInstant(E.aM)}getZoomLevel(){return this.getConfig().zoom}getZoomPercentage(){return Math.round(100*this.getConfig().zoom)}zoomToFit(o=this.DEFAULT_FIT_MARGIN,g=!0,C=300){const r=this.elementsService.getElements();0!==r.length?this.zoomToElements(r,o,g,C):this.resetZoom(g,C)}zoomToSelection(o=this.DEFAULT_FIT_MARGIN,g=!0,C=300){const r=this.selectionService.getSelectedElements();0!==r.length&&this.zoomToElements(r,o,g,C)}zoomToElements(o,g=this.DEFAULT_FIT_MARGIN,C=!0,r=300){if(0===o.length)return;const I=this.elementsService.calculateElementsBounds(o);if(!I)return;const{fullScreen:f}=this.getConfig(),w=f?this.canvasService.getContainerDimensions():this.canvasService.getCanvasDimensions(),b=Math.min(w.width*g/I.width,w.height*g/I.height);C?this.animateToTarget(b,r):this.setInstant(b)}zoomToArea(o,g,C,r,I=this.DEFAULT_FIT_MARGIN,f=!0,w=300){const O=this.canvasService.getCanvasDimensions(),T=Math.min(O.width*I/C,O.height*I/r);f?this.animateToTarget(T,w):this.setInstant(T)}getOptimalZoom(o,g,C=this.DEFAULT_FIT_MARGIN){const r=this.canvasService.getCanvasDimensions();return this.clampZoom(Math.min(r.width/o,r.height/g)*C)}clampZoom(o){return Math.max(E.DQ,Math.min(E.nD,o))}isValidZoom(o){return o>=E.DQ&&o<=E.nD}getZoomLimits(){return{min:E.DQ,max:E.nD}}easeInOutCubic(o){return o<.5?4*o*o*o:1-Math.pow(-2*o+2,3)/2}setInstant(o){const{fullScreen:g,center:C}=this.getConfig(),r=this.clampZoom(o);!g&&C&&this.centerCanvas(r),this.configService.updateConfig({zoom:r}),this.emitZoomChangeEvent()}animateToTarget(o,g=300){const{zoom:C,fullScreen:r,center:I}=this.getConfig(),f=this.clampZoom(o);!r&&I&&this.centerCanvas(f);const w=performance.now(),O=l=>{const T=Math.min((l-w)/g,1),B=this.easeInOutCubic(T);this.configService.updateConfig({zoom:C+(f-C)*B}),T<1?requestAnimationFrame(O):this.emitZoomChangeEvent()};requestAnimationFrame(O)}static{this.\u0275fac=function(g){return new(g||n)}}static{this.\u0275prov=S.jDH({token:n,factory:n.\u0275fac,providedIn:"root"})}}return n})()},2604:($,F,y)=>{y.d(F,{I:()=>ct});var S=y(177),e=y(4438),E=y(2107),k=y(4446),D=y(525),i=y(7785);let u=(()=>{class p{constructor(t,s,v){this.elementRef=t,this.apiService=s,this._cd=v}ngOnInit(){this.resizeObserver=new ResizeObserver(([t])=>{if(t.target===this.elementRef.nativeElement){const{fullScreen:s,center:v}=this.apiService.getConfig();setTimeout(()=>{s&&this.apiService.fullScreen(),v&&!s&&this.apiService.centerCanvas(),this._cd.detectChanges()},0)}}),this.resizeObserver.observe(this.elementRef.nativeElement)}ngOnDestroy(){this.resizeObserver?.disconnect()}static{this.\u0275fac=function(s){return new(s||p)(e.rXU(e.aKT),e.rXU(E.G),e.rXU(e.gRc))}}static{this.\u0275dir=e.FsC({type:p,selectors:[["","resizeHandler",""]],standalone:!0})}}return p})();var h=y(162),m=y(872),n=y(6751),a=y(3312),o=y(8936),g=y(6078);let C=(()=>{class p{constructor(){this.configService=(0,e.WQX)(i.w),this.apiService=(0,e.WQX)(E.G)}toggleKeyboardShortcuts(){const t=this.configService.getConfig();this.configService.updateConfigValue("keyboardShortcutsEnabled",!t.keyboardShortcutsEnabled)}handleKeyDown(t){if(this.isInputFocused())return;const s=t.key.toLowerCase();this.handleKeyDownShortcuts(s,t.ctrlKey||t.metaKey,t.shiftKey,t.altKey)&&(t.preventDefault(),t.stopPropagation())}handleKeyUp(t){}isInputFocused(){const t=document.activeElement;return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||"true"===t?.getAttribute("contenteditable")}handleKeyDownShortcuts(t,s,v,z){if(!s&&!v&&!z){if("v"===t)return this.apiService.setActiveTool(m.p.Select),!0;if("d"===t)return this.apiService.setActiveTool(m.p.Pen),!0;if("e"===t)return this.apiService.setActiveTool(m.p.Eraser),!0;if("h"===t)return this.apiService.setActiveTool(m.p.Hand),!0;if("r"===t)return this.apiService.setActiveTool(m.p.Rectangle),!0;if("o"===t)return this.apiService.setActiveTool(m.p.Ellipse),!0;if("a"===t)return this.apiService.setActiveTool(m.p.Arrow),!0;if("l"===t)return this.apiService.setActiveTool(m.p.Line),!0;if("t"===t)return this.apiService.setActiveTool(m.p.Text),!0}return s&&"z"===t&&!v?this.apiService.undo():s&&("y"===t||"z"===t&&v)?this.apiService.redo():s&&"a"===t?(this.apiService.selectAll(),!0):"escape"===t?(this.apiService.clearSelection(),!0):s&&"c"===t?(this.apiService.copyElements(),!0):s&&"x"===t?(this.apiService.cutElements(),!0):s&&"v"===t?(this.apiService.pasteElements(),!0):s&&"d"===t?(this.apiService.duplicateElements(),!0):"delete"===t||"backspace"===t?(this.apiService.deleteSelectedElements(),!0):s&&"g"===t&&!v?(this.apiService.groupSelectedElements(),!0):s&&"g"===t&&v?(this.apiService.ungroupSelectedElements(),!0):s||v||z||"]"!==t?!z||s||v||"]"!==t?!z||s||v||"["!==t?s||v||z||"["!==t?!v||s||z||"h"!==t?!v||s||z||"v"!==t?!z||s||v||"w"!==t?!z||s||v||"v"!==t?!z||s||v||"s"!==t?!z||s||v||"a"!==t?!z||s||v||"h"!==t?!z||s||v||"d"!==t?s&&"="===t||s&&"+"===t?(this.apiService.zoomIn(),!0):s&&"-"===t?(this.apiService.zoomOut(),!0):!v||s||z||"0"!==t?!v||s||z||"1"!==t?!v||s||z||"2"!==t?s&&"'"===t&&!v?(this.apiService.toggleGrid(),!0):s&&";"===t&&v?(this.apiService.toggleSnapToGrid(),!0):s||v||z||"arrowup"!==t&&"arrowdown"!==t&&"arrowleft"!==t&&"arrowright"!==t?!(s||!v||z||"arrowup"!==t&&"arrowdown"!==t&&"arrowleft"!==t&&"arrowright"!==t)&&(this.apiService.moveSelectedElements("arrowright"===t?10:"arrowleft"===t?-10:0,"arrowdown"===t?10:"arrowup"===t?-10:0),!0):(this.apiService.moveSelectedElements("arrowright"===t?1:"arrowleft"===t?-1:0,"arrowdown"===t?1:"arrowup"===t?-1:0),!0):(this.apiService.zoomToSelection(),!0):(this.apiService.zoomToFit(),!0):(this.apiService.resetZoom(),!0):(this.apiService.alignElements(g.Yu.Right),!0):(this.apiService.alignElements(g.Yu.Center),!0):(this.apiService.alignElements(g.Yu.Left),!0):(this.apiService.alignElements(g.Yu.Bottom),!0):(this.apiService.alignElements(g.Yu.Middle),!0):(this.apiService.alignElements(g.Yu.Top),!0):(this.apiService.flipVertical(),!0):(this.apiService.flipHorizontal(),!0):(this.apiService.sendToBack(),!0):(this.apiService.sendBackward(),!0):(this.apiService.bringForward(),!0):(this.apiService.bringToFront(),!0)}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275prov=e.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})();const r={cut:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M3.5 2.5a.5.5 0 0 0-1 0v11a.5.5 0 0 0 1 0v-11Zm9 0a.5.5 0 0 0-1 0v11a.5.5 0 0 0 1 0v-11ZM5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1h.5A1.5 1.5 0 0 1 13 3.5V12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3.5A1.5 1.5 0 0 1 4.5 2H5V1Zm1 0v1h4V1H6Z"/></svg>',copy:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2Zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6ZM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2Z"/></svg>',paste:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 3a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-7Zm-1.5.5A1.5 1.5 0 0 1 4.5 2h7A1.5 1.5 0 0 1 13 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-7A1.5 1.5 0 0 1 3 12.5v-9ZM6 1a1 1 0 0 0-1 1h6a1 1 0 0 0-1-1H6Z"/></svg>',duplicate:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M11 2a2 2 0 0 1 2 2v6.5a.5.5 0 0 1-1 0V4a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h6.5a.5.5 0 0 1 0 1H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7Zm4.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L12.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0Z"/></svg>',"select-all":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13ZM1 3.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5V13a.5.5 0 0 1-.5.5h-13A.5.5 0 0 1 1 13V3.5Z"/></svg>',delete:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/></svg>',order:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 3a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H6a.5.5 0 0 1 0-1h1.5V3.5A.5.5 0 0 1 8 3Zm0 7a.5.5 0 0 1 .5.5V12H10a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 8 10Zm-5-3a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm5 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm5 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"/></svg>',"bring-to-front":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 0a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2Zm6 9v5a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2H9Z"/></svg>',"bring-forward":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 2a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2Zm1 0v4h6V2H2Zm6 6v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1Zm6-6v4a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1Zm-1 0H9v4h5V2Z"/></svg>',"send-backward":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2Zm1 0v4h5V2H1Zm0 6v6a1 1 0 0 1 1 1h6a1 1 0 0 1-1-1V8a1 1 0 0 1-1-1H1Zm8-6v4a1 1 0 0 1 1 1h5a1 1 0 0 1 1-1V2a1 1 0 0 1-1-1H9a1 1 0 0 1 1 1Z"/></svg>',"send-to-back":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2Zm8 7h6a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2V9Z"/></svg>',align:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 14.5 0h-13ZM1 1.5a.5.5 0 0 1 .5-.5H4v3.5H1V1.5ZM5 4.5h6V1H5v3.5ZM12 5h3v6h-3V5Zm-1 6H5V5h6v6Zm-7-6H1v6h3V5Z"/></svg>',"align-left":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 1a.5.5 0 0 0-1 0v14a.5.5 0 0 0 1 0V1Zm3 0a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V1Zm0 7a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V8Z"/></svg>',"align-center":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 1 0v-13A.5.5 0 0 0 8 1ZM2 4.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-1Zm2 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1Z"/></svg>',"align-right":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M14.5 1a.5.5 0 0 1 1 0v14a.5.5 0 0 1-1 0V1Zm-2.5 0a.5.5 0 0 1 .5-.5H5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h7a.5.5 0 0 1-.5-.5V1Zm0 7a.5.5 0 0 1 .5-.5H2a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h10a.5.5 0 0 1-.5-.5V8Z"/></svg>',"align-top":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 0 1 0V1h13v.5a.5.5 0 0 0 1 0V1a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v.5Zm4 1a.5.5 0 0 1 .5.5v10a.5.5 0 0 1-1 0V3a.5.5 0 0 1 .5-.5Zm6 0a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0V3a.5.5 0 0 1 .5-.5Z"/></svg>',"align-middle":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 8a.5.5 0 0 0 .5.5H15a.5.5 0 0 0 0-1H1.5A.5.5 0 0 0 1 8Zm3.5-5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9a.5.5 0 0 1 .5-.5Zm7 0a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9a.5.5 0 0 1 .5-.5Z"/></svg>',"align-bottom":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 14.5a.5.5 0 0 1 1 0V15h13v-.5a.5.5 0 0 1 1 0V15a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-.5Zm4-1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-1 0v10a.5.5 0 0 0 .5.5Zm6 0a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-1 0v7a.5.5 0 0 0 .5.5Z"/></svg>',distribute:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 1 1 0v13a.5.5 0 0 1-1 0v-13Zm14 0a.5.5 0 0 0-1 0v13a.5.5 0 0 0 1 0v-13ZM5 5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V5Z"/></svg>',"distribute-horizontal":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 1 1 0v13a.5.5 0 0 1-1 0v-13Zm14 0a.5.5 0 0 0-1 0v13a.5.5 0 0 0 1 0v-13ZM4 5a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5Zm5 0a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1V5Z"/></svg>',"distribute-vertical":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 1a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Zm0 14a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1h-13ZM5 4a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H5Zm0 5a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H5Z"/></svg>',flip:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-1 0V.5A.5.5 0 0 1 8 0ZM2.5 2A1.5 1.5 0 0 0 1 3.5v9A1.5 1.5 0 0 0 2.5 14h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h4a.5.5 0 0 0 0-1h-4Zm7 0a.5.5 0 0 0 0 1h4a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-4a.5.5 0 0 0 0 1h4a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 2h-4Z"/></svg>',"flip-horizontal":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-1 0V.5A.5.5 0 0 1 8 0ZM2.5 2A1.5 1.5 0 0 0 1 3.5v9A1.5 1.5 0 0 0 2.5 14h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h4a.5.5 0 0 0 0-1h-4Zm7 0a.5.5 0 0 0 0 1h4a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-4a.5.5 0 0 0 0 1h4a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 2h-4Z"/></svg>',"flip-vertical":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M.5 8a.5.5 0 0 0 .5.5h15a.5.5 0 0 0 0-1H1A.5.5 0 0 0 .5 8ZM2 2.5A1.5 1.5 0 0 1 3.5 1h9A1.5 1.5 0 0 1 14 2.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4Zm0 11v-4a.5.5 0 0 1 1 0v4a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 1 0v4a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5Z"/></svg>',group:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 3A1.5 1.5 0 0 0 0 4.5v7A1.5 1.5 0 0 0 1.5 13H7a.5.5 0 0 0 0-1H1.5a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5H7a.5.5 0 0 0 0-1H1.5ZM9 4a.5.5 0 0 0 0 1h5.5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5H9a.5.5 0 0 0 0 1h5.5a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 14.5 3H9Z"/></svg>',ungroup:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 1.5A1.5 1.5 0 0 1 1.5 0h5A1.5 1.5 0 0 1 8 1.5V7H1.5A1.5 1.5 0 0 1 0 5.5v-4Zm8 0V7h6.5A1.5 1.5 0 0 0 16 5.5v-4A1.5 1.5 0 0 0 14.5 0h-5A1.5 1.5 0 0 0 8 1.5Zm-8 8A1.5 1.5 0 0 1 1.5 8H8v6.5A1.5 1.5 0 0 1 6.5 16h-5A1.5 1.5 0 0 1 0 14.5v-5Zm8 0V16h6a1.5 1.5 0 0 0 1.5-1.5v-5A1.5 1.5 0 0 0 14 8H8Z"/></svg>',lock:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z"/></svg>',unlock:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2zM3 8a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H3z"/></svg>',"arrow-right":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>'};let I=(()=>{class p{constructor(t){this.apiService=t,this.contextMenuVisibleSignal=(0,e.vPA)(!1),this.contextMenuPositionSignal=(0,e.vPA)({x:0,y:0}),this.containerBoundsSignal=(0,e.vPA)(null),this.focusedItemIndexSignal=(0,e.vPA)(-1),this.focusedSubmenuIdSignal=(0,e.vPA)(null),this.allMenuItemsCache=(0,e.EWP)(()=>{const s=this.getContextMenuSections()(),v=[];return s.forEach(z=>{z.items.forEach(_=>{v.push(_),_.submenu&&this.focusedSubmenuIdSignal()===_.id&&_.submenu.forEach(U=>{v.push(U)})})}),v})}getContextMenuVisible(){return this.contextMenuVisibleSignal.asReadonly()}getContextMenuPosition(){return this.contextMenuPositionSignal.asReadonly()}getContainerBounds(){return this.containerBoundsSignal.asReadonly()}getFocusedItemIndex(){return this.focusedItemIndexSignal.asReadonly()}getFocusedSubmenuId(){return this.focusedSubmenuIdSignal.asReadonly()}showContextMenu(t,s,v){this.contextMenuPositionSignal.set({x:t,y:s}),this.containerBoundsSignal.set(v||null),this.contextMenuVisibleSignal.set(!0),this.focusedItemIndexSignal.set(-1),this.focusedSubmenuIdSignal.set(null)}hideContextMenu(){this.contextMenuVisibleSignal.set(!1),this.focusedItemIndexSignal.set(-1),this.focusedSubmenuIdSignal.set(null)}getContextMenuSections(){return(0,e.EWP)(()=>{const t=this.apiService.getSelectedElements(),s=t.length>0,v=t.length>1,z=t.length>2,_=this.apiService.getClipboardInfo(),U=null!==_&&_.elementCount>0,V=s&&t.some(te=>te.groupId),K=s&&t.some(te=>te.locked),ae=s&&t.some(te=>!te.locked);return[{id:"clipboard",items:[{id:"cut",label:"Cut",shortcut:"Ctrl+X",enabled:s,visible:s,action:()=>this.apiService.cutElements()},{id:"copy",label:"Copy",shortcut:"Ctrl+C",enabled:s,visible:s,action:()=>this.apiService.copyElements()},{id:"paste",label:"Paste",shortcut:"Ctrl+V",enabled:U,visible:U,action:()=>this.apiService.pasteElements()},{id:"duplicate",label:"Duplicate",shortcut:"Ctrl+D",enabled:s,visible:s,divider:!0,action:()=>this.apiService.duplicateElements()}]},{id:"selection",items:[{id:"select-all",label:"Select All",shortcut:"Ctrl+A",enabled:!0,visible:!0,action:()=>this.apiService.selectAll()},{id:"delete",label:"Delete",shortcut:"Del",enabled:s,visible:s,divider:!0,action:()=>this.apiService.deleteSelectedElements()}]},{id:"arrange",items:[{id:"order",label:"Order",enabled:s,visible:s,submenu:[{id:"bring-to-front",label:"Bring to Front",shortcut:"Ctrl+Shift+]",enabled:!0,visible:!0,action:()=>this.apiService.bringToFront()},{id:"bring-forward",label:"Bring Forward",shortcut:"Ctrl+]",enabled:!0,visible:!0,action:()=>this.apiService.bringForward()},{id:"send-backward",label:"Send Backward",shortcut:"Ctrl+[",enabled:!0,visible:!0,action:()=>this.apiService.sendBackward()},{id:"send-to-back",label:"Send to Back",shortcut:"Ctrl+Shift+[",enabled:!0,visible:!0,action:()=>this.apiService.sendToBack()}]},{id:"transform",label:"Transform",enabled:s,visible:s,submenu:[{id:"align-left",label:"Align Left",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(g.Yu.Left)},{id:"align-center",label:"Align Center",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(g.Yu.Center)},{id:"align-right",label:"Align Right",enabled:!0,visible:!0,divider:!0,action:()=>this.apiService.alignElements(g.Yu.Right)},{id:"align-top",label:"Align Top",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(g.Yu.Top)},{id:"align-middle",label:"Align Middle",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(g.Yu.Middle)},{id:"align-bottom",label:"Align Bottom",enabled:!0,visible:!0,divider:!0,action:()=>this.apiService.alignElements(g.Yu.Bottom)},{id:"distribute-horizontal",label:"Distribute Horizontally",enabled:z,visible:z,action:()=>this.apiService.distributeHorizontally()},{id:"distribute-vertical",label:"Distribute Vertically",enabled:z,visible:z,divider:!0,action:()=>this.apiService.distributeVertically()},{id:"flip-horizontal",label:"Flip Horizontal",enabled:!0,visible:!0,action:()=>this.apiService.flipHorizontal()},{id:"flip-vertical",label:"Flip Vertical",enabled:!0,visible:!0,action:()=>this.apiService.flipVertical()}]}]},{id:"object",items:[{id:"group",label:"Group",shortcut:"Ctrl+G",enabled:v,visible:v,action:()=>this.apiService.groupSelectedElements()},{id:"ungroup",label:"Ungroup",shortcut:"Ctrl+Shift+G",enabled:V,visible:V,action:()=>this.apiService.ungroupSelectedElements()},{id:"lock",label:"Lock",shortcut:"Ctrl+L",enabled:ae,visible:ae,action:()=>this.apiService.lockElements()},{id:"unlock",label:"Unlock",shortcut:"Ctrl+Shift+L",enabled:K,visible:K,action:()=>this.apiService.unlockElements()}]}].map(te=>({...te,items:te.items.filter(ne=>ne.visible)})).filter(te=>te.items.length>0)})}executeAction(t){try{t()}catch(s){console.error("Error executing context menu action:",s)}finally{this.hideContextMenu()}}focusNextItem(){const t=this.allMenuItemsCache(),s=t.filter(ae=>ae.enabled);if(0===s.length)return;const v=this.focusedItemIndexSignal(),z=v>=0?t[v]:null,U=((z?s.indexOf(z):-1)+1)%s.length,K=t.indexOf(s[U]);this.focusedItemIndexSignal.set(K)}focusPreviousItem(){const t=this.allMenuItemsCache(),s=t.filter(ae=>ae.enabled);if(0===s.length)return;const v=this.focusedItemIndexSignal(),z=v>=0?t[v]:null,_=z?s.indexOf(z):-1,K=t.indexOf(s[_<=0?s.length-1:_-1]);this.focusedItemIndexSignal.set(K)}focusFirstItem(){const t=this.allMenuItemsCache(),s=t.filter(_=>_.enabled);if(0===s.length)return;const z=t.indexOf(s[0]);this.focusedItemIndexSignal.set(z)}focusLastItem(){const t=this.allMenuItemsCache(),s=t.filter(_=>_.enabled);if(0===s.length)return;const z=t.indexOf(s[s.length-1]);this.focusedItemIndexSignal.set(z)}openFocusedSubmenu(){const t=this.allMenuItemsCache(),s=this.focusedItemIndexSignal();if(s<0||s>=t.length)return;const v=t[s];v.submenu&&v.enabled&&this.focusedSubmenuIdSignal.set(v.id)}closeFocusedSubmenu(){this.focusedSubmenuIdSignal.set(null)}executeFocusedAction(){const t=this.allMenuItemsCache(),s=this.focusedItemIndexSignal();if(s<0||s>=t.length)return;const v=t[s];v.enabled&&v.action?this.executeAction(v.action):v.submenu&&v.enabled&&this.openFocusedSubmenu()}getIcon(t){return t&&r[t]||""}getAllMenuItems(){return this.allMenuItemsCache()}static{this.\u0275fac=function(s){return new(s||p)(e.KVO(E.G))}}static{this.\u0275prov=e.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})();var f=y(2262),w=y(2173),O=y(6212);let l=(()=>{class p{constructor(t,s){this.apiService=t,this.configService=s}handleFiles(t){Array.from(t).forEach(s=>{if(s.type.startsWith("image/")){const v=new FileReader;v.onload=z=>{const _=z.target?.result;if(_){const U=(0,w.n)(f.R.Image,{src:_,x:100,y:100,width:200,height:200,zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId());this.apiService.addElements([U])}},v.readAsDataURL(s)}})}handleText(t,s,v=!1){const z=this.configService.getConfig(),{x:_,y:U}=(0,O.y1)(z,{x:s.clientX,y:s.clientY});let V=t,K={color:z.strokeColor,fontSize:z.fontSize,fontFamily:z.fontFamily,fontWeight:"normal",fontStyle:"normal"};if(v){const me=(new DOMParser).parseFromString(t,"text/html");V=(me.body.textContent||"").trim();const te=me.body.firstElementChild;if(te){const ne=window.getComputedStyle(te);K={color:ne.color||K.color,fontSize:parseInt(ne.fontSize)||K.fontSize,fontFamily:ne.fontFamily||K.fontFamily,fontWeight:"bold"===ne.fontWeight||parseInt(ne.fontWeight)>=700?"bold":"normal",fontStyle:"italic"===ne.fontStyle?"italic":"normal"}}}if(V){const ae=(0,w.n)(f.R.Text,{x:_,y:U+.8*K.fontSize,text:V,style:K,zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId());this.apiService.addElements([ae])}}handleElements(t,s){const v=this.configService.getConfig(),z=(0,O.y1)(v,{x:s.clientX,y:s.clientY}),_=t.map(U=>({...U,x:z.x+(U.x||0),y:z.y+(U.y||0),zIndex:this.apiService.getNextZIndex()}));this.apiService.addElements(_)}static{this.\u0275fac=function(s){return new(s||p)(e.KVO(E.G),e.KVO(i.w))}}static{this.\u0275prov=e.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})();var b=y(7879);let T=(()=>{class p{constructor(){this.apiService=(0,e.WQX)(E.G)}handleWheel(t){t.preventDefault(),t.ctrlKey?this.handleZoom(t):t.shiftKey?this.handleHorizontalPan(t):this.handleVerticalPan(t)}handleZoom(t){(t.deltaY<0?1:-1)>0?this.apiService.zoomIn():this.apiService.zoomOut()}handleHorizontalPan(t){const s=this.apiService.getConfig();this.apiService.pan(t.deltaY*b.aW/s.zoom,0)}handleVerticalPan(t){const s=this.apiService.getConfig();this.apiService.pan(0,t.deltaY*b.aW/s.zoom)}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275prov=e.jDH({token:p,factory:p.\u0275fac})}}return p})(),B=(()=>{class p{constructor(t,s,v,z,_,U,V,K){this.toolsService=t,this.configService=s,this.EventBusService=v,this.keyboardShortcutService=z,this.apiService=_,this.contextMenuService=U,this.dragDropService=V,this.wheelHandlerService=K,this.pointerDownSig=(0,e.vPA)(null),this.pointerMoveSig=(0,e.vPA)(null),this.pointerUpSig=(0,e.vPA)(null),this.isSpaceHeld=!1}onPointerDown(t){if(1===t.button)return this.toolsService.pushTemporaryTool(m.p.Hand,"pan-middle"),void this.safeGetHandTool()?.handlePointerDown?.(t);2!==t.button&&!this.toolsService.hasTemporaryOverride()&&this.canDraw()&&(this.EventBusService.emit(h.w.DrawStart,t),this.toolsService.getActiveToolInstance()?.handlePointerDown?.(t),t.isDoubleClick&&this.EventBusService.emit(h.w.ElementDoubleClicked,{target:t.target,clientX:t.clientX,clientY:t.clientY}),this.pointerDownSig.set(t))}onPointerMove(t){this.toolsService.hasTemporaryOverride()?this.safeGetHandTool()?.handlePointerMove?.(t):this.canDraw()&&(this.EventBusService.emit(h.w.Drawing,t),this.toolsService.getActiveToolInstance()?.handlePointerMove?.(t),this.pointerMoveSig.set(t))}onPointerUp(t){if(1===t.button&&this.toolsService.hasTemporaryOverride())return this.safeGetHandTool()?.handlePointerUp?.(t),void this.toolsService.popTemporaryTool("pan-middle");this.canDraw()&&(this.EventBusService.emit(h.w.DrawEnd),this.toolsService.getActiveToolInstance()?.handlePointerUp?.(t),this.pointerUpSig.set(t))}onKeyDown(t){const s=t.target;if(!s||"INPUT"!==s.tagName&&"TEXTAREA"!==s.tagName&&!s.isContentEditable)return"Space"!==t.code||this.isSpaceHeld?(this.toolsService.getActiveToolInstance()?.handleKeyDown?.(t),void(this.canUseKeyboardShortcuts()&&this.keyboardShortcutService.handleKeyDown(t))):(this.isSpaceHeld=!0,this.toolsService.pushTemporaryTool(m.p.Hand,"pan-space"),void t.preventDefault())}onKeyUp(t){if("Space"===t.code&&this.isSpaceHeld)return this.isSpaceHeld=!1,this.toolsService.popTemporaryTool("pan-space"),void t.preventDefault();this.toolsService.getActiveToolInstance()?.handleKeyUp?.(t),this.canUseKeyboardShortcuts()&&this.keyboardShortcutService.handleKeyUp(t)}onWheel(t){this.canDraw()&&this.wheelHandlerService.handleWheel(t)}onDragOver(t){this.canDraw()&&t.dataTransfer&&(t.dataTransfer.dropEffect="copy")}onDrop(t){if(!this.canDraw())return;const s=t.dataTransfer?.files;if(s&&s.length>0)return void this.dragDropService.handleFiles(s);const v=t.dataTransfer?.getData("text/html");if(v)return void this.dragDropService.handleText(v,t,!0);const z=t.dataTransfer?.getData("text/plain");if(z)return void this.dragDropService.handleText(z,t,!1);const _=t.dataTransfer?.getData("application/json");if(_)try{const U=JSON.parse(_);Array.isArray(U)&&this.dragDropService.handleElements(U,t)}catch(U){console.warn("Failed to parse dropped JSON:",U)}}onContextMenu(t,s){if(!this.canDraw())return;const v=this.getTargetElementFromPointer(t),z=this.apiService.selectedElements(),_=z.length>0;v?z.some(V=>V.id===v.id)||this.apiService.selectElements(v):_||this.apiService.clearSelection(),this.contextMenuService.showContextMenu(t.clientX,t.clientY,s)}canDraw(){return this.configService.getConfig().drawingEnabled}canUseKeyboardShortcuts(){return this.configService.getConfig().keyboardShortcutsEnabled}safeGetHandTool(){try{return this.toolsService.getToolInstance(m.p.Hand)}catch{return null}}getTargetElementFromPointer(t){const s=this.apiService.getElements();return(0,n.e)(t,s)}static{this.\u0275fac=function(s){return new(s||p)(e.KVO(a.H),e.KVO(i.w),e.KVO(o.W),e.KVO(C),e.KVO(E.G),e.KVO(I),e.KVO(l),e.KVO(T))}}static{this.\u0275prov=e.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}}return p})(),P=(()=>{class p{constructor(){this.configService=(0,e.WQX)(i.w),this.svgService=(0,e.WQX)(B),this.elementRef=(0,e.WQX)(e.aKT),this.isHovered=!1,this.lastInteractionTime=0,this.INTERACTION_TIMEOUT=500,this.handleMouseEnter=()=>{this.isHovered=!0,p.activeDirective=this},this.handleMouseLeave=()=>{this.isHovered=!1},this.handleInteraction=()=>{this.lastInteractionTime=Date.now(),p.activeDirective=this}}static{this.activeDirective=null}ngOnInit(){const t=this.elementRef.nativeElement;t.addEventListener("mouseenter",this.handleMouseEnter),t.addEventListener("mouseleave",this.handleMouseLeave),t.addEventListener("pointerdown",this.handleInteraction),t.addEventListener("pointerup",this.handleInteraction)}ngOnDestroy(){const t=this.elementRef.nativeElement;t.removeEventListener("mouseenter",this.handleMouseEnter),t.removeEventListener("mouseleave",this.handleMouseLeave),t.removeEventListener("pointerdown",this.handleInteraction),t.removeEventListener("pointerup",this.handleInteraction),p.activeDirective===this&&(p.activeDirective=null)}isActiveWhiteboard(){const t=Date.now()-this.lastInteractionTime<this.INTERACTION_TIMEOUT;return this.isHovered||t||p.activeDirective===this}onGlobalKeyDown(t){this.configService.getConfig().keyboardShortcutsEnabled&&this.isActiveWhiteboard()&&this.svgService.onKeyDown(t)}onGlobalKeyUp(t){this.configService.getConfig().keyboardShortcutsEnabled&&this.isActiveWhiteboard()&&this.svgService.onKeyUp(t)}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275dir=e.FsC({type:p,selectors:[["","globalKeyboard",""]],hostBindings:function(s,v){1&s&&e.bIt("keydown",function(_){return v.onGlobalKeyDown(_)},!1,e.tSv)("keyup",function(_){return v.onGlobalKeyUp(_)},!1,e.tSv)},standalone:!0})}}return p})(),c=(()=>{class p{constructor(t){this.svgService=t,this.elementRef=(0,e.WQX)(e.aKT),this.lastClickTime=0,this.lastClickX=0,this.lastClickY=0,this.DOUBLE_CLICK_THRESHOLD=300,this.DOUBLE_CLICK_DISTANCE=10}onPointerDown(t){if(2!==t.button&&t.preventDefault(),t.currentTarget&&t.currentTarget.setPointerCapture(t.pointerId),2===t.button)return;const s=Date.now(),v=t.clientX,z=t.clientY;if(this.lastClickTime&&s-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(v-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE&&Math.abs(z-this.lastClickY)<this.DOUBLE_CLICK_DISTANCE){const U=this.createPointerInfo(t);return U.isDoubleClick=!0,this.svgService.onPointerDown(U),void(this.lastClickTime=0)}this.lastClickTime=s,this.lastClickX=v,this.lastClickY=z;const _=this.createPointerInfo(t);this.svgService.onPointerDown(_)}onPointerMove(t){if(t.clientX===this.lastX&&t.clientY===this.lastY||(this.lastX=t.clientX,this.lastY=t.clientY,2&t.buttons))return;const s=this.createPointerInfo(t);this.svgService.onPointerMove(s)}onPointerUp(t){if(this.lastX=t.clientX,this.lastY=t.clientY,t.currentTarget&&t.currentTarget.hasPointerCapture(t.pointerId)&&t.currentTarget.releasePointerCapture(t.pointerId),2===t.button)return;const s=this.createPointerInfo(t);this.svgService.onPointerUp(s)}onWheel(t){t.preventDefault(),this.svgService.onWheel(t)}onKeyDown(t){t.preventDefault(),this.svgService.onKeyDown(t)}onKeyUp(t){this.svgService.onKeyUp(t)}onDragOver(t){t.preventDefault(),t.stopPropagation(),this.svgService.onDragOver(t)}onDragEnter(t){t.preventDefault(),t.stopPropagation()}onDrop(t){t.preventDefault(),t.stopPropagation(),this.svgService.onDrop(t)}onContextMenu(t){t.preventDefault();const s=this.createPointerInfo(t),v=t.currentTarget.getBoundingClientRect(),z=this.getPointerPosition(t),_={...s,clientX:v.left+z.x,clientY:v.top+z.y};this.svgService.onContextMenu(_,v)}createPointerInfo(t){const{x:s,y:v}=this.getPointerPosition(t);return{x:s,y:v,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,movementX:t.movementX,movementY:t.movementY,pressure:t.pressure,tangentialPressure:t.tangentialPressure,tiltX:t.tiltX,tiltY:t.tiltY,twist:t.twist,width:t.width,height:t.height,pointerType:t.pointerType,pointerId:t.pointerId,isPrimary:t.isPrimary,button:t.button,buttons:t.buttons,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,eventType:t.type,timeStamp:t.timeStamp,target:t.target}}getPointerPosition(t){const s=t.currentTarget.getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}static{this.\u0275fac=function(s){return new(s||p)(e.rXU(B))}}static{this.\u0275dir=e.FsC({type:p,selectors:[["","svg",""]],hostBindings:function(s,v){1&s&&e.bIt("pointerdown",function(_){return v.onPointerDown(_)})("pointermove",function(_){return v.onPointerMove(_)})("pointerup",function(_){return v.onPointerUp(_)})("wheel",function(_){return v.onWheel(_)})("keydown",function(_){return v.onKeyDown(_)})("keyup",function(_){return v.onKeyUp(_)})("dragover",function(_){return v.onDragOver(_)})("dragenter",function(_){return v.onDragEnter(_)})("drop",function(_){return v.onDrop(_)})("contextmenu",function(_){return v.onContextMenu(_)})},standalone:!0})}}return p})();var R=y(1152);const N="nw-resize",A="ne-resize",d="ns-resize",M="ew-resize";let X=(()=>{class p{constructor(){this.cornerGrips=["nw","ne","se","sw"],this.sideGrips=["n","s","e","w"]}transform(t,s){if(t.includes("rotate"))return"grab";const v=this.isHorizontalOrientation(s);return this.cornerGrips.includes(t)?this.getCornerCursor(t,v):this.sideGrips.includes(t)?this.getSideCursor(t,v):"default"}isHorizontalOrientation(t){const s=t%180;return s<45||s>135}getCornerCursor(t,s){return"nw"===t||"se"===t?s?N:A:s?A:N}getSideCursor(t,s){return"n"===t||"s"===t?s?d:M:s?M:d}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275pipe=e.EJ8({name:"gripCursor",type:p,pure:!0,standalone:!0})}}return p})(),j=(()=>{class p{transform(t,s){if(t.isDeleting)return.1;let v=(t.opacity||100)/100;if(void 0!==t.style?.opacity&&(v*=t.style.opacity),t.layerId){const z=s.find(_=>_.id===t.layerId);z&&void 0!==z.opacity&&(v*=z.opacity)}return v}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275pipe=e.EJ8({name:"elementOpacity",type:p,pure:!0,standalone:!0})}}return p})();function q(p,Z){return[p[0]-Z[0],p[1]-Z[1]]}function he(p,Z){return function ee(p){return p[0]*p[0]+p[1]*p[1]}(q(p,Z))}function re(p,Z){return Math.hypot(p[1]-Z[1],p[0]-Z[0])}function de(p,Z,t){return function Q(p,Z){return[p[0]+Z[0],p[1]+Z[1]]}(p,function le(p,Z){return[p[0]*Z,p[1]*Z]}(q(Z,p),t))}function se(p){return[void 0!==p[0]?p[0]:0,void 0!==p[1]?p[1]:0,void 0!==p[2]?p[2]:1]}function ye(p,Z){return Math.abs(p[0]-Z[0])<1e-4&&Math.abs(p[1]-Z[1])<1e-4}function ue(p){return`${ie(p[0])},${ie(p[1])} `}function oe(p,Z){return`${ie((p[0]+Z[0])/2)},${ie((p[1]+Z[1])/2)} `}function ie(p){return Math.round(1e4*p)/1e4}let _e=(()=>{class p{transform(t,s){if(!t||0===t.length)return"";const v=function Pe(p,Z={}){const{streamline:t=.5,size:s=16,simulatePressure:v=!1}=Z;if(0===p.length)return[];const z=.15+.85*(1-t);let _=[...p],U=0;if(!v){let J=_[0];for(;J&&!(J[2]>=.025);)_.shift(),J=_[0]}if(!v){let J=_[_.length-1];for(;J&&!(J[2]>=.01);)_.pop(),J=_[_.length-1]}if(0===_.length){const J=p[0];return!J||"number"!=typeof J[0]||"number"!=typeof J[1]||isNaN(J[0])||isNaN(J[1])?[]:[se(J)]}let V=_[1];for(;V&&!(he(V,_[0])>(s/3)**2);)_[0][2]=Math.max(_[0][2],V[2]),_.splice(1,1),V=_[1];const K=_.pop();if(!K)return[];const ae=K;for(V=_[_.length-1];V&&!(he(V,ae)>(s/3)**2);)_.pop(),V=_[_.length-1],U++;_.push(ae);const me=Z.last||!Z.simulatePressure||_.length>1&&he(_[_.length-1],_[_.length-2])<s**2||U>0;if(2===_.length&&Z.simulatePressure){const J=_[1];_=_.slice(0,-1);for(let xe=1;xe<5;xe++){const ke=de(_[0],J,xe/4);ke[2]=(_[0][2]+(J[2]-_[0][2]))*xe/4,_.push(ke)}}const ce=[_[0]];let ve,Le,te=0,ne=ce[0];me&&t>0&&_.push(_[_.length-1]);for(let J=1,xe=_.length;J<xe;J++)ve=!z||Z.last&&J===xe-1?_[J]:de(_[J],ne,1-z),!ye(ne,ve)&&(Le=re(ve,ne),te+=Le,!(J<4&&te<s)&&(ne=ve,ce.push(ve)));return ce}(t,s);return function De(p,Z=!1){const t=p.length;if(0===t)return"";if(1===t){const _=p[0];if(!_||_.length<2||isNaN(_[0])||isNaN(_[1]))return"";const U=2;return`M ${_[0]} ${_[1]} m -${U}, 0 a ${U},${U} 0 1,0 ${2*U},0 a ${U},${U} 0 1,0 -${2*U},0`}let s=p[0],v=p[1];if(2===t)return`M${ue(s)}L${ue(v)}`;let z="";for(let _=2,U=t-1;_<U;_++)s=p[_],v=p[_+1],z+=oe(s,v);return Z?`M${oe(p[0],p[1])}Q${ue(p[1])}${oe(p[1],p[2])}T${z}${oe(p[t-1],p[0])}${oe(p[0],p[1])}Z`:`M${ue(p[0])}Q${ue(p[1])}${oe(p[1],p[2])}${p.length>3?"T":""}${z}L${ue(p[t-1])}`}(v)}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275pipe=e.EJ8({name:"pointsToPath",type:p,pure:!0,standalone:!0})}}return p})();const Re=["svgContainer"],Se=(p,Z)=>Z.id,pe=()=>["n","s","e","w"],Ee=()=>["nw","ne","se","sw"];function we(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"rect",15),e.k0s()),2&p){const t=e.XpG();e.BMQ("transform",t.gridConfig().transform),e.R7$(),e.BMQ("width",t.gridConfig().width+200)("height",t.gridConfig().height+200)}}function ge(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"path",17),e.nI1(2,"pointsToPath"),e.k0s()),2&p){const t=e.XpG().$implicit;e.R7$(),e.BMQ("d",e.i5U(2,7,t.points,t.pathOptions))("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function fe(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"image",18),e.k0s()),2&p){const t=e.XpG().$implicit;e.R7$(),e.BMQ("height",t.height)("width",t.width)("href",t.src,null,"xlink")("href",t.src)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function Te(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"line"),e.k0s()),2&p){const t=e.XpG().$implicit;e.R7$(),e.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)}}function Me(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"line",19),e.k0s()),2&p){const t=e.XpG().$implicit;e.R7$(),e.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)("fill",t.style.strokeColor)}}function be(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"rect"),e.k0s()),2&p){const t=e.XpG().$implicit;e.R7$(),e.BMQ("rx",t.rx)("width",t.width)("height",t.height)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-linejoin",t.style.lineJoin)}}function Be(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"ellipse"),e.k0s()),2&p){const t=e.XpG().$implicit;e.R7$(),e.BMQ("cx",t.cx)("cy",t.cy)("rx",t.rx)("ry",t.ry)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke",t.style.strokeColor)("fill",t.style.fill)}}function Ae(p,Z){if(1&p&&(e.qSk(),e.j41(0,"tspan"),e.EFF(1),e.k0s()),2&p){const t=Z.$implicit,s=Z.$index,v=e.XpG(2).$implicit;e.BMQ("x",0)("dy",0===s?0:1.2*(v.style.fontSize||16)),e.R7$(),e.JRh(t)}}function Ne(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g")(1,"text",20),e.Z7z(2,Ae,2,3,":svg:tspan",null,e.Vm6),e.k0s()()),2&p){const t=e.XpG().$implicit;e.R7$(),e.BMQ("font-size",t.style.fontSize)("font-family",t.style.fontFamily)("fill",t.style.color)("font-style",t.style.fontStyle)("font-weight",t.style.fontWeight)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke",t.style.strokeColor)("stroke-width",t.style.strokeWidth),e.R7$(),e.Dyx(t.text.split("\n"))}}function We(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g",16),e.nI1(1,"elementOpacity"),e.DNE(2,ge,3,10)(3,fe,2,9)(4,Te,2,9)(5,Me,2,10)(6,be,2,9)(7,Be,2,9)(8,Ne,4,11),e.k0s()),2&p){let t;const s=Z.$implicit,v=e.XpG();e.xc7("pointer-events",s.isLocked?"none":"auto")("mix-blend-mode",s.blendMode),e.Y8G("id","item_"+s.id),e.BMQ("data-wb-id",s.id)("transform",s.transform)("opacity",e.i5U(1,9,s,v.layers())),e.R7$(2),e.vxM(2,(t=s.type)===v.types.Pen?2:t===v.types.Image?3:t===v.types.Line?4:t===v.types.Arrow?5:t===v.types.Rectangle?6:t===v.types.Ellipse?7:t===v.types.Text?8:-1)}}function He(p,Z){if(1&p&&(e.qSk(),e.nrm(0,"rect",13)),2&p){const t=Z;e.BMQ("x",t.x)("y",t.y)("width",t.width)("height",t.height)}}function Ze(p,Z){if(1&p&&(e.qSk(),e.qex(0),e.nrm(1,"rect",24),e.nI1(2,"gripCursor"),e.bVm()),2&p){const t=Z.$implicit,s=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_resize_"+t)("x","n"===t||"s"===t?s.x:"e"===t?s.x+s.width-5:s.x-5)("y","n"===t?s.y-5:"s"===t?s.y+s.height-5:s.y)("width","n"===t||"s"===t?s.width:10)("height","n"===t||"s"===t?10:s.height)("cursor",e.i5U(2,6,t,s.rotation))}}function Fe(p,Z){if(1&p&&(e.qSk(),e.qex(0),e.nrm(1,"rect",25),e.nI1(2,"gripCursor"),e.bVm()),2&p){const t=Z.$implicit,s=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_resize_"+t)("x",s.x+("ne"===t||"se"===t?s.width:0)-5)("y",s.y+("se"===t||"sw"===t?s.height:0)-5)("cursor",e.i5U(2,4,t,s.rotation))}}function Ye(p,Z){if(1&p&&(e.qSk(),e.qex(0),e.nrm(1,"circle",26),e.nI1(2,"gripCursor"),e.bVm()),2&p){const t=Z.$implicit,s=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_rotate_"+t)("cx",s.x+("ne"===t||"se"===t?s.width:-20)+10)("cy",s.y+("se"===t||"sw"===t?s.height:-20)+10)("cursor",e.i5U(2,4,"rotate_"+t,s.rotation))}}function Xe(p,Z){if(1&p&&(e.qSk(),e.j41(0,"g",14),e.nrm(1,"rect",21),e.DNE(2,Ze,3,9,"ng-container",22)(3,Fe,3,7,"ng-container",22),e.nrm(4,"circle",23),e.DNE(5,Ye,3,7,"ng-container",22),e.k0s()),2&p){const t=Z;e.BMQ("transform","rotate("+t.rotation+","+(t.x+t.width/2)+","+(t.y+t.height/2)+")"),e.R7$(),e.BMQ("x",t.x)("y",t.y)("width",t.width)("height",t.height),e.R7$(),e.Y8G("ngForOf",e.lJ4(10,pe)),e.R7$(),e.Y8G("ngForOf",e.lJ4(11,Ee)),e.R7$(),e.BMQ("cx",t.handles.rotateHandle.x)("cy",t.handles.rotateHandle.y),e.R7$(),e.Y8G("ngForOf",e.lJ4(12,Ee))}}let Ue=(()=>{class p{constructor(){this.apiService=(0,e.WQX)(E.G),this.configService=(0,e.WQX)(i.w),this.toolsService=(0,e.WQX)(a.H),this.selectionService=(0,e.WQX)(R.A),this.canvasService=(0,e.WQX)(D.W),this.svgService=(0,e.WQX)(B),this.config=this.configService.getConfigSignal(),this.elements=this.apiService.allElements,this.layers=this.apiService.layers,this.selectedToolSignal=this.toolsService.selectedTool,this.selectionBoxSignal=this.selectionService.getSelectionBoxSignal(),this.boundingBoxSignal=this.selectionService.getBoundingBoxSignal(),this.transform=this.canvasService.getTransform(),this.filteredElements=(0,e.EWP)(()=>{const t=this.layers(),s=this.elements(),z=t.filter(V=>V.visible).map(V=>V.id);if(0===z.length)return[];const _=s.filter(V=>!V.layerId||z.includes(V.layerId));return(V=_,V.slice().sort((K,ae)=>{const me=K.layerId?t.find(ve=>ve.id===K.layerId):void 0,ce=ae.layerId?t.find(ve=>ve.id===ae.layerId):void 0;return 1e3*(me?.zIndex??0)+(K.zIndex??0)-(1e3*(ce?.zIndex??0)+(ae.zIndex??0))})).map(V=>({...V,transform:this.buildTransform(V),isLocked:this.computeIsLocked(V,t),blendMode:this.computeBlendMode(V,t)}));var V}),this.canvasWidth=(0,e.EWP)(()=>this.config().canvasWidth),this.canvasHeight=(0,e.EWP)(()=>this.config().canvasHeight),this.zoom=(0,e.EWP)(()=>this.config().zoom),this.x=(0,e.EWP)(()=>this.config().x),this.y=(0,e.EWP)(()=>this.config().y),this.canvasX=(0,e.EWP)(()=>this.config().canvasX),this.canvasY=(0,e.EWP)(()=>this.config().canvasY),this.gridSize=(0,e.EWP)(()=>this.config().gridSize),this.backgroundColor=(0,e.EWP)(()=>this.config().backgroundColor),this.enableGrid=(0,e.EWP)(()=>this.config().enableGrid),this.fullScreen=(0,e.EWP)(()=>this.config().fullScreen),this.svgDimensions=(0,e.EWP)(()=>{const t=this.fullScreen(),s=this.canvasWidth(),v=this.canvasHeight(),z=this.zoom();return t?{width:"100%",height:"100%"}:{width:s*z+"px",height:v*z+"px"}}),this.svgViewBox=(0,e.EWP)(()=>this.fullScreen()?`0 0 ${this.canvasWidth()/this.zoom()} ${this.canvasHeight()/this.zoom()}`:`0 0 ${this.canvasWidth()} ${this.canvasHeight()}`),this.contentTransform=(0,e.EWP)(()=>`translate(${this.x()}, ${this.y()})`),this.gridConfig=(0,e.EWP)(()=>{const t=this.x(),s=this.y(),v=this.zoom();return{transform:`translate(${t%100}, ${s%100})`,width:(this.canvasWidth()+100)/v,height:(this.canvasHeight()+100)/v}}),this.cursor=(0,e.EWP)(()=>this.toolsService.cursor()),this.types=f.R,this.tools=m.p}buildTransform(t){return`translate(${t.x},${t.y}) rotate(${t.rotation}) scale(${t.scaleX??1},${t.scaleY??1})`}computeIsLocked(t,s){return t.layerId&&s.find(z=>z.id===t.layerId)?.locked||!1}computeBlendMode(t,s){return t.layerId&&s.find(z=>z.id===t.layerId)?.blendMode||"normal"}ngAfterViewInit(){this.apiService.initializeWhiteboard(this.svgContainer.nativeElement)}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275cmp=e.VBU({type:p,selectors:[["ng-whiteboard-canvas"]],viewQuery:function(s,v){if(1&s&&e.GBs(Re,5),2&s){let z;e.mGM(z=e.lsd())&&(v.svgContainer=z.first)}},standalone:!0,features:[e.aNF],decls:18,vars:17,consts:[["svgContainer",""],["id","svgroot","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","tabindex","0","svg","","resizeHandler","","globalKeyboard",""],["id","svgcontent"],["id","smallGrid","patternUnits","userSpaceOnUse"],["fill","none","stroke","gray","stroke-width","0.5"],["id","grid","width","100","height","100","patternUnits","userSpaceOnUse"],["width","100","height","100","fill","url(#smallGrid)"],["d","M 100 0 H 0 V 100","fill","none","stroke","gray","stroke-width","2"],["id","arrow","refX","3","refY","3","markerWidth","6","markerHeight","6","stroke","context-stroke","fill","none","orient","auto"],["d","M 0 0 L 3 3 L 0 6"],["width","100%","height","100%"],[2,"pointer-events","all"],["transform-origin","center",1,"wb_element",3,"id","pointer-events","mix-blend-mode"],["stroke","blue","stroke-dasharray","5,5","fill","transparent"],["id","selectorParentGroup"],["x","-100","y","-100","fill","url(#grid)"],["transform-origin","center",1,"wb_element",3,"id"],["fill","none"],["preserveAspectRatio","none"],["marker-end","url(#arrow)"],["text-anchor","start","alignment-baseline","before-edge"],["id","selectorBox","fill","transparent","stroke","dodgerblue","stroke-width","1","cursor","move","pointer-events","all"],[4,"ngFor","ngForOf"],["id","selectorGrip_rotate_n","r","6","fill","white","stroke","green","stroke-width","1","cursor","grab"],["fill","transparent","stroke","transparent","pointer-events","all"],["width","10","height","10","fill","white","stroke","dodgerblue","stroke-width","1"],["r","6","fill","none","stroke","none","stroke-width","1"]],template:function(s,v){if(1&s&&(e.qSk(),e.j41(0,"svg",1,0)(2,"svg",2)(3,"defs")(4,"pattern",3),e.nrm(5,"path",4),e.k0s(),e.j41(6,"pattern",5),e.nrm(7,"rect",6)(8,"path",7),e.k0s(),e.j41(9,"marker",8),e.nrm(10,"path",9),e.k0s()(),e.nrm(11,"rect",10),e.DNE(12,we,2,3,":svg:g"),e.j41(13,"g",11),e.Z7z(14,We,9,12,":svg:g",12,Se),e.DNE(16,He,1,4,":svg:rect",13)(17,Xe,6,13,":svg:g",14),e.k0s()()()),2&s){let z,_;e.HbH("svgroot "+v.selectedToolSignal()),e.xc7("cursor",v.cursor()),e.R7$(2),e.BMQ("width",v.svgDimensions().width)("height",v.svgDimensions().height)("viewBox",v.svgViewBox())("x",v.canvasX())("y",v.canvasY()),e.R7$(2),e.BMQ("width",v.gridSize())("height",v.gridSize()),e.R7$(),e.BMQ("d","M "+v.gridSize()+" 0 H 0 V "+v.gridSize()),e.R7$(6),e.BMQ("fill",v.backgroundColor()),e.R7$(),e.vxM(12,v.enableGrid()?12:-1),e.R7$(),e.BMQ("transform",v.contentTransform()),e.R7$(),e.Dyx(v.filteredElements()),e.R7$(2),e.vxM(16,(z=v.selectionBoxSignal())?16:-1,z),e.R7$(),e.vxM(17,(_=v.boundingBoxSignal())?17:-1,_)}},dependencies:[S.MD,S.Sq,X,j,_e,c,u,P],styles:["[_nghost-%COMP%]{width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]{position:absolute;inset:0;-webkit-user-select:none;user-select:none;outline:none;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit;background-size:cover;background-position:50%;background-repeat:no-repeat;touch-action:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]:focus{outline:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%], [_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .selectorGroup[_ngcontent-%COMP%]{transform-box:fill-box;transform-origin:center}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-family:Arial,Helvetica,sans-serif}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0})}}return p})();const je=["contextMenu"],Oe=(p,Z)=>Z.id;function Ve(p,Z){if(1&p&&(e.j41(0,"span",9),e.EFF(1),e.k0s()),2&p){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.shortcut)}}function Ge(p,Z){1&p&&(e.j41(0,"span",10),e.EFF(1,"\u203a"),e.k0s())}function Ke(p,Z){if(1&p){const t=e.RV6();e.j41(0,"div",6),e.bIt("click",function(v){const z=e.eBV(t).$implicit,_=e.XpG(2);return e.Njj(_.onItemClick(z,v))})("mouseenter",function(v){const z=e.eBV(t).$implicit,_=e.XpG(2);return e.Njj(_.onItemHover(z,v))})("mouseleave",function(){e.eBV(t);const v=e.XpG(2);return e.Njj(v.onItemLeave())}),e.j41(1,"div",7)(2,"span",8),e.EFF(3),e.k0s(),e.DNE(4,Ve,2,1,"span",9)(5,Ge,2,0,"span",10),e.k0s()()}if(2&p){const t=Z.$implicit,s=e.XpG(2);e.AVh("disabled",!t.enabled)("divider-after",t.divider)("has-submenu",t.submenu)("active",s.hoveredItem===t)("focused",s.isFocused(t)),e.BMQ("title",t.shortcut||null),e.R7$(3),e.JRh(t.label),e.R7$(),e.vxM(4,t.shortcut?4:-1),e.R7$(),e.vxM(5,t.submenu?5:-1)}}function $e(p,Z){if(1&p&&(e.j41(0,"div",3),e.Z7z(1,Ke,6,14,"div",5,Oe),e.k0s()),2&p){const t=Z.$implicit;e.R7$(),e.Dyx(t.items)}}function Qe(p,Z){if(1&p&&(e.j41(0,"span",9),e.EFF(1),e.k0s()),2&p){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.shortcut)}}function Je(p,Z){if(1&p){const t=e.RV6();e.j41(0,"div",13),e.bIt("click",function(v){const z=e.eBV(t).$implicit,_=e.XpG(2);return e.Njj(_.onItemClick(z,v))}),e.j41(1,"div",7)(2,"span",8),e.EFF(3),e.k0s(),e.DNE(4,Qe,2,1,"span",9),e.k0s()()}if(2&p){const t=Z.$implicit,s=e.XpG(2);e.AVh("disabled",!t.enabled)("divider-after",t.divider)("focused",s.isFocused(t)),e.BMQ("title",t.shortcut||null),e.R7$(3),e.JRh(t.label),e.R7$(),e.vxM(4,t.shortcut?4:-1)}}function qe(p,Z){if(1&p){const t=e.RV6();e.j41(0,"div",11),e.bIt("mouseenter",function(){e.eBV(t);const v=e.XpG();return e.Njj(v.onSubmenuEnter())})("mouseleave",function(){e.eBV(t);const v=e.XpG();return e.Njj(v.onSubmenuLeave())})("click",function(v){return e.eBV(t),e.Njj(v.stopPropagation())}),e.Z7z(1,Je,5,9,"div",12,Oe),e.k0s()}if(2&p){const t=e.XpG();e.xc7("left",t.submenuPosition.left,"px")("top",t.submenuPosition.top,"px"),e.R7$(),e.Dyx(t.hoveredItem.submenu)}}let et=(()=>{class p{constructor(t){this.contextMenuService=t,this.hoveredItem=null,this.submenuPosition={left:0,top:0},this.submenuTimeout=null,this.isVisible=this.contextMenuService.getContextMenuVisible(),this.position=this.contextMenuService.getContextMenuPosition(),this.sections=this.contextMenuService.getContextMenuSections(),this.containerBounds=this.contextMenuService.getContainerBounds(),this.focusedItem=(0,e.EWP)(()=>{const s=this.contextMenuService.getFocusedItemIndex()();return this.contextMenuService.getAllMenuItems()[s]||null})}ngOnInit(){this.position=(0,e.EWP)(()=>{const t=this.contextMenuService.getContextMenuPosition()(),s=this.containerBounds();let v=t.x,z=t.y;return s&&(v=t.x-s.left,z=t.y-s.top),this.adjustPosition(v,z)})}ngOnDestroy(){this.contextMenuService.hideContextMenu(),this.submenuTimeout&&clearTimeout(this.submenuTimeout)}onItemClick(t,s){if(t.enabled){if(t.submenu)return void s.stopPropagation();t.action&&this.contextMenuService.executeAction(t.action)}}onItemHover(t,s){this.submenuTimeout&&(clearTimeout(this.submenuTimeout),this.submenuTimeout=null),t.submenu&&t.enabled?(this.hoveredItem=t,this.calculateSubmenuPosition(s.currentTarget)):this.hoveredItem=null}onItemLeave(){this.submenuTimeout&&clearTimeout(this.submenuTimeout),this.submenuTimeout=setTimeout(()=>{this.hoveredItem=null},100)}onSubmenuEnter(){this.submenuTimeout&&(clearTimeout(this.submenuTimeout),this.submenuTimeout=null)}onSubmenuLeave(){this.submenuTimeout&&clearTimeout(this.submenuTimeout),this.submenuTimeout=setTimeout(()=>{this.hoveredItem=null},100)}calculateSubmenuPosition(t){const s=t.getBoundingClientRect(),v=this.containerBounds();if(!v)return void(this.submenuPosition={left:s.right+4,top:s.top-4});const z=200,U=s.left-v.left,V=s.right-v.left,K=s.top-v.top,me=this.contextMenu?.nativeElement?.getBoundingClientRect(),ce=me?me.top-v.top:4,te=me?me.bottom-v.top:v.height-4;let ne=V+4;const ve=v.width-V-4;ve<z&&U-4>ve&&(ne=U-z-4);let J=K;const ze=32*(this.hoveredItem?.submenu?.length||0)+8;J+ze>te&&(J=te-ze),J<ce&&(J=ce),ne<4&&(ne=4),ne+z>v.width-4&&(ne=v.width-z-4),this.submenuPosition={left:ne,top:J}}onKeyDown(t){if(this.isVisible())switch(t.key){case"Escape":t.preventDefault(),this.contextMenuService.hideContextMenu();break;case"ArrowDown":t.preventDefault(),this.contextMenuService.focusNextItem();break;case"ArrowUp":t.preventDefault(),this.contextMenuService.focusPreviousItem();break;case"ArrowRight":t.preventDefault(),this.contextMenuService.openFocusedSubmenu();break;case"ArrowLeft":t.preventDefault(),this.contextMenuService.closeFocusedSubmenu();break;case"Enter":t.preventDefault(),this.contextMenuService.executeFocusedAction();break;case"Home":t.preventDefault(),this.contextMenuService.focusFirstItem();break;case"End":t.preventDefault(),this.contextMenuService.focusLastItem()}}onDocumentClick(t){this.isVisible()&&this.contextMenu?.nativeElement&&(this.contextMenu.nativeElement.contains(t.target)||this.contextMenuService.hideContextMenu())}adjustPosition(t,s){if(!this.contextMenu?.nativeElement)return{x:t,y:s};const z=this.contextMenu.nativeElement.getBoundingClientRect(),_=this.containerBounds();if(!_)return{x:t,y:s};let U=t,V=s;const K=10;t+z.width>_.width-K&&(U=Math.max(K,t-z.width)),U<K&&(U=K);const me=_.height-s-K,ce=Math.min(z.height,400);if(ce>me){const te=s-K;V=ce<=te?s-ce:te>me?s-Math.min(ce,te):Math.max(K,_.height-ce-K)}return V<K&&(V=K),V+ce>_.height-K&&(V=_.height-ce-K),{x:U,y:V}}isFocused(t){return this.focusedItem()===t}static{this.\u0275fac=function(s){return new(s||p)(e.rXU(I))}}static{this.\u0275cmp=e.VBU({type:p,selectors:[["wb-context-menu"]],viewQuery:function(s,v){if(1&s&&e.GBs(je,7),2&s){let z;e.mGM(z=e.lsd())&&(v.contextMenu=z.first)}},hostBindings:function(s,v){1&s&&e.bIt("keydown",function(_){return v.onKeyDown(_)},!1,e.EBC)("click",function(_){return v.onDocumentClick(_)},!1,e.EBC)},standalone:!0,features:[e.aNF],decls:6,vars:7,consts:[["contextMenu",""],[1,"context-menu",3,"click"],[1,"context-menu-content"],[1,"context-menu-section"],[1,"submenu",3,"left","top"],[1,"context-menu-item",3,"disabled","divider-after","has-submenu","active","focused"],[1,"context-menu-item",3,"click","mouseenter","mouseleave"],[1,"item-content"],[1,"item-label"],[1,"item-shortcut"],[1,"item-arrow"],[1,"submenu",3,"mouseenter","mouseleave","click"],[1,"context-menu-item","submenu-item",3,"disabled","divider-after","focused"],[1,"context-menu-item","submenu-item",3,"click"]],template:function(s,v){if(1&s){const z=e.RV6();e.j41(0,"div",1,0),e.bIt("click",function(U){return e.eBV(z),e.Njj(U.stopPropagation())}),e.j41(2,"div",2),e.Z7z(3,$e,3,0,"div",3,Oe),e.k0s()(),e.DNE(5,qe,3,4,"div",4)}2&s&&(e.xc7("left",v.position().x,"px")("top",v.position().y,"px"),e.AVh("visible",v.isVisible()),e.R7$(3),e.Dyx(v.sections()),e.R7$(2),e.vxM(5,v.hoveredItem&&v.hoveredItem.submenu?5:-1))},dependencies:[S.MD],styles:['.context-menu[_ngcontent-%COMP%]{position:absolute;z-index:10000;opacity:0;visibility:hidden;transform:scale(.95);transition:all .1s ease-out;pointer-events:none}.context-menu.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;transform:scale(1);pointer-events:auto}.context-menu-content[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:6px;box-shadow:0 4px 12px #00000026;padding:4px 0;min-width:200px;max-width:300px;max-height:400px;overflow-y:auto;-webkit-user-select:none;user-select:none}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.context-menu-section[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #f0f0f0;margin-bottom:4px;padding-bottom:4px}.context-menu-item[_ngcontent-%COMP%]{padding:8px 16px;cursor:pointer;transition:background-color .1s ease;position:relative}.context-menu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#f5f5f5}.context-menu-item.focused[_ngcontent-%COMP%]:not(.disabled){background-color:#e3f2fd;outline:2px solid #2196f3;outline-offset:-2px}.context-menu-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.context-menu-item.divider-after[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:16px;right:16px;height:1px;background-color:#e0e0e0;margin-bottom:-4px}.item-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.item-label[_ngcontent-%COMP%]{flex:1;font-size:14px;color:#333;font-weight:400}.item-shortcut[_ngcontent-%COMP%]{font-size:12px;color:#666;margin-left:16px;font-family:Monaco,Menlo,Ubuntu Mono,monospace}.item-arrow[_ngcontent-%COMP%]{margin-left:8px;font-size:16px;color:#999}.context-menu-item.has-submenu[_ngcontent-%COMP%]{position:relative}.context-menu-item.has-submenu.active[_ngcontent-%COMP%]{background-color:#f5f5f5}.submenu[_ngcontent-%COMP%]{position:absolute;background:#fff;border:1px solid #e0e0e0;border-radius:6px;box-shadow:0 4px 12px #00000026;padding:4px 0;min-width:200px;max-width:300px;-webkit-user-select:none;user-select:none;z-index:10001;opacity:1;transform:scale(1);transition:opacity .1s ease,transform .1s ease}.submenu-item[_ngcontent-%COMP%]{padding:8px 16px}.submenu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#f5f5f5}.context-menu-item.disabled[_ngcontent-%COMP%]   .item-label[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-shortcut[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-arrow[_ngcontent-%COMP%]{color:#999}@media (prefers-color-scheme: dark){.context-menu-content[_ngcontent-%COMP%], .submenu[_ngcontent-%COMP%]{background:#2a2a2a;border-color:#404040}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#3a3a3a}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#666}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#777}.context-menu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#404040}.context-menu-item.focused[_ngcontent-%COMP%]:not(.disabled){background-color:#1e3a5f;outline:2px solid #1976d2}.context-menu-item.has-submenu.active[_ngcontent-%COMP%]{background-color:#404040}.submenu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#404040}.item-label[_ngcontent-%COMP%]{color:#e0e0e0}.item-shortcut[_ngcontent-%COMP%]{color:#a0a0a0}.item-arrow[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-label[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-shortcut[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-arrow[_ngcontent-%COMP%]{color:#666}.context-menu-section[_ngcontent-%COMP%]:not(:last-child){border-bottom-color:#404040}.context-menu-item.divider-after[_ngcontent-%COMP%]:after{background-color:#404040}}']})}}return p})();var tt=y(6255),nt=y(3437),it=y(875),st=y(1389),ot=y(3909),rt=y(3452),at=y(4764),lt=y(710);let ct=(()=>{class p{constructor(){this.configService=(0,e.WQX)(i.w),this.apiService=(0,e.WQX)(E.G),this.toolsService=(0,e.WQX)(a.H),this.eventBusService=(0,e.WQX)(o.W),this.cd=(0,e.WQX)(e.gRc),this.instanceService=(0,e.WQX)(k.b),this.boardId=crypto.randomUUID(),this.ready=new e.bkB,this.destroyed=new e.bkB,this.drawStart=new e.bkB,this.drawing=new e.bkB,this.drawEnd=new e.bkB,this.elementsAdded=new e.bkB,this.elementsUpdated=new e.bkB,this.elementsSelected=new e.bkB,this.elementsRemoved=new e.bkB,this.elementDoubleClicked=new e.bkB,this.undo=new e.bkB,this.redo=new e.bkB,this.clear=new e.bkB,this.dataChange=new e.bkB,this.save=new e.bkB,this.imageAdded=new e.bkB,this.selectedToolChange=new e.bkB,this.configChange=new e.bkB,this.zoomChange=new e.bkB,this.eventsMap={[h.w.Ready]:this.ready,[h.w.Destroyed]:this.destroyed,[h.w.DrawStart]:this.drawStart,[h.w.Drawing]:this.drawing,[h.w.DrawEnd]:this.drawEnd,[h.w.ElementsAdded]:this.elementsAdded,[h.w.ElementsUpdated]:this.elementsUpdated,[h.w.ElementsSelected]:this.elementsSelected,[h.w.ElementsRemoved]:this.elementsRemoved,[h.w.ElementDoubleClicked]:this.elementDoubleClicked,[h.w.Undo]:this.undo,[h.w.Redo]:this.redo,[h.w.Clear]:this.clear,[h.w.DataChange]:this.dataChange,[h.w.Save]:this.save,[h.w.ImageAdded]:this.imageAdded,[h.w.ToolChange]:this.selectedToolChange,[h.w.ConfigChange]:this.configChange,[h.w.ZoomChange]:this.zoomChange},this.forwardEventsEffect=(0,e.QZP)(()=>{const s=this.eventBusService.getAllEventsSignal()();if(!s)return;const v=this.eventsMap[s.type];v&&(void 0!==s.payload?v.emit(s.payload):v.emit(),this.cd.markForCheck())})}set config(t){this.configService.updateConfig(t,!1)}get config(){return this.configService.getConfig()}set data(t){t&&t!==this.apiService.getElements()&&this.apiService.setElements(t)}set selectedTool(t){t&&this.toolsService.getActiveToolType()!==t&&this.toolsService.setActiveTool(t)}ngOnInit(){this.instanceService.register(this.boardId,this.apiService)}ngOnDestroy(){this.instanceService.unregister(this.boardId),this.eventBusService.emit(h.w.Destroyed)}static{this.\u0275fac=function(s){return new(s||p)}}static{this.\u0275cmp=e.VBU({type:p,selectors:[["ng-whiteboard"]],inputs:{boardId:"boardId",config:"config",data:"data",selectedTool:"selectedTool"},outputs:{ready:"ready",destroyed:"destroyed",drawStart:"drawStart",drawing:"drawing",drawEnd:"drawEnd",elementsAdded:"elementsAdded",elementsUpdated:"elementsUpdated",elementsSelected:"elementsSelected",elementsRemoved:"elementsRemoved",elementDoubleClicked:"elementDoubleClicked",undo:"undo",redo:"redo",clear:"clear",dataChange:"dataChange",save:"save",imageAdded:"imageAdded",selectedToolChange:"selectedToolChange",configChange:"configChange",zoomChange:"zoomChange"},standalone:!0,features:[e.Jv_([B,E.G,tt.L,D.W,st.q,at.T,lt.l,R.A,ot.W,a.H,rt.r,o.W,i.w,C,nt.a,it.k,I,l,T]),e.aNF],decls:3,vars:0,consts:[[2,"width","100%","height","100%","position","relative"]],template:function(s,v){1&s&&(e.j41(0,"div",0),e.nrm(1,"ng-whiteboard-canvas")(2,"wb-context-menu"),e.k0s())},dependencies:[S.MD,Ue,et],styles:["[_nghost-%COMP%]{display:block;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}"],changeDetection:0})}}return p})()},152:($,F,y)=>{y.d(F,{B:()=>k});var S=y(3236),e=y(9974),E=y(4360);function k(D,i=S.E){return(0,e.N)((u,h)=>{let m=null,n=null,a=null;const o=()=>{if(m){m.unsubscribe(),m=null;const C=n;n=null,h.next(C)}};function g(){const C=a+D,r=i.now();if(r<C)return m=this.schedule(void 0,C-r),void h.add(m);o()}u.subscribe((0,E._)(h,C=>{n=C,a=i.now(),m||(m=i.schedule(g,D),h.add(m))},()=>{o(),h.complete()},void 0,()=>{n=m=null}))})}},6780:($,F,y)=>{y.d(F,{R:()=>D});var S=y(8359);class e extends S.yU{constructor(u,h){super()}schedule(u,h=0){return this}}const E={setInterval(i,u,...h){const{delegate:m}=E;return m?.setInterval?m.setInterval(i,u,...h):setInterval(i,u,...h)},clearInterval(i){const{delegate:u}=E;return(u?.clearInterval||clearInterval)(i)},delegate:void 0};var k=y(7908);class D extends e{constructor(u,h){super(u,h),this.scheduler=u,this.work=h,this.pending=!1}schedule(u,h=0){var m;if(this.closed)return this;this.state=u;const n=this.id,a=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(a,n,h)),this.pending=!0,this.delay=h,this.id=null!==(m=this.id)&&void 0!==m?m:this.requestAsyncId(a,this.id,h),this}requestAsyncId(u,h,m=0){return E.setInterval(u.flush.bind(u,this),m)}recycleAsyncId(u,h,m=0){if(null!=m&&this.delay===m&&!1===this.pending)return h;null!=h&&E.clearInterval(h)}execute(u,h){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const m=this._execute(u,h);if(m)return m;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(u,h){let n,m=!1;try{this.work(u)}catch(a){m=!0,n=a||new Error("Scheduled action threw falsy error")}if(m)return this.unsubscribe(),n}unsubscribe(){if(!this.closed){const{id:u,scheduler:h}=this,{actions:m}=h;this.work=this.state=this.scheduler=null,this.pending=!1,(0,k.o)(m,this),null!=u&&(this.id=this.recycleAsyncId(h,u,null)),this.delay=null,super.unsubscribe()}}}},3604:($,F,y)=>{y.d(F,{q:()=>E});const S={now:()=>(S.delegate||Date).now(),delegate:void 0};class e{constructor(D,i=e.now){this.schedulerActionCtor=D,this.now=i}schedule(D,i=0,u){return new this.schedulerActionCtor(this,D).schedule(u,i)}}e.now=S.now;class E extends e{constructor(D,i=e.now){super(D,i),this.actions=[],this._active=!1}flush(D){const{actions:i}=this;if(this._active)return void i.push(D);let u;this._active=!0;do{if(u=D.execute(D.state,D.delay))break}while(D=i.shift());if(this._active=!1,u){for(;D=i.shift();)D.unsubscribe();throw u}}}},3236:($,F,y)=>{y.d(F,{E:()=>E,b:()=>k});var S=y(6780);const E=new(y(3604).q)(S.R),k=E}}]);