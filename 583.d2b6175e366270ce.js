"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[583],{7879:(it,I,d)=>{d.d(I,{GF:()=>at,Mt:()=>c,RZ:()=>H,Vf:()=>y,YO:()=>L,bO:()=>St,wM:()=>s});const c="selectorGroup",s="svgroot",H="item_",L="selectorGrip",y="selectorBox",at=1e3,St={high:3,normal:2,low:1}},3052:(it,I,d)=>{d.d(I,{X:()=>c});var c=function(s){return s.Save="save",s.Undo="undo",s.Redo="redo",s.Clear="clear",s.AddImage="addImage",s.ToggleGrid="toggleGrid",s.AddElement="addElement",s.UpdateElement="updateElement",s.removeElement="removeElement",s.SelectElement="selectElement",s.UpdateSelectedElement="updateSelectedElement",s.SetActiveTool="setActiveTool",s.SetCanvasDimensions="setCanvasDimensions",s.SetCanvasPosition="setCanvasPosition",s.UpdateGridTranslation="updateGridTranslation",s.UpdateElementsTranslation="updateElementsTranslation",s.FullScreen="fullScreen",s.CenterCanvas="centerCanvas",s.Batch="batch",s}(c||{})},2262:(it,I,d)=>{d.d(I,{R:()=>c});var c=function(s){return s.Pen="pen",s.Rectangle="rectangle",s.Ellipse="ellipse",s.Line="line",s.Arrow="arrow",s.Text="text",s.Image="image",s}(c||{})},872:(it,I,d)=>{d.d(I,{p:()=>c});var c=function(s){return s.Hand="hand",s.Select="select",s.Pen="pen",s.Rectangle="rectangle",s.Image="image",s.Line="line",s.Arrow="arrow",s.Ellipse="ellipse",s.Text="text",s.Eraser="eraser",s}(c||{})},6078:(it,I,d)=>{d.d(I,{$3:()=>s,OP:()=>L,o8:()=>c,pP:()=>H});var c=function(y){return y.Png="png",y.Jpeg="jpeg",y.Svg="svg",y.Base64="base64",y}(c||{}),s=function(y){return y.Round="round",y.Butt="butt",y.Square="square",y}(s||{}),H=function(y){return y.Round="round",y.Miter="miter",y.Bevel="bevel",y.MiterClip="miter-clip",y}(H||{}),L=function(y){return y.NW="nw",y.N="n",y.NE="ne",y.E="e",y.SE="se",y.S="s",y.SW="sw",y.W="w",y}(L||{})},583:(it,I,d)=>{d.d(I,{I:()=>ii});var c=d(1635),s=d(4438),H=d(1985),L=d(6977);function y(n){n||((0,s.Af3)(y),n=(0,s.WQX)(s.abz));const e=new H.c(t=>n.onDestroy(t.next.bind(t)));return t=>t.pipe((0,L.Q)(e))}var bt=d(5964),C=d(3052),Tt=d(4523),nt=d(4412),Dt=d(4572),Ot=d(9974);const{isArray:Y}=Array;function lt(n){return 1===n.length&&Y(n[0])?n[0]:n}var u=d(6450),E=d(1203),X=d(9326);function j(...n){const e=(0,X.ms)(n);return e?(0,E.F)(j(...n),(0,u.I)(e)):(0,Ot.N)((t,i)=>{(0,Dt.P)([t,...lt(n)])(i)})}function K(...n){return j(...n)}var st=d(6354),B=d(7879),m=d(2262),f=d(6078);const U={strokeWidth:2,strokeColor:"#000000",fill:"#000000",lineJoin:f.pP.Miter,lineCap:f.$3.Butt,dasharray:"",dashoffset:0},ht={...U,fontSize:14,fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal",color:"#000000"};function z(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function S(n,e){const t=e;return Math.round(n/t)*t}function Z(n,e,t,i){const r=Math.PI/4,o=t-n,a=i-e,l=Math.atan2(a,o),h=Math.sqrt(o*o+a*a),p=Math.round(l/r)*r;return{x:n+h*Math.cos(p),y:e+h*Math.sin(p),a:p}}function W(n,e){const t=document.createElement("a");t.href=n,t.setAttribute("visibility","hidden"),t.download=e||"new white-board",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function _t(n,e,t,i=(r=>r)){return n*i(.5-e*(.5-t))}function G(n,e){return[n[0]+e[0],n[1]+e[1]]}function F(n,e){return[n[0]-e[0],n[1]-e[1]]}function N(n,e){return[n[0]*e,n[1]*e]}function ct(n){return[n[1],-n[0]]}function Yt(n,e){return n[0]*e[0]+n[1]*e[1]}function ue(n,e){return n[0]===e[0]&&n[1]===e[1]}function jt(n,e){return function fe(n){return n[0]*n[0]+n[1]*n[1]}(F(n,e))}function Ht(n){return function de(n,e){return[n[0]/e,n[1]/e]}(n,function ge(n){return Math.hypot(n[0],n[1])}(n))}function pe(n,e){return Math.hypot(n[1]-e[1],n[0]-e[0])}function dt(n,e,t){let i=Math.sin(t),r=Math.cos(t),o=n[0]-e[0],a=n[1]-e[1];return[o*r-a*i+e[0],o*i+a*r+e[1]]}function Rt(n,e,t){return G(n,N(F(e,n),t))}function Lt(n,e,t){return G(n,N(e,t))}var{min:rt,PI:ye}=Math,ut=ye+1e-4;const be={size:1,smoothing:1,thinning:0,streamline:1};function It(n,e=1){return function Ee(n,e=!0){const t=n.length;if(t<4)return"";let i=n[0],r=n[1];const o=n[2];let a=`M${i[0].toFixed(2)},${i[1].toFixed(2)} Q${r[0].toFixed(2)},${r[1].toFixed(2)} ${((r[0]+o[0])/2).toFixed(2)},${((r[1]+o[1])/2).toFixed(2)} T`;for(let l=2,h=t-1;l<h;l++)i=n[l],r=n[l+1],a+=`${((i[0]+r[0])/2).toFixed(2)},${((i[1]+r[1])/2).toFixed(2)} `;return e&&(a+="Z"),a}(function Se(n,e={}){return function me(n,e={}){let{size:t=16,smoothing:i=.5,thinning:r=.5,simulatePressure:o=!0,easing:a=(v=>v),start:l={},end:h={},last:p=!1}=e,{cap:M=!0,easing:b=(v=>v*(2-v))}=l,{cap:A=!0,easing:O=(v=>--v*v*v+1)}=h;if(0===n.length||t<=0)return[];let zt,D=n[n.length-1].runningLength,_=!1===l.taper?0:!0===l.taper?Math.max(t,D):l.taper,pt=!1===h.taper?0:!0===h.taper?Math.max(t,D):h.taper,ie=Math.pow(t*i,2),yt=[],ot=[],Xt=n.slice(0,10).reduce((v,T)=>{let w=T.pressure;if(o){let k=rt(1,T.distance/t),At=rt(1,1-k);w=rt(1,v+.275*k*(At-v))}return(v+w)/2},n[0].pressure),R=_t(t,r,n[n.length-1].pressure,a),Ft=n[0].vector,mt=n[0].point,Pt=mt,tt=mt,et=Pt,Gt=!1;for(let v=0;v<n.length;v++){let{pressure:T}=n[v],{point:w,vector:k,distance:At,runningLength:vt}=n[v];if(v<n.length-1&&D-vt<3)continue;if(r){if(o){let J=rt(1,At/t),Wt=rt(1,1-J);T=rt(1,Xt+.275*J*(Wt-Xt))}R=_t(t,r,T,a)}else R=t/2;void 0===zt&&(zt=R);let ni=vt<_?b(vt/_):1,si=D-vt<pt?O((D-vt)/pt):1;R=Math.max(.01,R*Math.min(ni,si));let ne=(v<n.length-1?n[v+1]:n[v]).vector,Ut=v<n.length-1?Yt(k,ne):1,se=null!==Ut&&Ut<0;if(Yt(k,Ft)<0&&!Gt||se){let J=N(ct(Ft),R);for(let Wt=1/13,Mt=0;Mt<=1;Mt+=Wt)tt=dt(F(w,J),w,ut*Mt),yt.push(tt),et=dt(G(w,J),w,ut*-Mt),ot.push(et);mt=tt,Pt=et,se&&(Gt=!0);continue}if(Gt=!1,v===n.length-1){let J=N(ct(k),R);yt.push(F(w,J)),ot.push(G(w,J));continue}let re=N(ct(Rt(ne,k,Ut)),R);tt=F(w,re),(v<=1||jt(mt,tt)>ie)&&(yt.push(tt),mt=tt),et=G(w,re),(v<=1||jt(Pt,et)>ie)&&(ot.push(et),Pt=et),Xt=T,Ft=k}let V=n[0].point.slice(0,2),Q=n.length>1?n[n.length-1].point.slice(0,2):G(n[0].point,[1,1]),Nt=[],kt=[];if(1===n.length){if(!_&&!pt||p){let v=Lt(V,Ht(ct(F(V,Q))),-(zt||R)),T=[];for(let w=1/13,k=w;k<=1;k+=w)T.push(dt(v,V,2*ut*k));return T}}else{if(!(_||pt&&1===n.length))if(M)for(let T=1/13,w=T;w<=1;w+=T){let k=dt(ot[0],V,ut*w);Nt.push(k)}else{let T=F(yt[0],ot[0]),w=N(T,.5),k=N(T,.51);Nt.push(F(V,w),F(V,k),G(V,k),G(V,w))}let v=ct(function ce(n){return[-n[0],-n[1]]}(n[n.length-1].vector));if(pt||_&&1===n.length)kt.push(Q);else if(A){let T=Lt(Q,v,R);for(let w=1/29,k=w;k<1;k+=w)kt.push(dt(T,Q,3*ut*k))}else kt.push(G(Q,N(v,R)),G(Q,N(v,.99*R)),F(Q,N(v,.99*R)),F(Q,N(v,R)))}return yt.concat(kt,ot.reverse(),Nt)}(function ve(n,e={}){var t;let{streamline:i=.5,size:r=16,last:o=!1}=e;if(0===n.length)return[];let a=.15+.85*(1-i),l=Array.isArray(n[0])?n:n.map(({x:O,y:D,pressure:_=.5})=>[O,D,_]);if(2===l.length){let O=l[1];l=l.slice(0,-1);for(let D=1;D<5;D++)l.push(Rt(l[0],O,D/4))}1===l.length&&(l=[...l,[...G(l[0],[1,1]),...l[0].slice(2)]]);let h=[{point:[l[0][0],l[0][1]],pressure:l[0][2]>=0?l[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],p=!1,M=0,b=h[0],A=l.length-1;for(let O=1;O<l.length;O++){let D=o&&O===A?l[O].slice(0,2):Rt(b.point,l[O],a);if(ue(b.point,D))continue;let _=pe(D,b.point);if(M+=_,O<A&&!p){if(M<r)continue;p=!0}b={point:D,pressure:l[O][2]>=0?l[O][2]:.5,vector:Ht(F(b.point,D)),distance:_,runningLength:M},h.push(b)}return h[0].vector=(null==(t=h[1])?void 0:t.vector)||[0,0],h}(n,e),e)}(n,{...be,size:e}))}const Qt={[m.R.Arrow]:new class oe{create(e){return{type:m.R.Arrow,id:z(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,...e,style:{...U,...e.style}}}resize(e,t,i,r){return t.includes(f.OP.N)&&(e.y2+=r),t.includes(f.OP.S)&&(e.y1+=r),t.includes(f.OP.W)&&(e.x1+=i),t.includes(f.OP.E)&&(e.x2+=i),e}},[m.R.Ellipse]:new class ae{create(e){return{type:m.R.Ellipse,id:z(),x:0,y:0,cx:0,cy:0,rx:1,ry:1,rotation:0,opacity:100,...e,style:{...U,...e.style}}}resize(e,t,i,r){if(t.includes(f.OP.N)){const o=e.ry-r/2;o>0&&(e.ry=o,e.cy+=r/2)}if(t.includes(f.OP.S)){const o=e.ry+r/2;o>0&&(e.ry=o,e.cy+=r/2)}if(t.includes(f.OP.W)){const o=e.rx-i/2;o>0&&(e.rx=o,e.cx+=i/2)}if(t.includes(f.OP.E)){const o=e.rx+i/2;o>0&&(e.rx=o,e.cx+=i/2)}return e}},[m.R.Image]:new class le{create(e){return{type:m.R.Image,id:z(),x:0,y:0,width:1,height:1,src:"",rotation:0,opacity:100,...e,style:{...U,...e.style}}}resize(e,t,i,r){if(t.includes(f.OP.N)){const o=e.height-r;o>0&&(e.y+=r,e.height=o)}if(t.includes(f.OP.S)){const o=e.height+r;o>0&&(e.height=o)}if(t.includes(f.OP.W)){const o=e.width-i;o>0&&(e.x+=i,e.width=o)}if(t.includes(f.OP.E)){const o=e.width+i;o>0&&(e.width=o)}return e}},[m.R.Line]:new class he{create(e){return{type:m.R.Line,id:z(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,...e,style:{...U,...e.style}}}resize(e,t,i,r){return t.includes(f.OP.N)&&(e.y1+=r),t.includes(f.OP.S)&&(e.y2+=r),t.includes(f.OP.W)&&(e.x1+=i),t.includes(f.OP.E)&&(e.x2+=i),e}},[m.R.Pen]:new class Pe{create(e){return{type:m.R.Pen,id:z(),x:0,y:0,points:[],path:"",rotation:0,opacity:100,...e,style:{...U,...e.style}}}resize(e,t,i,r){const o=function we(n){if(0===n.length)return{x:0,y:0,width:0,height:0};let e=1/0,t=1/0,i=-1/0,r=-1/0;return n.forEach(o=>{o[0]<e&&(e=o[0]),o[1]<t&&(t=o[1]),o[0]>i&&(i=o[0]),o[1]>r&&(r=o[1])}),{x:e,y:t,width:i-e,height:r-t}}(e.points),{points:a,position:l}=this.getScaleFactors(t,o,i,r),h=o.x+o.width/2,p=o.y+o.height/2,[M,b]=a;return o.width*M<10||o.height*b<10||(e.x+=l.x,e.y+=l.y,e.points=e.points.map(A=>[h+(A[0]-h)*M,p+(A[1]-p)*b]),e.path=It(e.points)),e}getScaleFactors(e,t,i,r){const o=[1,1],a={x:0,y:0};return e.includes("w")&&(o[0]=(t.width-i)/t.width,a.x+=i/2),e.includes("n")&&(o[1]=(t.height-r)/t.height,a.y+=r/2),e.includes("e")&&(o[0]=(t.width+i)/t.width,a.x+=i/2),e.includes("s")&&(o[1]=(t.height+r)/t.height,a.y+=r/2),{points:o,position:a}}},[m.R.Rectangle]:new class ke{create(e){return{type:m.R.Rectangle,id:z(),x:0,y:0,width:1,height:1,rx:5,rotation:0,opacity:100,...e,style:{...U,...e.style}}}resize(e,t,i,r){if(t.includes(f.OP.N)){const o=e.height-r;o>0&&(e.y+=r,e.height=o)}if(t.includes(f.OP.S)){const o=e.height+r;o>0&&(e.height=o)}if(t.includes(f.OP.W)){const o=e.width-i;o>0&&(e.x+=i,e.width=o)}if(t.includes(f.OP.E)){const o=e.width+i;o>0&&(e.width=o)}return e}},[m.R.Text]:new class Me{create(e){return{type:m.R.Text,id:z(),x:0,y:0,text:"",rotation:0,opacity:100,scaleX:1,scaleY:1,...e,style:{...ht,...e.style}}}resize(e,t,i,r){const l=.016*i,h=.016*r;switch(t){case f.OP.NW:e.x+=i,e.y+=r,e.scaleX=Math.max(.1,e.scaleX-l),e.scaleY=Math.max(.1,e.scaleY-h);break;case f.OP.N:e.y+=r,e.scaleY=Math.max(.1,e.scaleY-h);break;case f.OP.NE:e.y+=r,e.scaleX=Math.max(.1,e.scaleX+l),e.scaleY=Math.max(.1,e.scaleY-h);break;case f.OP.E:e.scaleX=Math.max(.1,e.scaleX+l);break;case f.OP.SE:e.scaleX=Math.max(.1,e.scaleX+l),e.scaleY=Math.max(.1,e.scaleY+h);break;case f.OP.S:e.scaleY=Math.max(.1,e.scaleY+h);break;case f.OP.SW:e.x+=i,e.scaleX=Math.max(.1,e.scaleX-l),e.scaleY=Math.max(.1,e.scaleY+h);break;case f.OP.W:e.x+=i,e.scaleX=Math.max(.1,e.scaleX-l)}return e}}};function q(n,e){return Qt[n].create(e)}var x=d(872),g=function(n){return n.Ready="ready",n.Destroyed="destroyed",n.DrawStart="drawStart",n.Drawing="drawing",n.DrawEnd="drawEnd",n.ElementAdded="elementAdded",n.ElementUpdated="elementUpdated",n.ElementSelected="elementSelected",n.ElementDeleted="elementDeleted",n.Undo="undo",n.Redo="redo",n.Clear="clear",n.DataChange="dataChange",n.Save="save",n.ImageAdded="imageAdded",n.ToolChange="toolChange",n.ConfigChange="configChange",n}(g||{}),wt=d(1413);let gt=(()=>{class n{constructor(){this.eventSubject=new wt.B}ngOnDestroy(){this.destroy()}emit(t,i){this.eventSubject.next({type:t,payload:i})}listen(){return this.eventSubject.asObservable()}listenTo(t){return this.eventSubject.pipe((0,bt.p)(i=>i.type===t),(0,st.T)(i=>i.payload))}destroy(){this.eventSubject.complete()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=s.jDH({token:n,factory:n.\u0275fac})}}return n})(),Et=(()=>{class n{constructor(t){this.eventBusService=t,this.config={drawingEnabled:!0,canvasWidth:800,canvasHeight:600,fullScreen:!0,center:!0,strokeColor:"#333333",strokeWidth:2,backgroundColor:"#F8F9FA",lineJoin:f.pP.Miter,lineCap:f.$3.Butt,fill:"transparent",zoom:1,fontFamily:"sans-serif",fontSize:24,dasharray:"",dashoffset:0,x:0,y:0,enableGrid:!1,gridSize:10,snapToGrid:!0,rubberBox:{x:0,y:0,width:0,height:0,display:"none"},gridTranslation:{x:0,y:0},elementsTranslation:{x:0,y:0}}}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t},this.eventBusService.emit(g.ConfigChange,t)}isConfigDifferent(t,i){return this.config[t]!==i}updateConfigValue(t,i){this.config[t]=i,this.eventBusService.emit(g.ConfigChange,{[t]:i})}checkAndUpdateConfig(t,i){this.isConfigDifferent(t,i)&&this.updateConfigValue(t,i)}static{this.\u0275fac=function(i){return new(i||n)(s.KVO(gt))}}static{this.\u0275prov=s.jDH({token:n,factory:n.\u0275fac})}}return n})(),ft=(()=>{class n{constructor(t,i,r){this.EventBusService=t,this.configService=i,this.undoStack=[],this.redoStack=[],this.initialData=[],this.data=new nt.t([]),this.draftData=new nt.t([]),this.selectedTool=new nt.t(x.p.Pen),this.selectedElement=new nt.t(null),this.svgContainer=null,this.data$=this.data.pipe(K(this.draftData),(0,st.T)(([o,a])=>[...o,...a])),this.selectedTool$=this.selectedTool.asObservable(),this.debouncedPushToUndo=function xt(n,e){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>n(...i),e)}}(this.pushToUndo.bind(this),300),this.renderer=r.createRenderer(null,null)}initializeWhiteboard(t){this.svgContainer=t,this.initialData=JSON.parse(JSON.stringify(this.data.getValue())),this.EventBusService.emit(g.Ready)}getCanvas(){if(!this.svgContainer)throw new Error("SVG container not initialized");return this.svgContainer}getConfig(){return this.configService.getConfig()}getData(){return this.data.getValue()}getData$(){return this.data$}setData(t){this.data.next(t),this.EventBusService.emit(g.DataChange,t)}getDraftData(){return this.draftData.getValue()}pushToUndo(){this.undoStack.push(JSON.parse(JSON.stringify(this.getData()))),this.undoStack.length>B.GF&&this.undoStack.shift(),this.redoStack=[]}undo(){if(!this.undoStack.length)return!1;const t=this.undoStack.pop();return this.redoStack.push(t),this.setData(this.undoStack.length?JSON.parse(JSON.stringify(this.undoStack[this.undoStack.length-1])):JSON.parse(JSON.stringify(this.initialData))),this.selectElement(null),this.EventBusService.emit(g.Undo),!0}redo(){if(!this.redoStack.length)return!1;const t=this.redoStack.pop();return this.undoStack.push(JSON.parse(JSON.stringify(t))),this.undoStack.length>B.GF&&this.undoStack.shift(),this.setData(t),this.selectElement(null),this.EventBusService.emit(g.Redo),!0}clear(){this.setData([]),this.pushToUndo(),this.EventBusService.emit(g.Clear)}addElement(t){const i=this.getData();this.setData([...i,t]),this.pushToUndo(),this.EventBusService.emit(g.ElementAdded,t)}addElements(t){const i=this.getData();this.setData([...i,...t]),this.pushToUndo()}addToDraft(t){this.draftData.next([...this.draftData.getValue(),t])}updateDraft(t){const i=this.draftData.getValue(),r=i.findIndex(o=>o.id===t.id);r>-1&&(i[r]=t,this.draftData.next(i))}commitDraftToData(){const t=this.draftData.getValue();t.length&&(this.setData([...this.data.getValue(),...t]),this.pushToUndo(),this.draftData.next([]))}updateElement(t,i=!0){const r=this.getData(),o=r.findIndex(a=>a.id===t.id);o>-1&&(r[o]=t,this.setData(r),i&&(this.pushToUndo(),this.EventBusService.emit(g.ElementUpdated,t)))}removeElement(t){const i=this.getData(),r=i.findIndex(o=>o.id===t);r>-1&&(this.EventBusService.emit(g.ElementDeleted,i[r]),i.splice(r,1),this.setData(i),this.pushToUndo())}hasElement(t){return this.getData().some(i=>i.id===t.id)}getElementBbox(t){const i=`${B.RZ}${t.id}`,r=this.svgContainer?.querySelector(`#${i}`);if(r)return r.getBBox();throw new Error(`Element with id ${i} not found`)}getActiveTool(){return this.selectedTool.getValue()}setActiveTool(t){this.selectedTool.next(t),this.EventBusService.emit(g.ToolChange,t)}getSelectedElement(){return this.selectedElement.getValue()}selectElement(t){if(this.resetGrips(),t){this.selectedElement.next(t),this.setActiveTool(x.p.Select),this.selectedTool.next(x.p.Select);const i=this.getElementBbox(t);this.showGrips(i),this.EventBusService.emit(g.ElementSelected,t)}else this.selectedElement.next(null),this.EventBusService.emit(g.ElementSelected,null)}updateSelectedElement(t){const i=this.getSelectedElement();if(!i)return;const r={...i,...t};this.selectedElement.next(r),this.updateElement(r,!1),this.EventBusService.emit(g.ElementSelected,r),this.debouncedPushToUndo()}getCanvasCoordinates([t,i]){const{zoom:r,x:o,y:a,elementsTranslation:l}=this.getConfig();return[(t-o)/r-l.x,(i-a)/r-l.y]}showGrips(t){const i=this.getSelectedElement();i&&this.configService.updateConfig({rubberBox:{x:t.x-.5*(i.style.strokeWidth||0),y:t.y-.5*(i.style.strokeWidth||0),width:t.width+i.style.strokeWidth||0,height:t.height+i.style.strokeWidth||0,display:"block"}})}resetGrips(){this.configService.updateConfig({rubberBox:{x:0,y:0,width:0,height:0,display:"none"}})}setCanvasDimensions(t,i){this.configService.updateConfig({canvasWidth:t,canvasHeight:i})}setCanvasPosition(t,i){this.configService.updateConfig({x:t,y:i})}updateGridTranslation(t,i){this.configService.updateConfig({gridTranslation:{x:t,y:i}})}updateElementsTranslation(t,i){this.configService.updateConfig({elementsTranslation:{x:t,y:i}})}fullScreen(){this.setCanvasDimensions(this.svgContainer?.clientWidth||0,this.svgContainer?.clientHeight||0)}centerCanvas(){const{canvasWidth:t,canvasHeight:i,zoom:r}=this.getConfig();this.setCanvasPosition(((this.svgContainer?.clientWidth||0)-t*r)/2,((this.svgContainer?.clientHeight||0)-i*r)/2)}toggleGrid(){const{enableGrid:t}=this.getConfig();this.configService.updateConfig({enableGrid:!t})}addImage(t){const i=new Image;i.onload=()=>{const r=this.getConfig().canvasHeight,o=i.width,a=i.height,h=a>r?r-40:a,p=h===r-40?i.width/i.height*(r-40):o;let M=t.x||(o-p)*(t.x||0),b=t.y||(a-h)*(t.y||0);M<0&&(M=0),b<0&&(b=0);const A=q(m.R.Image,{src:t.image,width:p,height:h,x:M,y:b});this.addElement(A),this.selectElement(A),this.pushToUndo(),this.EventBusService.emit(g.ImageAdded,A.src)},i.src=t.image}save(t,i="New board"){var r=this;return(0,Tt.A)(function*(){const a=r.getCanvas().getElementById("svgcontent").cloneNode(!0),l=a.querySelector("#selectorParentGroup");l&&l.remove();const h=a.querySelector("#contentBackground");h&&h.removeAttribute("opacity"),a.setAttribute("x","0"),a.setAttribute("y","0");const p=(new XMLSerializer).serializeToString(a),M=yield function xe(n,e,t,i=f.o8.Png){return new Promise((r,o)=>{const a=document.createElement("canvas");a.width=e,a.height=t;const l=a.getContext("2d"),h=new Image;h.src=`data:image/svg+xml;base64,${btoa(n)}`,h.onload=()=>{l.drawImage(h,0,0,e,t);const p=a.toDataURL(`image/${i}`);r(p)},h.onerror=p=>{o(p)}})}(p,r.getConfig().canvasWidth,r.getConfig().canvasHeight,t);switch(t){case f.o8.Base64:r.EventBusService.emit(g.Save,M);break;case f.o8.Svg:{const b="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(p)));W(b,i),r.EventBusService.emit(g.Save,b);break}default:W(M,i),r.EventBusService.emit(g.Save,M)}})()}static{this.\u0275fac=function(i){return new(i||n)(s.KVO(gt),s.KVO(Et),s.KVO(s._9s))}}static{this.\u0275prov=s.jDH({token:n,factory:n.\u0275fac})}}return n})();var Jt=d(8306);let Kt=(()=>{class n{constructor(t,i){this._dataService=t,this._whiteboardService=i,this.initializeActionListeners()}initializeActionListeners(){this._whiteboardService.actions$.pipe((0,bt.p)(t=>t.length>0)).subscribe(t=>{t.forEach(i=>this.handleAction(i))})}handleAction(t){switch(t.type){case C.X.Undo:this._dataService.undo();break;case C.X.Redo:this._dataService.redo();break;case C.X.Clear:this._dataService.clear();break;case C.X.UpdateSelectedElement:this._dataService.updateSelectedElement(t.payload.partialElement);break;case C.X.Save:{const{format:i,name:r}=t.payload;this._dataService.save(i,r);break}case C.X.ToggleGrid:this._dataService.toggleGrid();break;case C.X.AddImage:this._dataService.addImage(t.payload);break;case C.X.Batch:t.payload.forEach(i=>this.handleAction(i))}}static{this.\u0275fac=function(i){return new(i||n)(s.KVO(ft),s.KVO(Jt.K))}}static{this.\u0275prov=s.jDH({token:n,factory:n.\u0275fac})}}return n})();class ${constructor(e){this.dataService=e,this.active=!1}get whiteboardConfig(){return this.dataService?.getConfig()}activate(){this.active=!0}deactivate(){this.active=!1}get isActive(){return this.active}}class Te extends ${constructor(){super(...arguments),this.type=x.p.Hand,this.isDragging=!1,this.startX=0,this.startY=0}handlePointerDown(e){this.isDragging=!0,this.startX=e.clientX,this.startY=e.clientY}handlePointerMove(e){if(!this.isDragging)return;const t=e.clientX-this.startX,i=e.clientY-this.startY,{gridTranslation:r,elementsTranslation:o}=this.dataService.getConfig(),l={x:o.x+t,y:o.y+i};this.updateGridPosition((r.x+t)%100,(r.y+i)%100),this.updateElementsPosition(l.x,l.y),this.startX=e.clientX,this.startY=e.clientY}handlePointerUp(){this.isDragging=!1}updateGridPosition(e,t){this.dataService.updateGridTranslation(e,t)}updateElementsPosition(e,t){this.dataService.updateElementsTranslation(e,t)}}class De extends ${constructor(){super(...arguments),this.type=x.p.Arrow,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(e){if(!this.active)return;let[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]);const{snapToGrid:r}=this.whiteboardConfig;if(r){const{gridSize:o}=this.whiteboardConfig;t=S(t,o),i=S(i,o)}this.startPoint=[t,i],this.lastX=t,this.lastY=i,this.element=q(m.R.Arrow,{x1:t,y1:i,x2:t,y2:i,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;let[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]);const{snapToGrid:r}=this.whiteboardConfig;if(r){const{gridSize:o}=this.whiteboardConfig;t=S(t,o),i=S(i,o)}if(e.shiftKey){const o=this.element.x1,a=this.element.y1,{x:l,y:h}=Z(o,a,t,i);[t,i]=[l,h]}(Math.abs(t-this.lastX)>this.MIN_LENGTH||Math.abs(i-this.lastY)>this.MIN_LENGTH)&&(this.element.x2=t,this.element.y2=i,this.lastX=t,this.lastY=i)}handlePointerUp(){this.active&&(this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null),this.lastX=0,this.lastY=0)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class Oe extends ${constructor(){super(...arguments),this.type=x.p.Ellipse,this.element=null,this.startPoint=null}handlePointerDown(e){if(!this.active)return;let[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]);const{snapToGrid:r}=this.whiteboardConfig;if(r){const{gridSize:o}=this.whiteboardConfig;t=S(t,o),i=S(i,o)}this.startPoint=[t,i],this.element=q(m.R.Ellipse,{cx:t,cy:i,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element||!this.startPoint)return;const[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]),r=this.startPoint[0]||0,o=this.startPoint[1]||0;let a=Math.abs(r+(t-r)/2),l=Math.abs(o+(i-o)/2),h=Math.abs(r-a),p=Math.abs(o-l);e.shiftKey&&(p=h,l=i>o?o+h:o-h),e.altKey&&(a=r,l=o,h=Math.abs(t-a),p=e.shiftKey?h:Math.abs(i-l)),this.element.rx=h,this.element.ry=p,this.element.cx=a,this.element.cy=l}handlePointerUp(){this.active&&this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}function Zt(n,e){const t=qt(n);if(t){if(t.id===B.Mt)return null;const i=t.getAttribute("data-wb-id");return e.find(o=>o.id===i)||null}return null}function qt(n){if(!n?.target)return null;let e=n.target;for(;e;){if(e.id===B.wM)return null;if(e.id.includes(B.RZ)||e.id.includes(B.YO)||e.id.includes(B.Vf))return e;if(!e.parentNode)break;e=e.parentNode}return null}class Re extends ${constructor(){super(...arguments),this.type=x.p.Eraser,this.hoveredElements=new Set}handlePointerDown(e){this.active&&(this.hoveredElements.clear(),this.processElement(e))}handlePointerUp(){this.active&&(this.hoveredElements.forEach(({id:e})=>{this.dataService.removeElement(e)}),this.hoveredElements.clear())}processElement(e){const t=Zt(e,this.dataService.getData());t&&!this.hoveredElements.has(t)&&(t.opacity=50,this.hoveredElements.add(t),this.dataService.updateElement(t,!1))}}class Ie extends ${constructor(){super(...arguments),this.type=x.p.Image}handlePointerDown(e){const[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]),r=document.createElement("input");r.type="file",r.accept="image/*",r.onchange=o=>{const a=o.target.files;if(a){const l=new FileReader;l.onload=h=>{this.dataService.addImage({image:h.target.result,x:t,y:i})},l.readAsDataURL(a[0])}},r.click()}}class Xe extends ${constructor(){super(...arguments),this.type=x.p.Line,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(e){if(!this.active)return;let[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]);const{snapToGrid:r}=this.whiteboardConfig;if(r){const{gridSize:o}=this.whiteboardConfig;t=S(t,o),i=S(i,o)}this.startPoint=[t,i],this.lastX=t,this.lastY=i,this.element=q(m.R.Line,{x1:t,y1:i,x2:t,y2:i,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;let[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]);const{snapToGrid:r}=this.whiteboardConfig;if(r){const{gridSize:o}=this.whiteboardConfig;t=S(t,o),i=S(i,o)}if(e.shiftKey){const o=this.element.x1,a=this.element.y1,{x:l,y:h}=Z(o,a,t,i);[t,i]=[l,h]}(Math.abs(t-this.lastX)>this.MIN_LENGTH||Math.abs(i-this.lastY)>this.MIN_LENGTH)&&(this.element.x2=t,this.element.y2=i,this.lastX=t,this.lastY=i)}handlePointerUp(){this.active&&(this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null),this.lastX=0,this.lastY=0)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class ze extends ${constructor(){super(...arguments),this.type=x.p.Pen,this.element=null}handlePointerDown(e){if(!this.active)return;const t=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]);this.element=q(m.R.Pen,{points:[t],path:It([t]),style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;const[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]),r=this.element.points;r.push([t,i]),this.element.points=r,this.element.path=It(r)}handlePointerUp(){this.active&&this.element&&(this.dataService.commitDraftToData(),this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,lineJoin:this.whiteboardConfig.lineJoin,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class Fe extends ${constructor(){super(...arguments),this.type=x.p.Rectangle,this.element=null,this.startPoint=null}handlePointerDown(e){if(!this.active)return;let[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]);const{snapToGrid:r}=this.whiteboardConfig;if(r){const{gridSize:o}=this.whiteboardConfig;t=S(t,o),i=S(i,o)}this.startPoint=[t,i],this.element=q(m.R.Rectangle,{x:t,y:i,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element||!this.startPoint)return;const[t,i]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]),r=this.startPoint[0]||0,o=this.startPoint[1]||0;let a=Math.abs(t-r),l=Math.abs(i-o),h=null,p=null;e.shiftKey?(a=l=Math.max(a,l),h=r<t?r:r-a,p=o<i?o:o-l):(h=Math.min(r,t),p=Math.min(o,i)),e.altKey&&(a*=2,l*=2,h=r-a/2,p=o-l/2);const{snapToGrid:M}=this.whiteboardConfig;if(M){const{gridSize:b}=this.whiteboardConfig;a=S(a,b),l=S(l,b),h=S(h,b),p=S(p,b)}this.element.width=a,this.element.height=l,this.element.x=h,this.element.y=p}handlePointerUp(){this.active&&this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineJoin:this.whiteboardConfig.lineJoin,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class Ge extends ${constructor(){super(...arguments),this.type=x.p.Select,this.isDragging=!1,this.currentAction=null,this.direction=f.OP.E}handlePointerDown(e){const t=qt(e);if(t){const i=t.id;i.includes(B.RZ)?(this.currentAction="select",this.handleSelect(t.getAttribute("data-wb-id"))):i.includes("selectorGrip_resize")?(this.currentAction="resize",this.direction=i.split("_")[2],this.handleResize(e)):i.includes("selectorBox")&&(this.currentAction="move",this.handleMove(e)),this.isDragging=!0}else this.dataService.selectElement(null),this.currentAction=null}handlePointerMove(e){this.isDragging&&this.currentAction&&("resize"===this.currentAction?this.handleResize(e):this.handleMove(e))}handlePointerUp(){this.isDragging&&(this.isDragging=!1,this.currentAction=null)}handleSelect(e){const t=this.dataService.getData().find(i=>i.id===e);t&&this.dataService.selectElement(t)}handleResize(e){const t=this.dataService.getSelectedElement();if(!t)return;this.dataService.showGrips(this.dataService.getElementBbox(t));const i=e.movementX,r=e.movementY,o=function Be(n){return Qt[n]}(t.type).resize(t,this.direction,i,r);this.dataService.updateSelectedElement(o)}handleMove(e){const t=this.dataService.getSelectedElement();t&&this.dataService.updateSelectedElement({x:t.x+e.movementX,y:t.y+e.movementY})}}class Ne extends ${constructor(){super(...arguments),this.type=x.p.Text,this.textElement=null,this.textInput=null}handlePointerDown(e){if(!this.active)return;if(this.textInput)return void this.finishTextInput();const t=Zt(e,this.dataService.getData());if(t&&t.type===m.R.Text)return this.textElement=t,void this.createTextInput(t.x,t.y,t.text);const[i,r]=this.dataService.getCanvasCoordinates([e.offsetX,e.offsetY]);this.textElement=this.createTextElement(i,r),this.createTextInput(i,r)}handlePointerUp(){this.textInput&&(this.textInput.addEventListener("blur",()=>this.finishTextInput()),this.textInput.focus())}createTextElement(e,t){const{snapToGrid:i,gridSize:r}=this.whiteboardConfig;return q(m.R.Text,{x:i?S(e,r):e,y:i?S(t,r):t,text:"",style:this.getElementStyle()})}createTextInput(e,t,i=""){const{zoom:r,elementsTranslation:o}=this.whiteboardConfig,a=this.dataService.getCanvas().parentElement?.querySelector("#textInput");a.value=i,a.style.left=(e-Math.abs(o.x))*r+"px",a.style.top=(t-Math.abs(o.y))*r+"px",a.style.fontFamily=this.textElement?.style.fontFamily||this.whiteboardConfig.fontFamily,a.style.fontSize=`${this.textElement?.style.fontSize||this.whiteboardConfig.fontSize}px`,a.style.color=this.textElement?.style.color||this.whiteboardConfig.strokeColor,a.style.transform=`scale(${this.textElement?.scaleX||1}, ${this.textElement?.scaleY||1})`,a.style.display="block",a.addEventListener("input",()=>this.handleTextInput(a)),a.addEventListener("keydown",l=>{"Enter"===l.key&&this.finishTextInput()}),this.textInput=a}handleTextInput(e){e.style.width=`${e.value.length}ch`,this.textElement&&(this.textElement.text=e.value,this.dataService.updateElement(this.textElement))}finishTextInput(){this.textInput&&this.textElement&&(this.textInput.value.trim()?this.dataService.hasElement(this.textElement)||(this.dataService.addElement(this.textElement),this.dataService.pushToUndo()):this.dataService.removeElement(this.textElement.id),this.textInput.style.display="none",this.textInput=null,this.textElement=null)}getElementStyle(){return{color:this.whiteboardConfig.strokeColor,fontSize:this.whiteboardConfig.fontSize,fontFamily:this.whiteboardConfig.fontFamily,lineJoin:this.whiteboardConfig.lineJoin,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,strokeColor:this.whiteboardConfig.fill,strokeWidth:0}}}let te=(()=>{class n{constructor(t){this.dataService=t,this.toolRegistry=new Map,this.initializeDefaultTools(t),this.dataService.selectedTool$.pipe(y()).subscribe(i=>{this.setCurrentTool(i)})}registerTool(t,i){if(this.toolRegistry.has(t))throw new Error(`Tool of type '${t}' is already registered.`);this.toolRegistry.set(t,i)}initializeDefaultTools(t){this.registerTool(x.p.Hand,new Te(t)),this.registerTool(x.p.Pen,new ze(t)),this.registerTool(x.p.Line,new Xe(t)),this.registerTool(x.p.Arrow,new De(t)),this.registerTool(x.p.Rectangle,new Fe(t)),this.registerTool(x.p.Ellipse,new Oe(t)),this.registerTool(x.p.Text,new Ne(t)),this.registerTool(x.p.Image,new Ie(t)),this.registerTool(x.p.Select,new Ge(t)),this.registerTool(x.p.Eraser,new Re(t))}setCurrentTool(t){const i=this.currentTool,r=this.toolRegistry.get(t);if(i&&i.deactivate(),!r)throw new Error(`Tool of type '${t}' not found.`);r.activate(),this.currentTool=r}getCurrentTool(){const t=this.currentTool;if(!t)throw new Error("No active tool found.");return t}getCurrentToolType(){return this.currentTool.type}getTool(t){const i=this.toolRegistry.get(t);if(!i)throw new Error(`Tool of type '${t}' not found.`);return i}clearRegistry(){this.toolRegistry.clear()}static{this.\u0275fac=function(i){return new(i||n)(s.KVO(ft))}}static{this.\u0275prov=s.jDH({token:n,factory:n.\u0275fac})}}return n})(),ee=(()=>{class n{constructor(t,i,r){this.toolManager=t,this.configService=i,this.EventBusService=r,this.pointerDownSubject=new wt.B,this.pointerMoveSubject=new wt.B,this.pointerUpSubject=new wt.B}onPointerDown(t){if(!this.canDraw())return;this.EventBusService.emit(g.DrawStart,t);const i=this.toolManager.getCurrentTool();i&&i.handlePointerDown&&i.handlePointerDown(t),this.pointerDownSubject.next(t)}onPointerMove(t){if(!this.canDraw())return;this.EventBusService.emit(g.Drawing,t);const i=this.toolManager.getCurrentTool();i&&i.handlePointerMove&&i.handlePointerMove(t),this.pointerMoveSubject.next(t)}onPointerUp(t){if(!this.canDraw())return;this.EventBusService.emit(g.DrawEnd);const i=this.toolManager.getCurrentTool();i&&i.handlePointerUp&&i.handlePointerUp(t),this.pointerUpSubject.next(t)}getPointerDown$(){return this.pointerDownSubject.asObservable()}getPointerMove$(){return this.pointerMoveSubject.asObservable()}getPointerUp$(){return this.pointerUpSubject.asObservable()}canDraw(){return this.configService.getConfig().drawingEnabled}static{this.\u0275fac=function(i){return new(i||n)(s.KVO(te),s.KVO(Et),s.KVO(gt))}}static{this.\u0275prov=s.jDH({token:n,factory:n.\u0275fac})}}return n})();function P(){return function(n,e){Object.defineProperty(n,e,{get:function(){return this.getConfigValue(e)},set:function(t){this.setConfigValue(e,t)},configurable:!0})}}let Ae=(()=>{class n{constructor(t){this.svgService=t}onPointerDown(t){0===t.button&&(t.currentTarget&&t.currentTarget.setPointerCapture(t.pointerId),this.svgService.onPointerDown(t))}onPointerMove(t){t.clientX===this.lastX&&t.clientY===this.lastY||(this.lastX=t.clientX,this.lastY=t.clientY,this.svgService.onPointerMove(t))}onPointerUp(t){0===t.button&&(this.lastX=t.clientX,this.lastY=t.clientY,t.currentTarget&&t.currentTarget.hasPointerCapture(t.pointerId)&&t.currentTarget.releasePointerCapture(t.pointerId),this.svgService.onPointerUp(t))}static{this.\u0275fac=function(i){return new(i||n)(s.rXU(ee))}}static{this.\u0275dir=s.FsC({type:n,selectors:[["","svg",""]],hostBindings:function(i,r){1&i&&s.bIt("pointerdown",function(a){return r.onPointerDown(a)})("pointermove",function(a){return r.onPointerMove(a)})("pointerup",function(a){return r.onPointerUp(a)})}})}}return n})(),Ue=(()=>{class n{constructor(t,i,r){this.elementRef=t,this.dataService=i,this._cd=r}ngOnInit(){this.resizeObserver=new ResizeObserver(([t])=>{if(t.target===this.elementRef.nativeElement){const{fullScreen:i,center:r}=this.dataService.getConfig();i&&this.dataService.fullScreen(),r&&!i&&this.dataService.centerCanvas(),this._cd.detectChanges()}}),this.resizeObserver.observe(this.elementRef.nativeElement)}ngOnDestroy(){this.resizeObserver?.disconnect()}static{this.\u0275fac=function(i){return new(i||n)(s.rXU(s.aKT),s.rXU(ft),s.rXU(s.gRc))}}static{this.\u0275dir=s.FsC({type:n,selectors:[["","resizeHandler",""]]})}}return n})();var We=d(177);const $e=["svgContainer"],_e=(n,e)=>e.id,Ye=(n,e)=>[0,0,n,e];function je(n,e){if(1&n&&(s.qSk(),s.j41(0,"g"),s.nrm(1,"rect",16),s.k0s()),2&n){const t=s.XpG();s.BMQ("transform","translate("+t.gridTranslation.x+","+t.gridTranslation.y+")"),s.R7$(),s.BMQ("width",t.canvasWidth+200)("height",t.canvasHeight+200)}}function He(n,e){if(1&n&&(s.qSk(),s.j41(0,"g"),s.nrm(1,"path",17),s.k0s()),2&n){const t=s.XpG().$implicit;s.R7$(),s.BMQ("d",t.path)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function Le(n,e){if(1&n&&(s.qSk(),s.j41(0,"g"),s.nrm(1,"image",18),s.k0s()),2&n){const t=s.XpG().$implicit;s.R7$(),s.BMQ("height",t.height)("width",t.width)("href",t.src,null,"xlink")("href",t.src)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function Ve(n,e){if(1&n&&(s.qSk(),s.j41(0,"g"),s.nrm(1,"line"),s.k0s()),2&n){const t=s.XpG().$implicit;s.R7$(),s.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)}}function Qe(n,e){if(1&n&&(s.qSk(),s.j41(0,"g"),s.nrm(1,"line",19),s.k0s()),2&n){const t=s.XpG().$implicit;s.R7$(),s.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)("fill",t.style.strokeColor)}}function Je(n,e){if(1&n&&(s.qSk(),s.j41(0,"g"),s.nrm(1,"rect"),s.k0s()),2&n){const t=s.XpG().$implicit;s.R7$(),s.BMQ("rx",t.rx)("width",t.width)("height",t.height)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-linejoin",t.style.lineJoin)}}function Ke(n,e){if(1&n&&(s.qSk(),s.j41(0,"g"),s.nrm(1,"ellipse"),s.k0s()),2&n){const t=s.XpG().$implicit;s.R7$(),s.BMQ("cx",t.cx)("cy",t.cy)("rx",t.rx)("ry",t.ry)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke",t.style.strokeColor)("fill",t.style.fill)}}function Ze(n,e){if(1&n&&(s.qSk(),s.j41(0,"g")(1,"text",20),s.EFF(2),s.k0s()()),2&n){const t=s.XpG().$implicit;s.BMQ("transform","scale("+t.scaleX+","+t.scaleY+")"),s.R7$(),s.BMQ("font-size",t.style.fontSize)("font-family",t.style.fontFamily)("fill",t.style.color)("font-style",t.style.fontStyle)("font-weight",t.style.fontWeight)("stroke-linecap",t.style.lineCap)("stroke-lineJoin",t.style.lineJoin)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke",t.style.strokeColor)("stroke-width",t.style.strokeWidth),s.R7$(),s.SpI(" ",t.text," ")}}function qe(n,e){if(1&n&&(s.qSk(),s.j41(0,"g",13),s.DNE(1,He,2,7)(2,Le,2,9)(3,Ve,2,9)(4,Qe,2,10)(5,Je,2,9)(6,Ke,2,9)(7,Ze,3,13),s.k0s()),2&n){let t;const i=e.$implicit,r=s.XpG();s.Y8G("id","item_"+i.id),s.BMQ("data-wb-id",i.id)("transform","translate("+i.x+","+i.y+")rotate("+i.rotation+")")("opacity",i.opacity/100),s.R7$(),s.vxM(1,(t=i.type)===r.types.Pen?1:t===r.types.Image?2:t===r.types.Line?3:t===r.types.Arrow?4:t===r.types.Rectangle?5:t===r.types.Ellipse?6:t===r.types.Text?7:-1)}}function ti(n,e){if(1&n&&(s.qSk(),s.j41(0,"g",14)(1,"g",21)(2,"g",22),s.nrm(3,"rect",23),s.k0s(),s.j41(4,"g",22),s.nrm(5,"circle",24)(6,"circle",25)(7,"circle",26)(8,"circle",27)(9,"rect",28)(10,"rect",29)(11,"rect",30)(12,"rect",31)(13,"rect",32)(14,"rect",33)(15,"rect",34)(16,"rect",35),s.k0s()()()),2&n){const t=s.XpG();s.R7$(),s.xc7("display",t.rubberBox.display),s.BMQ("transform","translate("+t.selectedElement.x+","+t.selectedElement.y+")rotate("+t.selectedElement.rotation+")"),s.R7$(2),s.BMQ("x",t.rubberBox.x)("y",t.rubberBox.y)("width",t.rubberBox.width)("height",t.rubberBox.height),s.R7$(2),s.BMQ("cx",t.rubberBox.x-4)("cy",t.rubberBox.y-4),s.R7$(),s.BMQ("cx",t.rubberBox.x+t.rubberBox.width+4)("cy",t.rubberBox.y-4),s.R7$(),s.BMQ("cx",t.rubberBox.x+t.rubberBox.width+4)("cy",t.rubberBox.y+t.rubberBox.height+4),s.R7$(),s.BMQ("cx",t.rubberBox.x-4)("cy",t.rubberBox.y+t.rubberBox.height+4),s.R7$(),s.BMQ("x",t.rubberBox.x-4)("y",t.rubberBox.y-4),s.R7$(),s.BMQ("x",t.rubberBox.x+t.rubberBox.width/2-4)("y",t.rubberBox.y-4),s.R7$(),s.BMQ("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y-4),s.R7$(),s.BMQ("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y+t.rubberBox.height/2-4),s.R7$(),s.BMQ("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y+t.rubberBox.height-4),s.R7$(),s.BMQ("x",t.rubberBox.x+t.rubberBox.width/2-4)("y",t.rubberBox.y+t.rubberBox.height-4),s.R7$(),s.BMQ("x",t.rubberBox.x-4)("y",t.rubberBox.y+t.rubberBox.height-4),s.R7$(),s.BMQ("x",t.rubberBox.x-4)("y",t.rubberBox.y+t.rubberBox.height/2-4)}}function ei(n,e){if(1&n&&(s.j41(0,"div",36),s.nrm(1,"input",37,1),s.k0s()),2&n){const t=s.sdS(2),i=s.XpG();s.xc7("font-family",i.fontFamily)("font-size",i.fontSize,"px")("pointer-events","none")("width",i.canvasWidth*i.zoom,"px")("height",i.canvasHeight*i.zoom,"px")("position","absolute")("top",i.y,"px")("left",i.x,"px"),s.R7$(),s.xc7("width",t.value.length+"ch")("height",2*i.zoom+"ch")}}let ii=(()=>{class n{set data(t){t&&t!==this.dataService.getData()&&this.dataService.setData(t)}get data$(){return this.dataService.getData$()}set selectedTool(t){t&&this.dataService.getActiveTool()!==t&&(this.dataService.setActiveTool(t),this.dataService.selectElement(null))}get selectedTool(){return this.dataService.getActiveTool()}constructor(t,i,r,o,a,l){this.whiteboardService=t,this.actionHandler=i,this.configService=r,this.dataService=o,this.eventBusService=a,this.cd=l,this.ready=new s.bkB,this.destroyed=new s.bkB,this.drawStart=new s.bkB,this.drawing=new s.bkB,this.drawEnd=new s.bkB,this.elementAdded=new s.bkB,this.elementUpdated=new s.bkB,this.elementSelected=new s.bkB,this.elementDeleted=new s.bkB,this.undo=new s.bkB,this.redo=new s.bkB,this.clear=new s.bkB,this.dataChange=new s.bkB,this.save=new s.bkB,this.imageAdded=new s.bkB,this.selectedToolChange=new s.bkB,this.configChanged=new s.bkB,this.types=m.R,this.tools=x.p,this.eventsMap={[g.Ready]:this.ready,[g.Destroyed]:this.destroyed,[g.DrawStart]:this.drawStart,[g.Drawing]:this.drawing,[g.DrawEnd]:this.drawEnd,[g.ElementAdded]:this.elementAdded,[g.ElementUpdated]:this.elementUpdated,[g.ElementSelected]:this.elementSelected,[g.ElementDeleted]:this.elementDeleted,[g.Undo]:this.undo,[g.Redo]:this.redo,[g.Clear]:this.clear,[g.DataChange]:this.dataChange,[g.Save]:this.save,[g.ImageAdded]:this.imageAdded,[g.ToolChange]:this.selectedToolChange,[g.ConfigChange]:this.configChanged},this.initObservables()}ngOnInit(){this.options&&this.populateInputsFromOptions(this.options)}ngOnChanges(t){t.options&&t.options.currentValue&&this.populateInputsFromOptions(t.options.currentValue)}ngAfterViewInit(){this.dataService.initializeWhiteboard(this.svgContainer.nativeElement)}ngOnDestroy(){this.eventBusService.emit(g.Destroyed)}get selectedElement(){return this.dataService.getSelectedElement()}get rubberBox(){return this.getConfigValue("rubberBox")}get gridTranslation(){return this.getConfigValue("gridTranslation")}get elementsTranslation(){return this.getConfigValue("elementsTranslation")}getConfigValue(t){return this.configService.getConfig()[t]}setConfigValue(t,i){this.configService.isConfigDifferent(t,i)&&(this.configService.updateConfigValue(t,i),["canvasWidth","canvasHeight","zoom"].includes(t)&&this.center&&!this.fullScreen&&this.dataService.centerCanvas())}populateInputsFromOptions(t){t&&Object.entries(t).forEach(([i,r])=>{void 0!==r&&this.setConfigValue(i,r)})}initObservables(){this.eventBusService.listen().pipe(y()).subscribe({next:t=>{t.payload?this.eventsMap[t.type].emit(t.payload):this.eventsMap[t.type].emit(),this.cd.detectChanges()},error:t=>console.error("Error occurred while listening to events:",t)})}static{this.\u0275fac=function(i){return new(i||n)(s.rXU(Jt.K),s.rXU(Kt),s.rXU(Et),s.rXU(ft),s.rXU(gt),s.rXU(s.gRc))}}static{this.\u0275cmp=s.VBU({type:n,selectors:[["ng-whiteboard"]],viewQuery:function(i,r){if(1&i&&s.GBs($e,5),2&i){let o;s.mGM(o=s.lsd())&&(r.svgContainer=o.first)}},inputs:{options:"options",data:"data",selectedTool:"selectedTool",drawingEnabled:"drawingEnabled",canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",fullScreen:"fullScreen",center:"center",strokeColor:"strokeColor",strokeWidth:"strokeWidth",backgroundColor:"backgroundColor",lineJoin:"lineJoin",lineCap:"lineCap",fill:"fill",zoom:"zoom",fontFamily:"fontFamily",fontSize:"fontSize",dasharray:"dasharray",dashoffset:"dashoffset",x:"x",y:"y",enableGrid:"enableGrid",gridSize:"gridSize",snapToGrid:"snapToGrid"},outputs:{ready:"ready",destroyed:"destroyed",drawStart:"drawStart",drawing:"drawing",drawEnd:"drawEnd",elementAdded:"elementAdded",elementUpdated:"elementUpdated",elementSelected:"elementSelected",elementDeleted:"elementDeleted",undo:"undo",redo:"redo",clear:"clear",dataChange:"dataChange",save:"save",imageAdded:"imageAdded",selectedToolChange:"selectedToolChange",configChanged:"configChanged"},features:[s.Jv_([ee,ft,te,gt,Et,Kt]),s.OA$],decls:19,vars:20,consts:[["svgContainer",""],["textInput",""],["id","svgroot","xlinkns","http://www.w3.org/2000/svg","svg","","resizeHandler",""],["id","svgcontent","xlinkns","http://www.w3.org/2000/svg"],["id","smallGrid","patternUnits","userSpaceOnUse"],["fill","none","stroke","gray","stroke-width","0.5"],["id","grid","width","100","height","100","patternUnits","userSpaceOnUse"],["width","100","height","100","fill","url(#smallGrid)"],["d","M 100 0 H 0 V 100","fill","none","stroke","gray","stroke-width","2"],["id","arrow","refX","3","refY","3","markerWidth","6","markerHeight","6","stroke","context-stroke","fill","none","orient","auto"],["d","M 0 0 L 3 3 L 0 6"],["width","100%","height","100%"],[2,"pointer-events","all"],[1,"wb_element",3,"id"],["id","selectorParentGroup"],["id","text-editor",3,"font-family","font-size","pointer-events","width","height","position","top","left"],["id","grid","x","-100","y","-100","fill","url(#grid)"],["fill","none"],["preserveAspectRatio","none"],["marker-end","url(#arrow)"],["text-anchor","start","alignment-baseline","before-edge"],["id","selectorGroup","transform","",1,"selectorGroup"],["display","inline"],["id","selectorBox","fill","none","stroke","#4F80FF",2,"cursor","move"],["id","selectorGrip_rotate_nw","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_ne","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_se","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_sw","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_resize_nw","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","nw-resize"],["id","selectorGrip_resize_n","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","n-resize"],["id","selectorGrip_resize_ne","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","ne-resize"],["id","selectorGrip_resize_e","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","e-resize"],["id","selectorGrip_resize_se","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","se-resize"],["id","selectorGrip_resize_s","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","s-resize"],["id","selectorGrip_resize_sw","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","sw-resize"],["id","selectorGrip_resize_w","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","w-resize"],["id","text-editor"],["type","text","id","textInput","autocomplete","off",1,"text-input"]],template:function(i,r){1&i&&(s.qSk(),s.j41(0,"svg",2,0)(2,"svg",3)(3,"defs")(4,"pattern",4),s.nrm(5,"path",5),s.k0s(),s.j41(6,"pattern",6),s.nrm(7,"rect",7)(8,"path",8),s.k0s(),s.j41(9,"marker",9),s.nrm(10,"path",10),s.k0s()(),s.nrm(11,"rect",11),s.DNE(12,je,2,3,":svg:g"),s.j41(13,"g",12),s.Z7z(14,qe,8,5,":svg:g",13,_e),s.nI1(16,"async"),s.DNE(17,ti,17,31,":svg:g",14),s.k0s()()(),s.DNE(18,ei,3,20,"div",15)),2&i&&(s.HbH("svgroot "+r.selectedTool),s.R7$(2),s.BMQ("width",r.canvasWidth*r.zoom)("height",r.canvasHeight*r.zoom)("viewBox",s.l_i(17,Ye,r.canvasWidth,r.canvasHeight))("x",r.x)("y",r.y),s.R7$(2),s.BMQ("width",r.gridSize)("height",r.gridSize),s.R7$(),s.BMQ("d","M "+r.gridSize+" 0 H 0 V "+r.gridSize),s.R7$(6),s.BMQ("fill",r.backgroundColor),s.R7$(),s.vxM(12,r.enableGrid?12:-1),s.R7$(),s.BMQ("transform","translate("+r.elementsTranslation.x+","+r.elementsTranslation.y+")"),s.R7$(),s.Dyx(s.bMT(16,15,r.data$)),s.R7$(3),s.vxM(17,r.selectedElement?17:-1),s.R7$(),s.vxM(18,r.selectedTool===r.tools.Text?18:-1))},dependencies:[Ae,Ue,We.Jj],styles:["[_nghost-%COMP%]{width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit;background-size:cover;background-position:50%;background-repeat:no-repeat;touch-action:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%], [_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .selectorGroup[_ngcontent-%COMP%]{transform-box:fill-box;transform-origin:center}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-family:Arial,Helvetica,sans-serif}[_nghost-%COMP%]   .svgroot.drawing[_ngcontent-%COMP%]{cursor:url(cursor.2cb01084080421f1.svg) 5 5,crosshair}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .hand[_ngcontent-%COMP%]{cursor:grab}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]{cursor:default}[_nghost-%COMP%]   .pen[_ngcontent-%COMP%]{cursor:url(pencil.5473798714690ad6.svg) 1 18,crosshair}[_nghost-%COMP%]   .image[_ngcontent-%COMP%]{cursor:copy}[_nghost-%COMP%]   .line[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .arrow[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .rectangle[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .ellipse[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .text[_ngcontent-%COMP%]{cursor:text}[_nghost-%COMP%]   .eraser[_ngcontent-%COMP%]{cursor:url(eraser.33503ef8cdcbf5ad.svg) 0 12,crosshair}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%]{cursor:pointer}.foreign[_ngcontent-%COMP%]{text-align:left}.insideforeign[_ngcontent-%COMP%]{display:inline-block}.text-input[_ngcontent-%COMP%]{display:none;position:absolute;background:transparent;border:1px dashed #0b89f0;outline:none;height:25px;font-size:inherit;font-family:inherit;min-width:5ch;width:5ch;height:2ch;padding:0;pointer-events:auto;z-index:5;transform-origin:top left}"],changeDetection:0})}}return(0,c.Cg)([P(),(0,c.Sn)("design:type",Boolean)],n.prototype,"drawingEnabled",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"canvasWidth",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"canvasHeight",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Boolean)],n.prototype,"fullScreen",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Boolean)],n.prototype,"center",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",String)],n.prototype,"strokeColor",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"strokeWidth",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",String)],n.prototype,"backgroundColor",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",String)],n.prototype,"lineJoin",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",String)],n.prototype,"lineCap",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",String)],n.prototype,"fill",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"zoom",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",String)],n.prototype,"fontFamily",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"fontSize",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",String)],n.prototype,"dasharray",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"dashoffset",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"x",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"y",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Boolean)],n.prototype,"enableGrid",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Number)],n.prototype,"gridSize",void 0),(0,c.Cg)([P(),(0,c.Sn)("design:type",Boolean)],n.prototype,"snapToGrid",void 0),n})()},8306:(it,I,d)=>{d.d(I,{K:()=>Ot});var c=d(1413),s=d(4412),H=d(8359),L=d(9974),y=d(4360),at=d(7908),St=d(3888),$t=d(9326),Ct=d(5225),bt=d(5964),C=d(3052),Tt=d(6078),nt=d(7879),Dt=d(4438);let Ot=(()=>{class Y{constructor(){this.BUFFER_SIZE=1e3,this.BATCH_INTERVAL=16,this.actionDispatcher=new c.B,this.priorityDispatcher=new s.t([]),this.actionBuffer=[],this.actions$=this.actionDispatcher.pipe(function Bt(Y,...lt){var u,E;const X=null!==(u=(0,$t.lI)(lt))&&void 0!==u?u:St.E,j=null!==(E=lt[0])&&void 0!==E?E:null,K=lt[1]||1/0;return(0,L.N)((st,B)=>{let m=[],f=!1;const U=S=>{const{buffer:Z,subs:W}=S;W.unsubscribe(),(0,at.o)(m,S),B.next(Z),f&&ht()},ht=()=>{if(m){const S=new H.yU;B.add(S);const W={buffer:[],subs:S};m.push(W),(0,Ct.N)(S,X,()=>U(W),Y)}};null!==j&&j>=0?(0,Ct.N)(B,X,ht,j,!0):f=!0,ht();const z=(0,y._)(B,S=>{const Z=m.slice();for(const W of Z){const{buffer:xt}=W;xt.push(S),K<=xt.length&&U(W)}},()=>{for(;m?.length;)B.next(m.shift().buffer);z?.unsubscribe(),B.complete(),B.unsubscribe()},void 0,()=>m=null);st.subscribe(z)})}(this.BATCH_INTERVAL),(0,bt.p)(u=>u.length>0)),this.isProcessing=!1}addElement(u){this.dispatchWithPriority({type:C.X.AddElement,payload:{element:u}},"normal")}addImage(u,E,X){this.dispatchWithPriority({type:C.X.AddImage,payload:{image:u,x:E,y:X}},"normal")}centerCanvas(){this.dispatchWithPriority({type:C.X.CenterCanvas},"normal")}clear(){this.dispatchWithPriority({type:C.X.Clear},"high")}dispatchBatch(u){this.dispatchWithPriority({type:C.X.Batch,payload:u},"low")}fullScreen(){this.dispatchWithPriority({type:C.X.FullScreen},"normal")}removeElement(u){this.dispatchWithPriority({type:C.X.removeElement,payload:{id:u}},"normal")}undo(){this.dispatchWithPriority({type:C.X.Undo},"high")}redo(){this.dispatchWithPriority({type:C.X.Redo},"high")}save(u=Tt.o8.Base64,E="New board"){this.dispatchWithPriority({type:C.X.Save,payload:{format:u,name:E}},"normal")}selectElement(u){this.dispatchWithPriority({type:C.X.SelectElement,payload:{element:u}},"normal")}setActiveTool(u){this.dispatchWithPriority({type:C.X.SetActiveTool,payload:{tool:u}},"normal")}setCanvasDimensions(u,E){this.dispatchWithPriority({type:C.X.SetCanvasDimensions,payload:{width:u,height:E}},"normal")}setCanvasPosition(u,E){this.dispatchWithPriority({type:C.X.SetCanvasPosition,payload:{x:u,y:E}},"normal")}toggleGrid(){this.dispatchWithPriority({type:C.X.ToggleGrid},"normal")}updateElement(u){this.dispatchWithPriority({type:C.X.UpdateElement,payload:{element:u}},"normal")}updateSelectedElement(u){this.dispatchWithPriority({type:C.X.UpdateSelectedElement,payload:{partialElement:u}},"normal")}dispatchWithPriority(u,E="normal"){const X=this.priorityDispatcher.value,j={action:u,priority:E},K=X.findIndex(B=>this.getPriorityWeight(B.priority)<this.getPriorityWeight(E)),st=-1===K?[...X,j]:[...X.slice(0,K),j,...X.slice(K)];this.priorityDispatcher.next(st),this.isProcessing||this.processNextAction()}dispatch(u){this.manageBuffer(u),this.actionDispatcher.next(u)}getPriorityWeight(u){return nt.bO[u]}manageBuffer(u){this.actionBuffer.length>=this.BUFFER_SIZE&&this.actionBuffer.shift(),this.actionBuffer.push(u)}processNextAction(){if(this.isProcessing)return;this.isProcessing=!0;const u=()=>{const E=this.priorityDispatcher.value;if(E.length>0){const{action:X}=E[0];this.dispatch(X),this.priorityDispatcher.next(E.slice(1)),u()}else this.isProcessing=!1};u()}static{this.\u0275fac=function(E){return new(E||Y)}}static{this.\u0275prov=Dt.jDH({token:Y,factory:Y.\u0275fac,providedIn:"root"})}}return Y})()}}]);