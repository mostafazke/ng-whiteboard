"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[696],{5696:(Mh,Ki,me)=>{me.r(Ki),me.d(Ki,{LiveAppComponent:()=>Oh});var L=me(4523);const f=function(n,e){if(!n)throw ke(e)},ke=function(n){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+n)},Yi=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=63&s|128):55296==(64512&s)&&i+1<n.length&&56320==(64512&n.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&n.charCodeAt(++i)),e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=63&s|128):(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=63&s|128)}return e},En={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0;let u=(15&a)<<2|c>>6,_=63&c;l||(_=64,o||(u=64)),i.push(t[r>>2],t[(3&r)<<4|a>>4],t[u],t[_])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray(Yi(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):function(n){const e=[];let t=0,i=0;for(;t<n.length;){const s=n[t++];if(s<128)e[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[t++];e[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const l=((7&s)<<18|(63&n[t++])<<12|(63&n[t++])<<6|63&n[t++])-65536;e[i++]=String.fromCharCode(55296+(l>>10)),e[i++]=String.fromCharCode(56320+(1023&l))}else{const r=n[t++],o=n[t++];e[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();const t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=t[n.charAt(s++)],a=s<n.length?t[n.charAt(s)]:0;++s;const c=s<n.length?t[n.charAt(s)]:64;++s;const h=s<n.length?t[n.charAt(s)]:64;if(++s,null==r||null==a||null==c||null==h)throw new So;i.push(r<<2|a>>4),64!==c&&(i.push(a<<4&240|c>>2),64!==h&&i.push(c<<6&192|h))}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class So extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const qi=function(n){const e=Yi(n);return En.encodeByteArray(e,!0)},At=function(n){return qi(n).replace(/\./g,"")},Rt=function(n){try{return En.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function To(n){return Xi(void 0,n)}function Xi(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===n&&(n={});break;case Array:n=[];break;default:return e}for(const t in e)!e.hasOwnProperty(t)||!No(t)||(n[t]=Xi(n[t],e[t]));return n}function No(n){return"__proto__"!==n}const xt=()=>{try{return function Ao(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if(typeof process>"u"||typeof process.env>"u")return;const n=process.env.__FIREBASE_DEFAULTS__;return n?JSON.parse(n):void 0})()||(()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const e=n&&Rt(n[1]);return e&&JSON.parse(e)})()}catch(n){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`)}},Ji=()=>{var n;return null===(n=xt())||void 0===n?void 0:n.config};class Qe{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,i))}}}function wn(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function bn(){return(bn=(0,L.A)(function*(n){return(yield fetch(n,{credentials:"include"})).ok})).apply(this,arguments)}const Ke={};let Zi=!1;function Bo(n,e){if(typeof window>"u"||typeof document>"u"||!wn(window.location.host)||Ke[n]===e||Ke[n]||Zi)return;function t(u){return`__firebase__banner__${u}`}Ke[n]=e;const i="__firebase__banner",r=function Lo(){const n={prod:[],emulator:[]};for(const e of Object.keys(Ke))Ke[e]?n.emulator.push(e):n.prod.push(e);return n}().prod.length>0;function h(){const u=function Fo(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}(i),_=t("text"),p=document.getElementById(_)||document.createElement("span"),C=t("learnmore"),R=document.getElementById(C)||document.createElement("a"),te=t("preprendIcon"),ne=document.getElementById(te)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(u.created){const xe=u.element;(function a(u){u.style.display="flex",u.style.background="#7faaf0",u.style.position="fixed",u.style.bottom="5px",u.style.left="5px",u.style.padding=".5em",u.style.borderRadius="5px",u.style.alignItems="center"})(xe),function d(u,_){u.setAttribute("id",_),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline"}(R,C);const Qi=function c(){const u=document.createElement("span");return u.style.cursor="pointer",u.style.marginLeft="16px",u.style.fontSize="24px",u.innerHTML=" &times;",u.onclick=()=>{Zi=!0,function o(){const u=document.getElementById(i);u&&u.remove()}()},u}();(function l(u,_){u.setAttribute("width","24"),u.setAttribute("id",_),u.setAttribute("height","24"),u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("fill","none"),u.style.marginLeft="-6px"})(ne,te),xe.append(ne,p,R,Qi),document.body.appendChild(xe)}r?(p.innerText="Preview backend disconnected.",ne.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(ne.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',p.innerText="Preview backend running in this workspace."),p.setAttribute("id",_)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",h):h()}function es(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(function kt(){return typeof navigator<"u"&&"string"==typeof navigator.userAgent?navigator.userAgent:""}())}class Ye extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name="FirebaseError",Object.setPrototypeOf(this,Ye.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,ns.prototype.create)}}class ns{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){const i=t[0]||{},s=`${this.service}/${e}`,r=this.errors[e],o=r?function jo(n,e){return n.replace(zo,(t,i)=>{const s=e[i];return null!=s?String(s):`<${i}?>`})}(r,i):"Error";return new Ye(s,`${this.serviceName}: ${o} (${s}).`,i)}}const zo=/\{\$([^}]+)}/g;function qe(n){return JSON.parse(n)}function x(n){return JSON.stringify(n)}const Pt=function(n){let e={},t={},i={},s="";try{const r=n.split(".");e=qe(Rt(r[0])||""),t=qe(Rt(r[1])||""),s=r[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:s}};function z(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Pe(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function is(n){for(const e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function Dt(n,e,t){const i={};for(const s in n)Object.prototype.hasOwnProperty.call(n,s)&&(i[s]=e.call(t,n[s],s,n));return i}function Ot(n,e){if(n===e)return!0;const t=Object.keys(n),i=Object.keys(e);for(const s of t){if(!i.includes(s))return!1;const r=n[s],o=e[s];if(ss(r)&&ss(o)){if(!Ot(r,o))return!1}else if(r!==o)return!1}for(const s of i)if(!t.includes(s))return!1;return!0}function ss(n){return null!==n&&"object"==typeof n}class Yo{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const i=this.W_;if("string"==typeof e)for(let h=0;h<16;h++)i[h]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let h=0;h<16;h++)i[h]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let h=16;h<80;h++){const u=i[h-3]^i[h-8]^i[h-14]^i[h-16];i[h]=4294967295&(u<<1|u>>>31)}let c,d,s=this.chain_[0],r=this.chain_[1],o=this.chain_[2],a=this.chain_[3],l=this.chain_[4];for(let h=0;h<80;h++){h<40?h<20?(c=a^r&(o^a),d=1518500249):(c=r^o^a,d=1859775393):h<60?(c=r&o|a&(r|o),d=2400959708):(c=r^o^a,d=3395469782);const u=(s<<5|s>>>27)+c+l+d+i[h]&4294967295;l=a,a=o,o=4294967295&(r<<30|r>>>2),r=s,s=u}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+r&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const i=t-this.blockSize;let s=0;const r=this.buf_;let o=this.inbuf_;for(;s<t;){if(0===o)for(;s<=i;)this.compress_(e,s),s+=this.blockSize;if("string"==typeof e){for(;s<t;)if(r[o]=e.charCodeAt(s),++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}else for(;s<t;)if(r[o]=e[s],++o,++s,o===this.blockSize){this.compress_(r),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(let s=this.blockSize-1;s>=56;s--)this.buf_[s]=255&t,t/=256;this.compress_(this.buf_);let i=0;for(let s=0;s<5;s++)for(let r=24;r>=0;r-=8)e[i]=this.chain_[s]>>r&255,++i;return e}}function De(n,e){return`${n} failed: ${e} argument `}const Mt=function(n){let e=0;for(let t=0;t<n.length;t++){const i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};function Xe(n){return n&&n._delegate?n._delegate:n}class Je{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const ge="[DEFAULT]";class sa{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const i=new Qe;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:t});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const i=this.normalizeInstanceIdentifier(e?.identifier),s=null!==(t=e?.optional)&&void 0!==t&&t;if(!this.isInitialized(i)&&!this.shouldAutoInitialize()){if(s)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:i})}catch(r){if(s)return null;throw r}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function oa(n){return"EAGER"===n.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:ge})}catch{}for(const[t,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(t);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(e=ge){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){var e=this;return(0,L.A)(function*(){const t=Array.from(e.instances.values());yield Promise.all([...t.filter(i=>"INTERNAL"in i).map(i=>i.INTERNAL.delete()),...t.filter(i=>"_delete"in i).map(i=>i._delete())])})()}isComponentSet(){return null!=this.component}isInitialized(e=ge){return this.instances.has(e)}getOptions(e=ge){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:t});for(const[r,o]of this.instancesDeferred.entries())i===this.normalizeInstanceIdentifier(r)&&o.resolve(s);return s}onInit(e,t){var i;const s=this.normalizeInstanceIdentifier(t),r=null!==(i=this.onInitCallbacks.get(s))&&void 0!==i?i:new Set;r.add(e),this.onInitCallbacks.set(s,r);const o=this.instances.get(s);return o&&e(o,s),()=>{r.delete(e)}}invokeOnInitCallbacks(e,t){const i=this.onInitCallbacks.get(t);if(i)for(const s of i)try{s(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(n=e,n===ge?void 0:n),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}var n;return i||null}normalizeInstanceIdentifier(e=ge){return this.component?this.component.multipleInstances?e:ge:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class aa{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new sa(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const Sn=[];var I=function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n}(I||{});const rs={debug:I.DEBUG,verbose:I.VERBOSE,info:I.INFO,warn:I.WARN,error:I.ERROR,silent:I.SILENT},la=I.INFO,ca={[I.DEBUG]:"log",[I.VERBOSE]:"log",[I.INFO]:"info",[I.WARN]:"warn",[I.ERROR]:"error"},ua=(n,e,...t)=>{if(e<n.logLevel)return;const i=(new Date).toISOString(),s=ca[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${i}]  ${n.name}:`,...t)};class os{constructor(e){this.name=e,this._logLevel=la,this._logHandler=ua,this._userLogHandler=null,Sn.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in I))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?rs[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,I.DEBUG,...e),this._logHandler(this,I.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,I.VERBOSE,...e),this._logHandler(this,I.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,I.INFO,...e),this._logHandler(this,I.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,I.WARN,...e),this._logHandler(this,I.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,I.ERROR,...e),this._logHandler(this,I.ERROR,...e)}}const ha=(n,e)=>e.some(t=>n instanceof t);let as,ls;const cs=new WeakMap,Tn=new WeakMap,us=new WeakMap,Nn=new WeakMap,An=new WeakMap;let Rn={get(n,e,t){if(n instanceof IDBTransaction){if("done"===e)return Tn.get(n);if("objectStoreNames"===e)return n.objectStoreNames||us.get(n);if("store"===e)return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ie(n[e])},set:(n,e,t)=>(n[e]=t,!0),has:(n,e)=>n instanceof IDBTransaction&&("done"===e||"store"===e)||e in n};function ya(n){return"function"==typeof n?function ga(n){return n!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?function fa(){return ls||(ls=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}().includes(n)?function(...e){return n.apply(xn(this),e),ie(cs.get(this))}:function(...e){return ie(n.apply(xn(this),e))}:function(e,...t){const i=n.call(xn(this),e,...t);return us.set(i,e.sort?e.sort():[e]),ie(i)}}(n):(n instanceof IDBTransaction&&function pa(n){if(Tn.has(n))return;const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{t(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});Tn.set(n,e)}(n),ha(n,function da(){return as||(as=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}())?new Proxy(n,Rn):n)}function ie(n){if(n instanceof IDBRequest)return function _a(n){const e=new Promise((t,i)=>{const s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{t(ie(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&cs.set(t,n)}).catch(()=>{}),An.set(e,n),e}(n);if(Nn.has(n))return Nn.get(n);const e=ya(n);return e!==n&&(Nn.set(n,e),An.set(e,n)),e}const xn=n=>An.get(n),Ca=["get","getKey","getAll","getAllKeys","count"],Ea=["put","add","delete","clear"],kn=new Map;function hs(n,e){if(!(n instanceof IDBDatabase)||e in n||"string"!=typeof e)return;if(kn.get(e))return kn.get(e);const t=e.replace(/FromIndex$/,""),i=e!==t,s=Ea.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!Ca.includes(t))return;const r=function(){var o=(0,L.A)(function*(a,...l){const c=this.transaction(a,s?"readwrite":"readonly");let d=c.store;return i&&(d=d.index(l.shift())),(yield Promise.all([d[t](...l),s&&c.done]))[0]});return function(l){return o.apply(this,arguments)}}();return kn.set(e,r),r}!function ma(n){Rn=n(Rn)}(n=>({...n,get:(e,t,i)=>hs(e,t)||n.get(e,t,i),has:(e,t)=>!!hs(e,t)||n.has(e,t)}));class wa{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function ba(n){const e=n.getComponent();return"VERSION"===e?.type}(t)){const i=t.getImmediate();return`${i.library}/${i.version}`}return null}).filter(t=>t).join(" ")}}const Lt="@firebase/app",J=new os("@firebase/app"),Ft="[DEFAULT]",Xa={[Lt]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/ai":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},ye=new Map,Ze=new Map,et=new Map;function ds(n,e){try{n.container.addComponent(e)}catch(t){J.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function Bt(n){const e=n.name;if(et.has(e))return J.debug(`There were multiple attempts to register component ${e}.`),!1;et.set(e,n);for(const t of ye.values())ds(t,n);for(const t of Ze.values())ds(t,n);return!0}const W=new ns("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class _s{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Je("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw W.create("app-deleted",{appName:this._name})}}function ms(n,e={}){let t=n;"object"!=typeof e&&(e={name:e});const i=Object.assign({name:Ft,automaticDataCollectionEnabled:!0},e),s=i.name;if("string"!=typeof s||!s)throw W.create("bad-app-name",{appName:String(s)});if(t||(t=Ji()),!t)throw W.create("no-options");const r=ye.get(s);if(r){if(Ot(t,r.options)&&Ot(i,r.config))return r;throw W.create("duplicate-app",{appName:s})}const o=new aa(s);for(const l of et.values())o.addComponent(l);const a=new _s(t,i,o);return ye.set(s,a),a}function ve(n,e,t){var i;let s=null!==(i=Xa[n])&&void 0!==i?i:n;t&&(s+=`-${t}`);const r=s.match(/\s|\//),o=e.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${e}":`];return r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void J.warn(a.join(" "))}Bt(new Je(`${s}-version`,()=>({library:s,version:e}),"VERSION"))}const rl="firebase-heartbeat-database",ol=1,tt="firebase-heartbeat-store";let On=null;function gs(){return On||(On=function va(n,e,{blocked:t,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(n,e),a=ie(o);return i&&o.addEventListener("upgradeneeded",l=>{i(ie(o.result),l.oldVersion,l.newVersion,ie(o.transaction),l)}),t&&o.addEventListener("blocked",l=>t(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}(rl,ol,{upgrade:(n,e)=>{if(0===e)try{n.createObjectStore(tt)}catch(t){console.warn(t)}}}).catch(n=>{throw W.create("idb-open",{originalErrorMessage:n.message})})),On}function Mn(){return(Mn=(0,L.A)(function*(n){try{const t=(yield gs()).transaction(tt),i=yield t.objectStore(tt).get(vs(n));return yield t.done,i}catch(e){if(e instanceof Ye)J.warn(e.message);else{const t=W.create("idb-get",{originalErrorMessage:e?.message});J.warn(t.message)}}})).apply(this,arguments)}function ys(n,e){return Ln.apply(this,arguments)}function Ln(){return(Ln=(0,L.A)(function*(n,e){try{const i=(yield gs()).transaction(tt,"readwrite");yield i.objectStore(tt).put(e,vs(n)),yield i.done}catch(t){if(t instanceof Ye)J.warn(t.message);else{const i=W.create("idb-set",{originalErrorMessage:t?.message});J.warn(i.message)}}})).apply(this,arguments)}function vs(n){return`${n.name}!${n.options.appId}`}class ul{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new dl(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){var e=this;return(0,L.A)(function*(){var t,i;try{const r=e.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Cs();if(null==(null===(t=e._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(e._heartbeatsCache=yield e._heartbeatsCachePromise,null==(null===(i=e._heartbeatsCache)||void 0===i?void 0:i.heartbeats))||e._heartbeatsCache.lastSentHeartbeatDate===o||e._heartbeatsCache.heartbeats.some(a=>a.date===o))return;if(e._heartbeatsCache.heartbeats.push({date:o,agent:r}),e._heartbeatsCache.heartbeats.length>30){const a=function fl(n){if(0===n.length)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}(e._heartbeatsCache.heartbeats);e._heartbeatsCache.heartbeats.splice(a,1)}return e._storage.overwrite(e._heartbeatsCache)}catch(s){J.warn(s)}})()}getHeartbeatsHeader(){var e=this;return(0,L.A)(function*(){var t;try{if(null===e._heartbeatsCache&&(yield e._heartbeatsCachePromise),null==(null===(t=e._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===e._heartbeatsCache.heartbeats.length)return"";const i=Cs(),{heartbeatsToSend:s,unsentEntries:r}=function hl(n,e=1024){const t=[];let i=n.slice();for(const s of n){const r=t.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),Es(t)>e){r.dates.pop();break}}else if(t.push({agent:s.agent,dates:[s.date]}),Es(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}(e._heartbeatsCache.heartbeats),o=At(JSON.stringify({version:2,heartbeats:s}));return e._heartbeatsCache.lastSentHeartbeatDate=i,r.length>0?(e._heartbeatsCache.heartbeats=r,yield e._storage.overwrite(e._heartbeatsCache)):(e._heartbeatsCache.heartbeats=[],e._storage.overwrite(e._heartbeatsCache)),o}catch(i){return J.warn(i),""}})()}}function Cs(){return(new Date).toISOString().substring(0,10)}class dl{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return(0,L.A)(function*(){return!!function Ho(){try{return"object"==typeof indexedDB}catch{return!1}}()&&function Vo(){return new Promise((n,e)=>{try{let t=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{t=!1},s.onerror=()=>{var r;e((null===(r=s.error)||void 0===r?void 0:r.message)||"")}}catch(t){e(t)}})}().then(()=>!0).catch(()=>!1)})()}read(){var e=this;return(0,L.A)(function*(){if(yield e._canUseIndexedDBPromise){const i=yield function al(n){return Mn.apply(this,arguments)}(e.app);return i?.heartbeats?i:{heartbeats:[]}}return{heartbeats:[]}})()}overwrite(e){var t=this;return(0,L.A)(function*(){var i;if(yield t._canUseIndexedDBPromise){const r=yield t.read();return ys(t.app,{lastSentHeartbeatDate:null!==(i=e.lastSentHeartbeatDate)&&void 0!==i?i:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}})()}add(e){var t=this;return(0,L.A)(function*(){var i;if(yield t._canUseIndexedDBPromise){const r=yield t.read();return ys(t.app,{lastSentHeartbeatDate:null!==(i=e.lastSentHeartbeatDate)&&void 0!==i?i:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}})()}}function Es(n){return At(JSON.stringify({version:2,heartbeats:n})).length}!function _l(n){Bt(new Je("platform-logger",e=>new wa(e),"PRIVATE")),Bt(new Je("heartbeat",e=>new ul(e),"PRIVATE")),ve(Lt,"0.13.2",n),ve(Lt,"0.13.2","esm2017"),ve("fire-js","")}(""),ve("firebase","11.10.0","app");const ws="@firebase/database";let Fn="";class gl{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),x(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:qe(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class yl{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return z(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Ss=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){const e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new gl(e)}}catch{}return new yl},Ce=Ss("localStorage"),Bn=Ss("sessionStorage"),Oe=new os("@firebase/database"),Ts=function(){let n=1;return function(){return n++}}(),Ns=function(n){const e=function(n){const e=[];let t=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);if(s>=55296&&s<=56319){const r=s-55296;i++,f(i<n.length,"Surrogate pair missing trail surrogate."),s=65536+(r<<10)+(n.charCodeAt(i)-56320)}s<128?e[t++]=s:s<2048?(e[t++]=s>>6|192,e[t++]=63&s|128):s<65536?(e[t++]=s>>12|224,e[t++]=s>>6&63|128,e[t++]=63&s|128):(e[t++]=s>>18|240,e[t++]=s>>12&63|128,e[t++]=s>>6&63|128,e[t++]=63&s|128)}return e}(n),t=new Yo;t.update(e);const i=t.digest();return En.encodeByteArray(i)},nt=function(...n){let e="";for(let t=0;t<n.length;t++){const i=n[t];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?e+=nt.apply(null,i):e+="object"==typeof i?x(i):i,e+=" "}return e};let Ee=null,As=!0;const k=function(...n){if(!0===As&&(As=!1,null===Ee&&!0===Bn.get("logging_enabled")&&function(n,e){f(!e||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Oe.logLevel=I.VERBOSE,Ee=Oe.log.bind(Oe),e&&Bn.set("logging_enabled",!0)):"function"==typeof n?Ee=n:(Ee=null,Bn.remove("logging_enabled"))}(!0)),Ee){const e=nt.apply(null,n);Ee(e)}},it=function(n){return function(...e){k(n,...e)}},Wn=function(...n){const e="FIREBASE INTERNAL ERROR: "+nt(...n);Oe.error(e)},G=function(...n){const e=`FIREBASE FATAL ERROR: ${nt(...n)}`;throw Oe.error(e),new Error(e)},D=function(...n){const e="FIREBASE WARNING: "+nt(...n);Oe.warn(e)},Wt=function(n){return"number"==typeof n&&(n!=n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},se="[MIN_NAME]",Z="[MAX_NAME]",we=function(n,e){if(n===e)return 0;if(n===se||e===Z)return-1;if(e===se||n===Z)return 1;{const t=Ps(n),i=Ps(e);return null!==t?null!==i?t-i==0?n.length-e.length:t-i:-1:null!==i?1:n<e?-1:1}},El=function(n,e){return n===e?0:n<e?-1:1},st=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+x(e))},Un=function(n){if("object"!=typeof n||null===n)return x(n);const e=[];for(const i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)0!==i&&(t+=","),t+=x(e[i]),t+=":",t+=Un(n[e[i]]);return t+="}",t},xs=function(n,e){const t=n.length;if(t<=e)return[n];const i=[];for(let s=0;s<t;s+=e)i.push(n.substring(s,s+e>t?t:s+e));return i};function P(n,e){for(const t in n)n.hasOwnProperty(t)&&e(t,n[t])}const ks=function(n){f(!Wt(n),"Invalid JSON number");const i=1023;let s,r,o,a,l;0===n?(r=0,o=0,s=1/n==-1/0?1:0):(s=n<0,(n=Math.abs(n))>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),r=a+i,o=Math.round(n*Math.pow(2,52-a)-Math.pow(2,52))):(r=0,o=Math.round(n/Math.pow(2,-1074))));const c=[];for(l=52;l;l-=1)c.push(o%2?1:0),o=Math.floor(o/2);for(l=11;l;l-=1)c.push(r%2?1:0),r=Math.floor(r/2);c.push(s?1:0),c.reverse();const d=c.join("");let h="";for(l=0;l<64;l+=8){let u=parseInt(d.substr(l,8),2).toString(16);1===u.length&&(u="0"+u),h+=u}return h.toLowerCase()},Sl=new RegExp("^-?(0*)\\d{1,10}$"),Ps=function(n){if(Sl.test(n)){const e=Number(n);if(e>=-2147483648&&e<=2147483647)return e}return null},Me=function(n){try{n()}catch(e){setTimeout(()=>{throw D("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},rt=function(n,e){const t=setTimeout(n,e);return"number"==typeof t&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):"object"==typeof t&&t.unref&&t.unref(),t};class Rl{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,function Za(n){return null!=n&&void 0!==n.settings}(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){D(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}}class xl{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(s=>this.auth_=s)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&"auth/token-not-initialized"===t.code?(k("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';e+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',D(e)}}let ot=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}return n.OWNER="owner",n})();const Fs=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Us="websocket",Hs="long_polling";class Vn{constructor(e,t,i,s,r=!1,o="",a=!1,l=!1,c=null){this.secure=t,this.namespace=i,this.webSocketOnly=s,this.nodeAdmin=r,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=l,this.emulatorOptions=c,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Ce.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Ce.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){return`${this.secure?"https://":"http://"}${this.host}/${this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:""}`}}function Vs(n,e,t){let i;if(f("string"==typeof e,"typeof type must == string"),f("object"==typeof t,"typeof params must == object"),e===Us)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else{if(e!==Hs)throw new Error("Unknown connection type: "+e);i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?"}(function kl(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams})(n)&&(t.ns=n.namespace);const s=[];return P(t,(r,o)=>{s.push(r+"="+o)}),i+s.join("&")}class Pl{constructor(){this.counters_={}}incrementCounter(e,t=1){z(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return To(this.counters_)}}const $n={},jn={};function zn(n){const e=n.toString();return $n[e]||($n[e]=new Pl),$n[e]}class Ol{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let s=0;s<i.length;++s)i[s]&&Me(()=>{this.onMessage_(i[s])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}class re{constructor(e,t,i,s,r,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=s,this.authToken=r,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=it(e),this.stats_=zn(t),this.urlFn=l=>(this.appCheckToken&&(l.ac=this.appCheckToken),Vs(t,Hs,l))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ol(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(3e4)),function(n){if("complete"===document.readyState)n();else{let e=!1;const t=function(){document.body?e||(e=!0,n()):setTimeout(t,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{"complete"===document.readyState&&t()}),window.attachEvent("onload",t))}}(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Gn((...r)=>{const[o,a,l,c,d]=r;if(this.incrementIncomingBytes_(r),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,"start"===o)this.id=a,this.password=l;else{if("close"!==o)throw new Error("Unrecognized command received: "+o);a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_()}},(...r)=>{const[o,a]=r;this.incrementIncomingBytes_(r),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);const i={start:"t"};i.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(i.cb=this.scriptTagHolder.uniqueCallbackIdentifier),i.v="5",this.transportSessionId&&(i.s=this.transportSessionId),this.lastSessionId&&(i.ls=this.lastSessionId),this.applicationId&&(i.p=this.applicationId),this.appCheckToken&&(i.ac=this.appCheckToken),typeof location<"u"&&location.hostname&&Fs.test(location.hostname)&&(i.r="f");const s=this.urlFn(i);this.log_("Connecting via long-poll to "+s),this.scriptTagHolder.addTag(s,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){re.forceAllow_=!0}static forceDisallow(){re.forceDisallow_=!0}static isAvailable(){return!(!re.forceAllow_&&(re.forceDisallow_||!(typeof document<"u")||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=x(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const i=qi(t),s=xs(i,1840);for(let r=0;r<s.length;r++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,s.length,s[r]),this.curSegmentNum++}addDisconnectPingFrame(e,t){this.myDisconnFrame=document.createElement("iframe");const i={dframe:"t"};i.id=e,i.pw=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=x(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Gn{constructor(e,t,i,s){this.onDisconnect=i,this.urlFn=s,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0;{this.uniqueCallbackIdentifier=Ts(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Gn.createIFrame_();let r="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,11)&&(r='<script>document.domain="'+document.domain+'";<\/script>');const o="<html><body>"+r+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){k("frame writing exception"),a.stack&&k(a.stack),k(a)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||k("No IE domain setting required")}catch{const i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),i="",s=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+i.length<=1870;){const o=this.pendingSegs.shift();i=i+"&seg"+s+"="+o.seg+"&ts"+s+"="+o.ts+"&d"+s+"="+o.d,s++}return t+=i,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},s=setTimeout(i,Math.floor(25e3));this.addTag(e,()=>{clearTimeout(s),i()})}addTag(e,t){setTimeout(()=>{try{if(!this.sendNewPolls)return;const i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){const s=i.readyState;(!s||"loaded"===s||"complete"===s)&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{k("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}}let Ht=null;typeof MozWebSocket<"u"?Ht=MozWebSocket:typeof WebSocket<"u"&&(Ht=WebSocket);let Le=(()=>{class n{constructor(t,i,s,r,o,a,l){this.connId=t,this.applicationId=s,this.appCheckToken=r,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=it(this.connId),this.stats_=zn(i),this.connURL=n.connectionURL_(i,a,l,r,s),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,s,r,o){const a={v:"5"};return typeof location<"u"&&location.hostname&&Fs.test(location.hostname)&&(a.r="f"),i&&(a.s=i),s&&(a.ls=s),r&&(a.ac=r),o&&(a.p=o),Vs(t,Us,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Ce.set("previous_websocket_failure",!0);try{let s;0,this.mySock=new Ht(this.connURL,[],s)}catch(s){this.log_("Error instantiating WebSocket.");const r=s.message||s.data;return r&&this.log_(r),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=s=>{this.handleIncomingFrame(s)},this.mySock.onerror=s=>{this.log_("WebSocket error.  Closing connection.");const r=s.message||s.data;r&&this.log_(r),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){const s=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);s&&s.length>1&&parseFloat(s[1])<4.4&&(t=!0)}return!t&&null!==Ht&&!n.forceDisallow_}static previouslyFailed(){return Ce.isInMemoryStorage||!0===Ce.get("previous_websocket_failure")}markConnectionHealthy(){Ce.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){const i=this.frames.join("");this.frames=null;const s=qe(i);this.onMessage(s)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(f(null===this.frames,"We already have a frame buffer"),t.length<=6){const i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(null===this.mySock)return;const i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(i);else{const s=this.extractFrameCount_(i);null!==s&&this.appendFrame_(s)}}send(t){this.resetKeepAlive();const i=x(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);const s=xs(i,16384);s.length>1&&this.sendString_(String(s.length));for(let r=0;r<s.length;r++)this.sendString_(s[r])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(45e3))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}return n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4,n})(),Ys=(()=>{class n{static get ALL_TRANSPORTS(){return[re,Le]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){const i=Le&&Le.isAvailable();let s=i&&!Le.previouslyFailed();if(t.webSocketOnly&&(i||D("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[Le];else{const r=this.transports_=[];for(const o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&r.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}return n.globalTransportInitialized_=!1,n})();class nr{constructor(e,t,i,s,r,o,a,l,c,d){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=s,this.authToken_=r,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=l,this.onKill_=c,this.lastSessionId=d,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=it("c:"+this.id+":"),this.transportManager_=new Ys(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));const s=e.healthyTimeout||0;s>0&&(this.healthyTimeout_=rt(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(s)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){this.sendData_({t:"d",d:e})}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=st("t",e),i=st("d",e);if("c"===t)this.onSecondaryControl_(i);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(i)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=st("t",e),i=st("d",e);"c"===t?this.onControl_(i):"d"===t&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=st("t",e);if("d"in e){const i=e.d;if("h"===t){const s=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(s.h=this.repoInfo_.host),this.onHandshake_(s)}else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let s=0;s<this.pendingDataMessages.length;++s)this.onDataMessage_(this.pendingDataMessages[s]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(i):"r"===t?this.onReset_(i):"e"===t?Wn("Server Error: "+i):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):Wn("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,i=e.v,s=e.h;this.sessionId=e.s,this.repoInfo_.host=s,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),"5"!==i&&D("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),rt(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):rt(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&1===this.state_&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Ce.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class ir{put(e,t,i,s){}merge(e,t,i,s){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}}class sr{constructor(e){this.allowedEvents_=e,this.listeners_={},f(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const i=[...this.listeners_[e]];for(let s=0;s<i.length;s++)i[s].callback.apply(i[s].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});const s=this.getInitialEvent(e);s&&t.apply(i,s)}off(e,t,i){this.validateEventType_(e);const s=this.listeners_[e]||[];for(let r=0;r<s.length;r++)if(s[r].callback===t&&(!i||i===s[r].context))return void s.splice(r,1)}validateEventType_(e){f(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}}class Vt extends sr{static getInstance(){return new Vt}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!es()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return f("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}class w{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let i=0;for(let s=0;s<this.pieces_.length;s++)this.pieces_[s].length>0&&(this.pieces_[i]=this.pieces_[s],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function E(){return new w("")}function g(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function oe(n){return n.pieces_.length-n.pieceNum_}function b(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new w(n.pieces_,e)}function Kn(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function at(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function ar(n){if(n.pieceNum_>=n.pieces_.length)return null;const e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new w(e,0)}function N(n,e){const t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof w)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{const i=e.split("/");for(let s=0;s<i.length;s++)i[s].length>0&&t.push(i[s])}return new w(t,0)}function y(n){return n.pieceNum_>=n.pieces_.length}function O(n,e){const t=g(n),i=g(e);if(null===t)return e;if(t===i)return O(b(n),b(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function Yn(n,e){if(oe(n)!==oe(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function U(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(oe(n)>oe(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}class ic{constructor(e,t){this.errorPrefix_=t,this.parts_=at(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=Mt(this.parts_[i]);lr(this)}}function lr(n){if(n.byteLength_>768)throw new Error(n.errorPrefix_+"has a key path longer than 768 bytes ("+n.byteLength_+").");if(n.parts_.length>32)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+be(n))}function be(n){return 0===n.parts_.length?"":"in property '"+n.parts_.join(".")+"'"}class qn extends sr{static getInstance(){return new qn}constructor(){let e,t;super(["visible"]),typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{const i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return f("visible"===e,"Unknown event type: "+e),[this.visible_]}}const lt=1e3;let jt,Ie=(()=>{class n extends ir{constructor(t,i,s,r,o,a,l,c){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=s,this.onConnectStatus_=r,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=l,this.authOverride_=c,this.id=n.nextPersistentConnectionId_++,this.log_=it("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=lt,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,c)throw new Error("Auth override specified in options, but not supported on non Node.js platforms");qn.getInstance().on("visible",this.onVisible_,this),-1===t.host.indexOf("fblocal")&&Vt.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,s){const r=++this.requestNumber_,o={r,a:t,b:i};this.log_(x(o)),f(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),s&&(this.requestCBHash_[r]=s)}get(t){this.initConnection_();const i=new Qe,r={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{const l=a.d;"ok"===a.s?i.resolve(l):i.reject(l)}};return this.outstandingGets_.push(r),this.outstandingGetCount_++,this.connected_&&this.sendGet_(this.outstandingGets_.length-1),i.promise}listen(t,i,s,r){this.initConnection_();const o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),f(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");const l={onComplete:r,hashFn:i,query:t,tag:s};this.listens.get(a).set(o,l),this.connected_&&this.sendListen_(l)}sendGet_(t){const i=this.outstandingGets_[t];this.sendRequest("g",i.request,s=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(s)})}sendListen_(t){const i=t.query,s=i._path.toString(),r=i._queryIdentifier;this.log_("Listen on "+s+" for "+r);const o={p:s};t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest("q",o,l=>{const c=l.d,d=l.s;n.warnOnListenWarnings_(c,i),(this.listens.get(s)&&this.listens.get(s).get(r))===t&&(this.log_("listen response",l),"ok"!==d&&this.removeListen_(s,r),t.onComplete&&t.onComplete(d,c))})}static warnOnListenWarnings_(t,i){if(t&&"object"==typeof t&&z(t,"w")){const s=Pe(t,"w");if(Array.isArray(s)&&~s.indexOf("no_index")){const r='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();D(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${r} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&40===t.length||function(n){const e=Pt(n).claims;return"object"==typeof e&&!0===e.admin}(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){const t=this.authToken_,i=function(n){const t=Pt(n).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(t)?"auth":"gauth",s={cred:t};null===this.authOverride_?s.noauth=!0:"object"==typeof this.authOverride_&&(s.authvar=this.authOverride_),this.sendRequest(i,s,r=>{const o=r.s,a=r.d||"error";this.authToken_===t&&("ok"===o?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{const i=t.s,s=t.d||"error";"ok"===i?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,s)})}unlisten(t,i){const s=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+s+" "+r),f(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(s,r)&&this.connected_&&this.sendUnlisten_(s,r,t._queryObject,i)}sendUnlisten_(t,i,s,r){this.log_("Unlisten on "+t+" for "+i);const o={p:t};r&&(o.q=s,o.t=r),this.sendRequest("n",o)}onDisconnectPut(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:s})}onDisconnectMerge(t,i,s){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,s):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:s})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,s,r){const o={p:i,d:s};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{r&&setTimeout(()=>{r(a.s,a.d)},Math.floor(0))})}put(t,i,s,r){this.putInternal("p",t,i,s,r)}merge(t,i,s,r){this.putInternal("m",t,i,s,r)}putInternal(t,i,s,r,o){this.initConnection_();const a={p:i,d:s};void 0!==o&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+i)}sendPut_(t){const i=this.outstandingPuts_[t].action,s=this.outstandingPuts_[t].request,r=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,s,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),r&&r(o.s,o.d)})}reportStats(t){if(this.connected_){const i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,s=>{"ok"!==s.s&&this.log_("reportStats","Error sending stats: "+s.d)})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+x(t));const i=t.r,s=this.requestCBHash_[i];s&&(delete this.requestCBHash_[i],s(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),"d"===t?this.onDataUpdate_(i.p,i.d,!1,i.t):"m"===t?this.onDataUpdate_(i.p,i.d,!0,i.t):"c"===t?this.onListenRevoked_(i.p,i.q):"ac"===t?this.onAuthRevoked_(i.s,i.d):"apc"===t?this.onAppCheckRevoked_(i.s,i.d):"sd"===t?this.onSecurityDebugPacket_(i):Wn("Unrecognized action received from server: "+x(t)+"\nAre you using the latest client?")}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){f(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=lt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=lt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=lt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const t=Math.max(0,(new Date).getTime()-this.lastConnectionAttemptTime_);let i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}establishConnection_(){var t=this;return(0,L.A)(function*(){if(t.shouldReconnect_()){t.log_("Making a connection attempt"),t.lastConnectionAttemptTime_=(new Date).getTime(),t.lastConnectionEstablishedTime_=null;const i=t.onDataMessage_.bind(t),s=t.onReady_.bind(t),r=t.onRealtimeDisconnect_.bind(t),o=t.id+":"+n.nextConnectionId_++,a=t.lastSessionId;let l=!1,c=null;const d=function(){c?c.close():(l=!0,r())};t.realtime_={close:d,sendRequest:function(_){f(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(_)}};const u=t.forceTokenRefresh_;t.forceTokenRefresh_=!1;try{const[_,p]=yield Promise.all([t.authTokenProvider_.getToken(u),t.appCheckTokenProvider_.getToken(u)]);l?k("getToken() completed but was canceled"):(k("getToken() completed. Creating connection."),t.authToken_=_&&_.accessToken,t.appCheckToken_=p&&p.token,c=new nr(o,t.repoInfo_,t.applicationId_,t.appCheckToken_,t.authToken_,i,s,r,C=>{D(C+" ("+t.repoInfo_.toString()+")"),t.interrupt("server_kill")},a))}catch(_){t.log_("Failed to get token: "+_),l||(t.repoInfo_.nodeAdmin&&D(_),d())}}})()}interrupt(t){k("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){k("Resuming connection for reason: "+t),delete this.interruptReasons_[t],is(this.interruptReasons_)&&(this.reconnectDelay_=lt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){const i=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){const i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let s;s=i?i.map(o=>Un(o)).join("$"):"default";const r=this.removeListen_(t,s);r&&r.onComplete&&r.onComplete("permission_denied")}removeListen_(t,i){const s=new w(t).toString();let r;if(this.listens.has(s)){const o=this.listens.get(s);r=o.get(i),o.delete(i),0===o.size&&this.listens.delete(s)}else r=void 0;return r}onAuthRevoked_(t,i){k("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),("invalid_token"===t||"permission_denied"===t)&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){k("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,("invalid_token"===t||"permission_denied"===t)&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const t of this.listens.values())for(const i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){const t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){const t={};let i="js";t["sdk."+i+"."+Fn.replace(/\./g,"-")]=1,es()?t["framework.cordova"]=1:function Uo(){return"object"==typeof navigator&&"ReactNative"===navigator.product}()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){const t=Vt.getInstance().currentlyOnline();return is(this.interruptReasons_)&&t}}return n.nextPersistentConnectionId_=0,n.nextConnectionId_=0,n})();class v{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new v(e,t)}}class $t{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const i=new v(se,e),s=new v(se,t);return 0!==this.compare(i,s)}minPost(){return v.MIN}}class hr extends $t{static get __EMPTY_NODE(){return jt}static set __EMPTY_NODE(e){jt=e}compare(e,t){return we(e.name,t.name)}isDefinedOn(e){throw ke("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return v.MIN}maxPost(){return new v(Z,jt)}makePost(e,t){return f("string"==typeof e,"KeyIndex indexValue must always be a string."),new v(e,jt)}toString(){return".key"}}const Q=new hr;class zt{constructor(e,t,i,s,r=null){this.isReverse_=s,this.resultGenerator_=r,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(o=t?i(e.key,t):1,s&&(o*=-1),o<0)e=this.isReverse_?e.left:e.right;else{if(0===o){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}let Jn,H=(()=>{class n{constructor(t,i,s,r,o){this.key=t,this.value=i,this.color=s??n.RED,this.left=r??M.EMPTY_NODE,this.right=o??M.EMPTY_NODE}copy(t,i,s,r,o){return new n(t??this.key,i??this.value,s??this.color,r??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,s){let r=this;const o=s(t,r.key);return r=o<0?r.copy(null,null,null,r.left.insert(t,i,s),null):0===o?r.copy(null,i,null,null,null):r.copy(null,null,null,null,r.right.insert(t,i,s)),r.fixUp_()}removeMin_(){if(this.left.isEmpty())return M.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let s,r;if(s=this,i(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed_()&&!s.left.left.isRed_()&&(s=s.moveRedLeft_()),s=s.copy(null,null,null,s.left.remove(t,i),null);else{if(s.left.isRed_()&&(s=s.rotateRight_()),!s.right.isEmpty()&&!s.right.isRed_()&&!s.right.left.isRed_()&&(s=s.moveRedRight_()),0===i(t,s.key)){if(s.right.isEmpty())return M.EMPTY_NODE;r=s.right.min_(),s=s.copy(r.key,r.value,null,null,s.right.removeMin_())}s=s.copy(null,null,null,null,s.right.remove(t,i))}return s.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){const t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){const t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){const t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){const t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})();class M{constructor(e,t=M.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new M(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,H.BLACK,null,null))}remove(e){return new M(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,H.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,s=null;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),0===t){if(i.left.isEmpty())return s?s.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}t<0?i=i.left:t>0&&(s=i,i=i.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new zt(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new zt(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new zt(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new zt(this.root_,null,this.comparator_,!0,e)}}function hc(n,e){return we(n.name,e.name)}function Xn(n,e){return we(n,e)}M.EMPTY_NODE=new class uc{copy(e,t,i,s,r){return this}insert(e,t,i){return new H(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const dr=function(n){return"number"==typeof n?"number:"+ks(n):"string:"+n},fr=function(n){if(n.isLeafNode()){const e=n.val();f("string"==typeof e||"number"==typeof e||"object"==typeof e&&z(e,".sv"),"Priority must be a string or number.")}else f(n===Jn||n.isEmpty(),"priority of unexpected type.");f(n===Jn||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let _r,pr,mr,Fe=(()=>{class n{static set __childrenNodeConstructor(t){_r=t}static get __childrenNodeConstructor(){return _r}constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,f(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),fr(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return".priority"===t?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return y(t)?this:".priority"===g(t)?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return".priority"===t?this.updatePriority(i):i.isEmpty()&&".priority"!==t?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){const s=g(t);return null===s?i:i.isEmpty()&&".priority"!==s?this:(f(".priority"!==s||1===oe(t),".priority must be the last token in a path"),this.updateImmediateChild(s,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(b(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+dr(this.priorityNode_.val())+":");const i=typeof this.value_;t+=i+":",t+="number"===i?ks(this.value_):this.value_,this.lazyHash_=Ns(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(f(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){const i=typeof t.value_,s=typeof this.value_,r=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(s);return f(r>=0,"Unknown leaf type: "+i),f(o>=0,"Unknown leaf type: "+s),r===o?"object"===s?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-r}withIndex(){return this}isIndexed(){return!0}equals(t){return t===this||!!t.isLeafNode()&&(this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_))}}return n.VALUE_TYPE_ORDER=["object","boolean","number","string"],n})();const S=new class pc extends $t{compare(e,t){const i=e.node.getPriority(),s=t.node.getPriority(),r=i.compareTo(s);return 0===r?we(e.name,t.name):r}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return v.MIN}maxPost(){return new v(Z,new Fe("[PRIORITY-POST]",mr))}makePost(e,t){const i=pr(e);return new v(t,new Fe("[PRIORITY-POST]",i))}toString(){return".priority"}},mc=Math.log(2);class gc{constructor(e){this.count=parseInt(Math.log(e+1)/mc,10),this.current_=this.count-1;const s=(r=>parseInt(Array(this.count+1).join("1"),2))();this.bits_=e+1&s}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Gt=function(n,e,t,i){n.sort(e);const s=function(l,c){const d=c-l;let h,u;if(0===d)return null;if(1===d)return h=n[l],u=t?t(h):h,new H(u,h.node,H.BLACK,null,null);{const _=parseInt(d/2,10)+l,p=s(l,_),C=s(_+1,c);return h=n[_],u=t?t(h):h,new H(u,h.node,H.BLACK,p,C)}},a=function(l){let c=null,d=null,h=n.length;const u=function(p,C){const R=h-p,te=h;h-=p;const ne=s(R+1,te),xe=n[R],Qi=t?t(xe):xe;_(new H(Qi,xe.node,C,null,ne))},_=function(p){c?(c.left=p,c=p):(d=p,c=p)};for(let p=0;p<l.count;++p){const C=l.nextBitIsOne(),R=Math.pow(2,l.count-(p+1));C?u(R,H.BLACK):(u(R,H.BLACK),u(R,H.RED))}return d}(new gc(n.length));return new M(i||e,a)};let Zn;const Be={};class ee{static get Default(){return f(Be&&S,"ChildrenNode.ts has not been loaded"),Zn=Zn||new ee({".priority":Be},{".priority":S}),Zn}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){const t=Pe(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof M?t:null}hasIndex(e){return z(this.indexSet_,e.toString())}addIndex(e,t){f(e!==Q,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=t.getIterator(v.Wrap);let a,o=r.getNext();for(;o;)s=s||e.isDefinedOn(o.node),i.push(o),o=r.getNext();a=s?Gt(i,e.getCompare()):Be;const l=e.toString(),c=Object.assign({},this.indexSet_);c[l]=e;const d=Object.assign({},this.indexes_);return d[l]=a,new ee(d,c)}addToIndexes(e,t){const i=Dt(this.indexes_,(s,r)=>{const o=Pe(this.indexSet_,r);if(f(o,"Missing index implementation for "+r),s===Be){if(o.isDefinedOn(e.node)){const a=[],l=t.getIterator(v.Wrap);let c=l.getNext();for(;c;)c.name!==e.name&&a.push(c),c=l.getNext();return a.push(e),Gt(a,o.getCompare())}return Be}{const a=t.get(e.name);let l=s;return a&&(l=l.remove(new v(e.name,a))),l.insert(e,e.node)}});return new ee(i,this.indexSet_)}removeFromIndexes(e,t){const i=Dt(this.indexes_,s=>{if(s===Be)return s;{const r=t.get(e.name);return r?s.remove(new v(e.name,r)):s}});return new ee(i,this.indexSet_)}}let ct,m=(()=>{class n{static get EMPTY_NODE(){return ct||(ct=new n(new M(Xn),null,ee.Default))}constructor(t,i,s){this.children_=t,this.priorityNode_=i,this.indexMap_=s,this.lazyHash_=null,this.priorityNode_&&fr(this.priorityNode_),this.children_.isEmpty()&&f(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||ct}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(".priority"===t)return this.getPriority();{const i=this.children_.get(t);return null===i?ct:i}}getChild(t){const i=g(t);return null===i?this:this.getImmediateChild(i).getChild(b(t))}hasChild(t){return null!==this.children_.get(t)}updateImmediateChild(t,i){if(f(i,"We should always be passing snapshot nodes"),".priority"===t)return this.updatePriority(i);{const s=new v(t,i);let r,o;i.isEmpty()?(r=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(s,this.children_)):(r=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(s,this.children_));const a=r.isEmpty()?ct:this.priorityNode_;return new n(r,a,o)}}updateChild(t,i){const s=g(t);if(null===s)return i;{f(".priority"!==g(t)||1===oe(t),".priority must be the last token in a path");const r=this.getImmediateChild(s).updateChild(b(t),i);return this.updateImmediateChild(s,r)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;const i={};let s=0,r=0,o=!0;if(this.forEachChild(S,(a,l)=>{i[a]=l.val(t),s++,o&&n.INTEGER_REGEXP_.test(a)?r=Math.max(r,Number(a)):o=!1}),!t&&o&&r<2*s){const a=[];for(const l in i)a[l]=i[l];return a}return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(null===this.lazyHash_){let t="";this.getPriority().isEmpty()||(t+="priority:"+dr(this.getPriority().val())+":"),this.forEachChild(S,(i,s)=>{const r=s.hash();""!==r&&(t+=":"+i+":"+r)}),this.lazyHash_=""===t?"":Ns(t)}return this.lazyHash_}getPredecessorChildName(t,i,s){const r=this.resolveIndex_(s);if(r){const o=r.getPredecessorKey(new v(t,i));return o?o.name:null}return this.children_.getPredecessorKey(t)}getFirstChildName(t){const i=this.resolveIndex_(t);if(i){const s=i.minKey();return s&&s.name}return this.children_.minKey()}getFirstChild(t){const i=this.getFirstChildName(t);return i?new v(i,this.children_.get(i)):null}getLastChildName(t){const i=this.resolveIndex_(t);if(i){const s=i.maxKey();return s&&s.name}return this.children_.maxKey()}getLastChild(t){const i=this.getLastChildName(t);return i?new v(i,this.children_.get(i)):null}forEachChild(t,i){const s=this.resolveIndex_(t);return s?s.inorderTraversal(r=>i(r.name,r.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){const s=this.resolveIndex_(i);if(s)return s.getIteratorFrom(t,r=>r);{const r=this.children_.getIteratorFrom(t.name,v.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,t)<0;)r.getNext(),o=r.peek();return r}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){const s=this.resolveIndex_(i);if(s)return s.getReverseIteratorFrom(t,r=>r);{const r=this.children_.getReverseIteratorFrom(t.name,v.Wrap);let o=r.peek();for(;null!=o&&i.compare(o,t)>0;)r.getNext(),o=r.peek();return r}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===ut?-1:0}withIndex(t){if(t===Q||this.indexMap_.hasIndex(t))return this;{const i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===Q||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{const i=t;if(this.getPriority().equals(i.getPriority())){if(this.children_.count()===i.children_.count()){const s=this.getIterator(S),r=i.getIterator(S);let o=s.getNext(),a=r.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=s.getNext(),a=r.getNext()}return null===o&&null===a}return!1}return!1}}resolveIndex_(t){return t===Q?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})();const ut=new class yc extends m{constructor(){super(new M(Xn),m.EMPTY_NODE,ee.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return m.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(v,{MIN:{value:new v(se,m.EMPTY_NODE)},MAX:{value:new v(Z,ut)}}),hr.__EMPTY_NODE=m.EMPTY_NODE,Fe.__childrenNodeConstructor=m,function dc(n){Jn=n}(ut),function _c(n){mr=n}(ut);const vc=!0;function A(n,e=null){if(null===n)return m.EMPTY_NODE;if("object"==typeof n&&".priority"in n&&(e=n[".priority"]),f(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof n&&".value"in n&&null!==n[".value"]&&(n=n[".value"]),"object"!=typeof n||".sv"in n)return new Fe(n,A(e));if(n instanceof Array||!vc){let t=m.EMPTY_NODE;return P(n,(i,s)=>{if(z(n,i)&&"."!==i.substring(0,1)){const r=A(s);(r.isLeafNode()||!r.isEmpty())&&(t=t.updateImmediateChild(i,r))}}),t.updatePriority(A(e))}{const t=[];let i=!1;if(P(n,(o,a)=>{if("."!==o.substring(0,1)){const l=A(a);l.isEmpty()||(i=i||!l.getPriority().isEmpty(),t.push(new v(o,l)))}}),0===t.length)return m.EMPTY_NODE;const r=Gt(t,hc,o=>o.name,Xn);if(i){const o=Gt(t,S.getCompare());return new m(r,A(e),new ee({".priority":o},{".priority":S}))}return new m(r,A(e),ee.Default)}}!function fc(n){pr=n}(A);class ei extends $t{constructor(e){super(),this.indexPath_=e,f(!y(e)&&".priority"!==g(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const i=this.extractChild(e.node),s=this.extractChild(t.node),r=i.compareTo(s);return 0===r?we(e.name,t.name):r}makePost(e,t){const i=A(e),s=m.EMPTY_NODE.updateChild(this.indexPath_,i);return new v(t,s)}maxPost(){const e=m.EMPTY_NODE.updateChild(this.indexPath_,ut);return new v(Z,e)}toString(){return at(this.indexPath_,0).join("/")}}const ti=new class Cc extends $t{compare(e,t){const i=e.node.compareTo(t.node);return 0===i?we(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return v.MIN}maxPost(){return v.MAX}makePost(e,t){const i=A(e);return new v(t,i)}toString(){return".value"}};function gr(n){return{type:"value",snapshotNode:n}}function We(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function ht(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function dt(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}class ni{constructor(e){this.index_=e}updateChild(e,t,i,s,r,o){f(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(t);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()||(null!=o&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(ht(t,a)):f(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(We(t,i)):o.trackChildChange(dt(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return null!=i&&(e.isLeafNode()||e.forEachChild(S,(s,r)=>{t.hasChild(s)||i.trackChildChange(ht(s,r))}),t.isLeafNode()||t.forEachChild(S,(s,r)=>{if(e.hasChild(s)){const o=e.getImmediateChild(s);o.equals(r)||i.trackChildChange(dt(s,r,o))}else i.trackChildChange(We(s,r))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?m.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class ft{constructor(e){this.indexedFilter_=new ni(e.getIndex()),this.index_=e.getIndex(),this.startPost_=ft.getStartPost_(e),this.endPost_=ft.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){const t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,s,r,o){return this.matches(new v(t,i))||(i=m.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,s,r,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=m.EMPTY_NODE);let s=t.withIndex(this.index_);s=s.updatePriority(m.EMPTY_NODE);const r=this;return t.forEachChild(S,(o,a)=>{r.matches(new v(o,a))||(s=s.updateImmediateChild(o,m.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class wc{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{const i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{const i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new ft(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,s,r,o){return this.rangedFilter_.matches(new v(t,i))||(i=m.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,s,r,o):this.fullLimitUpdateChild_(e,t,i,r,o)}updateFullNode(e,t,i){let s;if(t.isLeafNode()||t.isEmpty())s=m.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let r;s=m.EMPTY_NODE.withIndex(this.index_),r=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;r.hasNext()&&o<this.limit_;){const a=r.getNext();if(this.withinDirectionalStart(a)){if(!this.withinDirectionalEnd(a))break;s=s.updateImmediateChild(a.name,a.node),o++}}}else{let r;s=t.withIndex(this.index_),s=s.updatePriority(m.EMPTY_NODE),r=this.reverse_?s.getReverseIterator(this.index_):s.getIterator(this.index_);let o=0;for(;r.hasNext();){const a=r.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:s=s.updateImmediateChild(a.name,m.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,s,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,s,r){let o;if(this.reverse_){const h=this.index_.getCompare();o=(u,_)=>h(_,u)}else o=this.index_.getCompare();const a=e;f(a.numChildren()===this.limit_,"");const l=new v(t,i),c=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),d=this.rangedFilter_.matches(l);if(a.hasChild(t)){const h=a.getImmediateChild(t);let u=s.getChildAfterChild(this.index_,c,this.reverse_);for(;null!=u&&(u.name===t||a.hasChild(u.name));)u=s.getChildAfterChild(this.index_,u,this.reverse_);const _=null==u?1:o(u,l);if(d&&!i.isEmpty()&&_>=0)return r?.trackChildChange(dt(t,i,h)),a.updateImmediateChild(t,i);{r?.trackChildChange(ht(t,h));const C=a.updateImmediateChild(t,m.EMPTY_NODE);return null!=u&&this.rangedFilter_.matches(u)?(r?.trackChildChange(We(u.name,u.node)),C.updateImmediateChild(u.name,u.node)):C}}return i.isEmpty()?e:d&&o(c,l)>=0?(null!=r&&(r.trackChildChange(ht(c.name,c.node)),r.trackChildChange(We(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(c.name,m.EMPTY_NODE)):e}}class ii{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=S}hasStart(){return this.startSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return f(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return f(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:se}hasEnd(){return this.endSet_}getIndexEndValue(){return f(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return f(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Z}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return f(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===S}copy(){const e=new ii;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function yr(n){const e={};if(n.isDefault())return e;let t;if(n.index_===S?t="$priority":n.index_===ti?t="$value":n.index_===Q?t="$key":(f(n.index_ instanceof ei,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=x(t),n.startSet_){const i=n.startAfterSet_?"startAfter":"startAt";e[i]=x(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+x(n.indexStartName_))}if(n.endSet_){const i=n.endBeforeSet_?"endBefore":"endAt";e[i]=x(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+x(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function vr(n){const e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;""===t&&(t=n.isViewFromLeft()?"l":"r"),e.vf=t}return n.index_!==S&&(e.i=n.index_.toString()),e}class Kt extends ir{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return void 0!==t?"tag$"+t:(f(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,s){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=s,this.log_=it("p:rest:"),this.listens_={}}listen(e,t,i,s){const r=e._path.toString();this.log_("Listen called for "+r+" "+e._queryIdentifier);const o=Kt.getListenId_(e,i),a={};this.listens_[o]=a;const l=yr(e._queryParams);this.restRequest_(r+".json",l,(c,d)=>{let h=d;if(404===c&&(h=null,c=null),null===c&&this.onDataUpdate_(r,h,!1,i),Pe(this.listens_,o)===a){let u;u=c?401===c?"permission_denied":"rest_error:"+c:"ok",s(u,null)}})}unlisten(e,t){const i=Kt.getListenId_(e,t);delete this.listens_[i]}get(e){const t=yr(e._queryParams),i=e._path.toString(),s=new Qe;return this.restRequest_(i+".json",t,(r,o)=>{let a=o;404===r&&(a=null,r=null),null===r?(this.onDataUpdate_(i,a,!1,null),s.resolve(a)):s.reject(new Error(a))}),s.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([s,r])=>{s&&s.accessToken&&(t.auth=s.accessToken),r&&r.token&&(t.ac=r.token);const o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+function Ko(n){const e=[];for(const[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(s))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}(t);this.log_("Sending REST request for "+o);const a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&4===a.readyState){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let l=null;if(a.status>=200&&a.status<300){try{l=qe(a.responseText)}catch{D("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,l)}else 401!==a.status&&404!==a.status&&D("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}}class Ac{constructor(){this.rootNode_=m.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function Yt(){return{value:null,children:new Map}}function Ue(n,e,t){if(y(e))n.value=t,n.children.clear();else if(null!==n.value)n.value=n.value.updateChild(e,t);else{const i=g(e);n.children.has(i)||n.children.set(i,Yt()),Ue(n.children.get(i),e=b(e),t)}}function ai(n,e,t){null!==n.value?t(e,n.value):function Rc(n,e){n.children.forEach((t,i)=>{e(i,t)})}(n,(i,s)=>{ai(s,new w(e.toString()+"/"+i),t)})}class xc{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&P(this.last_,(i,s)=>{t[i]=t[i]-s}),this.last_=e,t}}class Dc{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new xc(e);const i=1e4+2e4*Math.random();rt(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){const e=this.statsListener_.get(),t={};let i=!1;P(e,(s,r)=>{r>0&&z(this.statsToReport_,s)&&(t[s]=r,i=!0)}),i&&this.server_.reportStats(t),rt(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var K=function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n}(K||{});function ui(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}class qt{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=K.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(y(this.path)){if(null!=this.affectedTree.value)return f(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new w(e));return new qt(E(),t,this.revert)}}return f(g(this.path)===e,"operationForChild called for unrelated child."),new qt(b(this.path),this.affectedTree,this.revert)}}class _t{constructor(e,t){this.source=e,this.path=t,this.type=K.LISTEN_COMPLETE}operationForChild(e){return y(this.path)?new _t(this.source,E()):new _t(this.source,b(this.path))}}class Se{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=K.OVERWRITE}operationForChild(e){return y(this.path)?new Se(this.source,E(),this.snap.getImmediateChild(e)):new Se(this.source,b(this.path),this.snap)}}class He{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=K.MERGE}operationForChild(e){if(y(this.path)){const t=this.children.subtree(new w(e));return t.isEmpty()?null:t.value?new Se(this.source,E(),t.value):new He(this.source,E(),t)}return f(g(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new He(this.source,b(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class ae{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(y(e))return this.isFullyInitialized()&&!this.filtered_;const t=g(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class Oc{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function pt(n,e,t,i,s,r){const o=i.filter(a=>a.type===t);o.sort((a,l)=>function Fc(n,e,t){if(null==e.childName||null==t.childName)throw ke("Should only compare child_ events.");const i=new v(e.childName,e.snapshotNode),s=new v(t.childName,t.snapshotNode);return n.index_.compare(i,s)}(n,a,l)),o.forEach(a=>{const l=function Lc(n,e,t){return"value"===e.type||"child_removed"===e.type||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}(n,a,r);s.forEach(c=>{c.respondsTo(a.type)&&e.push(c.createEvent(l,n.query_))})})}function Xt(n,e){return{eventCache:n,serverCache:e}}function mt(n,e,t,i){return Xt(new ae(e,t,i),n.serverCache)}function Er(n,e,t,i){return Xt(n.eventCache,new ae(e,t,i))}function Jt(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Te(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}let hi;class T{static fromObject(e){let t=new T(null);return P(e,(i,s)=>{t=t.set(new w(i),s)}),t}constructor(e,t=(()=>(hi||(hi=new M(El)),hi))()){this.value=e,this.children=t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:E(),value:this.value};if(y(e))return null;{const i=g(e),s=this.children.get(i);if(null!==s){const r=s.findRootMostMatchingPathAndValue(b(e),t);return null!=r?{path:N(new w(i),r.path),value:r.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(y(e))return this;{const t=g(e),i=this.children.get(t);return null!==i?i.subtree(b(e)):new T(null)}}set(e,t){if(y(e))return new T(t,this.children);{const i=g(e),r=(this.children.get(i)||new T(null)).set(b(e),t),o=this.children.insert(i,r);return new T(this.value,o)}}remove(e){if(y(e))return this.children.isEmpty()?new T(null):new T(null,this.children);{const t=g(e),i=this.children.get(t);if(i){const s=i.remove(b(e));let r;return r=s.isEmpty()?this.children.remove(t):this.children.insert(t,s),null===this.value&&r.isEmpty()?new T(null):new T(this.value,r)}return this}}get(e){if(y(e))return this.value;{const t=g(e),i=this.children.get(t);return i?i.get(b(e)):null}}setTree(e,t){if(y(e))return t;{const i=g(e),r=(this.children.get(i)||new T(null)).setTree(b(e),t);let o;return o=r.isEmpty()?this.children.remove(i):this.children.insert(i,r),new T(this.value,o)}}fold(e){return this.fold_(E(),e)}fold_(e,t){const i={};return this.children.inorderTraversal((s,r)=>{i[s]=r.fold_(N(e,s),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,E(),t)}findOnPath_(e,t,i){const s=!!this.value&&i(t,this.value);if(s)return s;if(y(e))return null;{const r=g(e),o=this.children.get(r);return o?o.findOnPath_(b(e),N(t,r),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,E(),t)}foreachOnPath_(e,t,i){if(y(e))return this;{this.value&&i(t,this.value);const s=g(e),r=this.children.get(s);return r?r.foreachOnPath_(b(e),N(t,s),i):new T(null)}}foreach(e){this.foreach_(E(),e)}foreach_(e,t){this.children.inorderTraversal((i,s)=>{s.foreach_(N(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}}class V{constructor(e){this.writeTree_=e}static empty(){return new V(new T(null))}}function gt(n,e,t){if(y(e))return new V(new T(t));{const i=n.writeTree_.findRootMostValueAndPath(e);if(null!=i){const s=i.path;let r=i.value;const o=O(s,e);return r=r.updateChild(o,t),new V(n.writeTree_.set(s,r))}{const s=new T(t),r=n.writeTree_.setTree(e,s);return new V(r)}}}function di(n,e,t){let i=n;return P(t,(s,r)=>{i=gt(i,N(e,s),r)}),i}function wr(n,e){if(y(e))return V.empty();{const t=n.writeTree_.setTree(e,new T(null));return new V(t)}}function fi(n,e){return null!=Ne(n,e)}function Ne(n,e){const t=n.writeTree_.findRootMostValueAndPath(e);return null!=t?n.writeTree_.get(t.path).getChild(O(t.path,e)):null}function br(n){const e=[],t=n.writeTree_.value;return null!=t?t.isLeafNode()||t.forEachChild(S,(i,s)=>{e.push(new v(i,s))}):n.writeTree_.children.inorderTraversal((i,s)=>{null!=s.value&&e.push(new v(i,s.value))}),e}function le(n,e){if(y(e))return n;{const t=Ne(n,e);return new V(null!=t?new T(t):n.writeTree_.subtree(e))}}function _i(n){return n.writeTree_.isEmpty()}function Ve(n,e){return Ir(E(),n.writeTree_,e)}function Ir(n,e,t){if(null!=e.value)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((s,r)=>{".priority"===s?(f(null!==r.value,"Priority writes must always be leaf nodes"),i=r.value):t=Ir(N(n,s),r,t)}),!t.getChild(n).isEmpty()&&null!==i&&(t=t.updateChild(N(n,".priority"),i)),t}}function Zt(n,e){return Rr(e,n)}function $c(n,e){if(n.snap)return U(n.path,e);for(const t in n.children)if(n.children.hasOwnProperty(t)&&U(N(n.path,t),e))return!0;return!1}function zc(n){return n.visible}function Sr(n,e,t){let i=V.empty();for(let s=0;s<n.length;++s){const r=n[s];if(e(r)){const o=r.path;let a;if(r.snap)U(t,o)?(a=O(t,o),i=gt(i,a,r.snap)):U(o,t)&&(a=O(o,t),i=gt(i,E(),r.snap.getChild(a)));else{if(!r.children)throw ke("WriteRecord should have .snap or .children");if(U(t,o))a=O(t,o),i=di(i,a,r.children);else if(U(o,t))if(a=O(o,t),y(a))i=di(i,E(),r.children);else{const l=Pe(r.children,g(a));if(l){const c=l.getChild(b(a));i=gt(i,E(),c)}}}}}return i}function Tr(n,e,t,i,s){if(i||s){const r=le(n.visibleWrites,e);return!s&&_i(r)?t:s||null!=t||fi(r,E())?Ve(Sr(n.allWrites,function(c){return(c.visible||s)&&(!i||!~i.indexOf(c.writeId))&&(U(c.path,e)||U(e,c.path))},e),t||m.EMPTY_NODE):null}{const r=Ne(n.visibleWrites,e);if(null!=r)return r;{const o=le(n.visibleWrites,e);return _i(o)?t:null!=t||fi(o,E())?Ve(o,t||m.EMPTY_NODE):null}}}function en(n,e,t,i){return Tr(n.writeTree,n.treePath,e,t,i)}function pi(n,e){return function Gc(n,e,t){let i=m.EMPTY_NODE;const s=Ne(n.visibleWrites,e);if(s)return s.isLeafNode()||s.forEachChild(S,(r,o)=>{i=i.updateImmediateChild(r,o)}),i;if(t){const r=le(n.visibleWrites,e);return t.forEachChild(S,(o,a)=>{const l=Ve(le(r,new w(o)),a);i=i.updateImmediateChild(o,l)}),br(r).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}return br(le(n.visibleWrites,e)).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}(n.writeTree,n.treePath,e)}function Nr(n,e,t,i){return function Qc(n,e,t,i,s){f(i||s,"Either existingEventSnap or existingServerSnap must exist");const r=N(e,t);if(fi(n.visibleWrites,r))return null;{const o=le(n.visibleWrites,r);return _i(o)?s.getChild(t):Ve(o,s.getChild(t))}}(n.writeTree,n.treePath,e,t,i)}function tn(n,e){return function Yc(n,e){return Ne(n.visibleWrites,e)}(n.writeTree,N(n.treePath,e))}function mi(n,e,t){return function Kc(n,e,t,i){const s=N(e,t),r=Ne(n.visibleWrites,s);return null!=r?r:i.isCompleteForChild(t)?Ve(le(n.visibleWrites,s),i.getNode().getImmediateChild(t)):null}(n.writeTree,n.treePath,e,t)}function Ar(n,e){return Rr(N(n.treePath,e),n.writeTree)}function Rr(n,e){return{treePath:n,writeTree:e}}class Zc{constructor(){this.changeMap=new Map}trackChildChange(e){const t=e.type,i=e.childName;f("child_added"===t||"child_changed"===t||"child_removed"===t,"Only child changes supported for tracking"),f(".priority"!==i,"Only non-priority child changes can be tracked.");const s=this.changeMap.get(i);if(s){const r=s.type;if("child_added"===t&&"child_removed"===r)this.changeMap.set(i,dt(i,e.snapshotNode,s.snapshotNode));else if("child_removed"===t&&"child_added"===r)this.changeMap.delete(i);else if("child_removed"===t&&"child_changed"===r)this.changeMap.set(i,ht(i,s.oldSnap));else if("child_changed"===t&&"child_added"===r)this.changeMap.set(i,We(i,e.snapshotNode));else{if("child_changed"!==t||"child_changed"!==r)throw ke("Illegal combination of changes: "+e+" occurred after "+s);this.changeMap.set(i,dt(i,e.snapshotNode,s.oldSnap))}}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}}const xr=new class eu{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}};class gi{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const i=null!=this.optCompleteServerCache_?new ae(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return mi(this.writes_,e,i)}}getChildAfterChild(e,t,i){const s=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Te(this.viewCache_),r=function Jc(n,e,t,i,s,r){return function qc(n,e,t,i,s,r,o){let a;const l=le(n.visibleWrites,e),c=Ne(l,E());if(null!=c)a=c;else{if(null==t)return[];a=Ve(l,t)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const d=[],h=o.getCompare(),u=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let _=u.getNext();for(;_&&d.length<s;)0!==h(_,i)&&d.push(_),_=u.getNext();return d}}(n.writeTree,n.treePath,e,t,i,s,r)}(this.writes_,s,t,1,i,e);return 0===r.length?null:r[0]}}function kr(n,e,t,i,s,r){const o=e.eventCache;if(null!=tn(i,t))return e;{let a,l;if(y(t))if(f(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){const c=Te(e),h=pi(i,c instanceof m?c:m.EMPTY_NODE);a=n.filter.updateFullNode(e.eventCache.getNode(),h,r)}else{const c=en(i,Te(e));a=n.filter.updateFullNode(e.eventCache.getNode(),c,r)}else{const c=g(t);if(".priority"===c){f(1===oe(t),"Can't have a priority with additional path components");const d=o.getNode();l=e.serverCache.getNode();const h=Nr(i,t,d,l);a=null!=h?n.filter.updatePriority(d,h):o.getNode()}else{const d=b(t);let h;if(o.isCompleteForChild(c)){l=e.serverCache.getNode();const u=Nr(i,t,o.getNode(),l);h=null!=u?o.getNode().getImmediateChild(c).updateChild(d,u):o.getNode().getImmediateChild(c)}else h=mi(i,c,e.serverCache);a=null!=h?n.filter.updateChild(o.getNode(),c,h,d,s,r):o.getNode()}}return mt(e,a,o.isFullyInitialized()||y(t),n.filter.filtersNodes())}}function nn(n,e,t,i,s,r,o,a){const l=e.serverCache;let c;const d=o?n.filter:n.filter.getIndexedFilter();if(y(t))c=d.updateFullNode(l.getNode(),i,null);else if(d.filtersNodes()&&!l.isFiltered()){const _=l.getNode().updateChild(t,i);c=d.updateFullNode(l.getNode(),_,null)}else{const _=g(t);if(!l.isCompleteForPath(t)&&oe(t)>1)return e;const p=b(t),R=l.getNode().getImmediateChild(_).updateChild(p,i);c=".priority"===_?d.updatePriority(l.getNode(),R):d.updateChild(l.getNode(),_,R,p,xr,null)}const h=Er(e,c,l.isFullyInitialized()||y(t),d.filtersNodes());return kr(n,h,t,s,new gi(s,h,r),a)}function yi(n,e,t,i,s,r,o){const a=e.eventCache;let l,c;const d=new gi(s,e,r);if(y(t))c=n.filter.updateFullNode(e.eventCache.getNode(),i,o),l=mt(e,c,!0,n.filter.filtersNodes());else{const h=g(t);if(".priority"===h)c=n.filter.updatePriority(e.eventCache.getNode(),i),l=mt(e,c,a.isFullyInitialized(),a.isFiltered());else{const u=b(t),_=a.getNode().getImmediateChild(h);let p;if(y(u))p=i;else{const C=d.getCompleteChild(h);p=null!=C?".priority"===Kn(u)&&C.getChild(ar(u)).isEmpty()?C:C.updateChild(u,i):m.EMPTY_NODE}l=_.equals(p)?e:mt(e,n.filter.updateChild(a.getNode(),h,p,u,d,o),a.isFullyInitialized(),n.filter.filtersNodes())}}return l}function Pr(n,e){return n.eventCache.isCompleteForChild(e)}function Dr(n,e,t){return t.foreach((i,s)=>{e=e.updateChild(i,s)}),e}function vi(n,e,t,i,s,r,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c,l=e;c=y(t)?i:new T(null).setTree(t,i);const d=e.serverCache.getNode();return c.children.inorderTraversal((h,u)=>{if(d.hasChild(h)){const p=Dr(0,e.serverCache.getNode().getImmediateChild(h),u);l=nn(n,l,new w(h),p,s,r,o,a)}}),c.children.inorderTraversal((h,u)=>{const _=!e.serverCache.isCompleteForChild(h)&&null===u.value;if(!d.hasChild(h)&&!_){const C=Dr(0,e.serverCache.getNode().getImmediateChild(h),u);l=nn(n,l,new w(h),C,s,r,o,a)}}),l}class cu{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const i=this.query_._queryParams,s=new ni(i.getIndex()),r=function bc(n){return n.loadsAllData()?new ni(n.getIndex()):n.hasLimit()?new wc(n):new ft(n)}(i);this.processor_=function tu(n){return{filter:n}}(r);const o=t.serverCache,a=t.eventCache,l=s.updateFullNode(m.EMPTY_NODE,o.getNode(),null),c=r.updateFullNode(m.EMPTY_NODE,a.getNode(),null),d=new ae(l,o.isFullyInitialized(),s.filtersNodes()),h=new ae(c,a.isFullyInitialized(),r.filtersNodes());this.viewCache_=Xt(h,d),this.eventGenerator_=new Oc(this.query_)}get query(){return this.query_}}function du(n,e){const t=Te(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!y(e)&&!t.getImmediateChild(g(e)).isEmpty())?t.getChild(e):null}function Or(n){return 0===n.eventRegistrations_.length}function Mr(n,e,t){const i=[];if(t){f(null==e,"A cancel should cancel all event registrations.");const s=n.query._path;n.eventRegistrations_.forEach(r=>{const o=r.createCancelEvent(t,s);o&&i.push(o)})}if(e){let s=[];for(let r=0;r<n.eventRegistrations_.length;++r){const o=n.eventRegistrations_[r];if(o.matches(e)){if(e.hasAnyCallback()){s=s.concat(n.eventRegistrations_.slice(r+1));break}}else s.push(o)}n.eventRegistrations_=s}else n.eventRegistrations_=[];return i}function Lr(n,e,t,i){e.type===K.MERGE&&null!==e.source.queryId&&(f(Te(n.viewCache_),"We should always have a full cache before handling merges"),f(Jt(n.viewCache_),"Missing event cache, even though we have a server cache"));const s=n.viewCache_,r=function iu(n,e,t,i,s){const r=new Zc;let o,a;if(t.type===K.OVERWRITE){const c=t;c.source.fromUser?o=yi(n,e,c.path,c.snap,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered()&&!y(c.path),o=nn(n,e,c.path,c.snap,i,s,a,r))}else if(t.type===K.MERGE){const c=t;c.source.fromUser?o=function ru(n,e,t,i,s,r,o){let a=e;return i.foreach((l,c)=>{const d=N(t,l);Pr(e,g(d))&&(a=yi(n,a,d,c,s,r,o))}),i.foreach((l,c)=>{const d=N(t,l);Pr(e,g(d))||(a=yi(n,a,d,c,s,r,o))}),a}(n,e,c.path,c.children,i,s,r):(f(c.source.fromServer,"Unknown source."),a=c.source.tagged||e.serverCache.isFiltered(),o=vi(n,e,c.path,c.children,i,s,a,r))}else if(t.type===K.ACK_USER_WRITE){const c=t;o=c.revert?function lu(n,e,t,i,s,r){let o;if(null!=tn(i,t))return e;{const a=new gi(i,e,s),l=e.eventCache.getNode();let c;if(y(t)||".priority"===g(t)){let d;if(e.serverCache.isFullyInitialized())d=en(i,Te(e));else{const h=e.serverCache.getNode();f(h instanceof m,"serverChildren would be complete if leaf node"),d=pi(i,h)}c=n.filter.updateFullNode(l,d,r)}else{const d=g(t);let h=mi(i,d,e.serverCache);null==h&&e.serverCache.isCompleteForChild(d)&&(h=l.getImmediateChild(d)),c=null!=h?n.filter.updateChild(l,d,h,b(t),a,r):e.eventCache.getNode().hasChild(d)?n.filter.updateChild(l,d,m.EMPTY_NODE,b(t),a,r):l,c.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=en(i,Te(e)),o.isLeafNode()&&(c=n.filter.updateFullNode(c,o,r)))}return o=e.serverCache.isFullyInitialized()||null!=tn(i,E()),mt(e,c,o,n.filter.filtersNodes())}}(n,e,c.path,i,s,r):function ou(n,e,t,i,s,r,o){if(null!=tn(s,t))return e;const a=e.serverCache.isFiltered(),l=e.serverCache;if(null!=i.value){if(y(t)&&l.isFullyInitialized()||l.isCompleteForPath(t))return nn(n,e,t,l.getNode().getChild(t),s,r,a,o);if(y(t)){let c=new T(null);return l.getNode().forEachChild(Q,(d,h)=>{c=c.set(new w(d),h)}),vi(n,e,t,c,s,r,a,o)}return e}{let c=new T(null);return i.foreach((d,h)=>{const u=N(t,d);l.isCompleteForPath(u)&&(c=c.set(d,l.getNode().getChild(u)))}),vi(n,e,t,c,s,r,a,o)}}(n,e,c.path,c.affectedTree,i,s,r)}else{if(t.type!==K.LISTEN_COMPLETE)throw ke("Unknown operation type: "+t.type);o=function au(n,e,t,i,s){const r=e.serverCache;return kr(n,Er(e,r.getNode(),r.isFullyInitialized()||y(t),r.isFiltered()),t,i,xr,s)}(n,e,t.path,i,r)}const l=r.getChanges();return function su(n,e,t){const i=e.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Jt(n);(t.length>0||!n.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&t.push(gr(Jt(e)))}}(e,o,l),{viewCache:o,changes:l}}(n.processor_,s,e,t,i);return function nu(n,e){f(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),f(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}(n.processor_,r.viewCache),f(r.viewCache.serverCache.isFullyInitialized()||!s.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=r.viewCache,Fr(n,r.changes,r.viewCache.eventCache.getNode(),null)}function Fr(n,e,t,i){return function Mc(n,e,t,i){const s=[],r=[];return e.forEach(o=>{"child_changed"===o.type&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&r.push(function Ec(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}(o.childName,o.snapshotNode))}),pt(n,s,"child_removed",e,i,t),pt(n,s,"child_added",e,i,t),pt(n,s,"child_moved",r,i,t),pt(n,s,"child_changed",e,i,t),pt(n,s,"value",e,i,t),s}(n.eventGenerator_,e,t,i?[i]:n.eventRegistrations_)}let sn,on;class Br{constructor(){this.views=new Map}}function Ci(n,e,t,i){const s=e.source.queryId;if(null!==s){const r=n.views.get(s);return f(null!=r,"SyncTree gave us an op for an invalid query."),Lr(r,e,t,i)}{let r=[];for(const o of n.views.values())r=r.concat(Lr(o,e,t,i));return r}}function yu(n,e,t,i,s,r){const o=function Wr(n,e,t,i,s){const o=n.views.get(e._queryIdentifier);if(!o){let a=en(t,s?i:null),l=!1;a?l=!0:i instanceof m?(a=pi(t,i),l=!1):(a=m.EMPTY_NODE,l=!1);const c=Xt(new ae(a,l,!1),new ae(i,s,!1));return new cu(e,c)}return o}(n,e,i,s,r);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),function fu(n,e){n.eventRegistrations_.push(e)}(o,t),function _u(n,e){const t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(S,(r,o)=>{i.push(We(r,o))}),t.isFullyInitialized()&&i.push(gr(t.getNode())),Fr(n,i,t.getNode(),e)}(o,t)}function Ur(n){const e=[];for(const t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function ce(n,e){let t=null;for(const i of n.views.values())t=t||du(i,e);return t}function Hr(n,e){return e._queryParams.loadsAllData()?rn(n):n.views.get(e._queryIdentifier)}function Vr(n,e){return null!=Hr(n,e)}function ue(n){return null!=rn(n)}function rn(n){for(const e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}let wu=1;class $r{constructor(e){this.listenProvider_=e,this.syncPointTree_=new T(null),this.pendingWriteTree_=function Xc(){return{visibleWrites:V.empty(),allWrites:[],lastWriteId:-1}}(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function Ei(n,e,t,i,s){return function Wc(n,e,t,i,s){f(i>n.lastWriteId,"Stacking an older write on top of newer ones"),void 0===s&&(s=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:s}),s&&(n.visibleWrites=gt(n.visibleWrites,e,t)),n.lastWriteId=i}(n.pendingWriteTree_,e,t,i,s),s?$e(n,new Se({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,t)):[]}function he(n,e,t=!1){const i=function Hc(n,e){for(let t=0;t<n.allWrites.length;t++){const i=n.allWrites[t];if(i.writeId===e)return i}return null}(n.pendingWriteTree_,e);if(function Vc(n,e){const t=n.allWrites.findIndex(a=>a.writeId===e);f(t>=0,"removeWrite called with nonexistent writeId.");const i=n.allWrites[t];n.allWrites.splice(t,1);let s=i.visible,r=!1,o=n.allWrites.length-1;for(;s&&o>=0;){const a=n.allWrites[o];a.visible&&(o>=t&&$c(a,i.path)?s=!1:U(i.path,a.path)&&(r=!0)),o--}return!!s&&(r?(function jc(n){n.visibleWrites=Sr(n.allWrites,zc,E()),n.lastWriteId=n.allWrites.length>0?n.allWrites[n.allWrites.length-1].writeId:-1}(n),!0):(i.snap?n.visibleWrites=wr(n.visibleWrites,i.path):P(i.children,l=>{n.visibleWrites=wr(n.visibleWrites,N(i.path,l))}),!0))}(n.pendingWriteTree_,e)){let r=new T(null);return null!=i.snap?r=r.set(E(),!0):P(i.children,o=>{r=r.set(new w(o),!0)}),$e(n,new qt(i.path,r,t))}return[]}function yt(n,e,t){return $e(n,new Se({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,t))}function an(n,e,t,i,s=!1){const r=e._path,o=n.syncPointTree_.get(r);let a=[];if(o&&("default"===e._queryIdentifier||Vr(o,e))){const l=function vu(n,e,t,i){const s=e._queryIdentifier,r=[];let o=[];const a=ue(n);if("default"===s)for(const[l,c]of n.views.entries())o=o.concat(Mr(c,t,i)),Or(c)&&(n.views.delete(l),c.query._queryParams.loadsAllData()||r.push(c.query));else{const l=n.views.get(s);l&&(o=o.concat(Mr(l,t,i)),Or(l)&&(n.views.delete(s),l.query._queryParams.loadsAllData()||r.push(l.query)))}return a&&!ue(n)&&r.push(new(function mu(){return f(sn,"Reference.ts has not been loaded"),sn}())(e._repo,e._path)),{removed:r,events:o}}(o,e,t,i);(function gu(n){return 0===n.views.size})(o)&&(n.syncPointTree_=n.syncPointTree_.remove(r));const c=l.removed;if(a=l.events,!s){const d=-1!==c.findIndex(u=>u._queryParams.loadsAllData()),h=n.syncPointTree_.findOnPath(r,(u,_)=>ue(_));if(d&&!h){const u=n.syncPointTree_.subtree(r);if(!u.isEmpty()){const _=function Ru(n){return n.fold((e,t,i)=>{if(t&&ue(t))return[rn(t)];{let s=[];return t&&(s=Ur(t)),P(i,(r,o)=>{s=s.concat(o)}),s}})}(u);for(let p=0;p<_.length;++p){const C=_[p],R=C.query,te=Qr(n,C);n.listenProvider_.startListening(Ct(R),vt(n,R),te.hashFn,te.onComplete)}}}!h&&c.length>0&&!i&&(d?n.listenProvider_.stopListening(Ct(e),null):c.forEach(u=>{const _=n.queryToTagMap.get(cn(u));n.listenProvider_.stopListening(Ct(u),_)}))}!function xu(n,e){for(let t=0;t<e.length;++t){const i=e[t];if(!i._queryParams.loadsAllData()){const s=cn(i),r=n.queryToTagMap.get(s);n.queryToTagMap.delete(s),n.tagToQueryMap.delete(r)}}}(n,c)}return a}function wi(n,e,t,i=!1){const s=e._path;let r=null,o=!1;n.syncPointTree_.foreachOnPath(s,(u,_)=>{const p=O(u,s);r=r||ce(_,p),o=o||ue(_)});let l,a=n.syncPointTree_.get(s);a?(o=o||ue(a),r=r||ce(a,E())):(a=new Br,n.syncPointTree_=n.syncPointTree_.set(s,a)),null!=r?l=!0:(l=!1,r=m.EMPTY_NODE,n.syncPointTree_.subtree(s).foreachChild((_,p)=>{const C=ce(p,E());C&&(r=r.updateImmediateChild(_,C))}));const c=Vr(a,e);if(!c&&!e._queryParams.loadsAllData()){const u=cn(e);f(!n.queryToTagMap.has(u),"View does not exist, but we have a tag");const _=function ku(){return wu++}();n.queryToTagMap.set(u,_),n.tagToQueryMap.set(_,u)}let h=yu(a,e,t,Zt(n.pendingWriteTree_,s),r,l);if(!c&&!o&&!i){const u=Hr(a,e);h=h.concat(function Pu(n,e,t){const i=e._path,s=vt(n,e),r=Qr(n,t),o=n.listenProvider_.startListening(Ct(e),s,r.hashFn,r.onComplete),a=n.syncPointTree_.subtree(i);if(s)f(!ue(a.value),"If we're adding a query, it shouldn't be shadowed");else{const l=a.fold((c,d,h)=>{if(!y(c)&&d&&ue(d))return[rn(d).query];{let u=[];return d&&(u=u.concat(Ur(d).map(_=>_.query))),P(h,(_,p)=>{u=u.concat(p)}),u}});for(let c=0;c<l.length;++c){const d=l[c];n.listenProvider_.stopListening(Ct(d),vt(n,d))}}return o}(n,e,u))}return h}function ln(n,e,t){const s=n.pendingWriteTree_,r=n.syncPointTree_.findOnPath(e,(o,a)=>{const c=ce(a,O(o,e));if(c)return c});return Tr(s,e,r,t,!0)}function $e(n,e){return zr(e,n.syncPointTree_,null,Zt(n.pendingWriteTree_,E()))}function zr(n,e,t,i){if(y(n.path))return Gr(n,e,t,i);{const s=e.get(E());null==t&&null!=s&&(t=ce(s,E()));let r=[];const o=g(n.path),a=n.operationForChild(o),l=e.children.get(o);if(l&&a){const c=t?t.getImmediateChild(o):null,d=Ar(i,o);r=r.concat(zr(a,l,c,d))}return s&&(r=r.concat(Ci(s,n,i,t))),r}}function Gr(n,e,t,i){const s=e.get(E());null==t&&null!=s&&(t=ce(s,E()));let r=[];return e.children.inorderTraversal((o,a)=>{const l=t?t.getImmediateChild(o):null,c=Ar(i,o),d=n.operationForChild(o);d&&(r=r.concat(Gr(d,a,l,c)))}),s&&(r=r.concat(Ci(s,n,i,t))),r}function Qr(n,e){const t=e.query,i=vt(n,t);return{hashFn:()=>(function uu(n){return n.viewCache_.serverCache.getNode()}(e)||m.EMPTY_NODE).hash(),onComplete:s=>{if("ok"===s)return i?function Tu(n,e,t){const i=bi(n,t);if(i){const s=Ii(i),r=s.path,o=s.queryId,a=O(r,e);return Si(n,r,new _t(ui(o),a))}return[]}(n,t._path,i):function Su(n,e){return $e(n,new _t({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(n,t._path);{const r=function Il(n,e){let t="Unknown Error";"too_big"===n?t="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===n?t="Client doesn't have permission to access the desired data.":"unavailable"===n&&(t="The service is unavailable");const i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}(s,t);return an(n,t,null,r)}}}}function vt(n,e){const t=cn(e);return n.queryToTagMap.get(t)}function cn(n){return n._path.toString()+"$"+n._queryIdentifier}function bi(n,e){return n.tagToQueryMap.get(e)}function Ii(n){const e=n.indexOf("$");return f(-1!==e&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new w(n.substr(0,e))}}function Si(n,e,t){const i=n.syncPointTree_.get(e);return f(i,"Missing sync point for query tag that we're tracking"),Ci(i,t,Zt(n.pendingWriteTree_,e),null)}function Ct(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(function Eu(){return f(on,"Reference.ts has not been loaded"),on}())(n._repo,n._path):n}class Ti{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Ti(t)}node(){return this.node_}}class Ni{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=N(this.path_,e);return new Ni(this.syncTree_,t)}node(){return ln(this.syncTree_,this.path_)}}const Du=function(n){return(n=n||{}).timestamp=n.timestamp||(new Date).getTime(),n},Kr=function(n,e,t){return n&&"object"==typeof n?(f(".sv"in n,"Unexpected leaf node or priority contents"),"string"==typeof n[".sv"]?Ou(n[".sv"],e,t):"object"==typeof n[".sv"]?Mu(n[".sv"],e):void f(!1,"Unexpected server value: "+JSON.stringify(n,null,2))):n},Ou=function(n,e,t){if("timestamp"===n)return t.timestamp;f(!1,"Unexpected server value: "+n)},Mu=function(n,e,t){n.hasOwnProperty("increment")||f(!1,"Unexpected server value: "+JSON.stringify(n,null,2));const i=n.increment;"number"!=typeof i&&f(!1,"Unexpected increment value: "+i);const s=e.node();if(f(null!==s&&typeof s<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!s.isLeafNode())return i;const o=s.getValue();return"number"!=typeof o?i:o+i},Yr=function(n,e,t,i){return Ri(e,new Ni(t,n),i)},Ai=function(n,e,t){return Ri(n,new Ti(e),t)};function Ri(n,e,t){const i=n.getPriority().val(),s=Kr(i,e.getImmediateChild(".priority"),t);let r;if(n.isLeafNode()){const o=n,a=Kr(o.getValue(),e,t);return a!==o.getValue()||s!==o.getPriority().val()?new Fe(a,A(s)):n}{const o=n;return r=o,s!==o.getPriority().val()&&(r=r.updatePriority(new Fe(s))),o.forEachChild(S,(a,l)=>{const c=Ri(l,e.getImmediateChild(a),t);c!==l&&(r=r.updateImmediateChild(a,c))}),r}}class xi{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}}function un(n,e){let t=e instanceof w?e:new w(e),i=n,s=g(t);for(;null!==s;){const r=Pe(i.node.children,s)||{children:{},childCount:0};i=new xi(s,i,r),t=b(t),s=g(t)}return i}function Ae(n){return n.node.value}function ki(n,e){n.node.value=e,Pi(n)}function qr(n){return n.node.childCount>0}function hn(n,e){P(n.node.children,(t,i)=>{e(new xi(t,n,i))})}function Xr(n,e,t,i){t&&!i&&e(n),hn(n,s=>{Xr(s,e,!0,i)}),t&&i&&e(n)}function Et(n){return new w(null===n.parent?n.name:Et(n.parent)+"/"+n.name)}function Pi(n){null!==n.parent&&function Bu(n,e,t){const i=function Lu(n){return void 0===Ae(n)&&!qr(n)}(t),s=z(n.node.children,e);i&&s?(delete n.node.children[e],n.node.childCount--,Pi(n)):!i&&!s&&(n.node.children[e]=t.node,n.node.childCount++,Pi(n))}(n.parent,n.name,n)}const Wu=/[\[\].#$\/\u0000-\u001F\u007F]/,Uu=/[\[\].#$\u0000-\u001F\u007F]/,Di=10485760,dn=function(n){return"string"==typeof n&&0!==n.length&&!Wu.test(n)},Jr=function(n){return"string"==typeof n&&0!==n.length&&!Uu.test(n)},bt=function(n,e,t){const i=t instanceof w?new ic(t,n):t;if(void 0===e)throw new Error(n+"contains undefined "+be(i));if("function"==typeof e)throw new Error(n+"contains a function "+be(i)+" with contents = "+e.toString());if(Wt(e))throw new Error(n+"contains "+e.toString()+" "+be(i));if("string"==typeof e&&e.length>Di/3&&Mt(e)>Di)throw new Error(n+"contains a string greater than "+Di+" utf8 bytes "+be(i)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){let s=!1,r=!1;if(P(e,(o,a)=>{if(".value"===o)s=!0;else if(".priority"!==o&&".sv"!==o&&(r=!0,!dn(o)))throw new Error(n+" contains an invalid key ("+o+") "+be(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');(function sc(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=Mt(e),lr(n)})(i,o),bt(n,a,i),function rc(n){const e=n.parts_.pop();n.byteLength_-=Mt(e),n.parts_.length>0&&(n.byteLength_-=1)}(i)}),s&&r)throw new Error(n+' contains ".value" child '+be(i)+" in addition to actual children.")}},Mi=function(n,e,t,i){if(!(i&&void 0===t||Jr(t)))throw new Error(De(n,e)+'was an invalid path = "'+t+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},$u=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Mi(n,e,t,i)};class ju{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function fn(n,e){let t=null;for(let i=0;i<e.length;i++){const s=e[i],r=s.getPath();null!==t&&!Yn(r,t.path)&&(n.eventLists_.push(t),t=null),null===t&&(t={events:[],path:r}),t.events.push(s)}t&&n.eventLists_.push(t)}function to(n,e,t){fn(n,t),no(n,i=>Yn(i,e))}function F(n,e,t){fn(n,t),no(n,i=>U(i,e)||U(e,i))}function no(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){const s=n.eventLists_[i];s&&(e(s.path)?(zu(n.eventLists_[i]),n.eventLists_[i]=null):t=!1)}t&&(n.eventLists_=[]),n.recursionDepth_--}function zu(n){for(let e=0;e<n.events.length;e++){const t=n.events[e];if(null!==t){n.events[e]=null;const i=t.getEventRunner();Ee&&k("event: "+t.toString()),Me(i)}}}const Gu=25;class Qu{constructor(e,t,i,s){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=s,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ju,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Yt(),this.transactionQueueTree_=new xi,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function so(n){const t=n.infoData_.getNode(new w(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function St(n){return Du({timestamp:so(n)})}function ro(n,e,t,i,s){n.dataUpdateCount++;const r=new w(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(s)if(i){const l=Dt(t,c=>A(c));o=function Nu(n,e,t,i){const s=bi(n,i);if(s){const r=Ii(s),o=r.path,a=r.queryId,l=O(o,e),c=T.fromObject(t);return Si(n,o,new He(ui(a),l,c))}return[]}(n.serverSyncTree_,r,l,s)}else{const l=A(t);o=function jr(n,e,t,i){const s=bi(n,i);if(null!=s){const r=Ii(s),o=r.path,a=r.queryId,l=O(o,e);return Si(n,o,new Se(ui(a),l,t))}return[]}(n.serverSyncTree_,r,l,s)}else if(i){const l=Dt(t,c=>A(c));o=function Iu(n,e,t){const i=T.fromObject(t);return $e(n,new He({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,i))}(n.serverSyncTree_,r,l)}else{const l=A(t);o=yt(n.serverSyncTree_,r,l)}let a=r;o.length>0&&(a=ze(n,r)),F(n.eventQueue_,a,o)}function oo(n,e){Li(n,"connected",e),!1===e&&function Ju(n){je(n,"onDisconnectEvents");const e=St(n),t=Yt();ai(n.onDisconnect_,E(),(s,r)=>{const o=Yr(s,r,n.serverSyncTree_,e);Ue(t,s,o)});let i=[];ai(t,E(),(s,r)=>{i=i.concat(yt(n.serverSyncTree_,s,r));const o=Ui(n,s);ze(n,o)}),n.onDisconnect_=Yt(),F(n.eventQueue_,E(),i)}(n)}function Li(n,e,t){const i=new w("/.info/"+e),s=A(t);n.infoData_.updateSnapshot(i,s);const r=yt(n.infoSyncTree_,i,s);F(n.eventQueue_,i,r)}function _n(n){return n.nextWriteId_++}function Fi(n,e,t,i,s){je(n,"set",{path:e.toString(),value:t,priority:i});const r=St(n),o=A(t,i),a=ln(n.serverSyncTree_,e),l=Ai(o,a,r),c=_n(n),d=Ei(n.serverSyncTree_,e,l,c,!0);fn(n.eventQueue_,d),n.server_.put(e.toString(),o.val(!0),(u,_)=>{const p="ok"===u;p||D("set at "+e+" failed: "+u);const C=he(n.serverSyncTree_,c,!p);F(n.eventQueue_,e,C),function de(n,e,t,i){e&&Me(()=>{if("ok"===t)e(null);else{const s=(t||"error").toUpperCase();let r=s;i&&(r+=": "+i);const o=new Error(r);o.code=s,e(o)}})}(0,s,u,_)});const h=Ui(n,e);ze(n,h),F(n.eventQueue_,h,[])}function Bi(n,e,t){let i;i=".info"===g(e._path)?an(n.infoSyncTree_,e,t):an(n.serverSyncTree_,e,t),to(n.eventQueue_,e._path,i)}function je(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),k(t,...e)}function Wi(n,e,t){return ln(n.serverSyncTree_,e,t)||m.EMPTY_NODE}function pn(n,e=n.transactionQueueTree_){if(e||mn(n,e),Ae(e)){const t=uo(n,e);f(t.length>0,"Sending zero length transaction queue"),t.every(s=>0===s.status)&&function rh(n,e,t){const i=t.map(c=>c.currentWriteId),s=Wi(n,e,i);let r=s;const o=s.hash();for(let c=0;c<t.length;c++){const d=t[c];f(0===d.status,"tryToSendTransactionQueue_: items in queue should all be run."),d.status=1,d.retryCount++;const h=O(e,d.path);r=r.updateChild(h,d.currentOutputSnapshotRaw)}const a=r.val(!0),l=e;n.server_.put(l.toString(),a,c=>{je(n,"transaction put response",{path:l.toString(),status:c});let d=[];if("ok"===c){const h=[];for(let u=0;u<t.length;u++)t[u].status=2,d=d.concat(he(n.serverSyncTree_,t[u].currentWriteId)),t[u].onComplete&&h.push(()=>t[u].onComplete(null,!0,t[u].currentOutputSnapshotResolved)),t[u].unwatcher();mn(n,un(n.transactionQueueTree_,e)),pn(n,n.transactionQueueTree_),F(n.eventQueue_,e,d);for(let u=0;u<h.length;u++)Me(h[u])}else{if("datastale"===c)for(let h=0;h<t.length;h++)t[h].status=3===t[h].status?4:0;else{D("transaction at "+l.toString()+" failed: "+c);for(let h=0;h<t.length;h++)t[h].status=4,t[h].abortReason=c}ze(n,e)}},o)}(n,Et(e),t)}else qr(e)&&hn(e,t=>{pn(n,t)})}function ze(n,e){const t=co(n,e),i=Et(t);return function oh(n,e,t){if(0===e.length)return;const i=[];let s=[];const o=e.filter(a=>0===a.status).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){const l=e[a],c=O(t,l.path);let h,d=!1;if(f(null!==c,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,h=l.abortReason,s=s.concat(he(n.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=Gu)d=!0,h="maxretry",s=s.concat(he(n.serverSyncTree_,l.currentWriteId,!0));else{const u=Wi(n,l.path,o);l.currentInputSnapshot=u;const _=e[a].update(u.val());if(void 0!==_){bt("transaction failed: Data returned ",_,l.path);let p=A(_);"object"==typeof _&&null!=_&&z(_,".priority")||(p=p.updatePriority(u.getPriority()));const R=l.currentWriteId,te=St(n),ne=Ai(p,u,te);l.currentOutputSnapshotRaw=p,l.currentOutputSnapshotResolved=ne,l.currentWriteId=_n(n),o.splice(o.indexOf(R),1),s=s.concat(Ei(n.serverSyncTree_,l.path,ne,l.currentWriteId,l.applyLocally)),s=s.concat(he(n.serverSyncTree_,R,!0))}else d=!0,h="nodata",s=s.concat(he(n.serverSyncTree_,l.currentWriteId,!0))}F(n.eventQueue_,t,s),s=[],d&&(e[a].status=2,setTimeout(e[a].unwatcher,Math.floor(0)),e[a].onComplete&&i.push("nodata"===h?()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot):()=>e[a].onComplete(new Error(h),!1,null)))}mn(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)Me(i[a]);pn(n,n.transactionQueueTree_)}(n,uo(n,t),i),i}function co(n,e){let t,i=n.transactionQueueTree_;for(t=g(e);null!==t&&void 0===Ae(i);)i=un(i,t),t=g(e=b(e));return i}function uo(n,e){const t=[];return ho(n,e,t),t.sort((i,s)=>i.order-s.order),t}function ho(n,e,t){const i=Ae(e);if(i)for(let s=0;s<i.length;s++)t.push(i[s]);hn(e,s=>{ho(n,s,t)})}function mn(n,e){const t=Ae(e);if(t){let i=0;for(let s=0;s<t.length;s++)2!==t[s].status&&(t[i]=t[s],i++);t.length=i,ki(e,t.length>0?t:void 0)}hn(e,i=>{mn(n,i)})}function Ui(n,e){const t=Et(co(n,e)),i=un(n.transactionQueueTree_,e);return function Fu(n,e,t){let i=t?n:n.parent;for(;null!==i;){if(e(i))return!0;i=i.parent}}(i,s=>{Hi(n,s)}),Hi(n,i),Xr(i,s=>{Hi(n,s)}),t}function Hi(n,e){const t=Ae(e);if(t){const i=[];let s=[],r=-1;for(let o=0;o<t.length;o++)3===t[o].status||(1===t[o].status?(f(r===o-1,"All SENT items should be at beginning of queue."),r=o,t[o].status=3,t[o].abortReason="set"):(f(0===t[o].status,"Unexpected transaction status in abort"),t[o].unwatcher(),s=s.concat(he(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));-1===r?ki(e,void 0):t.length=r+1,F(n.eventQueue_,Et(e),s);for(let o=0;o<i.length;o++)Me(i[o])}}const Vi=function(n,e){const t=ch(n),i=t.namespace;return"firebase.com"===t.domain&&G(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||"undefined"===i)&&"localhost"!==t.domain&&G("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||typeof window<"u"&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&D("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new Vn(t.host,t.secure,i,"ws"===t.scheme||"wss"===t.scheme,e,"",i!==t.subdomain),path:new w(t.pathString)}},ch=function(n){let e="",t="",i="",s="",r="",o=!0,a="https",l=443;if("string"==typeof n){let c=n.indexOf("//");c>=0&&(a=n.substring(0,c-1),n=n.substring(c+2));let d=n.indexOf("/");-1===d&&(d=n.length);let h=n.indexOf("?");-1===h&&(h=n.length),e=n.substring(0,Math.min(d,h)),d<h&&(s=function ah(n){let e="";const t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let s=t[i];try{s=decodeURIComponent(s.replace(/\+/g," "))}catch{}e+="/"+s}return e}(n.substring(d,h)));const u=function lh(n){const e={};"?"===n.charAt(0)&&(n=n.substring(1));for(const t of n.split("&")){if(0===t.length)continue;const i=t.split("=");2===i.length?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):D(`Invalid query segment '${t}' in query '${n}'`)}return e}(n.substring(Math.min(n.length,h)));c=e.indexOf(":"),c>=0?(o="https"===a||"wss"===a,l=parseInt(e.substring(c+1),10)):c=e.length;const _=e.slice(0,c);if("localhost"===_.toLowerCase())t="localhost";else if(_.split(".").length<=2)t=_;else{const p=e.indexOf(".");i=e.substring(0,p).toLowerCase(),t=e.substring(p+1),r=i}"ns"in u&&(r=u.ns)}return{host:e,port:l,domain:t,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class _o{constructor(e,t,i,s){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=s}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+x(this.snapshot.exportVal())}}class po{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class $i{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return f(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class B{constructor(e,t,i,s){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=s}get key(){return y(this._path)?null:Kn(this._path)}get ref(){return new $(this._repo,this._path)}get _queryIdentifier(){const e=vr(this._queryParams),t=Un(e);return"{}"===t?"default":t}get _queryObject(){return vr(this._queryParams)}isEqual(e){if(!((e=Xe(e))instanceof B))return!1;const t=this._repo===e._repo,i=Yn(this._path,e._path);return t&&i&&this._queryIdentifier===e._queryIdentifier}toJSON(){return this.toString()}toString(){return this._repo.toString()+function tc(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)""!==n.pieces_[t]&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}(this._path)}}class $ extends B{constructor(e,t){super(e,t,new ii,!1)}get parent(){const e=ar(this._path);return null===e?null:new $(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Re{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new w(e),i=Ge(this.ref,e);return new Re(this._node.getChild(t),i,S)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,(i,s)=>e(new Re(s,Ge(this.ref,i),S)))}hasChild(e){const t=new w(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function ji(n,e){return(n=Xe(n))._checkNotDeleted("ref"),void 0!==e?Ge(n._root,e):n._root}function Ge(n,e){return null===g((n=Xe(n))._path)?$u("child","path",e,!1):Mi("child","path",e,!1),new $(n._repo,N(n._path,e))}function zi(n,e){(function(n,e){if(".info"===g(e))throw new Error(n+" failed = Can't modify data under /.info/")})("set",(n=Xe(n))._path),function(n,e,t,i){i&&void 0===e||bt(De(n,"value"),e,t)}("set",e,n._path,!1);const t=new Qe;return Fi(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}class Tt{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const i=t._queryParams.getIndex();return new _o("value",this,new Re(e.snapshotNode,new $(t._repo,t._path),i))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new po(this,e,t):null}matches(e){return e instanceof Tt&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class vn{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new po(this,e,t):null}createEvent(e,t){f(null!=e.childName,"Child events should have a childName.");const i=Ge(new $(t._repo,t._path),e.childName),s=t._queryParams.getIndex();return new _o(e.type,this,new Re(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof vn&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function mo(n,e,t,i){return function Nt(n,e,t,i,s){let r;if("object"==typeof i&&(r=void 0,s=i),"function"==typeof i&&(r=i),s&&s.onlyOnce){const l=t,c=(d,h)=>{Bi(n._repo,n,a),l(d,h)};c.userCallback=t.userCallback,c.context=t.context,t=c}const o=new $i(t,r||void 0),a="value"===e?new Tt(o):new vn(e,o);return function nh(n,e,t){let i;i=".info"===g(e._path)?wi(n.infoSyncTree_,e,t):wi(n.serverSyncTree_,e,t),to(n.eventQueue_,e._path,i)}(n._repo,n,a),()=>Bi(n._repo,n,a)}(n,"value",e,t,i)}(function pu(n){f(!sn,"__referenceConstructor has already been defined"),sn=n})($),function Cu(n){f(!on,"__referenceConstructor has already been defined"),on=n}($);const Gi={};function Co(n,e,t,i,s){let r=i||n.options.databaseURL;void 0===r&&(n.options.projectId||G("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),k("Using default host for project ",n.options.projectId),r=`${n.options.projectId}-default-rtdb.firebaseio.com`);let l,c,o=Vi(r,s),a=o.repoInfo;typeof process<"u"&&process.env&&(c=process.env.FIREBASE_DATABASE_EMULATOR_HOST),c?(l=!0,r=`http://${c}?ns=${a.namespace}`,o=Vi(r,s),a=o.repoInfo):l=!o.repoInfo.secure;const d=s&&l?new ot(ot.OWNER):new xl(n.name,n.options,e);(function(n,e){const t=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!dn(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==t.length&&!function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Jr(n)}(t))throw new Error(De(n,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')})("Invalid Firebase Database URL",o),y(o.path)||G("Database URL must point to the root of a Firebase Database (not including a child path).");const h=function Ih(n,e,t,i){let s=Gi[e.name];s||(s={},Gi[e.name]=s);let r=s[n.toURLString()];return r&&G("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Qu(n,false,t,i),s[n.toURLString()]=r,r}(a,n,d,new Rl(n,t));return new Th(h,n)}class Th{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(function Ku(n,e,t){if(n.stats_=zn(n.repoInfo_),n.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)n.server_=new Kt(n.repoInfo_,(i,s,r,o)=>{ro(n,i,s,r,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>oo(n,!0),0);else{if(typeof t<"u"&&null!==t){if("object"!=typeof t)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{x(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new Ie(n.repoInfo_,e,(i,s,r,o)=>{ro(n,i,s,r,o)},i=>{oo(n,i)},i=>{!function Yu(n,e){P(e,(t,i)=>{Li(n,t,i)})}(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=function Dl(n,e){const t=n.toString();return jn[t]||(jn[t]=e()),jn[t]}(n.repoInfo_,()=>new Dc(n.stats_,n.server_)),n.infoData_=new Ac,n.infoSyncTree_=new $r({startListening:(i,s,r,o)=>{let a=[];const l=n.infoData_.getNode(i._path);return l.isEmpty()||(a=yt(n.infoSyncTree_,i._path,l),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),Li(n,"connected",!1),n.serverSyncTree_=new $r({startListening:(i,s,r,o)=>(n.server_.listen(i,r,s,(a,l)=>{const c=o(a,l);F(n.eventQueue_,i._path,c)}),[]),stopListening:(i,s)=>{n.server_.unlisten(i,s)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new $(this._repo,E())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function bh(n,e){const t=Gi[e];(!t||t[n.key]!==n)&&G(`Database ${e}(${n.repoInfo_}) has already been deleted.`),function lo(n){n.persistentConnection_&&n.persistentConnection_.interrupt("repo_interrupt")}(n),delete t[n.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&G("Cannot call "+e+" on a deleted database.")}}function wo(n=function il(n=Ft){const e=ye.get(n);if(!e&&n===Ft&&Ji())return ms();if(!e)throw W.create("no-app",{appName:n});return e}(),e){const t=function fs(n,e){const t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){const i=(n=>{const e=(n=>{var e,t;return null===(t=null===(e=xt())||void 0===e?void 0:e.emulatorHosts)||void 0===t?void 0:t[n]})(n);if(!e)return;const t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const i=parseInt(e.substring(t+1),10);return"["===e[0]?[e.substring(1,t-1),i]:[e.substring(0,t),i]})("database");i&&function Nh(n,e,t,i={}){(n=Xe(n))._checkNotDeleted("useEmulator");const s=`${e}:${t}`,r=n._repoInternal;if(n._instanceStarted){if(s===n._repoInternal.repoInfo_.host&&Ot(i,r.repoInfo_.emulatorOptions))return;G("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(r.repoInfo_.nodeAdmin)i.mockUserToken&&G('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new ot(ot.OWNER);else if(i.mockUserToken){const a="string"==typeof i.mockUserToken?i.mockUserToken:function Mo(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const i=e||"demo-project",s=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}}},n);return[At(JSON.stringify({alg:"none",type:"JWT"})),At(JSON.stringify(o)),""].join(".")}(i.mockUserToken,n.app.options.projectId);o=new ot(a)}wn(e)&&(function Oo(n){bn.apply(this,arguments)}(e),Bo("Database",!0)),function wh(n,e,t,i){const s=e.lastIndexOf(":"),o=wn(e.substring(0,s));n.repoInfo_=new Vn(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}(r,s,i,o)}(t,...i)}return t}Ie.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)},Ie.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)},function Ah(n){(function Is(n){Fn=n})("11.10.0"),Bt(new Je("database",(e,{instanceIdentifier:t})=>Co(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t),"PUBLIC").setMultipleInstances(!0)),ve(ws,"1.0.20",n),ve(ws,"1.0.20","esm2017")}();var kh=me(5149);var Ph=me(6600),Dh=me(177),pe=me(4438);let Oh=(()=>{class n{constructor(){this.data=[],this.loading=!1}ngOnInit(){const s=ji(wo(ms({apiKey:"AIzaSyAdG7uHrr3e-LneLzDdxMWasf3ZBqCfEpo",authDomain:"whiteboard-65361.firebaseapp.com",projectId:"whiteboard-65361",storageBucket:"whiteboard-65361.appspot.com",messagingSenderId:"316627579817",appId:"1:316627579817:web:99cbcdebdf34df9da1cab8",measurementId:"G-WY9JS9587B",databaseURL:"https://whiteboard-65361-default-rtdb.europe-west1.firebasedatabase.app"})),"data/");this.loading=!0,mo(s,r=>{this.loading=!1;const o=r.val();this.data=o||[]})}onDataChange(t){this.loading||(this.data=t,zi(ji(wo(),"data/"),t))}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275cmp=pe.VBU({type:n,selectors:[["app-whiteboard-live-app"]],standalone:!0,features:[pe.Jv_([kh.K]),pe.aNF],decls:2,vars:1,consts:[[1,"container"],[3,"dataChange","data"]],template:function(i,s){1&i&&(pe.j41(0,"div",0)(1,"app-comprehensive-component",1),pe.bIt("dataChange",function(o){return s.onDataChange(o)}),pe.k0s()()),2&i&&(pe.R7$(),pe.Y8G("data",s.data))},dependencies:[Dh.MD,Ph.S],styles:[".container[_ngcontent-%COMP%]{height:100%;width:100%}"]})}}return n})()}}]);