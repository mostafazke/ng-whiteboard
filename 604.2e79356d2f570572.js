"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[604],{2107:(Q,Y,x)=>{x.d(Y,{G:()=>p});var I=x(4523),e=x(4438),b=x(7785),z=x(9989),O=x(525),s=x(6255),m=x(3437),c=x(710),u=x(1152),i=x(3312),h=x(875),o=x(4764),E=x(6078),w=x(162),a=x(1389),D=x(3909);let p=(()=>{class P{constructor(){this.elementsService=(0,e.WQX)(s.L),this.canvasService=(0,e.WQX)(O.W),this.selectionService=(0,e.WQX)(u.A),this.toolsService=(0,e.WQX)(i.H),this.ioService=(0,e.WQX)(a.q),this.historyService=(0,e.WQX)(h.k),this.zoomService=(0,e.WQX)(o.T),this.panService=(0,e.WQX)(c.l),this.layerService=(0,e.WQX)(m.a),this.configService=(0,e.WQX)(b.w),this.clipboardService=(0,e.WQX)(D.W),this.eventBusService=(0,e.WQX)(z.W),this.elements=this.elementsService.elements,this.draftElements=this.elementsService.draftElements,this.allElements=this.elementsService.allElements,this.selectedElements=this.selectionService.getSelectedElementsSignal(),this.config=(0,e.EWP)(()=>this.configService.getConfig()),this.elementsCount=this.elementsService.elementsCount,this.hasElements=this.elementsService.hasElements,this.selectedTool=this.toolsService.selectedTool,this.availableTools=this.toolsService.availableTools,this.layers=this.layerService.layers,this.activeLayerId=this.layerService.activeLayerId,this.activeLayer=this.layerService.activeLayer}setElements(d){this.elementsService.setElements(d)}getElements(){return this.elementsService.getElements()}addElements(d){this.elementsService.addElements(d)}updateElements(d){const y=d.map(W=>({...W,id:W.id}));this.elementsService.updateElements(y)}removeElements(d){this.elementsService.removeElements(d)}clear(){this.elementsService.clear()}clearAll(){this.elementsService.clear(),this.selectionService.clearSelection()}addElement(d){this.addElements([d])}updateElement(d){this.updateElements([d])}removeElementsByIds(d){this.elementsService.removeElementsByIds(d)}getElementById(d){return this.elementsService.getElementById(d)}getElementsByIds(d){return this.elementsService.getElementsByIds(d)}getNextZIndex(){return this.elementsService.getNextZIndex()}getAllElements(){return this.elementsService.getElements()}getDraftElements(){return this.elementsService.getDraftElements()}addDraftElements(d){this.elementsService.addDraftElements(d)}updateDraftElements(d){this.elementsService.updateDraftElements(d)}removeDraftElements(d){this.elementsService.removeDraftElements(d)}commitDraftElements(){this.elementsService.commitDraftElements()}elementExists(d){return this.elementsService.elementExists(d)}selectElements(d,y=!1){this.selectionService.selectElements(d,y)}deselectElement(d){this.selectionService.deselectElement(d)}toggleSelection(d){this.selectionService.toggleSelection(d)}clearSelection(){this.selectionService.clearSelection()}selectAll(){this.selectionService.selectAll()}getSelectedElements(){return this.selectionService.getSelectedElements()}updateSelectedElements(d){this.selectionService.updateSelectedElements(d)}removeSelectedElements(){this.selectionService.removeSelectedElements()}isSelected(d){return this.selectionService.isSelected(d)}clearSelectionBox(){this.selectionService.clearSelectionBox()}transformSelectedElements(d){this.selectionService.transformSelectedElements(d)}setSelectionBox(d){this.selectionService.setSelectionBox(d)}updateBoundingBox(){this.selectionService.updateBoundingBox()}getBoundingBox(){return this.selectionService.getBoundingBox()}setBoundingBox(d){this.selectionService.setBoundingBox(d)}getClipboardInfo(){return this.clipboardService.getClipboardInfo()}copyElements(){this.selectionService.copyElements()}cutElements(){this.selectionService.cutElements()}pasteElements(){this.selectionService.pasteElements()}duplicateElements(){this.selectionService.duplicateElements()}deleteSelectedElements(){this.selectionService.deleteSelectedElements()}bringToFront(){this.selectionService.bringToFront()}bringForward(){this.selectionService.bringForward()}sendBackward(){this.selectionService.sendBackward()}sendToBack(){this.selectionService.sendToBack()}groupSelectedElements(){this.selectionService.groupSelectedElements()}ungroupSelectedElements(){this.selectionService.ungroupSelectedElements()}lockElements(){this.selectionService.lockElements()}unlockElements(){this.selectionService.unlockElements()}alignElements(d){this.selectionService.alignElements(d)}distributeHorizontally(){this.selectionService.distributeHorizontally()}distributeVertically(){this.selectionService.distributeVertically()}flipHorizontal(){this.selectionService.flipHorizontal()}flipVertical(){this.selectionService.flipVertical()}moveSelectedElements(d,y){this.selectionService.moveSelectedElements(d,y)}rotateSelectedElements(d){this.selectionService.rotateSelectedElements(d)}scaleSelectedElements(d){this.selectionService.scaleSelectedElements(d)}initializeWhiteboard(d){this.canvasService.initializeCanvas(d),this.toolsService.setApiService(this)}getCanvas(){return this.canvasService.getCanvas()}setCanvasDimensions(d,y){this.canvasService.setCanvasDimensions(d,y)}centerCanvas(){this.canvasService.centerCanvas()}fullScreen(){this.canvasService.fullScreen()}exitFullScreen(d,y){this.canvasService.exitFullScreen(d,y)}resetCanvas(){this.canvasService.resetCanvas()}setZoom(d){this.zoomService.zoom(d)}zoomIn(){this.zoomService.zoomIn()}zoomOut(){this.zoomService.zoomOut()}resetZoom(){this.zoomService.resetZoom()}zoomToFit(){this.zoomService.zoomToFit()}zoomToSelection(){this.zoomService.zoomToSelection()}pan(d,y){this.panService.pan(d,y)}panTo(d,y){this.panService.panTo(d,y)}resetPan(){this.panService.resetPan()}save(d=E.o8.Base64,y="whiteboard"){var W=this;return(0,I.A)(function*(){return W.ioService.save(d,y)})()}addImage(d){this.ioService.addImage(d)}importImageFile(d,y,W){var L=this;return(0,I.A)(function*(){return L.ioService.importImageFile(d,y,W)})()}exportData(){return this.ioService.exportData()}importData(d){this.ioService.importData(d)}exportAsPNG(d="whiteboard"){var y=this;return(0,I.A)(function*(){return y.ioService.exportAsPng(d)})()}exportAsSVG(d="whiteboard"){var y=this;return(0,I.A)(function*(){return y.ioService.exportAsSvg(d)})()}exportAsJSON(d="whiteboard"){const y=this.ioService.exportData(),W=new Blob([y],{type:"application/json"}),L=URL.createObjectURL(W),g=document.createElement("a");g.href=L,g.download=`${d}.json`,g.click(),URL.revokeObjectURL(L)}undo(){const d=this.historyService.undo();return!!d&&(this.elementsService.setElements(d),this.selectionService.clearSelection(),this.eventBusService.emit(w.w.Undo,void 0),!0)}redo(){const d=this.historyService.redo();return!!d&&(this.elementsService.setElements(d),this.selectionService.clearSelection(),this.eventBusService.emit(w.w.Redo,void 0),!0)}getCanUndoSignal(){return this.historyService.getCanUndoSignal()}getCanRedoSignal(){return this.historyService.getCanRedoSignal()}clearHistory(){this.historyService.clearHistory()}recordElementCreation(d,y){this.historyService.recordElementCreation(d,y)}recordElementUpdate(d,y){this.historyService.recordElementUpdate(d,y)}recordElementDeletion(d,y){this.historyService.recordElementDeletion(d,y)}recordClear(d,y){this.historyService.recordClear(d,y)}recordChange(d,y,W){this.historyService.recordChange(d,y,W)}getConfig(){return this.configService.getConfig()}updateConfig(d){this.configService.updateConfig(d)}updateConfigValue(d,y){this.configService.updateConfigValue(d,y)}addLayer(d){return this.layerService.addLayer(d)}removeLayer(d){return this.layerService.removeLayer(d)}duplicateLayer(d){const y=this.elementsService.elements(),W=this.layerService.duplicateLayer(d,y);if(W.layer&&W.elementMap.size>0){const L=[...y],g=[];W.elementMap.forEach((S,T)=>{const _=y.find(l=>l.id===T);if(_){const l=W.layer;if(!l)return;const M={..._,id:S,layerId:l.id};g.push(M)}}),this.elementsService.addElements(g);const n=this.elementsService.elements();this.historyService.recordChange(L,n,`Duplicate layer: ${W.layer.name}`)}}setActiveLayer(d){return this.layerService.setActiveLayer(d)}getActiveLayerId(){return this.layerService.getActiveLayerId()}toggleLayerVisibility(d){return this.layerService.toggleLayerVisibility(d)}toggleLayerLock(d){return this.layerService.toggleLayerLock(d)}renameLayer(d,y){return this.layerService.renameLayer(d,y)}setLayerOpacity(d,y){return this.layerService.setLayerOpacity(d,y)}setLayerBlendMode(d,y){return this.layerService.setLayerBlendMode(d,y)}moveLayerUp(d){return this.layerService.moveLayerUp(d)}moveLayerDown(d){return this.layerService.moveLayerDown(d)}reorderLayersByIndex(d,y){return this.layerService.reorderLayersByIndex(d,y)}toggleGrid(){this.canvasService.toggleGrid()}toggleSnapToGrid(){this.canvasService.toggleSnapToGrid()}setGridSize(d){this.canvasService.setGridSize(d)}setActiveTool(d){this.toolsService.setActiveTool(d)}getActiveTool(){return this.toolsService.getActiveToolType()}setToolEnabled(d,y){return this.toolsService.setToolEnabledByType(d,y)}setEnabledTools(d){this.toolsService.setEnabledTools(d)}setCursor(d){this.toolsService.setCursor(d)}resetCursor(){this.toolsService.resetCursor()}screenToCanvas(d,y){return this.canvasService.screenToCanvas(d,y)}canvasToScreen(d,y){return this.canvasService.canvasToScreen(d,y)}getSelectionBoxSignal(){return this.selectionService.getSelectionBoxSignal()}getBoundingBoxSignal(){return this.selectionService.getBoundingBoxSignal()}static{this.\u0275fac=function(y){return new(y||P)}}static{this.\u0275prov=e.jDH({token:P,factory:P.\u0275fac})}}return P})()},525:(Q,Y,x)=>{x.d(Y,{W:()=>O});var I=x(4438),e=x(162),b=x(7785),z=x(9989);let O=(()=>{class s{constructor(c,u,i){this.configService=c,this.eventBusService=u,this.svgContainer=null,this.transform=(0,I.EWP)(()=>{const{zoom:h,x:o,y:E}=this.getConfig();return`translate(${o}, ${E}) scale(${h})`}),this.renderer=i.createRenderer(null,null)}initializeCanvas(c){this.svgContainer=c;const{fullScreen:u,center:i}=this.getConfig();!u&&i&&setTimeout(()=>{this.centerCanvas()},0),this.eventBusService.emit(e.w.Ready)}getCanvas(){if(!this.svgContainer)throw new Error("SVG container not initialized");return this.svgContainer}isCanvasInitialized(){return null!==this.svgContainer}getConfig(){return this.configService.getConfig()}setCanvasDimensions(c,u){this.configService.updateConfig({canvasWidth:c,canvasHeight:u})}setCanvasPosition(c,u){this.configService.updateConfig({x:c,y:u})}getCanvasDimensions(){const c=this.getConfig();return{width:c.canvasWidth,height:c.canvasHeight}}getCanvasPosition(){const c=this.getConfig();return{x:c.x,y:c.y}}getContainerDimensions(){return this.svgContainer?{width:this.svgContainer.clientWidth||0,height:this.svgContainer.clientHeight||0}:{width:0,height:0}}fullScreen(){const{width:c,height:u}=this.getContainerDimensions();this.setCanvasDimensions(c,u),this.configService.updateConfig({fullScreen:!0}),this.centerCanvas()}exitFullScreen(c=800,u=600){this.setCanvasDimensions(c,u),this.configService.updateConfig({fullScreen:!1,zoom:1}),this.centerCanvas()}centerCanvas(){const{fullScreen:c}=this.getConfig();if(c)this.configService.updateConfig({x:0,y:0,canvasX:0,canvasY:0});else{const{canvasWidth:u,canvasHeight:i,zoom:h,center:o}=this.getConfig(),{width:E,height:w}=this.getContainerDimensions();this.configService.updateConfig({x:o?u/2:0,y:o?i/2:0,canvasX:(E-u*h)/2,canvasY:(w-i*h)/2})}}resetCanvas(){this.configService.updateConfig({x:0,y:0,zoom:1,canvasX:0,canvasY:0})}toggleGrid(){const{enableGrid:c}=this.getConfig();this.configService.updateConfig({enableGrid:!c})}setGridVisible(c){this.configService.updateConfig({enableGrid:c})}setGridSize(c){this.configService.updateConfig({gridSize:c})}toggleSnapToGrid(){const{snapToGrid:c}=this.getConfig();this.configService.updateConfig({snapToGrid:!c})}getTransform(){return this.transform}getTransformString(){return this.transform()}screenToCanvas(c,u){const{zoom:i,x:h,y:o}=this.getConfig();return{x:(c-h)/i,y:(u-o)/i}}canvasToScreen(c,u){const{zoom:i,x:h,y:o}=this.getConfig();return{x:c*i+h,y:u*i+o}}getVisibleBounds(){const{zoom:c,x:u,y:i}=this.getConfig(),{width:h,height:o}=this.getContainerDimensions();return{left:-u/c,top:-i/c,right:(-u+h)/c,bottom:(-i+o)/c}}isPointVisible(c,u){const i=this.getVisibleBounds();return c>=i.left&&c<=i.right&&u>=i.top&&u<=i.bottom}isRectVisible(c,u,i,h){const o=this.getVisibleBounds();return!(c+i<o.left||c>o.right||u+h<o.top||u>o.bottom)}getCanvasDimensionsProvider(){return()=>this.getCanvasDimensions()}getContainerDimensionsProvider(){return()=>this.getContainerDimensions()}transformCoordinates(c,u){return{x:c,y:u}}validateZoom(c){return Math.max(.1,Math.min(10,c))}static{this.\u0275fac=function(u){return new(u||s)(I.KVO(b.w),I.KVO(z.W),I.KVO(I._9s))}}static{this.\u0275prov=I.jDH({token:s,factory:s.\u0275fac,providedIn:"root"})}}return s})()},4446:(Q,Y,x)=>{x.d(Y,{b:()=>b});var I=x(4438),e=x(2107);let b=(()=>{class z{constructor(){this.instances=new Map,this._activeId=(0,I.vPA)(null),this.activeId=this._activeId.asReadonly(),this._registryVersion=(0,I.vPA)(0),this.registryVersion=this._registryVersion.asReadonly()}register(s,m){if(!s||0===s.trim().length)throw new Error("Whiteboard instance ID cannot be empty.");if(!(m instanceof e.G))throw new Error("Instance must be an ApiService instance.");this.instances.set(s,m),this._registryVersion.update(c=>c+1)}unregister(s){const m=this.instances.delete(s);return m&&(this._activeId()===s&&this._activeId.set(null),this._registryVersion.update(c=>c+1)),m}getInstance(s){return this.instances.get(s)}hasInstance(s){return this.instances.has(s)}getAllInstanceIds(){return Array.from(this.instances.keys())}getInstanceCount(){return this.instances.size}setActive(s){if(!this.hasInstance(s))throw new Error(`Whiteboard with ID "${s}" not found in registry. Cannot set as active.`);this._activeId.set(s)}clearActive(){this._activeId.set(null)}getActiveInstance(){const s=this._activeId();return s?this.instances.get(s):void 0}clearAll(){this.instances.clear(),this._activeId.set(null),this._registryVersion.update(s=>s+1)}static{this.\u0275fac=function(m){return new(m||z)}}static{this.\u0275prov=I.jDH({token:z,factory:z.\u0275fac,providedIn:"root"})}}return z})()},7785:(Q,Y,x)=>{x.d(Y,{w:()=>s});var I=x(4438),e=x(6078),b=x(3265),z=x(162),O=x(9989);let s=(()=>{class m{constructor(u){this.eventBusService=u,this.config=(0,I.vPA)({drawingEnabled:!0,canvasWidth:800,canvasHeight:600,fullScreen:!0,center:!0,canvasX:0,canvasY:0,strokeColor:"#333333",strokeWidth:2,backgroundColor:"#F8F9FA",lineJoin:e.pP.Round,lineCap:e.$3.Round,fill:"transparent",zoom:1,x:0,y:0,fontFamily:"sans-serif",fontSize:24,dasharray:"",dashoffset:0,enableGrid:!1,gridSize:10,snapToGrid:!0,keyboardShortcutsEnabled:!0,penType:b.mY.Pen}),this.editorConfig=(0,I.vPA)({title:"Whiteboard",enableEditor:!0,showTitle:!0,showZoom:!0,showLayers:!0,showTools:!0,showGrid:!0,showBackground:!0,showStroke:!0,showFill:!0,showOpacity:!0,showFont:!0,showDash:!0,showEraser:!0,showUndo:!0,showRedo:!0,showClear:!0,showSave:!0,showLoad:!1,showExport:!0,showImport:!1,showShare:!1,showSettings:!1,showHelp:!1,showAbout:!1,showFeedback:!1,showSupport:!1,showContact:!1,showPrivacy:!1,showTerms:!1,showLicense:!1,showAttribution:!1,showCredits:!1,showChangelog:!1,showReleaseNotes:!1,showRoadmap:!1,showBlog:!1,showForum:!1,showCommunity:!1,showEvents:!1,showWebinars:!1,showWorkshops:!1,showTutorials:!1,showDocumentation:!1,showAPI:!1,showSDK:!1,showCLI:!1,showPlugins:!1,showExtensions:!1,showIntegrations:!1,showAddons:!1,showThemes:!1,showTemplates:!1,showSnippets:!1,showExamples:!0,showDemos:!0,showSamples:!1,showShowcases:!1,showPortfolios:!1,showCaseStudies:!1,showSuccessStories:!1,showTestimonials:!1,showReviews:!1,showRatings:!1,showComparisons:!1,showAlternatives:!1,showInsights:!1})}getConfig(){return this.config()}getConfigSignal(){return this.config.asReadonly()}getEditorConfig(){return this.editorConfig()}getEditorConfigSignal(){return this.editorConfig.asReadonly()}updateConfig(u,i=!0){if(this.config.update(o=>({...o,...u})),"zoom"in u){const o=this.config();this.eventBusService.emit(z.w.ZoomChange,{zoom:o.zoom})}i&&this.eventBusService.emit(z.w.ConfigChange,this.config())}isConfigDifferent(u,i){return this.config()[u]!==i}updateConfigValue(u,i){this.config.update(h=>({...h,[u]:i})),this.eventBusService.emit(z.w.ConfigChange,this.config())}updateEditorConfigValue(u,i){this.editorConfig.update(h=>({...h,[u]:i}))}checkAndUpdateConfig(u,i){this.isConfigDifferent(u,i)&&this.updateConfigValue(u,i)}getConfigValue(u){return this.config()[u]}setConfigValue(u,i){this.config.update(h=>({...h,[u]:i})),this.eventBusService.emit(z.w.ConfigChange,this.config())}getConfigKeys(){return Object.keys(this.config())}getConfigValues(){return Object.values(this.config())}static{this.\u0275fac=function(i){return new(i||m)(I.KVO(O.W))}}static{this.\u0275prov=I.jDH({token:m,factory:m.\u0275fac,providedIn:"root"})}}return m})()},7879:(Q,Y,x)=>{x.d(Y,{AD:()=>L,Be:()=>m,Bn:()=>u,DQ:()=>o,Dr:()=>p,Mt:()=>I,RZ:()=>b,Sb:()=>s,Vu:()=>W,Wd:()=>P,YO:()=>O,_:()=>d,aM:()=>w,aR:()=>y,aW:()=>a,bL:()=>h,c1:()=>R,fh:()=>D,i$:()=>z,nD:()=>E,wM:()=>e});const I="selectorGroup",e="svgroot",b="item_",z="selectorBox",O="selectorGrip_",s="selectorGrip_resize",m="selectorGrip_rotate",u="data-wb-id",h=.25,o=.1,E=5,w=1,a=.5,D={LEFT:0,MIDDLE:1,RIGHT:2},p={PAN_MIDDLE:"pan-middle",PAN_SPACE:"pan-space"},P={HTML:"text/html",PLAIN:"text/plain",JSON:"application/json"},R={COPY:"copy"},d={ESCAPE:"Escape",ENTER:"Enter",SPACE:"Space",DELETE:"Delete",BACKSPACE:"Backspace",ARROW_UP:"ArrowUp",ARROW_DOWN:"ArrowDown",ARROW_LEFT:"ArrowLeft",ARROW_RIGHT:"ArrowRight",TAB:"Tab"},y={ESCAPE:"escape",ENTER:"enter",SPACE:"space",DELETE:"delete",BACKSPACE:"backspace",ARROW_UP:"arrowup",ARROW_DOWN:"arrowdown",ARROW_LEFT:"arrowleft",ARROW_RIGHT:"arrowright",TAB:"tab"},W={IMAGE:"image/"},L={SMALL_STEP:1,LARGE_STEP:10}},2173:(Q,Y,x)=>{x.d(Y,{n:()=>L,lE:()=>d});var I=x(2262),e=x(6078);const b={strokeWidth:2,strokeColor:"#000000",fill:"#000000",lineJoin:e.pP.Round,lineCap:e.$3.Round,dasharray:"",dashoffset:0},z={...b,fontSize:14,fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal",color:"#000000"};function O(){return Math.random().toString(36).substring(2).padEnd(12,"0").substring(0,12)}var s=x(6042);function m(g,n,S,T){const _=[[{x:g.minX,y:g.minY},{x:g.maxX,y:g.minY}],[{x:g.maxX,y:g.minY},{x:g.maxX,y:g.maxY}],[{x:g.maxX,y:g.maxY},{x:g.minX,y:g.maxY}],[{x:g.minX,y:g.maxY},{x:g.minX,y:g.minY}]];for(const[l,M]of _)if((0,s.Em)(n,S,l,M,T))return!0;return!1}function u(g,n,S,T,_,l,M){const C={x:g,y:n},A={x:S,y:T};return(0,s.d4)(_.x,_.y,C,A)<=M||(0,s.d4)(l.x,l.y,C,A)<=M}var a=x(2319);const R={[I.R.Arrow]:new class h{create(n){return{type:I.R.Arrow,id:O(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...n,style:{...b,...n.style}}}resize(n,S,T,_){return S.includes(e.OP.N)&&(n.y2+=_),S.includes(e.OP.S)&&(n.y1+=_),S.includes(e.OP.W)&&(n.x1+=T),S.includes(e.OP.E)&&(n.x2+=T),n}getBounds(n){const S=n.x1+n.x,T=n.y1+n.y,_=n.x2+n.x,l=n.y2+n.y;return{minX:Math.min(S,_),minY:Math.min(T,l),maxX:Math.max(S,_),maxY:Math.max(T,l),width:Math.abs(_-S),height:Math.abs(l-T)}}hitTest(n,S,T,_){const{x1:l,y1:M,x2:C,y2:A}=n;return u(l,M,C,A,S,T,_)}},[I.R.Ellipse]:new class o{create(n){return{type:I.R.Ellipse,id:O(),x:0,y:0,cx:0,cy:0,rx:1,ry:1,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...n,style:{...b,...n.style}}}resize(n,S,T,_){if(S.includes(e.OP.N)){const l=n.ry-_/2;l>0&&(n.ry=l,n.cy+=_/2)}if(S.includes(e.OP.S)){const l=n.ry+_/2;l>0&&(n.ry=l,n.cy+=_/2)}if(S.includes(e.OP.W)){const l=n.rx-T/2;l>0&&(n.rx=l,n.cx+=T/2)}if(S.includes(e.OP.E)){const l=n.rx+T/2;l>0&&(n.rx=l,n.cx+=T/2)}return n}getBounds(n){const S=n.cx+n.x,T=n.cy+n.y;return{minX:S-n.rx,minY:T-n.ry,maxX:S+n.rx,maxY:T+n.ry,width:2*n.rx,height:2*n.ry}}hitTest(n,S,T,_){const{cx:l,cy:M,rx:C,ry:A}=n;return function c(g,n,S,T,_,l,M){return(0,s.d4)(g,n,_,l)<=Math.max(S,T)+M}(l,M,C,A,S,T,_)}},[I.R.Image]:new class E{create(n){return{type:I.R.Image,id:O(),x:0,y:0,width:1,height:1,src:"",rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...n,style:{...b,...n.style}}}resize(n,S,T,_){if(S.includes(e.OP.N)){const l=n.height-_;l>0&&(n.y+=_,n.height=l)}if(S.includes(e.OP.S)){const l=n.height+_;l>0&&(n.height=l)}if(S.includes(e.OP.W)){const l=n.width-T;l>0&&(n.x+=T,n.width=l)}if(S.includes(e.OP.E)){const l=n.width+T;l>0&&(n.width=l)}return n}getBounds(n){return{minX:n.x,minY:n.y,maxX:n.x+n.width,maxY:n.y+n.height,width:n.width,height:n.height}}hitTest(n,S,T,_){return m(this.getBounds(n),S,T,_)}},[I.R.Line]:new class w{create(n){return{type:I.R.Line,id:O(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...n,style:{...b,...n.style}}}resize(n,S,T,_){return S.includes(e.OP.N)&&(n.y1+=_),S.includes(e.OP.S)&&(n.y2+=_),S.includes(e.OP.W)&&(n.x1+=T),S.includes(e.OP.E)&&(n.x2+=T),n}getBounds(n){const S=n.x1+n.x,T=n.y1+n.y,_=n.x2+n.x,l=n.y2+n.y;return{minX:Math.min(S,_),minY:Math.min(T,l),maxX:Math.max(S,_),maxY:Math.max(T,l),width:Math.abs(_-S),height:Math.abs(l-T)}}hitTest(n,S,T,_){const{x1:l,y1:M,x2:C,y2:A}=n;return u(l,M,C,A,S,T,_)}},[I.R.Pen]:new class D{create(n){return{type:I.R.Pen,id:O(),x:0,y:0,points:[],rotation:0,opacity:100,zIndex:1,selectAfterDraw:!1,...n,style:{...b,...n.style}}}resize(n,S,T,_){const l=(0,a.AJ)(n.points),{points:M,position:C}=this.getScaleFactors(S,l,T,_),A=l.minX+l.width/2,N=l.minY+l.height/2,[H,Z]=M;return l.width*H<10||l.height*Z<10||(n.x+=C.x,n.y+=C.y,n.points=n.points.map(U=>[A+(U[0]-A)*H,N+(U[1]-N)*Z])),n}getScaleFactors(n,S,T,_){const l=[1,1],M={x:0,y:0};return n.includes("w")&&(l[0]=(S.width-T)/S.width,M.x+=T/2),n.includes("n")&&(l[1]=(S.height-_)/S.height,M.y+=_/2),n.includes("e")&&(l[0]=(S.width+T)/S.width,M.x+=T/2),n.includes("s")&&(l[1]=(S.height+_)/S.height,M.y+=_/2),{points:l,position:M}}getBounds(n){const{minX:S,minY:T,maxX:_,maxY:l,width:M,height:C}=(0,a.AJ)(n.points);return{minX:S+n.x,minY:T+n.y,maxX:_+n.x,maxY:l+n.y,width:M,height:C}}hitTest(n,S,T,_){return function i(g,n,S,T){for(let _=0;_<g.length-1;_++){const l={x:g[_][0],y:g[_][1]},M={x:g[_+1][0],y:g[_+1][1]};if((0,s.d4)(n.x,n.y,l,M)<=T||(0,s.d4)(S.x,S.y,l,M)<=T)return!0}return!1}(n.points,S,T,_)}},[I.R.Rectangle]:new class p{create(n){return{type:I.R.Rectangle,id:O(),x:0,y:0,width:1,height:1,rx:5,rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,...n,style:{...b,...n.style}}}resize(n,S,T,_){if(S.includes(e.OP.N)){const l=n.height-_;l>0&&(n.y+=_,n.height=l)}if(S.includes(e.OP.S)){const l=n.height+_;l>0&&(n.height=l)}if(S.includes(e.OP.W)){const l=n.width-T;l>0&&(n.x+=T,n.width=l)}if(S.includes(e.OP.E)){const l=n.width+T;l>0&&(n.width=l)}return n}getBounds(n){return{minX:n.x,minY:n.y,maxX:n.x+n.width,maxY:n.y+n.height,width:n.width,height:n.height}}hitTest(n,S,T,_){return m(this.getBounds(n),S,T,_)}},[I.R.Text]:new class P{create(n){return{type:I.R.Text,id:O(),x:0,y:0,text:"",rotation:0,opacity:100,zIndex:1,selectAfterDraw:!0,scaleX:1,scaleY:1,...n,style:{...z,...n.style}}}resize(n,S,T,_){const C=.016*T,A=.016*_;switch(S){case e.OP.NW:n.x+=T,n.y+=_,n.scaleX=Math.max(.1,n.scaleX-C),n.scaleY=Math.max(.1,n.scaleY-A);break;case e.OP.N:n.y+=_,n.scaleY=Math.max(.1,n.scaleY-A);break;case e.OP.NE:n.y+=_,n.scaleX=Math.max(.1,n.scaleX+C),n.scaleY=Math.max(.1,n.scaleY-A);break;case e.OP.E:n.scaleX=Math.max(.1,n.scaleX+C);break;case e.OP.SE:n.scaleX=Math.max(.1,n.scaleX+C),n.scaleY=Math.max(.1,n.scaleY+A);break;case e.OP.S:n.scaleY=Math.max(.1,n.scaleY+A);break;case e.OP.SW:n.x+=T,n.scaleX=Math.max(.1,n.scaleX-C),n.scaleY=Math.max(.1,n.scaleY+A);break;case e.OP.W:n.x+=T,n.scaleX=Math.max(.1,n.scaleX-C)}return n}getBounds(n){const{text:S,x:T,y:_,scaleX:l,scaleY:M,style:C}=n,A=C.fontSize??z.fontSize??16,N=1.2*A,H=.6*A,Z=S.split("\n"),j=H*Z.reduce((le,V)=>Math.max(le,V.length),0)*l||A*l,$=N*Z.length*M||A*M,q=.8*A*M;return{minX:T,minY:_-q,maxX:T+j,maxY:_-q+$,width:j,height:$}}hitTest(n,S,T,_){return m(this.getBounds(n),S,T,_)}}};function d(g){return R[g]}let y=null;function L(g,n,S){const _={...n,layerId:S||(y?y():"")};return R[g].create(_)}},6255:(Q,Y,x)=>{x.d(Y,{L:()=>m});var I=x(875),e=x(4438),b=x(162),z=x(9820),O=x(3437),s=x(9989);let m=(()=>{class c{constructor(i){this.eventBus=i,this.historyService=(0,e.WQX)(I.k),this.layerManagement=(0,e.WQX)(O.a),this._elements=(0,e.vPA)([]),this._draftElements=(0,e.vPA)([]),this._maxZIndex=(0,e.vPA)(0),this._locks=(0,e.vPA)(new Map),this.elements=this._elements.asReadonly(),this.draftElements=this._draftElements.asReadonly(),this.allElements=(0,e.EWP)(()=>[...this._elements(),...this._draftElements()]),this.elementsCount=(0,e.EWP)(()=>this._elements().length),this.hasElements=(0,e.EWP)(()=>this.elementsCount()>0),this.elementTypes=(0,e.EWP)(()=>{const h=this._elements().map(o=>o.type);return[...new Set(h)]}),this.elementsByType=(0,e.EWP)(()=>{const h=this._elements(),o=new Map;return h.forEach(E=>{const w=E.type;o.has(w)||o.set(w,[]);const a=o.get(w);a&&a.push(E)}),o}),this.maxZIndex=(0,e.EWP)(()=>this._maxZIndex()),this.elementsByZIndex=(0,e.EWP)(()=>[...this._elements()].sort((h,o)=>(h.zIndex||0)-(o.zIndex||0))),this.lockedElements=(0,e.EWP)(()=>this._elements().filter(h=>!0===h.locked)),this.unlockedElements=(0,e.EWP)(()=>this._elements().filter(h=>!0!==h.locked)),this.lockedElementsCount=(0,e.EWP)(()=>this.lockedElements().length),this.hasLockedElements=(0,e.EWP)(()=>this.lockedElementsCount()>0),this.lockStats=(0,e.EWP)(()=>{const h=this.elementsCount(),o=this.lockedElementsCount();return{total:h,locked:o,unlocked:h-o,lockPercentage:h>0?Math.round(o/h*100):0,allLocked:h>0&&o===h,noneLocked:0===o}}),this.locks=this._locks.asReadonly()}getElements(){return[...this._elements()]}getDraftElements(){return[...this._draftElements()]}getAllElements(){return this.allElements()}addElements(i){if(!i?.length)return;const h=this.layerManagement.getActiveLayerId(),o=i.map(a=>({...a,zIndex:a.zIndex??this.getNextZIndex(),layerId:a.layerId??h}));this.updateMaxZIndex(o);const E=this._elements(),w=[...E,...o];this._elements.set(w),o.forEach(a=>{a.layerId&&this.layerManagement.assignElementToLayer(a.id,a.layerId)}),this.historyService.recordElementCreation(E,w),this.eventBus.emit(b.w.ElementsAdded,o),this.eventBus.emit(b.w.DataChange,w)}updateElements(i,h=!1){if(!i?.length)return;const o=this._elements(),E=new Map(i.map(D=>[D.id,D])),w=[],a=o.map(D=>{const p=E.get(D.id);if(!p)return D;if(!h&&D.locked&&!this.isLockOperation(p))return console.warn(`Attempted to modify locked element: ${D.id}`),D;if(!h&&D.layerId){const R=this.layerManagement.getElementLayer(D.id);if(R?.locked)return console.warn(`Attempted to modify element on locked layer: ${R.name}`),D}const P={...D,...p};return null!=P.zIndex&&this._maxZIndex.update(R=>Math.max(R,P.zIndex)),w.push(P),P});this._elements.set(a),w.length>0&&this.historyService.recordElementUpdate(o,a),w.length>0&&(this.eventBus.emit(b.w.ElementsUpdated,w),this.eventBus.emit(b.w.DataChange,a))}removeElementsByIds(i,h=!1){if(!i?.length)return;const o=new Set(i),E=this._elements(),w=E.filter(p=>{if(!o.has(p.id))return!1;if(!h&&p.locked)return console.warn(`Attempted to remove locked element: ${p.id}`),!1;if(!h&&p.layerId){const P=this.layerManagement.getElementLayer(p.id);if(P?.locked)return console.warn(`Attempted to remove element from locked layer: ${P.name}`),!1}return!0});if(0===w.length)return;const a=new Set(w.map(p=>p.id)),D=E.filter(p=>!a.has(p.id));this._elements.set(D),w.forEach(p=>{this.layerManagement.removeElementFromAllLayers(p.id)}),this.historyService.recordElementDeletion(E,D),this.eventBus.emit(b.w.ElementsRemoved,w),this.eventBus.emit(b.w.DataChange,D)}removeElements(i,h=!1){const o=i.map(E=>E.id);this.removeElementsByIds(o,h)}clear(){const i=this._elements();this._elements.set([]),this._maxZIndex.set(0),i.forEach(h=>{this.layerManagement.removeElementFromAllLayers(h.id)}),this.historyService.recordClear(i,[]),this.eventBus.emit(b.w.DataChange,[])}setElements(i){const h=i.map(o=>({...o,zIndex:o.zIndex??this.getNextZIndex()}));this.updateMaxZIndex(h),this._elements.set([...h]),this.eventBus.emit(b.w.DataChange,h)}addDraftElements(i){if(!i?.length)return;const h=this.layerManagement.activeLayer();if(h?.locked)return void console.warn(`Cannot draw on locked layer: ${h.name}`);const o=i.map(a=>({...a,zIndex:a.zIndex??this.getNextZIndex()}));this.updateMaxZIndex(o);const w=[...this._draftElements(),...o];this._draftElements.set(w)}updateDraftElements(i){if(!i?.length)return;const h=this._draftElements(),o=new Map(i.map(a=>[a.id,a])),E=[],w=h.map(a=>{const D=o.get(a.id);if(D){const p={...a,...D};return E.push(p),p}return a});this._draftElements.set(w)}removeDraftElements(i){if(!i?.length)return;const h=new Set(i),E=this._draftElements().filter(w=>!h.has(w.id));this._draftElements.set(E)}clearDraftElements(){this._draftElements.set([])}commitDraftElements(i){const h=this._draftElements(),o=i?h.filter(a=>i.includes(a.id)):h;if(0===o.length)return[];const E=this.layerManagement.activeLayer();if(E?.locked)return console.warn(`Cannot commit elements to locked layer: ${E.name}`),this._draftElements.set([]),[];this.addElements(o);const w=i?h.filter(a=>!i.includes(a.id)):[];return this._draftElements.set(w),o}getNextZIndex(){return this._maxZIndex.update(i=>i+1),this._maxZIndex()}bringToFront(i,h=!1){if(!i?.length)return;const o=this.getNextZIndex(),E=i.map(w=>({id:w,zIndex:o}));this.updateElements(E,h)}sendToBack(i,h=!1){if(!i?.length)return;const o=i.map(E=>({id:E,zIndex:0}));this.updateElements(o,h)}lockElements(i){if(!i?.length)return;const h={timestamp:Date.now(),reason:"User locked"},o=this._locks(),E=new Map(o),w=i.map(a=>(E.set(a,h),{id:a,locked:!0}));this._locks.set(E),this.updateElements(w,!0)}unlockElements(i){if(!i?.length)return;const h=this._locks(),o=new Map(h),E=i.map(w=>(o.delete(w),{id:w,locked:!1}));this._locks.set(o),this.updateElements(E,!0)}toggleElementsLock(i){if(!i?.length)return;const h=[],o=[];i.forEach(E=>{const w=this.getElementById(E);w&&(w.locked?o.push(E):h.push(E))}),h.length>0&&this.lockElements(h),o.length>0&&this.unlockElements(o)}lockAllElements(){const i=this._elements().map(h=>h.id);this.lockElements(i)}unlockAllElements(){const i=this._elements().map(h=>h.id);this.unlockElements(i)}isElementLocked(i){return!!this.getElementById(i)?.locked}getLockedElementIds(){return this.lockedElements().map(i=>i.id)}getUnlockedElementIds(){return this.unlockedElements().map(i=>i.id)}moveToLayer(i,h,o=!1){if(!i?.length)return;const E=i.map(w=>({id:w,layerId:h}));this.updateElements(E,o)}getElementsByLayer(i){return this._elements().filter(h=>h.layerId===i)}getElementById(i){return this._elements().find(o=>o.id===i)||this._draftElements().find(o=>o.id===i)}getElementsByIds(i){const h=new Set(i);return this.allElements().filter(E=>h.has(E.id))}getElementsByType(i){return this._elements().filter(h=>h.type===i)}searchElements(i){let h=this._elements();if(i.type&&(h=h.filter(o=>o.type===i.type)),i.layerId&&(h=h.filter(o=>o.layerId===i.layerId)),void 0!==i.locked&&(h=h.filter(o=>!!o.locked===i.locked)),i.textContent){const o=i.textContent.toLowerCase();h=h.filter(E=>(E.text||E.content||"").toLowerCase().includes(o))}if(i.zIndexRange){const{min:o,max:E}=i.zIndexRange;h=h.filter(w=>{const a=w.zIndex||0;return a>=o&&a<=E})}return i.bounds&&(h=this.findElementsInBounds(i.bounds).filter(o=>h.some(E=>E.id===o.id))),h}findElementsByText(i){return this.searchElements({textContent:i})}getElementsInRadius(i,h,o){return this._elements().filter(E=>{const w=E.x-i,a=E.y-h;return Math.sqrt(w*w+a*a)<=o})}getNearestElement(i,h){const o=this._elements();if(0===o.length)return;let E=o[0],w=this.getDistanceToElement(i,h,E);for(let a=1;a<o.length;a++){const D=this.getDistanceToElement(i,h,o[a]);D<w&&(w=D,E=o[a])}return E}createSnapshot(){return{elements:[...this._elements()],draftElements:[...this._draftElements()],maxZIndex:this._maxZIndex(),timestamp:Date.now()}}restoreSnapshot(i){this._elements.set([...i.elements]),this._draftElements.set([...i.draftElements]),this._maxZIndex.set(i.maxZIndex)}findElementsInBounds(i){return this._elements().filter(h=>h.x<i.x+i.width&&h.x+(h.width||50)>i.x&&h.y<i.y+i.height&&h.y+(h.height||50)>i.y)}calculateElementsBounds(i){if(0===i.length)return null;const h=i.map(z.P),o=Math.min(...h.map(P=>P.minX)),E=Math.min(...h.map(P=>P.minY)),D=Math.max(...h.map(P=>P.maxX))-o,p=Math.max(...h.map(P=>P.maxY))-E;return{x:o,y:E,width:D,height:p,centerX:o+D/2,centerY:E+p/2}}getElementsCount(){return this.elementsCount()}getElementTypes(){return this.elementTypes()}normalizeZIndices(){const i=[...this._elements()].sort((o,E)=>(o.zIndex||0)-(E.zIndex||0)),h=i.map((o,E)=>({id:o.id,zIndex:E+1}));this._maxZIndex.set(i.length),this.updateElements(h,!0)}addElement(i){this.addElements([i])}updateElement(i,h=!1){this.updateElements([i],h)}removeElement(i,h=!1){this.removeElementsByIds([i.id],h)}elementExists(i){return void 0!==this.getElementById(i)}getElementsByZIndexRange(i,h){return this._elements().filter(o=>{const E=o.zIndex||0;return E>=i&&E<=h})}getElementsByProperty(i,h){return this._elements().filter(o=>o[i]===h)}lockElement(i){this.lockElements([i])}unlockElement(i){this.unlockElements([i])}toggleElementLock(i){this.toggleElementsLock([i])}getModifiableElements(){return this.unlockedElements()}hasLockedElementsInSelection(i){return i.some(h=>this.isElementLocked(h))}filterUnlockedElements(i){return i.filter(h=>!this.isElementLocked(h))}getModifiableElementsFromIds(i){const h=this.filterUnlockedElements(i);return this.getElementsByIds(h)}safeUpdateElements(i){const h=[],o=[],E=i.filter(w=>this.isElementLocked(w.id)?(h.push(w.id),!1):(o.push(w.id),!0));return E.length>0&&this.updateElements(E,!1),{updated:o,locked:h}}isLockOperation(i){return"locked"in i}updateMaxZIndex(i){const h=Math.max(...i.map(o=>o.zIndex||0));this._maxZIndex.update(o=>Math.max(o,h))}getDistanceToElement(i,h,o){const p=i-(o.x+(o.width||50)/2),P=h-(o.y+(o.height||50)/2);return Math.sqrt(p*p+P*P)}static{this.\u0275fac=function(h){return new(h||c)(e.KVO(s.W))}}static{this.\u0275prov=e.jDH({token:c,factory:c.\u0275fac,providedIn:"root"})}}return c})()},3437:(Q,Y,x)=>{x.d(Y,{a:()=>b});var I=x(4438),e=x(4289);let b=(()=>{class z{constructor(){this._layers=(0,I.vPA)([]),this._activeLayerId=(0,I.vPA)(""),this.layers=this._layers.asReadonly(),this.activeLayerId=this._activeLayerId.asReadonly(),this.activeLayer=(0,I.EWP)(()=>{const s=this._layers(),m=this._activeLayerId();return s.find(c=>c.id===m)||s[0]}),this.sortedLayers=(0,I.EWP)(()=>[...this._layers()].sort((s,m)=>s.zIndex-m.zIndex)),this.visibleLayers=(0,I.EWP)(()=>this._layers().filter(s=>s.visible)),this.unlockedLayers=(0,I.EWP)(()=>this._layers().filter(s=>!s.locked)),this.initializeDefaultLayer()}addLayer(s){const m=this._layers(),c=Math.max(...m.map(o=>o.zIndex),0)+1,u=m.length+1,i={id:this.generateLayerId(),name:s||`Layer ${u}`,visible:!0,locked:!1,zIndex:c,elements:[],opacity:1,blendMode:"normal"},h=m.map(o=>({...o,visible:!1}));return this._layers.set([...h,i]),this.setActiveLayer(i.id),i}removeLayer(s){const m=this._layers();if(m.length<=1)return console.warn("Cannot delete the last remaining layer"),!1;if(!m.find(i=>i.id===s))return console.warn(`Layer with id ${s} not found`),!1;const u=m.filter(i=>i.id!==s);if(this._layers.set(u),this._activeLayerId()===s){const i=u[Math.max(0,u.length-1)];this.setActiveLayer(i.id)}return!0}duplicateLayer(s,m){const c=this._layers(),u=c.find(w=>w.id===s);if(!u)return console.warn(`Layer with id ${s} not found`),{layer:null,elementMap:new Map};const i=Math.max(...c.map(w=>w.zIndex),0)+1,h={id:this.generateLayerId(),name:`${u.name} Copy`,visible:!0,locked:u.locked,zIndex:i,elements:[],opacity:u.opacity,blendMode:u.blendMode},o=new Map;return m.filter(w=>u.elements.includes(w.id)).forEach(w=>{const a=crypto.randomUUID();o.set(w.id,a),h.elements.push(a)}),this._layers.set([...c,h]),this.setActiveLayer(h.id),{layer:h,elementMap:o}}renameLayer(s,m){const c=this._layers(),u=c.findIndex(h=>h.id===s);if(-1===u)return console.warn(`Layer with id ${s} not found`),!1;if(c[u].locked)return console.warn(`Cannot rename locked layer: ${c[u].name}`),!1;const i=[...c];return i[u]={...i[u],name:m.trim()||`Layer ${u+1}`},this._layers.set(i),!0}reorderLayer(s,m){const c=this._layers(),u=c.findIndex(h=>h.id===s);if(-1===u)return console.warn(`Layer with id ${s} not found`),!1;if(c[u].locked)return console.warn(`Cannot reorder locked layer: ${c[u].name}`),!1;const i=[...c];return i[u]={...i[u],zIndex:m},this._layers.set(i),!0}moveLayerUp(s){const m=this.sortedLayers(),c=m.findIndex(h=>h.id===s);if(-1===c||c===m.length-1)return!1;const u=m[c];if(u.locked)return console.warn(`Cannot move locked layer: ${u.name}`),!1;const i=m[c+1];return this.reorderLayer(u.id,i.zIndex)&&this.reorderLayer(i.id,u.zIndex)}moveLayerDown(s){const m=this.sortedLayers(),c=m.findIndex(h=>h.id===s);if(-1===c||0===c)return!1;const u=m[c];if(u.locked)return console.warn(`Cannot move locked layer: ${u.name}`),!1;const i=m[c-1];return this.reorderLayer(u.id,i.zIndex)&&this.reorderLayer(i.id,u.zIndex)}reorderLayersByIndex(s,m){const c=this._layers();if(s===m)return!1;if(s<0||s>=c.length||m<0||m>=c.length)return console.warn("Invalid layer indices for reordering"),!1;const u=c[s];if(u.locked)return console.warn(`Cannot reorder locked layer: ${u.name}`),!1;const i=[...c];i.splice(s,1),i.splice(m,0,u);const h=i.map((o,E)=>({...o,zIndex:i.length-1-E}));return this._layers.set(h),!0}toggleLayerVisibility(s){return this.updateLayerProperty(s,"visible",m=>!m)}toggleLayerLock(s){return this._layers().find(u=>u.id===s)?this.updateLayerProperty(s,"locked",u=>!u):(console.warn(`Layer with id ${s} not found`),!1)}setLayerOpacity(s,m){const u=this._layers().find(h=>h.id===s);if(!u)return console.warn(`Layer with id ${s} not found`),!1;if(u.locked)return console.warn(`Cannot change opacity of locked layer: ${u.name}`),!1;const i=Math.max(0,Math.min(1,m));return this.updateLayerProperty(s,"opacity",()=>i)}setLayerBlendMode(s,m){const u=this._layers().find(h=>h.id===s);return u?u.locked?(console.warn(`Cannot change blend mode of locked layer: ${u.name}`),!1):e.B.map(h=>h.value).includes(m)?this.updateLayerProperty(s,"blendMode",()=>m):(console.warn(`Invalid blend mode: ${m}. Using 'normal' instead.`),this.updateLayerProperty(s,"blendMode",()=>"normal")):(console.warn(`Layer with id ${s} not found`),!1)}setActiveLayer(s){const m=this._layers();if(!m.find(i=>i.id===s))return console.warn(`Layer with id ${s} not found`),!1;const u=m.map(i=>({...i,visible:i.id===s}));return this._layers.set(u),this._activeLayerId.set(s),!0}getActiveLayerId(){return this._activeLayerId()}isActiveLayerValid(){const s=this.activeLayer();return!!s&&s.visible&&!s.locked}getActiveLayerIssues(){const s=this.activeLayer();if(!s)return["No active layer"];const m=[];return s.visible||m.push("Active layer is hidden"),s.locked&&m.push("Active layer is locked"),m}assignElementToActiveLayer(s){const m=this._activeLayerId();return this.assignElementToLayer(s,m)}assignElementToLayer(s,m){const c=this._layers(),u=c.findIndex(w=>w.id===m);if(-1===u)return console.warn(`Layer with id ${m} not found`),!1;if(c[u].locked)return console.warn(`Cannot assign elements to locked layer: ${c[u].name}`),!1;this.removeElementFromAllLayers(s);const i=this._layers(),h=i.findIndex(w=>w.id===m),o=[...i],E=[...o[h].elements];return E.includes(s)||(E.push(s),o[h]={...o[h],elements:E},this._layers.set(o)),!0}removeElementFromAllLayers(s){const c=this._layers().map(u=>({...u,elements:u.elements.filter(i=>i!==s)}));this._layers.set(c)}getElementLayer(s){return this._layers().find(c=>c.elements.includes(s))||null}getVisibleElements(s){const m=this.visibleLayers(),c=new Set(m.flatMap(u=>u.elements));return s.filter(u=>c.has(u.id))}getEditableElements(s){const m=this.unlockedLayers(),c=new Set(m.flatMap(u=>u.elements));return s.filter(u=>c.has(u.id))}getSortedElements(s){const m=this.sortedLayers(),c=new Map;return m.forEach(u=>{u.elements.forEach(i=>{c.set(i,u.zIndex)})}),s.sort((u,i)=>(c.get(u.id)??0)-(c.get(i.id)??0))}exportLayerState(){return{layers:this._layers(),activeLayerId:this._activeLayerId()}}importLayerState(s){if(!s.layers||0===s.layers.length)return console.warn("Invalid layer state provided"),void this.initializeDefaultLayer();this._layers.set(s.layers);const m=s.layers.find(c=>c.id===s.activeLayerId);this._activeLayerId.set(m?s.activeLayerId:s.layers[0].id)}reset(){this.initializeDefaultLayer()}initializeDefaultLayer(){const s={id:"default",name:"Layer 1",visible:!0,locked:!1,zIndex:0,elements:[],opacity:1,blendMode:"normal"};this._layers.set([s]),this._activeLayerId.set(s.id)}generateLayerId(){return`layer-${Date.now()}-${Math.random().toString(36).substr(2,9)}`}updateLayerProperty(s,m,c){const u=this._layers(),i=u.findIndex(E=>E.id===s);if(-1===i)return console.warn(`Layer with id ${s} not found`),!1;const h=[...u];return h[i]={...h[i],[m]:c(h[i][m])},this._layers.set(h),!0}static{this.\u0275fac=function(m){return new(m||z)}}static{this.\u0275prov=I.jDH({token:z,factory:z.\u0275fac,providedIn:"root"})}}return z})()},1152:(Q,Y,x)=>{x.d(Y,{A:()=>o});var I=x(4438),e=x(872),b=x(6078),z=x(162),O=x(9820),s=x(2500),m=x(9989),c=x(3909),u=x(6255),i=x(3312),h=x(525);let o=(()=>{class E{constructor(a,D,p,P,R){this.eventBus=a,this.clipboardService=D,this.elementsService=p,this.toolsService=P,this.canvasService=R,this.OFFSET_INCREMENT=20,this.selectedElementIdsSignal=(0,I.vPA)(new Set),this.selectionBoxSignal=(0,I.vPA)({x:0,y:0,width:0,height:0,visible:!1}),this.boundingBoxSignal=(0,I.vPA)(null),this.selectedIdsSignal=(0,I.EWP)(()=>Array.from(this.selectedElementIdsSignal())),this.hasSelectionSignal=(0,I.EWP)(()=>this.selectedElementIdsSignal().size>0),this.initializeDataProviders()}initializeDataProviders(){this.getElementsFn=()=>this.elementsService.getElements(),this.updateElementsFn=a=>this.elementsService.updateElements(a),this.removeElementsFn=(a,D)=>this.elementsService.removeElements(a,D)}cutElements(){const a=this.getSelectedElements();0!==a.length&&(this.clipboardService.cut(a),this.deleteSelectedElements())}copyElements(){const a=this.getSelectedElements();0!==a.length&&this.clipboardService.copy(a)}pasteElements(){const a=this.clipboardService.paste();a.length>0&&this.selectElements(a)}duplicateElements(){const a=this.getSelectedElements();if(0===a.length)return;const D=this.clipboardService.duplicateElements(a);D.length>0&&this.selectElements(D)}deleteSelectedElements(){const a=this.getSelectedElements();0===a.length||!this.removeElementsFn||(this.removeElementsFn(a,!0),this.clearSelection())}getSelectedIds(){return this.selectedIdsSignal()}getSelectedElements(){if(!this.getElementsFn)return console.warn("Element data provider not set"),[];const a=this.getSelectedIds();return this.getElementsFn().filter(D=>a.includes(D.id))}getSelectedElementsSignal(){return(0,I.EWP)(()=>this.getSelectedElements())}isSelected(a){const D="string"==typeof a?a:a.id;return this.selectedElementIdsSignal().has(D)}getSelectionCount(){return this.selectedElementIdsSignal().size}hasSelection(){return this.getSelectionCount()>0}selectElements(a,D=!1){const P=(Array.isArray(a)?a:[a]).map(L=>"string"==typeof L?L:L.id),R=this.expandSelectionToIncludeGroups(P),d=Array.from(this.selectedElementIdsSignal()),y=D?[...new Set([...d,...R])]:R;this.selectedElementIdsSignal.set(new Set(y)),y.length>0&&this.toolsService.setActiveTool(e.p.Select);const W=this.getSelectedElements();this.updateBoundingBoxFromElements(W),this.eventBus.emit(z.w.ElementsSelected,W)}deselectElement(a){const D="string"==typeof a?a:a.id,p=new Set(this.selectedElementIdsSignal());if(p.has(D)){this.expandSelectionToIncludeGroups([D]).forEach(d=>{p.delete(d)}),this.selectedElementIdsSignal.set(p),this.updateBoundingBox();const R=this.getSelectedElements();this.eventBus.emit(z.w.ElementsSelected,R)}}toggleSelection(a){const D="string"==typeof a?a:a.id,p=new Set(this.selectedElementIdsSignal()),P=p.has(D),R=this.expandSelectionToIncludeGroups([D]);P?R.forEach(y=>{p.delete(y)}):(R.forEach(y=>{p.add(y)}),this.toolsService.setActiveTool(e.p.Select)),this.selectedElementIdsSignal.set(p),this.updateBoundingBox();const d=this.getSelectedElements();this.eventBus.emit(z.w.ElementsSelected,d)}clearSelection(){this.selectedElementIdsSignal.set(new Set),this.clearBoundingBox(),this.eventBus.emit(z.w.ElementsSelected,[])}selectAll(){if(!this.getElementsFn)return void console.warn("Element data provider not set");const a=this.getElementsFn(),D=new Set(a.map(p=>p.id));this.selectedElementIdsSignal.set(D),a.length>0&&this.toolsService.setActiveTool(e.p.Select),this.updateBoundingBox(),this.eventBus.emit(z.w.ElementsSelected,a)}selectElementsInArea(a){if(!this.getElementsFn)return void console.warn("Element data provider not set");const D=this.getElementsFn(),p=[];D.forEach(P=>{const R=(0,O.P)(P);!(R.maxX<a.x||R.minX>a.x+a.width||R.maxY<a.y||R.minY>a.y+a.height)&&p.push(P.id)}),p.length>0&&this.selectElements(p)}setSelectionBox(a){this.selectionBoxSignal.set(a)}getSelectionBox(){return this.selectionBoxSignal()}getSelectionBoxSignal(){return this.selectionBoxSignal.asReadonly()}clearSelectionBox(){this.selectionBoxSignal.set({x:0,y:0,width:0,height:0,visible:!1})}updateBoundingBox(){const a=this.getSelectedElements();this.updateBoundingBoxFromElements(a)}getBoundingBox(){return this.boundingBoxSignal()}getBoundingBoxSignal(){return this.boundingBoxSignal.asReadonly()}clearBoundingBox(){this.boundingBoxSignal.set(null)}setBoundingBox(a){this.boundingBoxSignal.set(a)}expandSelectionToIncludeGroups(a){if(!this.getElementsFn)return a;const D=this.getElementsFn(),p=D.filter(d=>a.includes(d.id)),P=new Set(p.map(d=>d.groupId).filter(d=>null!=d));return 0===P.size?a:D.filter(d=>a.includes(d.id)||d.groupId&&P.has(d.groupId)).map(d=>d.id)}calculateBoundingBox(a){let D,p=0;if(1===a.length){const S=a[0];p=S.rotation||0,D=(0,O.P)(S)}else{const S=(0,s.L)(a);if(!S)throw new Error("Cannot calculate bounding box for empty element list");D=S,p=0}const{minX:P,minY:R,maxX:d,maxY:y,width:W,height:L}=D;return{x:P,y:R,width:W,height:L,handles:{topLeft:{x:P,y:R},topRight:{x:d,y:R},bottomLeft:{x:P,y},bottomRight:{x:d,y},rotateHandle:{x:P+W/2,y:R-20}},rotation:p}}updateBoundingBoxFromElements(a){a&&0!==a.length?this.boundingBoxSignal.set(this.calculateBoundingBox(a)):this.clearBoundingBox()}updateSelectedElements(a,D){const p=this.getSelectedElements();if(0===p.length)return;const P=D||this.updateElementsFn;if(!P)return;P(p.map(y=>({...a,id:y.id})),!0),this.updateBoundingBox();const d=this.getSelectedElements();this.eventBus.emit(z.w.ElementsSelected,d)}transformSelectedElements(a,D){const p=this.getSelectedElements();if(0===p.length)return;const P=D||this.updateElementsFn;if(!P)return;P(a(p).map(W=>({...W,id:W.id})),!0),this.updateBoundingBox();const y=this.getSelectedElements();this.eventBus.emit(z.w.ElementsSelected,y)}getSelectionBounds(){const a=this.getSelectedElements();if(0===a.length)return null;const D=a.map(O.P);return{minX:Math.min(...D.map(p=>p.minX)),minY:Math.min(...D.map(p=>p.minY)),maxX:Math.max(...D.map(p=>p.maxX)),maxY:Math.max(...D.map(p=>p.maxY))}}selectionContainsType(a){return this.getSelectedElements().some(D=>D.type===a)}getSelectedElementTypes(){const a=this.getSelectedElements().map(D=>D.type);return[...new Set(a)]}removeSelectedElements(){const a=this.getSelectedElements();0!==a.length&&this.removeElementsFn&&(this.removeElementsFn(a,!0),this.clearSelection())}bringToFront(){const a=this.getSelectedElements();if(0===a.length||!this.getElementsFn||!this.updateElementsFn)return;const D=this.getElementsFn(),p=Math.max(...D.map(R=>R.zIndex||0)),P=a.map((R,d)=>({id:R.id,zIndex:p+d+1}));this.updateElementsFn(P)}bringForward(){const a=this.getSelectedElements();if(0===a.length||!this.getElementsFn||!this.updateElementsFn)return;const p=[...this.getElementsFn()].sort((R,d)=>(R.zIndex||0)-(d.zIndex||0)),P=[];a.forEach(R=>{let y=p.findIndex(W=>W.id===R.id)+1;for(;y<p.length&&a.some(W=>W.id===p[y].id);)y++;if(y<p.length){const W=p[y];P.push({id:R.id,zIndex:W.zIndex}),P.push({id:W.id,zIndex:R.zIndex})}}),P.length>0&&this.updateElementsFn(P)}sendBackward(){const a=this.getSelectedElements();if(0===a.length||!this.getElementsFn||!this.updateElementsFn)return;const p=[...this.getElementsFn()].sort((R,d)=>(R.zIndex||0)-(d.zIndex||0)),P=[];a.forEach(R=>{let y=p.findIndex(W=>W.id===R.id)-1;for(;y>=0&&a.some(W=>W.id===p[y].id);)y--;if(y>=0){const W=p[y];P.push({id:R.id,zIndex:W.zIndex}),P.push({id:W.id,zIndex:R.zIndex})}}),P.length>0&&this.updateElementsFn(P)}sendToBack(){const a=this.getSelectedElements();if(0===a.length||!this.getElementsFn||!this.updateElementsFn)return;const D=a.map((d,y)=>({id:d.id,zIndex:y+1}));this.updateElementsFn(D);const R=this.getElementsFn().filter(d=>!a.some(y=>y.id===d.id)).map((d,y)=>({id:d.id,zIndex:a.length+y+1}));R.length>0&&this.updateElementsFn(R)}groupSelectedElements(){const a=this.getSelectedElements();if(a.length<2||!this.updateElementsFn)return;const D=`group_${Date.now()}`,p=a.map(P=>({id:P.id,groupId:D}));this.updateElementsFn(p)}ungroupSelectedElements(){const a=this.getSelectedElements();if(0===a.length||!this.getElementsFn||!this.updateElementsFn)return;const D=a.filter(y=>null!=y.groupId);if(0===D.length)return;const p=[...new Set(D.map(y=>y.groupId).filter(Boolean))],d=this.getElementsFn().filter(y=>null!=y.groupId&&p.includes(y.groupId)).map(y=>({id:y.id,groupId:void 0}));this.updateElementsFn(d)}lockElements(){const a=this.getSelectedElements();if(0===a.length||!this.updateElementsFn)return;const D=a.map(p=>({id:p.id,locked:!0}));this.updateElementsFn(D)}unlockElements(){const a=this.getSelectedElements();if(0===a.length||!this.updateElementsFn)return;const D=a.map(p=>({id:p.id,locked:!1}));this.updateElementsFn(D)}alignElements(a){const D=this.getSelectedElements();if(0===D.length)return;if(!this.updateElementsFn)return void console.warn("Update elements function not available");const p=this.calculateAlignmentUpdates(D,a);p.length>0&&(this.updateElementsFn(p,!0),this.updateBoundingBox())}distributeHorizontally(){this.alignElements(b.Yu.DistributeHorizontally)}distributeVertically(){this.alignElements(b.Yu.DistributeVertically)}calculateAlignmentUpdates(a,D){if(0===a.length)return[];const p=[],P=a.map(R=>({element:R,bounds:(0,O.P)(R)}));if(1===a.length){const R=this.canvasService.getVisibleBounds(),d=P[0].bounds,y=P[0].element;switch(D){case b.Yu.Left:{const W=R.left-d.minX;0!==W&&p.push({id:y.id,x:y.x+W});break}case b.Yu.Center:{const g=(R.left+R.right)/2-(d.minX+d.width/2);0!==g&&p.push({id:y.id,x:y.x+g});break}case b.Yu.Right:{const W=R.right-d.maxX;0!==W&&p.push({id:y.id,x:y.x+W});break}case b.Yu.Top:{const W=R.top-d.minY;0!==W&&p.push({id:y.id,y:y.y+W});break}case b.Yu.Middle:{const g=(R.top+R.bottom)/2-(d.minY+d.height/2);0!==g&&p.push({id:y.id,y:y.y+g});break}case b.Yu.Bottom:{const W=R.bottom-d.maxY;0!==W&&p.push({id:y.id,y:y.y+W});break}default:return console.warn("Unsupported alignment type for single element:",D),[]}return p}switch(D){case b.Yu.Left:{const R=Math.min(...P.map(d=>d.bounds.minX));P.forEach(({element:d,bounds:y})=>{const W=R-y.minX;0!==W&&p.push({id:d.id,x:d.x+W})});break}case b.Yu.Center:{const R=P.reduce((d,y)=>d+(y.bounds.minX+y.bounds.width/2),0)/P.length;P.forEach(({element:d,bounds:y})=>{const L=R-(y.minX+y.width/2);0!==L&&p.push({id:d.id,x:d.x+L})});break}case b.Yu.Right:{const R=Math.max(...P.map(d=>d.bounds.maxX));P.forEach(({element:d,bounds:y})=>{const W=R-y.maxX;0!==W&&p.push({id:d.id,x:d.x+W})});break}case b.Yu.Top:{const R=Math.min(...P.map(d=>d.bounds.minY));P.forEach(({element:d,bounds:y})=>{const W=R-y.minY;0!==W&&p.push({id:d.id,y:d.y+W})});break}case b.Yu.Middle:{const R=P.reduce((d,y)=>d+(y.bounds.minY+y.bounds.height/2),0)/P.length;P.forEach(({element:d,bounds:y})=>{const L=R-(y.minY+y.height/2);0!==L&&p.push({id:d.id,y:d.y+L})});break}case b.Yu.Bottom:{const R=Math.max(...P.map(d=>d.bounds.maxY));P.forEach(({element:d,bounds:y})=>{const W=R-y.maxY;0!==W&&p.push({id:d.id,y:d.y+W})});break}case b.Yu.DistributeHorizontally:{if(a.length<3)return[];const R=P.sort((T,_)=>T.bounds.minX-_.bounds.minX),d=R[0].bounds.minX,n=(R[R.length-1].bounds.maxX-d-R.reduce((T,_)=>T+_.bounds.width,0))/(R.length-1);let S=d;R.forEach(({element:T,bounds:_},l)=>{if(0===l)S+=_.width;else{if(l===R.length-1)return;{S+=n;const M=S-_.minX;0!==M&&p.push({id:T.id,x:T.x+M}),S+=_.width}}});break}case b.Yu.DistributeVertically:{if(a.length<3)return[];const R=P.sort((T,_)=>T.bounds.minY-_.bounds.minY),d=R[0].bounds.minY,n=(R[R.length-1].bounds.maxY-d-R.reduce((T,_)=>T+_.bounds.height,0))/(R.length-1);let S=d;R.forEach(({element:T,bounds:_},l)=>{if(0===l)S+=_.height;else{if(l===R.length-1)return;{S+=n;const M=S-_.minY;0!==M&&p.push({id:T.id,y:T.y+M}),S+=_.height}}});break}default:return console.warn("Unsupported alignment type:",D),[]}return p}flipHorizontal(){const a=this.getSelectedElements();if(0===a.length||!this.updateElementsFn)return;const D=a.map(p=>({id:p.id,scaleX:-(p.scaleX??1)}));this.updateElementsFn(D,!0),this.updateBoundingBox()}flipVertical(){const a=this.getSelectedElements();if(0===a.length||!this.updateElementsFn)return;const D=a.map(p=>({id:p.id,scaleY:-(p.scaleY??1)}));this.updateElementsFn(D,!0),this.updateBoundingBox()}moveSelectedElements(a,D){const p=this.getSelectedElements();if(0===p.length||!this.updateElementsFn)return;const P=p.map(R=>({id:R.id,x:R.x+a,y:R.y+D}));this.updateElementsFn(P,!0),this.updateBoundingBox()}rotateSelectedElements(a){const D=this.getSelectedElements();if(0===D.length||!this.updateElementsFn)return;const p=D.map(P=>({id:P.id,rotation:(P.rotation||0)+a}));this.updateElementsFn(p,!0),this.updateBoundingBox()}scaleSelectedElements(a){const D=this.getSelectedElements();if(0===D.length||!this.updateElementsFn)return;const p=D.map(P=>{const R={id:P.id};return"width"in P&&void 0!==P.width&&(R.width=P.width*a),"height"in P&&void 0!==P.height&&(R.height=P.height*a),void 0!==P.style?.strokeWidth&&(R.style={...P.style,strokeWidth:P.style.strokeWidth*a}),"rx"in P&&void 0!==P.rx&&(R.rx=P.rx*a),"ry"in P&&void 0!==P.ry&&(R.ry=P.ry*a),R}).filter(P=>Object.keys(P).length>1);p.length>0&&(this.updateElementsFn(p,!0),this.updateBoundingBox())}static{this.\u0275fac=function(D){return new(D||E)(I.KVO(m.W),I.KVO(c.W),I.KVO(u.L),I.KVO(i.H),I.KVO(h.W))}}static{this.\u0275prov=I.jDH({token:E,factory:E.\u0275fac,providedIn:"root"})}}return E})()},9989:(Q,Y,x)=>{x.d(Y,{W:()=>W});var I=x(4438),e=x(1413),b=x(5964),z=x(6354),O=x(8359);class s extends O.yU{constructor(g,n){super()}schedule(g,n=0){return this}}const m={setInterval(L,g,...n){const{delegate:S}=m;return S?.setInterval?S.setInterval(L,g,...n):setInterval(L,g,...n)},clearInterval(L){const{delegate:g}=m;return(g?.clearInterval||clearInterval)(L)},delegate:void 0};var c=x(7908);const i={now:()=>(i.delegate||Date).now(),delegate:void 0};class h{constructor(g,n=h.now){this.schedulerActionCtor=g,this.now=n}schedule(g,n=0,S){return new this.schedulerActionCtor(this,g).schedule(S,n)}}h.now=i.now;const E=new class o extends h{constructor(g,n=h.now){super(g,n),this.actions=[],this._active=!1}flush(g){const{actions:n}=this;if(this._active)return void n.push(g);let S;this._active=!0;do{if(S=g.execute(g.state,g.delay))break}while(g=n.shift());if(this._active=!1,S){for(;g=n.shift();)g.unsubscribe();throw S}}}(class u extends s{constructor(g,n){super(g,n),this.scheduler=g,this.work=n,this.pending=!1}schedule(g,n=0){var S;if(this.closed)return this;this.state=g;const T=this.id,_=this.scheduler;return null!=T&&(this.id=this.recycleAsyncId(_,T,n)),this.pending=!0,this.delay=n,this.id=null!==(S=this.id)&&void 0!==S?S:this.requestAsyncId(_,this.id,n),this}requestAsyncId(g,n,S=0){return m.setInterval(g.flush.bind(g,this),S)}recycleAsyncId(g,n,S=0){if(null!=S&&this.delay===S&&!1===this.pending)return n;null!=n&&m.clearInterval(n)}execute(g,n){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const S=this._execute(g,n);if(S)return S;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(g,n){let T,S=!1;try{this.work(g)}catch(_){S=!0,T=_||new Error("Scheduled action threw falsy error")}if(S)return this.unsubscribe(),T}unsubscribe(){if(!this.closed){const{id:g,scheduler:n}=this,{actions:S}=n;this.work=this.state=this.scheduler=null,this.pending=!1,(0,c.o)(S,this),null!=g&&(this.id=this.recycleAsyncId(n,g,null)),this.delay=null,super.unsubscribe()}}});var a=x(9974),D=x(4360),P=x(3669);function d(L,g){return L===g}var y=x(162);let W=(()=>{class L{constructor(){this.eventSubject=new e.B,this.eventSignals={[y.w.Ready]:(0,I.vPA)(void 0),[y.w.Destroyed]:(0,I.vPA)(void 0),[y.w.DrawStart]:(0,I.vPA)(void 0),[y.w.Drawing]:(0,I.vPA)(void 0),[y.w.DrawEnd]:(0,I.vPA)(void 0),[y.w.ElementsAdded]:(0,I.vPA)(void 0),[y.w.ElementsUpdated]:(0,I.vPA)(void 0),[y.w.ElementsSelected]:(0,I.vPA)(void 0),[y.w.ElementsRemoved]:(0,I.vPA)(void 0),[y.w.ElementDoubleClicked]:(0,I.vPA)(void 0),[y.w.Undo]:(0,I.vPA)(void 0),[y.w.Redo]:(0,I.vPA)(void 0),[y.w.Clear]:(0,I.vPA)(void 0),[y.w.DataChange]:(0,I.vPA)(void 0),[y.w.Save]:(0,I.vPA)(void 0),[y.w.ImageAdded]:(0,I.vPA)(void 0),[y.w.ToolChange]:(0,I.vPA)(void 0),[y.w.ConfigChange]:(0,I.vPA)(void 0),[y.w.ZoomChange]:(0,I.vPA)(void 0)},this.lastEventInternal=(0,I.vPA)(void 0),this.lastEvent=this.lastEventInternal.asReadonly(),this.defaultDebounceConfigs={[y.w.ElementsAdded]:{debounceTime:100,distinctUntilChanged:!0},[y.w.Drawing]:{debounceTime:16,distinctUntilChanged:!1}}}ngOnDestroy(){this.destroy()}emit(n,S){const T={type:n,payload:S,timestamp:Date.now()};this.eventSubject.next(T),(0,I.O8t)(()=>{this.eventSignals[n].set(T.payload),this.lastEventInternal.set(T)})}listen(){return this.eventSubject.asObservable()}getEventSignal(n){return this.eventSignals[n].asReadonly()}getAllEventsSignal(){return this.lastEvent}on(n,S){let T=this.eventSubject.pipe((0,b.p)(l=>l.type===n),(0,z.T)(l=>l.payload));const _=S||this.defaultDebounceConfigs[n];return _?(_.debounceTime>0&&(T=T.pipe(function p(L,g=E){return(0,a.N)((n,S)=>{let T=null,_=null,l=null;const M=()=>{if(T){T.unsubscribe(),T=null;const A=_;_=null,S.next(A)}};function C(){const A=l+L,N=g.now();if(N<A)return T=this.schedule(void 0,A-N),void S.add(T);M()}n.subscribe((0,D._)(S,A=>{_=A,l=g.now(),T||(T=g.schedule(C,L),S.add(T))},()=>{M(),S.complete()},void 0,()=>{_=T=null}))})}(_.debounceTime))),_.distinctUntilChanged&&(T=T.pipe(function R(L,g=P.D){return L=L??d,(0,a.N)((n,S)=>{let T,_=!0;n.subscribe((0,D._)(S,l=>{const M=g(l);(_||!L(T,M))&&(_=!1,T=M,S.next(l))}))})}(_.comparator))),T):T}listenToMultiple(n){return this.eventSubject.pipe((0,b.p)(S=>n.includes(S.type)),(0,z.T)(S=>({type:S.type,payload:S.payload,timestamp:S.timestamp})))}destroy(){this.eventSubject.complete()}static{this.\u0275fac=function(S){return new(S||L)}}static{this.\u0275prov=I.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}}return L})()},875:(Q,Y,x)=>{x.d(Y,{k:()=>e});var I=x(4438);let e=(()=>{class b{constructor(){this.undoStack=[],this.redoStack=[],this.MAX_HISTORY=50,this.canUndoSignal=(0,I.vPA)(!1),this.canRedoSignal=(0,I.vPA)(!1),this.undoDescriptionSignal=(0,I.vPA)(void 0),this.redoDescriptionSignal=(0,I.vPA)(void 0),this.batching=!1,this.batchDepth=0,this.batchBeforeSnapshot=null,this.batchDescription="Batch operation",this.pendingBatchAfter=null}getCanUndoSignal(){return this.canUndoSignal.asReadonly()}getCanRedoSignal(){return this.canRedoSignal.asReadonly()}getUndoDescriptionSignal(){return this.undoDescriptionSignal.asReadonly()}getRedoDescriptionSignal(){return this.redoDescriptionSignal.asReadonly()}recordChange(O,s,m){this.batching||this.snapshotsEqual(O,s)||this.pushHistory({before:this.cloneElements(O),after:this.cloneElements(s),description:m,timestamp:Date.now()})}recordElementCreation(O,s){this.recordChange(O,s,"Create element")}recordElementUpdate(O,s){this.recordChange(O,s,"Update element")}recordElementDeletion(O,s){this.recordChange(O,s,"Delete element")}recordClear(O,s){this.recordChange(O,s,"Clear whiteboard")}startBatch(O,s){return 0===this.batchDepth&&(this.batchBeforeSnapshot=this.cloneElements(s),this.batchDescription=O,this.batching=!0),this.batchDepth++,{execute:()=>this.finishBatchCommit(),clear:()=>this.cancelBatch()}}completeBatch(O){this.batching&&(this.pendingBatchAfter=this.cloneElements(O))}finishBatchCommit(){if(this.batchDepth=Math.max(0,this.batchDepth-1),this.batchDepth>0)return;if(!this.batching||!this.batchBeforeSnapshot)return void this.resetBatchState();const O=this.pendingBatchAfter??this.batchBeforeSnapshot;this.snapshotsEqual(this.batchBeforeSnapshot,O)||this.pushHistory({before:this.batchBeforeSnapshot,after:O,description:this.batchDescription,timestamp:Date.now()}),this.resetBatchState()}cancelBatch(){this.batchDepth=0,this.resetBatchState()}resetBatchState(){this.batching=!1,this.batchBeforeSnapshot=null,this.batchDescription="Batch operation"}undo(){return this.performUndo()}redo(){return this.performRedo()}clearHistory(){this.undoStack=[],this.redoStack=[],this.updateSignals()}performUndo(){if(0===this.undoStack.length)return null;const O=this.undoStack.pop();return O?(this.redoStack.push(O),this.updateSignals(),this.cloneElements(O.before)):null}performRedo(){if(0===this.redoStack.length)return null;const O=this.redoStack.pop();return O?(this.undoStack.push(O),this.updateSignals(),this.cloneElements(O.after)):null}pushHistory(O){this.undoStack.push(O),this.undoStack.length>this.MAX_HISTORY&&this.undoStack.shift(),this.redoStack=[],this.updateSignals()}updateSignals(){this.canUndoSignal.set(this.undoStack.length>0),this.canRedoSignal.set(this.redoStack.length>0),this.undoDescriptionSignal.set(this.undoStack[this.undoStack.length-1]?.description),this.redoDescriptionSignal.set(this.redoStack[this.redoStack.length-1]?.description)}cloneElements(O){return O.map(s=>{const m={...s},c=s.points;return Array.isArray(c)&&(m.points=c.map(u=>[...u])),m})}snapshotsEqual(O,s){if(O.length!==s.length)return!1;const m=new Map(O.map(c=>[c.id,c]));for(const c of s){const u=m.get(c.id);if(!u||JSON.stringify(u)!==JSON.stringify(c))return!1}return!0}static{this.\u0275fac=function(s){return new(s||b)}}static{this.\u0275prov=I.jDH({token:b,factory:b.\u0275fac,providedIn:"root"})}}return b})()},3909:(Q,Y,x)=>{x.d(Y,{W:()=>b});var I=x(4438),e=x(6255);let b=(()=>{class z{constructor(s){this.elementsService=s,this.CLIPBOARD_KEY="whiteboard-clipboard",this.OFFSET_INCREMENT=20}copy(s){if(0===s.length)return;const m={elements:s,timestamp:Date.now()};try{localStorage.setItem(this.CLIPBOARD_KEY,JSON.stringify(m))}catch(c){console.error("Failed to copy elements to clipboard:",c)}}cut(s){this.copy(s)}paste(){const s=this.getData();if(!s?.elements.length)return[];const m=this.duplicateElementsWithOffset(s.elements,this.OFFSET_INCREMENT,this.OFFSET_INCREMENT);return this.elementsService.addElements(m),m}clear(){try{localStorage.removeItem(this.CLIPBOARD_KEY)}catch(s){console.error("Failed to clear clipboard:",s)}}hasData(){const s=this.getData();return null!==s&&s.elements.length>0}getData(){try{const s=localStorage.getItem(this.CLIPBOARD_KEY);return s?JSON.parse(s):null}catch(s){return console.error("Failed to read clipboard data:",s),null}}duplicateElements(s,m=this.OFFSET_INCREMENT,c=this.OFFSET_INCREMENT){if(0===s.length)return[];const u=this.duplicateElementsWithOffset(s,m,c);return this.elementsService.addElements(u),u}createDuplicates(s,m=this.OFFSET_INCREMENT,c=this.OFFSET_INCREMENT){return this.duplicateElementsWithOffset(s,m,c)}getClipboardInfo(){const s=this.getData();return s?{elementCount:s.elements.length,timestamp:s.timestamp}:null}isDataFresh(s=3e5){const m=this.getData();return!!m&&Date.now()-m.timestamp<=s}getClipboardElementTypes(){const s=this.getData();if(!s)return[];const m=s.elements.map(c=>c.type);return[...new Set(m)]}duplicateElementsWithOffset(s,m,c){return s.map(u=>({...u,id:`${u.id}_copy_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x:u.x+m,y:u.y+c}))}static{this.\u0275fac=function(m){return new(m||z)(I.KVO(e.L))}}static{this.\u0275prov=I.jDH({token:z,factory:z.\u0275fac,providedIn:"root"})}}return z})()},1389:(Q,Y,x)=>{x.d(Y,{q:()=>d});var I=x(4523),e=x(2173),b=x(2262),z=x(6078),O=x(162),i=x(7879),h=x(4438),o=x(6255),E=x(525),w=x(4764),a=x(710),D=x(9989),p=x(1152),P=x(3437),R=x(7785);let d=(()=>{class y{constructor(L,g,n,S,T,_,l,M){this.elementsService=L,this.canvasService=g,this.zoomService=n,this.panService=S,this.eventBusService=T,this.selectionService=_,this.layerManagementService=l,this.configService=M}addImage(L){const g=new Image;g.onload=()=>{const{canvasHeight:n}=this.canvasService.getConfig(),T=g.height,l=T>n?n-40:T;let C=L.x||0,A=L.y||0;C<0&&(C=0),A<0&&(A=0);const N=(0,e.n)(b.R.Image,{src:L.image,width:l===n-40?g.width/g.height*(n-40):g.width,height:l,x:C,y:A,zIndex:this.elementsService.getNextZIndex()});this.elementsService.addElements([N]),N.selectAfterDraw&&this.selectionService.selectElements([N.id]),this.eventBusService.emit(O.w.ImageAdded,N.src)},g.onerror=()=>{console.error("Failed to load image")},g.src=L.image}importImageFile(L,g,n){return new Promise((S,T)=>{if(!L.type.startsWith(i.Vu.IMAGE))return void T(new Error("Invalid file type. Only images are supported."));const _=new FileReader;_.onload=l=>{const M=l.target?.result;M?(this.addImage({image:M,x:g,y:n}),S()):T(new Error("Failed to read file"))},_.onerror=()=>{T(new Error("Failed to read file"))},_.readAsDataURL(L)})}importImageFromUrl(L,g,n){var S=this;return(0,I.A)(function*(){try{const _=yield(yield fetch(L)).blob();return new Promise((l,M)=>{const C=new FileReader;C.onload=A=>{const N=A.target?.result;N?(S.addImage({image:N,x:g,y:n}),l()):M(new Error("Failed to process URL"))},C.onerror=()=>{M(new Error("Failed to process URL"))},C.readAsDataURL(_)})}catch(T){throw new Error(`Failed to load image from URL: ${T}`)}})()}save(L=z.o8.Base64,g="New board"){var n=this;return(0,I.A)(function*(){const T=n.canvasService.getCanvas().getElementById("svgcontent");if(!T)throw new Error("SVG content not found");const _=n.prepareSvgForExport(T),l=(new XMLSerializer).serializeToString(_),{canvasWidth:M,canvasHeight:C}=n.canvasService.getConfig();try{const A=yield function u(y,W,L,g=z.o8.Png){return new Promise((n,S)=>{const T=document.createElement("canvas");T.width=W,T.height=L;const _=T.getContext("2d"),l=new Image,M=encodeURIComponent(y);l.src=`data:image/svg+xml;charset=utf-8,${M}`,l.onload=()=>{_.drawImage(l,0,0,W,L);const C=T.toDataURL(`image/${g}`);n(C)},l.onerror=C=>{S(C)}})}(l,M,C,L);switch(L){case z.o8.Base64:n.eventBusService.emit(O.w.Save,A);break;case z.o8.Svg:{const N="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(l)));n.downloadFile(N,g,"svg"),n.eventBusService.emit(O.w.Save,N);break}default:n.downloadFile(A,g,n.getFileExtension(L)),n.eventBusService.emit(O.w.Save,A)}return A}catch(A){throw console.error("Failed to save whiteboard:",A),A}})()}exportAsPng(L="whiteboard"){var g=this;return(0,I.A)(function*(){return g.save(z.o8.Png,L)})()}exportAsJpeg(L="whiteboard"){var g=this;return(0,I.A)(function*(){return g.save(z.o8.Jpeg,L)})()}exportAsSvg(L="whiteboard"){var g=this;return(0,I.A)(function*(){return g.save(z.o8.Svg,L)})()}exportAsBase64(){var L=this;return(0,I.A)(function*(){return L.save(z.o8.Base64)})()}exportData(){const L=this.elementsService.getElements(),g=this.canvasService.getConfig(),n=this.layerManagementService.exportLayerState(),S=this.configService.getEditorConfig(),T={version:"1.0",timestamp:(new Date).toISOString(),elements:L,layers:n,canvas:{width:g.canvasWidth,height:g.canvasHeight,backgroundColor:g.backgroundColor,fullScreen:g.fullScreen,center:g.center},viewport:{zoom:g.zoom,x:g.x,y:g.y,canvasX:g.canvasX,canvasY:g.canvasY},drawing:{strokeColor:g.strokeColor,strokeWidth:g.strokeWidth,fill:g.fill,lineJoin:g.lineJoin,lineCap:g.lineCap,dasharray:g.dasharray,dashoffset:g.dashoffset,penType:g.penType},grid:{enabled:g.enableGrid,size:g.gridSize,snapToGrid:g.snapToGrid},text:{fontFamily:g.fontFamily,fontSize:g.fontSize},editor:S,settings:{drawingEnabled:g.drawingEnabled,keyboardShortcutsEnabled:g.keyboardShortcutsEnabled}};return JSON.stringify(T,null,2)}exportDataAsFile(L="whiteboard-export"){const g=this.exportData(),n="data:application/json;charset=utf-8,"+encodeURIComponent(g);this.downloadFile(n,L,"json"),this.eventBusService.emit(O.w.Save,g)}importData(L){try{const g=JSON.parse(L);if(!g.elements||!Array.isArray(g.elements))throw new Error("Invalid data format: elements array not found");if(this.elementsService.clear(),g.layers&&this.layerManagementService.importLayerState(g.layers),this.elementsService.setElements(g.elements),g.canvas){const{canvas:n}=g;n.width&&n.height&&this.canvasService.setCanvasDimensions(n.width,n.height),void 0!==n.backgroundColor&&this.configService.updateConfig({backgroundColor:n.backgroundColor},!1),void 0!==n.fullScreen&&this.configService.updateConfig({fullScreen:n.fullScreen},!1),void 0!==n.center&&this.configService.updateConfig({center:n.center},!1)}if(g.viewport){const{viewport:n}=g;void 0!==n.zoom&&this.zoomService.zoom(n.zoom),void 0!==n.x&&void 0!==n.y&&this.panService.panTo(n.x,n.y),void 0!==n.canvasX&&void 0!==n.canvasY&&this.configService.updateConfig({canvasX:n.canvasX,canvasY:n.canvasY},!1)}if(g.drawing){const{drawing:n}=g,S={};void 0!==n.strokeColor&&(S.strokeColor=n.strokeColor),void 0!==n.strokeWidth&&(S.strokeWidth=n.strokeWidth),void 0!==n.fill&&(S.fill=n.fill),void 0!==n.lineJoin&&(S.lineJoin=n.lineJoin),void 0!==n.lineCap&&(S.lineCap=n.lineCap),void 0!==n.dasharray&&(S.dasharray=n.dasharray),void 0!==n.dashoffset&&(S.dashoffset=n.dashoffset),void 0!==n.penType&&(S.penType=n.penType),this.configService.updateConfig(S,!1)}if(g.grid){const{grid:n}=g,S={};void 0!==n.enabled&&(S.enableGrid=n.enabled),void 0!==n.size&&(S.gridSize=n.size),void 0!==n.snapToGrid&&(S.snapToGrid=n.snapToGrid),this.configService.updateConfig(S,!1)}if(g.text){const{text:n}=g,S={};void 0!==n.fontFamily&&(S.fontFamily=n.fontFamily),void 0!==n.fontSize&&(S.fontSize=n.fontSize),this.configService.updateConfig(S,!1)}if(g.editor&&Object.keys(g.editor).forEach(S=>{this.configService.updateEditorConfigValue(S,g.editor[S])}),g.settings){const{settings:n}=g,S={};void 0!==n.drawingEnabled&&(S.drawingEnabled=n.drawingEnabled),void 0!==n.keyboardShortcutsEnabled&&(S.keyboardShortcutsEnabled=n.keyboardShortcutsEnabled),this.configService.updateConfig(S,!1)}this.configService.updateConfig({},!0),this.eventBusService.emit(O.w.ElementsAdded,g.elements)}catch(g){throw console.error("Failed to import data:",g),new Error(`Failed to import data: ${g}`)}}importDataFromFile(L){return new Promise((g,n)=>{if(!L.type.includes("json"))return void n(new Error("Invalid file type. Only JSON files are supported."));const S=new FileReader;S.onload=T=>{const _=T.target?.result;if(_&&"string"==typeof _)try{this.importData(_),g()}catch(l){n(l)}else n(new Error("Failed to read file"))},S.onerror=()=>{n(new Error("Failed to read file"))},S.readAsText(L)})}downloadFile(L,g,n){!function s(y,W){const L=document.createElement("a");L.href=y,L.setAttribute("visibility","hidden"),L.download=W||"new white-board",document.body.appendChild(L),L.click(),document.body.removeChild(L)}(L,`${g}.${n}`)}getFileExtension(L){switch(L){case z.o8.Png:return"png";case z.o8.Jpeg:return"jpg";case z.o8.Svg:return"svg";case z.o8.Base64:return"txt";default:return"png"}}prepareSvgForExport(L){const g=L.cloneNode(!0),n=g.querySelector("#selectorParentGroup");n&&n.remove();const S=g.querySelector("#contentBackground");return S&&S.removeAttribute("opacity"),g.setAttribute("x","0"),g.setAttribute("y","0"),g}importMultipleImages(L,g=50){var n=this;return(0,I.A)(function*(){const S=[];let T=0,_=0;for(let l=0;l<L.length;l++)S.push(n.importImageFile(L[l],T,_)),T+=200+g,T>800&&(T=0,_+=200+g);yield Promise.all(S)})()}processImage(L){return L}static{this.\u0275fac=function(g){return new(g||y)(h.KVO(o.L),h.KVO(E.W),h.KVO(w.T),h.KVO(a.l),h.KVO(D.W),h.KVO(p.A),h.KVO(P.a),h.KVO(R.w))}}static{this.\u0275prov=h.jDH({token:y,factory:y.\u0275fac,providedIn:"root"})}}return y})()},3452:(Q,Y,x)=>{x.d(Y,{r:()=>T});var I=x(2173),e=x(872),b=x(2262),z=x(6212),O=x(6084);class s{constructor(l){this.apiService=l,this.active=!1,this.baseCursor=O.x.Default}get whiteboardConfig(){return this.apiService?.getConfig()}getPointerPosition({x:l,y:M}){return(0,z.y1)(this.apiService.getConfig(),{x:l,y:M})}activate(){this.active=!0,this.onActivate?.()}deactivate(){this.active=!1,this.onDeactivate?.()}setCursor(l){this.apiService.setCursor(l)}resetCursor(){this.apiService.resetCursor()}get isActive(){return this.active}}class m extends s{constructor(){super(...arguments),this.type=e.p.Arrow,this.baseCursor=O.x.Crosshair,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(l){if(!this.active)return;const M=this.getPointerPosition(l);let{x:C,y:A}=M;const{snapToGrid:N}=this.whiteboardConfig;if(N){const{gridSize:H}=this.whiteboardConfig;C=(0,z.Ej)(C,H),A=(0,z.Ej)(A,H)}this.startPoint={x:C,y:A},this.lastX=C,this.lastY=A,this.element=(0,I.n)(b.R.Arrow,{x1:C,y1:A,x2:C,y2:A,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(l){if(!this.active||!this.element)return;const M=this.getPointerPosition(l);let C=M.x,A=M.y;const{snapToGrid:N}=this.whiteboardConfig;if(N){const{gridSize:H}=this.whiteboardConfig;C=(0,z.Ej)(C,H),A=(0,z.Ej)(A,H)}if(l.shiftKey){const H=this.element.x1,Z=this.element.y1,{x:U,y:j}=(0,z.Jt)(H,Z,C,A);C=U,A=j}(Math.abs(C-this.lastX)>this.MIN_LENGTH||Math.abs(A-this.lastY)>this.MIN_LENGTH)&&(this.apiService.updateDraftElements([{id:this.element.id,x2:C,y2:A}]),this.lastX=C,this.lastY=A)}handlePointerUp(){if(this.active){if(this.element&&this.startPoint){const l=this.element;this.apiService.commitDraftElements(),l.selectAfterDraw&&this.apiService.selectElements([l.id]),this.startPoint=null,this.element=null}this.lastX=0,this.lastY=0}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class c extends s{constructor(){super(...arguments),this.type=e.p.Ellipse,this.baseCursor=O.x.Crosshair,this.element=null,this.startPoint=null}handlePointerDown(l){if(!this.active)return;let{x:M,y:C}=this.getPointerPosition(l);const{snapToGrid:A}=this.whiteboardConfig;if(A){const{gridSize:N}=this.whiteboardConfig;M=(0,z.Ej)(M,N),C=(0,z.Ej)(C,N)}this.startPoint={x:M,y:C},this.element=(0,I.n)(b.R.Ellipse,{cx:M,cy:C,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(l){if(!this.active||!this.element||!this.startPoint)return;const{x:M,y:C}=this.getPointerPosition(l),{x:A,y:N}=this.startPoint;let H,Z,U,j;l.altKey?(H=A,Z=N,U=Math.abs(M-H),j=l.shiftKey?U:Math.abs(C-Z)):(H=(A+M)/2,Z=(N+C)/2,U=Math.abs(A-M)/2,j=l.shiftKey?U:Math.abs(N-C)/2,l.shiftKey&&(Z=C>N?N+U:N-U)),this.apiService.updateDraftElements([{id:this.element.id,rx:U,ry:j,cx:H,cy:Z}])}handlePointerUp(){if(this.active&&this.element&&this.startPoint){const l=this.element;this.apiService.commitDraftElements(),l.selectAfterDraw&&this.apiService.selectElements([l.id]),this.startPoint=null,this.element=null}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var u=x(2319);class i extends s{constructor(){super(...arguments),this.type=e.p.Eraser,this.baseCursor=O.x.Eraser,this.isErasing=!1,this.hoveredElementIds=new Set,this.lastPosition=null}handlePointerDown(l){if(!this.active)return;this.hoveredElementIds.clear();const M=this.getPointerPosition(l);this.isErasing=!0,this.eraseElementsAt(M,M),this.lastPosition=M}handlePointerMove(l){if(!this.active||!this.isErasing||!this.lastPosition)return;const M=this.getPointerPosition(l);this.eraseElementsAt(this.lastPosition,M,l.altKey),this.lastPosition=M}handlePointerUp(){if(this.active){if(this.hoveredElementIds.size>0){const l=Array.from(this.hoveredElementIds),M=this.expandToIncludeGroups(l),C=this.apiService.getElements().filter(A=>M.includes(A.id));C.forEach(A=>{A.isDeleting=!1}),this.apiService.updateElements(C),this.apiService.removeElements(C)}this.hoveredElementIds.clear(),this.isErasing=!1,this.lastPosition=null}}eraseElementsAt(l,M,C=!1){const A=this.apiService.getElements(),N=this.apiService.getConfig()?.zoom||1,H=Math.hypot(M.x-l.x,M.y-l.y),j=10/N+H*(.5*Math.log2(H+1));for(const $ of A){const q=(0,I.lE)($.type).getBounds($);if((0,u.DB)(q,l,M,j)&&this.isPointInElement($,l,M,j)){C&&this.expandToIncludeGroups([$.id]).forEach(he=>{this.hoveredElementIds.delete(he);const re=A.find(de=>de.id===he);re&&(re.isDeleting=!1)}),!C&&!this.hoveredElementIds.has($.id)&&this.expandToIncludeGroups([$.id]).forEach(he=>{this.hoveredElementIds.add(he);const re=A.find(de=>de.id===he);re&&(re.isDeleting=!0)});const le=this.expandToIncludeGroups([$.id]),V=A.filter(ee=>le.includes(ee.id));this.apiService.updateElements(V)}}}isPointInElement(l,M,C,A){return(0,I.lE)(l.type).hitTest(l,M,C,A)}expandToIncludeGroups(l){const M=this.apiService.getElements(),C=M.filter(H=>l.includes(H.id)),A=new Set(C.map(H=>H.groupId).filter(H=>null!=H));return 0===A.size?l:M.filter(H=>l.includes(H.id)||H.groupId&&A.has(H.groupId)).map(H=>H.id)}}class h extends s{constructor(){super(...arguments),this.type=e.p.Hand,this.baseCursor=O.x.Grab,this.isDragging=!1,this.startX=0,this.startY=0}handlePointerDown(l){this.isDragging=!0,this.startX=l.clientX,this.startY=l.clientY,this.setCursor(O.x.Grabbing)}handlePointerMove(l){if(!this.isDragging)return;const{zoom:M}=this.whiteboardConfig;this.apiService.pan((l.clientX-this.startX)/M,(l.clientY-this.startY)/M),this.startX=l.clientX,this.startY=l.clientY}handlePointerUp(){this.isDragging=!1,this.resetCursor()}}class o extends s{constructor(){super(...arguments),this.type=e.p.Image,this.baseCursor=O.x.Image}handlePointerDown(l){const{x:M,y:C}=this.getPointerPosition(l),A=document.createElement("input");A.type="file",A.accept="image/*",A.onchange=N=>{const H=N.target.files;if(H){const Z=new FileReader;Z.onload=U=>{this.apiService.addImage({image:U.target.result,x:M,y:C})},Z.readAsDataURL(H[0])}},A.click()}}class E extends s{constructor(){super(...arguments),this.type=e.p.Line,this.baseCursor=O.x.Crosshair,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(l){if(!this.active)return;let{x:M,y:C}=this.getPointerPosition(l);const{snapToGrid:A}=this.whiteboardConfig;if(A){const{gridSize:N}=this.whiteboardConfig;M=(0,z.Ej)(M,N),C=(0,z.Ej)(C,N)}this.startPoint={x:M,y:C},this.lastX=M,this.lastY=C,this.element=(0,I.n)(b.R.Line,{x1:M,y1:C,x2:M,y2:C,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(l){if(!this.active||!this.element)return;const M=this.getPointerPosition(l);let C=M.x,A=M.y;const{snapToGrid:N}=this.whiteboardConfig;if(N){const{gridSize:H}=this.whiteboardConfig;C=(0,z.Ej)(C,H),A=(0,z.Ej)(A,H)}if(l.shiftKey){const H=this.element.x1,Z=this.element.y1,{x:U,y:j}=(0,z.Jt)(H,Z,C,A);[C,A]=[U,j]}(Math.abs(C-this.lastX)>this.MIN_LENGTH||Math.abs(A-this.lastY)>this.MIN_LENGTH)&&(this.apiService.updateDraftElements([{id:this.element.id,x2:C,y2:A}]),this.lastX=C,this.lastY=A)}handlePointerUp(){if(this.active){if(this.element&&this.startPoint){const l=this.element;this.apiService.commitDraftElements(),l.selectAfterDraw&&this.apiService.selectElements([l.id]),this.startPoint=null,this.element=null}this.lastX=0,this.lastY=0}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var w=x(3265);class a extends s{constructor(l){super(l),this.type=e.p.Pen,this.baseCursor=O.x.Crosshair,this.element=null}getCurrentPathOptions(){const C=(0,w.Nn)(this.whiteboardConfig.penType,w.Of.Medium).strokeOptions;return{smoothing:C.smoothing||.5,streamline:C.streamline||.5,thinning:C.thinning||.5,simulatePressure:void 0===C.simulatePressure||C.simulatePressure,size:C.size||16,easing:C.easing||(A=>A<.5?2*A*A:1-Math.pow(-2*A+2,2)/2),start:C.start||{cap:!0,taper:.3},end:C.end||{cap:!0,taper:.4}}}handlePointerDown(l){if(!this.active)return;const M=this.getPointerPosition(l),C=this.getCurrentPathOptions();this.element=(0,I.n)(b.R.Pen,{points:[[M.x,M.y]],pathOptions:C,isComplete:!1,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(l){if(!this.active||!this.element)return;const{x:M,y:C}=this.getPointerPosition(l),A=[...this.element.points,[M,C]];this.element.points=A,this.apiService.updateDraftElements([{id:this.element.id,points:A}])}handlePointerUp(){if(this.active&&this.element){const l=this.element;this.apiService.updateDraftElements([{id:l.id,isComplete:!0}]),this.apiService.commitDraftElements(),l.selectAfterDraw&&this.apiService.selectElements([l.id]),this.element=null}}getElementStyle(){const M=(0,w.Nn)(this.whiteboardConfig.penType,w.Of.Medium);return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,lineJoin:this.whiteboardConfig.lineJoin,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,opacity:M.opacity}}}class D extends s{constructor(){super(...arguments),this.type=e.p.Rectangle,this.baseCursor=O.x.Crosshair,this.element=null,this.startPoint=null}handlePointerDown(l){if(!this.active)return;let{x:M,y:C}=this.getPointerPosition(l);const{snapToGrid:A}=this.whiteboardConfig;if(A){const{gridSize:N}=this.whiteboardConfig;M=(0,z.Ej)(M,N),C=(0,z.Ej)(C,N)}this.startPoint={x:M,y:C},this.element=(0,I.n)(b.R.Rectangle,{x:M,y:C,style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId()),this.apiService.addDraftElements([this.element])}handlePointerMove(l){if(!this.active||!this.element||!this.startPoint)return;const{x:M,y:C}=this.getPointerPosition(l),A=this.startPoint.x,N=this.startPoint.y;let H=Math.abs(M-A),Z=Math.abs(C-N),U=null,j=null;l.shiftKey?(H=Z=Math.max(H,Z),U=A<M?A:A-H,j=N<C?N:N-Z):(U=Math.min(A,M),j=Math.min(N,C)),l.altKey&&(H*=2,Z*=2,U=A-H/2,j=N-Z/2);const{snapToGrid:$}=this.whiteboardConfig;if($){const{gridSize:q}=this.whiteboardConfig;H=(0,z.Ej)(H,q),Z=(0,z.Ej)(Z,q),U=(0,z.Ej)(U,q),j=(0,z.Ej)(j,q)}this.apiService.updateDraftElements([{id:this.element.id,width:H,height:Z,x:U,y:j}])}handlePointerUp(){if(this.active&&this.element&&this.startPoint){const l=this.element;this.apiService.commitDraftElements(),l.selectAfterDraw&&this.apiService.selectElements([l.id]),this.startPoint=null,this.element=null}}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineJoin:this.whiteboardConfig.lineJoin,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}var p=x(7879),P=x(6078),R=x(6751),d=x(6042),y=x(2500),W=x(9820),L=function(_){return _[_.None=0]="None",_[_.Select=1]="Select",_[_.Move=2]="Move",_[_.Resize=3]="Resize",_[_.Rotate=4]="Rotate",_[_.BoxSelect=5]="BoxSelect",_}(L||{});class g extends s{constructor(){super(...arguments),this.type=e.p.Select,this.baseCursor=O.x.Default,this.currentAction=L.None,this.startPoint=null,this.currentHandle=null,this.rotateStartAngle=null,this.selectionCenter=null,this.initialBoundingBox=null,this.initialElementRotations=new Map,this.initialElementStates=new Map,this.rafId=null,this.pendingPointerEvent=null}getCurrentAction(){return this.currentAction}getStartPoint(){return this.startPoint}getCurrentHandle(){return this.currentHandle}onDeactivate(){this.apiService.clearSelection()}handlePointerDown(l){const M=(0,R.r)(l),C=M?.id??"";if(this.startPoint=this.getPointerPosition(l),C.includes(p.RZ)){const A=M?.getAttribute(p.Bn)??null;this.handleElementSelect(A,l.shiftKey),this.currentAction=L.Move}else C.includes(p.Sb)?(this.currentHandle=this.getResizeDirection(C),this.initializeResize(),this.currentAction=L.Resize):C.includes(p.Be)?(this.initializeRotation(l),this.currentAction=L.Rotate):C.includes(p.i$)?this.currentAction=L.Move:(this.initializeBoxSelect(l),this.currentAction=L.BoxSelect)}handlePointerMove(l){this.pendingPointerEvent=l,null===this.rafId&&(this.rafId=requestAnimationFrame(()=>{if(this.rafId=null,!this.pendingPointerEvent||!this.startPoint)return;const M=this.pendingPointerEvent,C=this.getPointerPosition(M);switch(this.currentAction){case L.Move:this.handleMove(C,M.shiftKey);break;case L.Resize:this.handleResize(C,M.shiftKey);break;case L.Rotate:this.handleRotate(C,M.ctrlKey);break;case L.BoxSelect:this.handleBoxSelect(C,M.shiftKey)}}))}handlePointerUp(){null!==this.rafId&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.pendingPointerEvent=null,this.currentAction===L.BoxSelect&&this.apiService.clearSelectionBox(),this.currentAction===L.Rotate&&(this.initialElementRotations.clear(),this.apiService.updateBoundingBox()),this.initialElementStates.clear(),this.currentAction=L.None,this.startPoint=null,this.currentHandle=null,this.rotateStartAngle=null,this.selectionCenter=null,this.initialBoundingBox=null}handleElementSelect(l,M){if(!l)return;const C=this.apiService.getElementById(l);C&&(C.locked||(M?this.apiService.toggleSelection(C):this.apiService.selectElements([C])))}handleMove(l,M){if(!this.startPoint)return;const C=l.x-this.startPoint.x,A=l.y-this.startPoint.y;let N=C,H=A;if(M){const Z=(0,d.ZN)(C,A);N=Z.x,H=Z.y}this.apiService.transformSelectedElements(Z=>Z.map(U=>U.locked?U:{...U,x:U.x+N,y:U.y+H})),this.startPoint=l}handleResize(l,M){if(!this.startPoint||null===this.currentHandle||!this.initialBoundingBox)return;const C=this.currentHandle,A=this.apiService.getSelectedElements();if(!A.length)return;if(1===A.length){const re=A[0];if(!this.initialElementStates.get(re.id))return;const se=l.x-this.startPoint.x,ye=l.y-this.startPoint.y;let Ie=se,Ce=ye;if(re.rotation&&0!==re.rotation){const ue=-re.rotation*Math.PI/180,oe=Math.cos(ue),ie=Math.sin(ue);Ie=se*oe-ye*ie,Ce=se*ie+ye*oe}let Pe=Ie,De=Ce;if(M){const ue=(0,d.ZN)(Ie,Ce);Pe=ue.x,De=ue.y}return void this.apiService.transformSelectedElements(ue=>ue.map(oe=>{if(oe.locked)return oe;const ie=this.initialElementStates.get(oe.id);if(!ie)return oe;let _e=null;if(ie.rotation&&0!==ie.rotation){const Ee=ie.width||2*ie.rx||0,we=ie.height||2*ie.ry||0;let ge=0,fe=0;fe=C.includes(P.OP.N)?we:C.includes(P.OP.S)?0:we/2,ge=C.includes(P.OP.W)?Ee:C.includes(P.OP.E)?0:Ee/2;const Te=ie.rotation*Math.PI/180,Me=Math.cos(Te),be=Math.sin(Te);_e={x:ie.x+(ge*Me-fe*be),y:ie.y+(ge*be+fe*Me)}}const Se=(0,I.lE)(ie.type).resize({...ie},C,Pe,De);if(ie.rotation&&0!==ie.rotation&&_e){const Ee=Se.width||2*Se.rx||0,we=Se.height||2*Se.ry||0;let ge=0,fe=0;fe=C.includes(P.OP.N)?we:C.includes(P.OP.S)?0:we/2,ge=C.includes(P.OP.W)?Ee:C.includes(P.OP.E)?0:Ee/2;const Me=(Se.rotation??0)*Math.PI/180,be=Math.cos(Me),Ae=Math.sin(Me),Be={x:Se.x+(ge*be-fe*Ae),y:Se.y+(ge*Ae+fe*be)};Se.x+=_e.x-Be.x,Se.y+=_e.y-Be.y}return Se}))}const N=this.initialBoundingBox,H=l.x-this.startPoint.x,Z=l.y-this.startPoint.y;let U,j,$,q;switch(C){case P.OP.N:U=N.x,j=N.y+N.height,$=N.width,q=N.height-Z;break;case P.OP.S:U=N.x,j=N.y,$=N.width,q=N.height+Z;break;case P.OP.E:U=N.x,j=N.y,$=N.width+H,q=N.height;break;case P.OP.W:U=N.x+N.width,j=N.y,$=N.width-H,q=N.height;break;case P.OP.NE:U=N.x,j=N.y+N.height,$=N.width+H,q=N.height-Z;break;case P.OP.NW:U=N.x+N.width,j=N.y+N.height,$=N.width-H,q=N.height-Z;break;case P.OP.SE:U=N.x,j=N.y,$=N.width+H,q=N.height+Z;break;case P.OP.SW:U=N.x+N.width,j=N.y,$=N.width-H,q=N.height+Z;break;default:return}if($<=0||q<=0)return;const le=$/N.width,V=q/N.height;let ee=le,he=V;if(M){const re=Math.min(Math.abs(le),Math.abs(V))*Math.sign(le)*Math.sign(V);ee=re,he=re}this.apiService.transformSelectedElements(re=>re.map(de=>{if(de.locked)return de;const se=this.initialElementStates.get(de.id);if(!se)return de;const De=U+(se.x-U)*ee,ue=j+(se.y-j)*he,oe={...de,x:De,y:ue};if("width"in se&&void 0!==se.width&&(oe.width=se.width*Math.abs(ee)),"height"in se&&void 0!==se.height&&(oe.height=se.height*Math.abs(he)),se.style?.strokeWidth){const ie=(Math.abs(ee)+Math.abs(he))/2;oe.style={...de.style,strokeWidth:se.style.strokeWidth*ie}}return oe.rotation=se.rotation,oe}))}handleRotate(l,M){if(!this.startPoint||!this.selectionCenter||null===this.rotateStartAngle)return;const C=this.apiService.getSelectedElements();if(0===C.length)return;let N=(0,d.Qu)(this.selectionCenter,l)-this.rotateStartAngle;if(N>180&&(N-=360),N<-180&&(N+=360),M&&(N=15*Math.round(N/15)),C.length>1){const H=this.selectionCenter;this.apiService.transformSelectedElements(Z=>Z.map(U=>{if(U.locked)return U;const j=this.initialElementStates.get(U.id);if(!j)return U;const $=this.initialElementRotations.get(U.id)??j.rotation??0,le=(0,I.lE)(j.type).getBounds(j),V={x:(le.minX+le.maxX)/2,y:(le.minY+le.maxY)/2},ee=(0,y.U)(V,H,N),de=ee.x-(V.x-j.x),se=ee.y-(V.y-j.y),ye=(0,d.n0)($+N);return{...U,x:de,y:se,rotation:ye}}))}else{const H=C[0];let U=(this.initialElementRotations.get(H.id)??H.rotation??0)+N;U=(0,d.n0)(U),this.apiService.transformSelectedElements(j=>j.map($=>$.locked?$:{...$,rotation:U}))}}handleBoxSelect(l,M){if(!this.startPoint)return;const C={x:Math.min(this.startPoint.x,l.x),y:Math.min(this.startPoint.y,l.y),width:Math.abs(l.x-this.startPoint.x),height:Math.abs(l.y-this.startPoint.y),visible:!0};this.apiService.setSelectionBox(C);const N=this.apiService.getElements().filter(H=>this.checkElementInSelectionBox(H,C)&&!H.locked);this.apiService.selectElements(N,M),this.apiService.updateBoundingBox()}initializeBoxSelect(l){l.shiftKey||this.apiService.clearSelection();const{x:M,y:C}=this.getPointerPosition(l);this.apiService.setSelectionBox({x:M,y:C,width:0,height:0,visible:!0})}initializeResize(){const l=this.apiService.getSelectedElements();if(0===l.length)return;this.initialElementStates.clear(),l.forEach(Z=>{this.initialElementStates.set(Z.id,{...Z})});const M=l.map(Z=>(0,W.P)(Z)),C=Math.min(...M.map(Z=>Z.minX)),A=Math.min(...M.map(Z=>Z.minY)),N=Math.max(...M.map(Z=>Z.maxX)),H=Math.max(...M.map(Z=>Z.maxY));this.initialBoundingBox={x:C,y:A,width:N-C,height:H-A}}initializeRotation(l){const M=this.apiService.getBoundingBoxSignal(),A="function"==typeof M?M():M;if(!A)return;this.selectionCenter={x:A.x+A.width/2,y:A.y+A.height/2};const N=this.getPointerPosition(l);this.rotateStartAngle=(0,d.Qu)(this.selectionCenter,N);const H=this.apiService.getSelectedElements();this.initialElementRotations.clear(),this.initialElementStates.clear(),H.forEach(Z=>{this.initialElementRotations.set(Z.id,Z.rotation||0),this.initialElementStates.set(Z.id,{...Z})}),this.apiService.setBoundingBox(null)}checkElementInSelectionBox(l,M){const A=(0,I.lE)(l.type).getBounds(l);return(0,d.n4)(A,M)}getResizeDirection(l){const M=l.split("_")[2];let C=P.OP.N;Object.values(P.OP).includes(M)&&(C=M);const A=this.apiService.getSelectedElements();return A.length>0?(0,d.TP)(C,A[0].rotation||0):C}}class n extends s{constructor(){super(...arguments),this.type=e.p.Text,this.baseCursor=O.x.Text,this.textElement=null,this.textInput=null}get isEditing(){return null!==this.textInput}handlePointerDown(l){if(!this.active)return;if(this.textInput)return void this.finishTextInput();const M=(0,R.e)(l,this.apiService.getElements());if(M&&M.type===b.R.Text)return this.textElement=M,void this.createTextInput(M.x,M.y,M.text);const{x:C,y:A}=this.getPointerPosition(l),H=A+.8*(this.whiteboardConfig.fontSize||16);this.textElement=this.createTextElement(C,H),this.createTextInput(C,H,"",l)}handlePointerUp(){this.textInput&&(this.textInput.addEventListener("blur",()=>this.finishTextInput()),this.textInput.focus())}createTextElement(l,M){const{snapToGrid:C,gridSize:A}=this.whiteboardConfig;return(0,I.n)(b.R.Text,{x:C?(0,z.Ej)(l,A):l,y:C?(0,z.Ej)(M,A):M,text:"",style:this.getElementStyle(),zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId())}createTextInput(l,M,C="",A){const Z=.8*(this.textElement?.style?.fontSize||16),j=this.apiService.getCanvas().parentElement;if(!j)return void console.error("Cannot find whiteboard container");const $=j.getBoundingClientRect();let q,le;if(A)q=A.clientX-$.left-1,le=A.clientY-$.top-1;else{const ee=this.whiteboardConfig;q=ee.canvasX+(l+ee.x)*ee.zoom-1,le=ee.canvasY+(M+ee.y)*ee.zoom-1-Z*ee.zoom}const V=document.createElement("textarea");V.id="whiteboard-text-input",V.setAttribute("aria-label","Text input"),V.style.position="absolute",V.style.left=`${q}px`,V.style.top=`${le}px`,V.style.fontSize=`${this.textElement?.style?.fontSize||16}px`,V.style.fontFamily=this.textElement?.style?.fontFamily||"Arial",V.style.color=this.textElement?.style?.color||"#000000",V.style.fontWeight=this.textElement?.style?.fontWeight||"normal",V.style.fontStyle=this.textElement?.style?.fontStyle||"normal",V.style.border="1px dashed #000",V.style.background="white",V.style.outline="none",V.style.resize="none",V.style.overflow="hidden",V.style.lineHeight="1.2",V.style.whiteSpace="pre-wrap",V.style.margin="0",V.style.padding="2px",V.style.boxSizing="border-box",V.style.zIndex="10000",V.style.pointerEvents="auto",V.value=C,V.rows=1,V.addEventListener("input",()=>this.handleTextInput(V)),V.addEventListener("keydown",ee=>{(ee.key===p._.ENTER&&ee.ctrlKey||ee.key===p._.ESCAPE)&&(ee.preventDefault(),this.finishTextInput())}),j?j.appendChild(V):document.body.appendChild(V),V.focus(),this.textInput=V,this.handleTextInput(V)}handleTextInput(l){const M=l.value.split("\n"),C=M.reduce((A,N)=>Math.max(A,N.length),0);l.style.width=`${Math.max(C,10)}ch`,l.rows=Math.max(M.length,1),this.textElement&&(this.textElement.text=l.value,this.apiService.updateElements([this.textElement]))}finishTextInput(){if(this.textInput&&this.textElement){this.textInput.value.trim()?this.apiService.elementExists(this.textElement.id)||(this.apiService.addElements([this.textElement]),this.textElement.selectAfterDraw&&this.apiService.selectElements([this.textElement.id])):this.apiService.removeElements([this.textElement]);try{this.textInput.parentElement&&this.textInput.parentElement.removeChild(this.textInput)}catch{}this.textInput=null,this.textElement=null}}getElementStyle(){return{color:this.whiteboardConfig.strokeColor,fontSize:this.whiteboardConfig.fontSize,fontFamily:this.whiteboardConfig.fontFamily,lineJoin:this.whiteboardConfig.lineJoin,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,strokeColor:this.whiteboardConfig.fill,strokeWidth:0}}}var S=x(4438);let T=(()=>{class _{createTool(M,C){switch(M){case e.p.Arrow:return new m(C);case e.p.Ellipse:return new c(C);case e.p.Eraser:return new i(C);case e.p.Hand:return new h(C);case e.p.Image:return new o(C);case e.p.Line:return new E(C);case e.p.Pen:return new a(C);case e.p.Rectangle:return new D(C);case e.p.Select:return new g(C);case e.p.Text:return new n(C);default:throw new Error(`Unknown tool type: ${M}`)}}static{this.\u0275fac=function(C){return new(C||_)}}static{this.\u0275prov=S.jDH({token:_,factory:_.\u0275fac,providedIn:"root"})}}return _})()},3312:(Q,Y,x)=>{x.d(Y,{H:()=>u});var I=x(4438),e=x(9989),b=x(872);const z={[b.p.Hand]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M402-40q-30 0-56-13.5T303-92L48-465l24-23q19-19 45-22t47 12l116 81v-383q0-17 11.5-28.5T320-840q17 0 28.5 11.5T360-800v537L212-367l157 229q5 8 14 13t19 5h278q33 0 56.5-23.5T760-200v-560q0-17 11.5-28.5T800-800q17 0 28.5 11.5T840-760v560q0 66-47 113T680-40H402Zm38-440v-400q0-17 11.5-28.5T480-920q17 0 28.5 11.5T520-880v400h-80Zm160 0v-360q0-17 11.5-28.5T640-880q17 0 28.5 11.5T680-840v360h-80ZM486-300Z"/></svg>',[b.p.Select]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M516-120 402-402 120-516v-56l720-268-268 720h-56Zm26-148 162-436-436 162 196 78 78 196Zm-78-196Z"/></svg>',[b.p.Pen]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"/></svg>',[b.p.Line]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M199-199q-9-9-9-21t9-21l520-520q9-9 21-9t21 9q9 9 9 21t-9 21L241-199q-9 9-21 9t-21-9Z"/></svg>',[b.p.Arrow]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="m560-240-56-58 142-142H160v-80h486L504-662l56-58 240 240-240 240Z"/></svg>',[b.p.Rectangle]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M200-200q-33 0-56.5-23.5T120-280v-400q0-33 23.5-56.5T200-760h560q33 0 56.5 23.5T840-680v400q0 33-23.5 56.5T760-200H200Zm0-80h560v-400H200v400Zm0 0v-400 400Z"/></svg>',[b.p.Ellipse]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm0-80q134 0 227-93t93-227q0-134-93-227t-227-93q-134 0-227 93t-93 227q0 134 93 227t227 93Zm0-320Z"/></svg>',[b.p.Text]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M280-160v-520H80v-120h520v120H400v520H280Zm360 0v-320H520v-120h360v120H760v320H640Z"/></svg>',[b.p.Image]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M480-480ZM200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h320v80H200v560h560v-320h80v320q0 33-23.5 56.5T760-120H200Zm40-160h480L570-480 450-320l-90-120-120 160Zm440-320v-80h-80v-80h80v-80h80v80h80v80h-80v80h-80Z"/></svg>',[b.p.Eraser]:'<svg xmlns="http://www.w3.org/2000/svg" height="24px" viewBox="0 -960 960 960" width="24px" fill="currentColor"><path d="M690-240h190v80H610l80-80Zm-500 80-85-85q-23-23-23.5-57t22.5-58l440-456q23-24 56.5-24t56.5 23l199 199q23 23 23 57t-23 57L520-160H190Zm296-80 314-322-198-198-442 456 64 64h262Zm-6-240Z"/></svg>'};var O=x(6084),s=x(162),m=x(3452);const c=[{id:"hand",type:b.p.Hand,name:"Hand",description:"Pan and navigate the canvas",icon:z[b.p.Hand],enabled:!0,order:0},{id:"select",type:b.p.Select,name:"Select",description:"Select and manipulate elements",icon:z[b.p.Select],enabled:!0,order:1},{id:"pen",type:b.p.Pen,name:"Pen",description:"Draw freehand lines",icon:z[b.p.Pen],enabled:!0,order:2},{id:"line",type:b.p.Line,name:"Line",description:"Draw straight lines",icon:z[b.p.Line],enabled:!0,order:3},{id:"arrow",type:b.p.Arrow,name:"Arrow",description:"Draw arrow lines",icon:z[b.p.Arrow],enabled:!0,order:4},{id:"rectangle",type:b.p.Rectangle,name:"Rectangle",description:"Draw rectangles",icon:z[b.p.Rectangle],enabled:!0,order:5},{id:"ellipse",type:b.p.Ellipse,name:"Ellipse",description:"Draw ellipses and circles",icon:z[b.p.Ellipse],enabled:!0,order:6},{id:"text",type:b.p.Text,name:"Text",description:"Add text annotations",icon:z[b.p.Text],enabled:!0,order:7},{id:"image",type:b.p.Image,name:"Image",description:"Add images",icon:z[b.p.Image],enabled:!0,order:8},{id:"eraser",type:b.p.Eraser,name:"Eraser",description:"Remove elements",icon:z[b.p.Eraser],enabled:!0,order:9}];let u=(()=>{class i{constructor(){this.eventBusService=(0,I.WQX)(e.W),this.toolFactory=(0,I.WQX)(m.r),this._apiServiceCache=(0,I.vPA)(void 0),this._selectedTool=(0,I.vPA)(b.p.Pen),this._toolConfigs=(0,I.vPA)(new Map),this._currentToolInstance=(0,I.vPA)(null),this._cursor=(0,I.vPA)(O.x.Default),this._temporaryOverrides=(0,I.vPA)([]),this.toolInstanceCache=new Map,this.selectedTool=this._selectedTool.asReadonly(),this.currentTool=this._currentToolInstance.asReadonly(),this.cursor=this._cursor.asReadonly(),this.temporaryOverrides=this._temporaryOverrides.asReadonly(),this.effectiveTool=(0,I.EWP)(()=>{const o=this._temporaryOverrides();return o.length>0?o[o.length-1].tool:this._selectedTool()}),this.availableTools=(0,I.EWP)(()=>{const o=this._toolConfigs();return Array.from(o.values()).filter(E=>E.enabled).sort((E,w)=>(E.order??999)-(w.order??999))}),this.initializeDefaultTools(),(0,I.QZP)(()=>{const o=this.effectiveTool();this._apiServiceCache()&&this.updateCurrentToolInstance(o)},{allowSignalWrites:!0}),(0,I.QZP)(()=>{this._currentToolInstance()&&this.updateCursorForActiveTool()},{allowSignalWrites:!0})}initializeDefaultTools(){const o=new Map;c.forEach(E=>{o.set(E.id,{...E})}),this._toolConfigs.set(o)}updateCurrentToolInstance(o){const E=this._currentToolInstance();E&&E.type!==o&&E.deactivate();const w=this.getToolInstance(o);w.activate(),this._currentToolInstance.set(w),this.hasTemporaryOverride()||this.eventBusService.emit(s.w.ToolChange,o)}updateCursorForActiveTool(){const o=this._currentToolInstance();this._cursor.set(o&&"baseCursor"in o?o.baseCursor:O.x.Default)}getActiveToolType(){return this.effectiveTool()}getActiveToolInstance(){const o=this._currentToolInstance();if(!o)throw new Error("No active tool instance found.");return o}setActiveTool(o){this._selectedTool()!==o&&this._selectedTool.set(o)}isToolActive(o){return this.effectiveTool()===o}getToolInstance(o){if(!Array.from(this._toolConfigs().values()).some(a=>a.type===o))throw new Error(`Tool type '${o}' is not registered.`);if(!this.toolInstanceCache.has(o)){const a=this._apiServiceCache();if(!a)throw new Error("ApiService not set. Call setApiService() first.");const D=this.toolFactory.createTool(o,a);this.toolInstanceCache.set(o,D)}const w=this.toolInstanceCache.get(o);if(!w)throw new Error(`Failed to create or retrieve tool instance for type: ${o}`);return w}getRegisteredToolTypes(){return Array.from(this._toolConfigs().values()).map(o=>o.type).filter((o,E,w)=>w.indexOf(o)===E)}isToolRegistered(o){return Array.from(this._toolConfigs().values()).some(E=>E.type===o)}resetToDefaultTool(){this.setActiveTool(b.p.Pen)}registerTool(o){const E=this._toolConfigs(),w=new Map(E);w.set(o.id,{...o}),this._toolConfigs.set(w)}registerTools(o){const E=this._toolConfigs(),w=new Map(E);o.forEach(a=>{w.set(a.id,{...a})}),this._toolConfigs.set(w)}unregisterTool(o){const E=this._toolConfigs();if(!E.has(o))return!1;const w=E.get(o),a=new Map(E);return a.delete(o),this._toolConfigs.set(a),this._selectedTool()===w?.type&&this.resetToDefaultTool(),!0}getToolConfig(o){return this._toolConfigs().get(o)}getToolConfigs(){return Array.from(this._toolConfigs().values())}setToolEnabled(o,E){const w=this.getToolConfig(o);return!!w&&(this.registerTool({...w,enabled:E}),!E&&this._selectedTool()===w.type&&this.resetToDefaultTool(),!0)}setToolEnabledByType(o,E){const w=Array.from(this._toolConfigs().values()).find(a=>a.type===o);return!!w&&this.setToolEnabled(w.id,E)}setEnabledTools(o){const E=new Set(o),w=this._toolConfigs(),a=new Map;w.forEach((D,p)=>{a.set(p,{...D,enabled:E.has(D.type)})}),this._toolConfigs.set(a),E.has(this._selectedTool())||this.setActiveTool(o[0]||b.p.Pen)}pushTemporaryTool(o,E=`temp-${Date.now()}`){if(this._temporaryOverrides().some(D=>D.reason===E))return;const a={tool:o,reason:E,timestamp:Date.now()};this._temporaryOverrides.update(D=>[...D,a])}popTemporaryTool(o){const E=this._temporaryOverrides();if(0===E.length)return;let w;w=o?E.filter(a=>a.reason!==o):E.slice(0,-1),w.length!==E.length&&this._temporaryOverrides.set(w)}clearTemporaryTools(){this._temporaryOverrides.set([])}hasTemporaryOverride(){return this._temporaryOverrides().length>0}setCursor(o){this._cursor.set(o)}resetCursor(){this.updateCursorForActiveTool()}destroy(){const o=this._currentToolInstance();o&&o.deactivate(),this.toolInstanceCache.clear(),this.clearTemporaryTools()}setApiService(o){this._apiServiceCache.set(o)}static{this.\u0275fac=function(E){return new(E||i)}}static{this.\u0275prov=I.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},6084:(Q,Y,x)=>{x.d(Y,{x:()=>I});var I=function(e){return e.Default="default",e.Pointer="pointer",e.None="none",e.ContextMenu="context-menu",e.Help="help",e.Progress="progress",e.Wait="wait",e.Crosshair="crosshair",e.Cell="cell",e.Text="text",e.VerticalText="vertical-text",e.Grab="grab",e.Grabbing="grabbing",e.Move="move",e.AllScroll="all-scroll",e.NResize="n-resize",e.SResize="s-resize",e.EResize="e-resize",e.WResize="w-resize",e.NEResize="ne-resize",e.NWResize="nw-resize",e.SEResize="se-resize",e.SWResize="sw-resize",e.EWResize="ew-resize",e.NSResize="ns-resize",e.NESWResize="nesw-resize",e.NWSEResize="nwse-resize",e.Copy="copy",e.Alias="alias",e.NoDrop="no-drop",e.NotAllowed="not-allowed",e.ZoomIn="zoom-in",e.ZoomOut="zoom-out",e.ColResize="col-resize",e.RowResize="row-resize",e.Pencil="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggZmlsbD0iIzAwMCIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjAuNSIgZD0ibTE2LjMxOCA2LjExLTMuNTM2LTMuNTM1IDEuNDE1LTEuNDE0Yy42My0uNjMgMi4wNzMtLjc1NSAyLjgyOCAwbC43MDcuNzA3Yy43NTUuNzU1LjYzMSAyLjE5OCAwIDIuODI5TDE2LjMxOCA2LjExem0tMS40MTQgMS40MTUtOS45IDkuOS00LjU5NiAxLjA2IDEuMDYtNC41OTYgOS45LTkuOSAzLjUzNiAzLjUzNnoiLz48L3N2Zz4=') 0 24, auto",e.Brush="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNNyAxNGMtMS42NiAwLTMgMS4zNC0zIDMgMCAxLjMxLTEuMTYgMi0yIDIgLjkyIDEuMjIgMi40OSAyIDQgMiAyLjIxIDAgNC0xLjc5IDQtNCAwLTEuNjYtMS4zNC0zLTMtM3ptMTMuNzEtOS4zN2wtMS4zNC0xLjM0YS45OTYuOTk2IDAgMCAwLTEuNDEgMEw5IDEyLjI1IDExLjc1IDE1bDguOTYtOC45NmEuOTk2Ljk5NiAwIDAgMCAwLTEuNDF6Ii8+PC9zdmc+') 0 24, auto",e.Eraser="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTYuMjQgMy41Nmw0Ljk1IDQuOTRjLjc4Ljc5Ljc4IDIuMDUgMCAyLjg0TDEyIDIwLjUzYTQuMDA4IDQuMDA4IDAgMCAxLTUuNjYgMEwyLjgxIDE3Yy0uNzgtLjc5LS43OC0yLjA1IDAtMi44NGwxMC42LTEwLjZjLjc5LS43OCAyLjA1LS43OCAyLjgzIDBNNC4yMiAxNS41OGwzLjU0IDMuNTNjLjc4Ljc5IDIuMDQuNzkgMi44MyAwbDMuNTMtMy41My00Ljk1LTQuOTUtNC45NSA0Ljk1eiIvPjwvc3ZnPg==') 12 12, auto",e.Highlighter="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSI0IiB5PSIxMCIgd2lkdGg9IjE2IiBoZWlnaHQ9IjgiIGZpbGw9IiMwMDAiIG9wYWNpdHk9IjAuNiIgc3Ryb2tlPSIjZmZmIiBzdHJva2Utd2lkdGg9IjAuNSIvPjxwYXRoIGQ9Ik0yIDIwaDIwdjNIMnoiIGZpbGw9IiMwMDAiIG9wYWNpdHk9IjAuOCIvPjwvc3ZnPg==') 12 24, auto",e.TextCursor="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNNSA0djNoNS41djEyaDNWN0gxOVY0SDV6Ii8+PC9zdmc+') 12 0, text",e.Shape="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iMiIgZmlsbD0iIzAwMCIvPjwvc3ZnPg==') 12 12, crosshair",e.Arrow="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMyAzbDcuMDcgMTYuOTcgMi41MS03LjM5IDcuMzktMi41MUwzIDN6Ii8+PC9zdmc+') 0 0, default",e.Hand="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTMgNnY1aDNMMTIgMTdsLTQtNmgzVjZjMC0xLjEuOS0yIDItMnMyIC5IDIgMnptOCAwdjVoLTJWNmMwLTIuMjEtMS43OS00LTQtNGgtMkMxMC43OSAyIDkgMy43OSA5IDZ2NUg3VjZjMC0zLjMxIDIuNjktNiA2LTZoMmMzLjMxIDAgNiAyLjY5IDYgNnoiLz48L3N2Zz4=') 12 12, grab",e.Rotate="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTIgNnYzbDQtNC00LTR2M2MtNC40MiAwLTggMy41OC04IDggMCAxLjU3LjQ2IDMuMDMgMS4yNCA0LjI2TDYuNyAxNC44Yy0uNDUtLjgzLS43LTEuNzktLjctMi44IDAtMy4zMSAyLjY5LTYgNi02em02Ljc2IDEuNzRMMTcuMyA5LjJjLjQ0Ljg0LjcgMS43OS43IDIuOCAwIDMuMzEtMi42OSA2LTYgNnYtM2wtNCA0IDQgNHYtM2M0LjQyIDAgOC0zLjU4IDgtOCAwLTEuNTctLjQ2LTMuMDMtMS4yNC00LjI2eiIvPjwvc3ZnPg==') 12 12, grab",e.Eyedropper="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMjAuNzEgNS42M2wtMi4zNC0yLjM0Yy0uMzktLjM5LTEuMDItLjM5LTEuNDEgMGwtMy4xMiAzLjEyLTEuOTMtMS45MS0xLjQxIDEuNDEgMS40MiAxLjQyTDMgMTYuMjVWMjFoNC43NWw4LjkyLTguOTIgMS40MiAxLjQyIDEuNDEtMS40MS0xLjkyLTEuOTIgMy4xMy0zLjEyYy4zOS0uMzkuMzktMS4wMiAwLTEuNDJ6Ii8+PC9zdmc+') 0 24, crosshair",e.LaserPointer="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI0IiBmaWxsPSIjMDAwIiBvcGFjaXR5PSIwLjgiLz48Y2lyY2xlIGN4PSIxMiIgY3k9IjEyIiByPSI2IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMSIgb3BhY2l0eT0iMC41Ii8+PGNpcmNsZSBjeD0iMTIiIGN5PSIxMiIgcj0iOCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSIjMDAwIiBzdHJva2Utd2lkdGg9IjAuNSIgb3BhY2l0eT0iMC4zIi8+PC9zdmc+') 12 12, none",e.Image="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cmVjdCB4PSIzIiB5PSIzIiB3aWR0aD0iMTgiIGhlaWdodD0iMTgiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzAwMCIgc3Ryb2tlLXdpZHRoPSIyIi8+PGNpcmNsZSBjeD0iOC41IiBjeT0iOC41IiByPSIxLjUiIGZpbGw9IiMwMDAiLz48cG9seWxpbmUgcG9pbnRzPSIyMSAxNSAxNSA5IDkgMTUgNiAxMiAzIDE1IiBmaWxsPSJub25lIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPjwvc3ZnPg==') 12 12, crosshair",e.Dot="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyMCIgaGVpZ2h0PSIyMCIgdmlld0JveD0iMCAwIDIwIDIwIj48Y2lyY2xlIGN4PSIxMCIgY3k9IjEwIiByPSIyIiBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMSIvPjwvc3ZnPg==') 10 10, crosshair",e.Plus="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48cGF0aCBmaWxsPSIjMDAwIiBzdHJva2U9IiNmZmYiIHN0cm9rZS13aWR0aD0iMC41IiBkPSJNMTkgMTNoLTZ2NmgtMnYtNkg1di0yaDZWNWgydjZoNnYyeiIvPjwvc3ZnPg==') 12 12, crosshair",e.Line="url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0Ij48bGluZSB4MT0iMyIgeTE9IjIxIiB4Mj0iMjEiIHkyPSIzIiBzdHJva2U9IiMwMDAiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIi8+PGNpcmNsZSBjeD0iMyIgY3k9IjIxIiByPSIyIiBmaWxsPSIjMDAwIi8+PGNpcmNsZSBjeD0iMjEiIGN5PSIzIiByPSIyIiBmaWxsPSIjMDAwIi8+PC9zdmc+') 12 12, crosshair",e}(I||{})},2262:(Q,Y,x)=>{x.d(Y,{R:()=>I});var I=function(e){return e.Pen="pen",e.Rectangle="rectangle",e.Ellipse="ellipse",e.Line="line",e.Arrow="arrow",e.Text="text",e.Image="image",e}(I||{})},162:(Q,Y,x)=>{x.d(Y,{w:()=>I});var I=function(e){return e.Ready="ready",e.Destroyed="destroyed",e.DrawStart="drawStart",e.Drawing="drawing",e.DrawEnd="drawEnd",e.ElementsAdded="elementsAdded",e.ElementsUpdated="elementsUpdated",e.ElementsSelected="elementsSelected",e.ElementsRemoved="elementsRemoved",e.ElementDoubleClicked="elementDoubleClicked",e.Undo="undo",e.Redo="redo",e.Clear="clear",e.DataChange="dataChange",e.Save="save",e.ImageAdded="imageAdded",e.ToolChange="toolChange",e.ConfigChange="configChange",e.ZoomChange="zoomChange",e}(I||{})},4289:(Q,Y,x)=>{x.d(Y,{B:()=>I});const I=[{value:"normal",label:"Normal",description:"Default blending",category:"normal"},{value:"multiply",label:"Multiply",description:"Darkens by multiplying colors",category:"darken"},{value:"darken",label:"Darken",description:"Keeps darkest colors",category:"darken"},{value:"color-burn",label:"Color Burn",description:"Increases contrast and darkens",category:"darken"},{value:"screen",label:"Screen",description:"Lightens by inverting and multiplying",category:"lighten"},{value:"lighten",label:"Lighten",description:"Keeps lightest colors",category:"lighten"},{value:"color-dodge",label:"Color Dodge",description:"Brightens and reduces contrast",category:"lighten"},{value:"overlay",label:"Overlay",description:"Combines multiply and screen",category:"contrast"},{value:"soft-light",label:"Soft Light",description:"Subtle version of overlay",category:"contrast"},{value:"hard-light",label:"Hard Light",description:"Intense version of overlay",category:"contrast"},{value:"difference",label:"Difference",description:"Subtracts colors",category:"contrast"},{value:"exclusion",label:"Exclusion",description:"Similar to difference but less contrast",category:"contrast"},{value:"hue",label:"Hue",description:"Uses hue of top layer",category:"component"},{value:"saturation",label:"Saturation",description:"Uses saturation of top layer",category:"component"},{value:"color",label:"Color",description:"Uses hue and saturation of top layer",category:"component"},{value:"luminosity",label:"Luminosity",description:"Uses luminosity of top layer",category:"component"}]},3265:(Q,Y,x)=>{x.d(Y,{Nn:()=>D,Of:()=>b,mY:()=>e});var I=x(6078),e=function(p){return p.Pen="pen",p.Marker="marker",p.Highlighter="highlighter",p.Brush="brush",p.Pencil="pencil",p}(e||{}),b=function(p){return p.ExtraFine="extra-fine",p.Fine="fine",p.Medium="medium",p.Thick="thick",p.ExtraThick="extra-thick",p}(b||{});const z={size:3,thinning:.8,smoothing:.9,streamline:.8,simulatePressure:!0,easing:p=>p<.5?2*p*p:1-Math.pow(-2*p+2,2)/2,start:{cap:!0,taper:.5},end:{cap:!0,taper:.6}},O={size:6,thinning:0,smoothing:.2,streamline:.3,simulatePressure:!1,easing:()=>1,start:{cap:!1,taper:!1},end:{cap:!1,taper:!1}},m={size:14,thinning:.85,smoothing:.95,streamline:.9,simulatePressure:!0,easing:p=>Math.pow(p,1.8),start:{cap:!0,taper:.7},end:{cap:!0,taper:.8}},c={size:1.5,thinning:.6,smoothing:.15,streamline:.1,simulatePressure:!0,easing:p=>Math.min(1,.7*p+.3+.1*Math.sin(20*p)),start:{cap:!0,taper:.1},end:{cap:!0,taper:.2}},u={[b.ExtraFine]:1,[b.Fine]:3,[b.Medium]:6,[b.Thick]:12,[b.ExtraThick]:20},i={[b.ExtraFine]:.5,[b.Fine]:1.5,[b.Medium]:3,[b.Thick]:6,[b.ExtraThick]:10},h={"pen-fine":{id:"pen-fine",name:"Fine Pen",type:e.Pen,thickness:b.Fine,strokeColor:"#000000",strokeWidth:i[b.Fine],lineCap:I.$3.Round,lineJoin:I.pP.Round,strokeOptions:{...z,size:u[b.Fine]},display:{description:"Smooth fine pen for detailed drawing",icon:"\u270f\ufe0f"}},"pen-medium":{id:"pen-medium",name:"Medium Pen",type:e.Pen,thickness:b.Medium,strokeColor:"#000000",strokeWidth:i[b.Medium],lineCap:I.$3.Round,lineJoin:I.pP.Round,strokeOptions:{...z,size:u[b.Medium]},display:{description:"Standard pen for general use",icon:"\u{1f58a}\ufe0f"}},"pen-thick":{id:"pen-thick",name:"Thick Pen",type:e.Pen,thickness:b.Thick,strokeColor:"#000000",strokeWidth:i[b.Thick],lineCap:I.$3.Round,lineJoin:I.pP.Round,strokeOptions:{...z,size:u[b.Thick]},display:{description:"Thick pen for bold strokes",icon:"\u{1f58d}\ufe0f"}},"marker-medium":{id:"marker-medium",name:"Medium Marker",type:e.Marker,thickness:b.Medium,strokeColor:"#2563eb",strokeWidth:i[b.Medium],lineCap:I.$3.Square,lineJoin:I.pP.Miter,strokeOptions:{...O,size:u[b.Medium]},display:{description:"Consistent marker for clean lines",icon:"\u{1f58d}\ufe0f"}},"marker-thick":{id:"marker-thick",name:"Thick Marker",type:e.Marker,thickness:b.Thick,strokeColor:"#dc2626",strokeWidth:i[b.Thick],lineCap:I.$3.Square,lineJoin:I.pP.Miter,strokeOptions:{...O,size:u[b.Thick]},display:{description:"Thick marker for emphasis",icon:"\u{1f58d}\ufe0f"}},"highlighter-medium":{id:"highlighter-medium",name:"Highlighter",type:e.Highlighter,thickness:b.Medium,strokeColor:"#fefc34",strokeWidth:i[b.ExtraThick],lineCap:I.$3.Square,lineJoin:I.pP.Miter,opacity:.4,strokeOptions:{size:18,thinning:.05,smoothing:.1,streamline:.1,simulatePressure:!1,easing:p=>p,start:{cap:!1,taper:!1},end:{cap:!1,taper:!1},size:u[b.ExtraThick]},display:{description:"Translucent highlighter for emphasis",icon:"\u{1f58d}\ufe0f"}},"brush-medium":{id:"brush-medium",name:"Paint Brush",type:e.Brush,thickness:b.Medium,strokeColor:"#059669",strokeWidth:i[b.Thick],lineCap:I.$3.Round,lineJoin:I.pP.Round,strokeOptions:{...m,size:u[b.Thick]},display:{description:"Expressive brush with pressure sensitivity",icon:"\u{1f58c}\ufe0f"}},"pencil-fine":{id:"pencil-fine",name:"Pencil",type:e.Pencil,thickness:b.Fine,strokeColor:"#374151",strokeWidth:i[b.Fine],lineCap:I.$3.Round,lineJoin:I.pP.Round,strokeOptions:{...c,size:u[b.Fine]},display:{description:"Natural pencil for sketching",icon:"\u270f\ufe0f"}}},o=Object.values(h),E={};Object.values(h).forEach(p=>{E[`${p.type}-${p.thickness}`]=p});const w=h["pen-medium"];function D(p,P=b.Medium){const R=function a(p,P){return E[`${p}-${P}`]}(p,P);return R||o.find(y=>y.type===p)||w}},872:(Q,Y,x)=>{x.d(Y,{p:()=>I});var I=function(e){return e.Hand="hand",e.Select="select",e.Pen="pen",e.Rectangle="rectangle",e.Image="image",e.Line="line",e.Arrow="arrow",e.Ellipse="ellipse",e.Text="text",e.Eraser="eraser",e}(I||{})},6078:(Q,Y,x)=>{x.d(Y,{$3:()=>b,OP:()=>O,Yu:()=>e,o8:()=>I,pP:()=>z});var I=function(s){return s.Png="png",s.Jpeg="jpeg",s.Svg="svg",s.Base64="base64",s}(I||{}),e=function(s){return s.Left="left",s.Center="center",s.Right="right",s.Top="top",s.Middle="middle",s.Bottom="bottom",s.DistributeHorizontally="distribute-horizontally",s.DistributeVertically="distribute-vertically",s}(e||{}),b=function(s){return s.Round="round",s.Butt="butt",s.Square="square",s}(b||{}),z=function(s){return s.Round="round",s.Miter="miter",s.Bevel="bevel",s.MiterClip="miter-clip",s}(z||{}),O=function(s){return s.NW="nw",s.N="n",s.NE="ne",s.E="e",s.SE="se",s.S="s",s.SW="sw",s.W="w",s}(O||{})},9820:(Q,Y,x)=>{x.d(Y,{P:()=>b});var I=x(2173);function b(z){return(0,I.lE)(z.type).getBounds(z)}},6751:(Q,Y,x)=>{x.d(Y,{e:()=>e,r:()=>b});var I=x(7879);function e(z,O){const s=b(z);if(s){if(s.id===I.Mt)return null;const m=s.getAttribute(I.Bn);return O.find(u=>u.id===m)||null}return null}function b(z){if(!z?.target)return null;let O=z.target;for(;O;){if(O.id===I.wM)return null;if(O.id.includes(I.RZ)||O.id.includes(I.YO)||O.id.includes(I.i$))return O;if(!O.parentNode)break;O=O.parentNode}return null}},2319:(Q,Y,x)=>{function I(m){if(0===m.length)throw new Error("Cannot calculate bounding box for empty points array");let c=1/0,u=1/0,i=-1/0,h=-1/0;for(const[o,E]of m)c=Math.min(c,o),u=Math.min(u,E),i=Math.max(i,o),h=Math.max(h,E);return{minX:c,minY:u,maxX:i,maxY:h,width:i-c,height:h-u}}function s(m,c,u,i){return m.minX-i<=Math.max(c.x,u.x)&&m.maxX+i>=Math.min(c.x,u.x)&&m.minY-i<=Math.max(c.y,u.y)&&m.maxY+i>=Math.min(c.y,u.y)}x.d(Y,{AJ:()=>I,DB:()=>s})},6212:(Q,Y,x)=>{function I(O,s){const{zoom:m,x:c,y:u,canvasX:i,canvasY:h,fullScreen:o}=O;return o?{x:s.x/m-c,y:s.y/m-u}:{x:(s.x-i)/m-c,y:(s.y-h)/m-u}}function e(O,s,m,c){const u=Math.PI/4,i=m-O,h=c-s,o=Math.atan2(h,i),E=Math.sqrt(i*i+h*h),w=Math.round(o/u)*u;return{x:O+E*Math.cos(w),y:s+E*Math.sin(w),a:w}}function b(O,s){return Math.round(O/s)*s}x.d(Y,{Ej:()=>b,Jt:()=>e,y1:()=>I})},6042:(Q,Y,x)=>{x.d(Y,{Em:()=>m,Qu:()=>b,TP:()=>u,ZN:()=>O,d4:()=>s,n0:()=>z,n4:()=>c});var I=x(6078);const e=1e-6;function b(i,h){return Math.atan2(h.y-i.y,h.x-i.x)*(180/Math.PI)}function z(i){return(i%=360)<0?i+360:i}function O(i,h){return Math.abs(i)>Math.abs(h)?{x:i,y:0}:{x:0,y:h}}function s(i,h,o,E){const w=o.x,a=o.y,D=E.x,p=E.y,P=(D-w)**2+(p-a)**2;if(0===P)return Math.sqrt((i-w)**2+(h-a)**2);let R=((i-w)*(D-w)+(h-a)*(p-a))/P;return R=Math.max(0,Math.min(1,R)),Math.sqrt((i-(w+R*(D-w)))**2+(h-(a+R*(p-a)))**2)}function m(i,h,o,E,w=e){const a=(g,n)=>g.x*n.y-g.y*n.x,D=(g,n)=>({x:g.x-n.x,y:g.y-n.y}),p=D(h,i),P=D(E,o),R=D(o,i),d=a(p,P),y=a(R,p);if(Math.abs(d)<w){if(Math.abs(y)>=w)return!1;const g=p.x*p.x+p.y*p.y,n=(R.x*p.x+R.y*p.y)/g,S=D(E,i),T=(S.x*p.x+S.y*p.y)/g;return n>=0&&n<=1||T>=0&&T<=1||n<0&&T>1||n>1&&T<0}const W=y/d,L=a(R,P)/d;return W>=0&&W<=1&&L>=0&&L<=1}function c(i,h){return i.minX<=h.x+h.width&&i.maxX>=h.x&&i.minY<=h.y+h.height&&i.maxY>=h.y}function u(i,h){const o=Math.round(z(h)/45)%8,E=Object.values(I.OP),a=(E.indexOf(i)+o)%8;return E[a]}},2500:(Q,Y,x)=>{x.d(Y,{L:()=>b,U:()=>z});var I=x(9820);function b(O){if(0===O.length)return null;const s=O.map(h=>function e(O){const s=(0,I.P)(O);if(!O.rotation||0===O.rotation)return s;const m=s.width/2,c=s.height/2,u=[{x:0,y:0},{x:s.width,y:0},{x:s.width,y:s.height},{x:0,y:s.height}],i=(O.rotation||0)*(Math.PI/180),h=Math.cos(i),o=Math.sin(i),w=u.map(y=>{const W=y.x-m,L=y.y-c;return{x:W*h-L*o+m,y:W*o+L*h+c}}).map(y=>({x:y.x+O.x,y:y.y+O.y})),a=w.map(y=>y.x),D=w.map(y=>y.y),p=Math.min(...a),P=Math.min(...D),R=Math.max(...a),d=Math.max(...D);return{minX:p,minY:P,maxX:R,maxY:d,width:R-p,height:d-P}}(h)),m=Math.min(...s.map(h=>h.minX)),c=Math.min(...s.map(h=>h.minY)),u=Math.max(...s.map(h=>h.maxX)),i=Math.max(...s.map(h=>h.maxY));return{minX:m,minY:c,maxX:u,maxY:i,width:u-m,height:i-c}}function z(O,s,m){const c=m*(Math.PI/180),u=Math.cos(c),i=Math.sin(c),h=O.x-s.x,o=O.y-s.y;return{x:s.x+h*u-o*i,y:s.y+h*i+o*u}}},710:(Q,Y,x)=>{x.d(Y,{l:()=>z});var I=x(4438),e=x(7785),b=x(9989);let z=(()=>{class O{constructor(m,c){this.configService=m,this.eventBusService=c,this.DEFAULT_PAN_BOUNDS={x:-1/0,y:-1/0,width:1/0,height:1/0},this.panBounds=this.DEFAULT_PAN_BOUNDS}getConfig(){return this.configService.getConfig()}pan(m,c){const u=this.getConfig(),{x:i,y:h}=u,w=this.constrainPanPosition(i+m,h+c);this.setCanvasPosition(w.x,w.y)}panTo(m,c){const u=this.constrainPanPosition(m,c);this.setCanvasPosition(u.x,u.y)}setCanvasPosition(m,c){this.configService.updateConfig({x:m,y:c})}getPanPosition(){const m=this.getConfig();return{x:m.x,y:m.y}}resetPan(){this.setCanvasPosition(0,0)}setPanBounds(m){this.panBounds=m}resetPanBounds(){this.panBounds=this.DEFAULT_PAN_BOUNDS}getPanBounds(){return{...this.panBounds}}constrainPanPosition(m,c){return this.panBounds===this.DEFAULT_PAN_BOUNDS?{x:m,y:c}:{x:Math.max(this.panBounds.x,Math.min(this.panBounds.x+this.panBounds.width,m)),y:Math.max(this.panBounds.y,Math.min(this.panBounds.y+this.panBounds.height,c))}}isPositionWithinBounds(m,c){return this.panBounds===this.DEFAULT_PAN_BOUNDS||m>=this.panBounds.x&&m<=this.panBounds.x+this.panBounds.width&&c>=this.panBounds.y&&c<=this.panBounds.y+this.panBounds.height}getDistanceToBounds(){const{x:m,y:c}=this.getPanPosition();return this.panBounds===this.DEFAULT_PAN_BOUNDS?{left:1/0,top:1/0,right:1/0,bottom:1/0}:{left:m-this.panBounds.x,top:c-this.panBounds.y,right:this.panBounds.x+this.panBounds.width-m,bottom:this.panBounds.y+this.panBounds.height-c}}panWithEasing(m,c){this.panTo(m,c)}panWithMomentum(m,c){this.pan(m,c)}validatePanOperation(m,c,u,i){return this.isPositionWithinBounds(m+u,c+i)}applyPanAcceleration(m,c){return{dx:m,dy:c}}onPanChange(m,c){}static{this.\u0275fac=function(c){return new(c||O)(I.KVO(e.w),I.KVO(b.W))}}static{this.\u0275prov=I.jDH({token:O,factory:O.\u0275fac,providedIn:"root"})}}return O})()},4764:(Q,Y,x)=>{x.d(Y,{T:()=>u});var I=x(4438),e=x(7785),b=x(7879),z=x(162),O=x(525),s=x(6255),m=x(1152),c=x(9989);let u=(()=>{class i{constructor(){this.canvasService=(0,I.WQX)(O.W),this.elementsService=(0,I.WQX)(s.L),this.selectionService=(0,I.WQX)(m.A),this.configService=(0,I.WQX)(e.w),this.eventBusService=(0,I.WQX)(c.W),this.DEFAULT_FIT_MARGIN=.9,this.zoomSubscription=this.eventBusService.on(z.w.ZoomChange).subscribe(()=>{const{center:o,fullScreen:E,zoom:w}=this.getConfig();o&&!E&&this.centerCanvas(w)})}ngOnDestroy(){this.zoomSubscription?.unsubscribe()}emitZoomChangeEvent(){const{zoom:o}=this.getConfig();this.eventBusService.emit(z.w.ZoomChange,{zoom:o})}getConfig(){return this.configService.getConfig()}centerCanvas(o){const{canvasWidth:E,canvasHeight:w}=this.getConfig(),a=this.canvasService.getContainerDimensions(),D=(a.width-E*o)/2,p=(a.height-w*o)/2;return this.configService.updateConfig({canvasX:D,canvasY:p},!1),{x:D,y:p}}zoom(o,E=!0,w=300){if(o<=0)return;const a=Math.round(100*this.clampZoom(o))/100;E?this.animateToTarget(a,w):this.setInstant(a)}zoomIn(o=!0,E=300){const{zoom:w}=this.getConfig(),a=Math.round(100*(w+b.bL))/100;a<=b.nD&&this.zoom(a,o,E)}zoomOut(o=!0,E=300){const{zoom:w}=this.getConfig(),a=Math.round(100*(w-b.bL))/100;a>=b.DQ&&this.zoom(a,o,E)}resetZoom(o=!0,E=300){o?this.animateToTarget(b.aM,E):this.setInstant(b.aM)}getZoomLevel(){return this.getConfig().zoom}getZoomPercentage(){return Math.round(100*this.getConfig().zoom)}zoomToFit(o=this.DEFAULT_FIT_MARGIN,E=!0,w=300){const a=this.elementsService.getElements();0!==a.length?this.zoomToElements(a,o,E,w):this.resetZoom(E,w)}zoomToSelection(o=this.DEFAULT_FIT_MARGIN,E=!0,w=300){const a=this.selectionService.getSelectedElements();0!==a.length&&this.zoomToElements(a,o,E,w)}zoomToElements(o,E=this.DEFAULT_FIT_MARGIN,w=!0,a=300){if(0===o.length)return;const D=this.elementsService.calculateElementsBounds(o);if(!D)return;const{fullScreen:p}=this.getConfig(),P=p?this.canvasService.getContainerDimensions():this.canvasService.getCanvasDimensions(),y=Math.min(P.width*E/D.width,P.height*E/D.height);w?this.animateToTarget(y,a):this.setInstant(y)}zoomToArea(o,E,w,a,D=this.DEFAULT_FIT_MARGIN,p=!0,P=300){const R=this.canvasService.getCanvasDimensions(),W=Math.min(R.width*D/w,R.height*D/a);p?this.animateToTarget(W,P):this.setInstant(W)}getOptimalZoom(o,E,w=this.DEFAULT_FIT_MARGIN){const a=this.canvasService.getCanvasDimensions();return this.clampZoom(Math.min(a.width/o,a.height/E)*w)}clampZoom(o){return Math.max(b.DQ,Math.min(b.nD,o))}isValidZoom(o){return o>=b.DQ&&o<=b.nD}getZoomLimits(){return{min:b.DQ,max:b.nD}}easeInOutCubic(o){return o<.5?4*o*o*o:1-Math.pow(-2*o+2,3)/2}setInstant(o){const{fullScreen:E,center:w}=this.getConfig(),a=this.clampZoom(o);!E&&w&&this.centerCanvas(a),this.configService.updateConfig({zoom:a}),this.emitZoomChangeEvent()}animateToTarget(o,E=300){const{zoom:w,fullScreen:a,center:D}=this.getConfig(),p=this.clampZoom(o);!a&&D&&this.centerCanvas(p);const P=performance.now(),R=d=>{const W=Math.min((d-P)/E,1),L=this.easeInOutCubic(W);this.configService.updateConfig({zoom:w+(p-w)*L}),W<1?requestAnimationFrame(R):this.emitZoomChangeEvent()};requestAnimationFrame(R)}static{this.\u0275fac=function(E){return new(E||i)}}static{this.\u0275prov=I.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})()},2604:(Q,Y,x)=>{x.d(Y,{I:()=>ct});var I=x(177),e=x(4438),b=x(2107),z=x(4446),O=x(525),s=x(7785);let m=(()=>{class f{constructor(t,r,v){this.elementRef=t,this.apiService=r,this._cd=v}ngOnInit(){this.resizeObserver=new ResizeObserver(([t])=>{if(t.target===this.elementRef.nativeElement){const{fullScreen:r,center:v}=this.apiService.getConfig();setTimeout(()=>{r&&this.apiService.fullScreen(),v&&!r&&this.apiService.centerCanvas(),this._cd.detectChanges()},0)}}),this.resizeObserver.observe(this.elementRef.nativeElement)}ngOnDestroy(){this.resizeObserver?.disconnect()}static{this.\u0275fac=function(r){return new(r||f)(e.rXU(e.aKT),e.rXU(b.G),e.rXU(e.gRc))}}static{this.\u0275dir=e.FsC({type:f,selectors:[["","resizeHandler",""]],standalone:!0})}}return f})();var c=x(7879),u=x(162),i=x(872),h=x(6751),o=x(3312),E=x(9989),w=x(6078);let a=(()=>{class f{constructor(){this.configService=(0,e.WQX)(s.w),this.apiService=(0,e.WQX)(b.G)}toggleKeyboardShortcuts(){const t=this.configService.getConfig();this.configService.updateConfigValue("keyboardShortcutsEnabled",!t.keyboardShortcutsEnabled)}handleKeyDown(t){if(this.isInputFocused())return;const r=t.key.toLowerCase();this.handleKeyDownShortcuts(r,t.ctrlKey||t.metaKey,t.shiftKey,t.altKey)&&(t.preventDefault(),t.stopPropagation())}handleKeyUp(t){}isInputFocused(){const t=document.activeElement;return t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement||"true"===t?.getAttribute("contenteditable")}handleKeyDownShortcuts(t,r,v,k){if(!r&&!v&&!k){if("v"===t)return this.apiService.setActiveTool(i.p.Select),!0;if("d"===t)return this.apiService.setActiveTool(i.p.Pen),!0;if("e"===t)return this.apiService.setActiveTool(i.p.Eraser),!0;if("h"===t)return this.apiService.setActiveTool(i.p.Hand),!0;if("r"===t)return this.apiService.setActiveTool(i.p.Rectangle),!0;if("o"===t)return this.apiService.setActiveTool(i.p.Ellipse),!0;if("a"===t)return this.apiService.setActiveTool(i.p.Arrow),!0;if("l"===t)return this.apiService.setActiveTool(i.p.Line),!0;if("t"===t)return this.apiService.setActiveTool(i.p.Text),!0}return r&&"z"===t&&!v?this.apiService.undo():r&&("y"===t||"z"===t&&v)?this.apiService.redo():r&&"a"===t?(this.apiService.selectAll(),!0):t===c.aR.ESCAPE?(this.apiService.clearSelection(),!0):r&&"c"===t?(this.apiService.copyElements(),!0):r&&"x"===t?(this.apiService.cutElements(),!0):r&&"v"===t?(this.apiService.pasteElements(),!0):r&&"d"===t?(this.apiService.duplicateElements(),!0):t===c.aR.DELETE||t===c.aR.BACKSPACE?(this.apiService.deleteSelectedElements(),!0):r&&"g"===t&&!v?(this.apiService.groupSelectedElements(),!0):r&&"g"===t&&v?(this.apiService.ungroupSelectedElements(),!0):r||v||k||"]"!==t?!k||r||v||"]"!==t?!k||r||v||"["!==t?r||v||k||"["!==t?!v||r||k||"h"!==t?!v||r||k||"v"!==t?!k||r||v||"w"!==t?!k||r||v||"v"!==t?!k||r||v||"s"!==t?!k||r||v||"a"!==t?!k||r||v||"h"!==t?!k||r||v||"d"!==t?r&&"="===t||r&&"+"===t?(this.apiService.zoomIn(),!0):r&&"-"===t?(this.apiService.zoomOut(),!0):!v||r||k||"0"!==t?!v||r||k||"1"!==t?!v||r||k||"2"!==t?r&&"'"===t&&!v?(this.apiService.toggleGrid(),!0):r&&";"===t&&v?(this.apiService.toggleSnapToGrid(),!0):r||v||k||t!==c.aR.ARROW_UP&&t!==c.aR.ARROW_DOWN&&t!==c.aR.ARROW_LEFT&&t!==c.aR.ARROW_RIGHT?!(r||!v||k||t!==c.aR.ARROW_UP&&t!==c.aR.ARROW_DOWN&&t!==c.aR.ARROW_LEFT&&t!==c.aR.ARROW_RIGHT)&&(this.apiService.moveSelectedElements(t===c.aR.ARROW_RIGHT?c.AD.LARGE_STEP:t===c.aR.ARROW_LEFT?-c.AD.LARGE_STEP:0,t===c.aR.ARROW_DOWN?c.AD.LARGE_STEP:t===c.aR.ARROW_UP?-c.AD.LARGE_STEP:0),!0):(this.apiService.moveSelectedElements(t===c.aR.ARROW_RIGHT?c.AD.SMALL_STEP:t===c.aR.ARROW_LEFT?-c.AD.SMALL_STEP:0,t===c.aR.ARROW_DOWN?c.AD.SMALL_STEP:t===c.aR.ARROW_UP?-c.AD.SMALL_STEP:0),!0):(this.apiService.zoomToSelection(),!0):(this.apiService.zoomToFit(),!0):(this.apiService.resetZoom(),!0):(this.apiService.alignElements(w.Yu.Right),!0):(this.apiService.alignElements(w.Yu.Center),!0):(this.apiService.alignElements(w.Yu.Left),!0):(this.apiService.alignElements(w.Yu.Bottom),!0):(this.apiService.alignElements(w.Yu.Middle),!0):(this.apiService.alignElements(w.Yu.Top),!0):(this.apiService.flipVertical(),!0):(this.apiService.flipHorizontal(),!0):(this.apiService.sendToBack(),!0):(this.apiService.sendBackward(),!0):(this.apiService.bringForward(),!0):(this.apiService.bringToFront(),!0)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})();const D={cut:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M3.5 2.5a.5.5 0 0 0-1 0v11a.5.5 0 0 0 1 0v-11Zm9 0a.5.5 0 0 0-1 0v11a.5.5 0 0 0 1 0v-11ZM5 1a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v1h.5A1.5 1.5 0 0 1 13 3.5V12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V3.5A1.5 1.5 0 0 1 4.5 2H5V1Zm1 0v1h4V1H6Z"/></svg>',copy:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2Zm2-1a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H6ZM2 5a1 1 0 0 0-1 1v8a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1v-1h1v1a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h1v1H2Z"/></svg>',paste:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4.5 3a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h7a.5.5 0 0 0 .5-.5v-9a.5.5 0 0 0-.5-.5h-7Zm-1.5.5A1.5 1.5 0 0 1 4.5 2h7A1.5 1.5 0 0 1 13 3.5v9a1.5 1.5 0 0 1-1.5 1.5h-7A1.5 1.5 0 0 1 3 12.5v-9ZM6 1a1 1 0 0 0-1 1h6a1 1 0 0 0-1-1H6Z"/></svg>',duplicate:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M11 2a2 2 0 0 1 2 2v6.5a.5.5 0 0 1-1 0V4a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h6.5a.5.5 0 0 1 0 1H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h7Zm4.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L12.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0Z"/></svg>',"select-all":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 2A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h13a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-13ZM1 3.5a.5.5 0 0 1 .5-.5h13a.5.5 0 0 1 .5.5V13a.5.5 0 0 1-.5.5h-13A.5.5 0 0 1 1 13V3.5Z"/></svg>',delete:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5Zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6Z"/><path d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1ZM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118ZM2.5 3h11V2h-11v1Z"/></svg>',order:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 3a.5.5 0 0 1 .5.5v2a.5.5 0 0 1-.5.5H6a.5.5 0 0 1 0-1h1.5V3.5A.5.5 0 0 1 8 3Zm0 7a.5.5 0 0 1 .5.5V12H10a.5.5 0 0 1 0 1H8a.5.5 0 0 1-.5-.5v-2A.5.5 0 0 1 8 10Zm-5-3a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm5 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2Zm5 0a1 1 0 1 0 0-2 1 1 0 0 0 0 2Z"/></svg>',"bring-to-front":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M2 0a2 2 0 0 0-2 2v4a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2Zm6 9v5a2 2 0 0 0 2 2h4a2 2 0 0 0 2-2v-4a2 2 0 0 0-2-2H9Z"/></svg>',"bring-forward":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 2a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2Zm1 0v4h6V2H2Zm6 6v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1Zm6-6v4a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1Zm-1 0H9v4h5V2Z"/></svg>',"send-backward":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v4a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V2Zm1 0v4h5V2H1Zm0 6v6a1 1 0 0 1 1 1h6a1 1 0 0 1-1-1V8a1 1 0 0 1-1-1H1Zm8-6v4a1 1 0 0 1 1 1h5a1 1 0 0 1 1-1V2a1 1 0 0 1-1-1H9a1 1 0 0 1 1 1Z"/></svg>',"send-to-back":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 2a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2Zm8 7h6a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-4a2 2 0 0 1-2-2V9Z"/></svg>',align:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 0A1.5 1.5 0 0 0 0 1.5v13A1.5 1.5 0 0 0 1.5 16h13a1.5 1.5 0 0 0 1.5-1.5v-13A1.5 1.5 0 0 0 14.5 0h-13ZM1 1.5a.5.5 0 0 1 .5-.5H4v3.5H1V1.5ZM5 4.5h6V1H5v3.5ZM12 5h3v6h-3V5Zm-1 6H5V5h6v6Zm-7-6H1v6h3V5Z"/></svg>',"align-left":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 1a.5.5 0 0 0-1 0v14a.5.5 0 0 0 1 0V1Zm3 0a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V1Zm0 7a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5H5a.5.5 0 0 1-.5-.5V8Z"/></svg>',"align-center":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a.5.5 0 0 0-.5.5v13a.5.5 0 0 0 1 0v-13A.5.5 0 0 0 8 1ZM2 4.5a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-1Zm2 5a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-7a.5.5 0 0 1-.5-.5v-1Z"/></svg>',"align-right":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M14.5 1a.5.5 0 0 1 1 0v14a.5.5 0 0 1-1 0V1Zm-2.5 0a.5.5 0 0 1 .5-.5H5a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h7a.5.5 0 0 1-.5-.5V1Zm0 7a.5.5 0 0 1 .5-.5H2a.5.5 0 0 1 .5.5v3a.5.5 0 0 1-.5.5h10a.5.5 0 0 1-.5-.5V8Z"/></svg>',"align-top":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 0 1 0V1h13v.5a.5.5 0 0 0 1 0V1a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v.5Zm4 1a.5.5 0 0 1 .5.5v10a.5.5 0 0 1-1 0V3a.5.5 0 0 1 .5-.5Zm6 0a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-1 0V3a.5.5 0 0 1 .5-.5Z"/></svg>',"align-middle":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 8a.5.5 0 0 0 .5.5H15a.5.5 0 0 0 0-1H1.5A.5.5 0 0 0 1 8Zm3.5-5a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9a.5.5 0 0 1 .5-.5Zm7 0a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-1 0v-9a.5.5 0 0 1 .5-.5Z"/></svg>',"align-bottom":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 14.5a.5.5 0 0 1 1 0V15h13v-.5a.5.5 0 0 1 1 0V15a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1v-.5Zm4-1a.5.5 0 0 0 .5-.5V3a.5.5 0 0 0-1 0v10a.5.5 0 0 0 .5.5Zm6 0a.5.5 0 0 0 .5-.5V6a.5.5 0 0 0-1 0v7a.5.5 0 0 0 .5.5Z"/></svg>',distribute:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 1 1 0v13a.5.5 0 0 1-1 0v-13Zm14 0a.5.5 0 0 0-1 0v13a.5.5 0 0 0 1 0v-13ZM5 5a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H6a1 1 0 0 1-1-1V5Z"/></svg>',"distribute-horizontal":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1 1.5a.5.5 0 0 1 1 0v13a.5.5 0 0 1-1 0v-13Zm14 0a.5.5 0 0 0-1 0v13a.5.5 0 0 0 1 0v-13ZM4 5a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V5Zm5 0a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1h-1a1 1 0 0 1-1-1V5Z"/></svg>',"distribute-vertical":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 1a.5.5 0 0 0 0 1h13a.5.5 0 0 0 0-1h-13Zm0 14a.5.5 0 0 1 0-1h13a.5.5 0 0 1 0 1h-13ZM5 4a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V5a1 1 0 0 0-1-1H5Zm0 5a1 1 0 0 0-1 1v1a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-1a1 1 0 0 0-1-1H5Z"/></svg>',flip:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-1 0V.5A.5.5 0 0 1 8 0ZM2.5 2A1.5 1.5 0 0 0 1 3.5v9A1.5 1.5 0 0 0 2.5 14h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h4a.5.5 0 0 0 0-1h-4Zm7 0a.5.5 0 0 0 0 1h4a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-4a.5.5 0 0 0 0 1h4a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 2h-4Z"/></svg>',"flip-horizontal":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 0a.5.5 0 0 1 .5.5v15a.5.5 0 0 1-1 0V.5A.5.5 0 0 1 8 0ZM2.5 2A1.5 1.5 0 0 0 1 3.5v9A1.5 1.5 0 0 0 2.5 14h4a.5.5 0 0 0 0-1h-4a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h4a.5.5 0 0 0 0-1h-4Zm7 0a.5.5 0 0 0 0 1h4a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-4a.5.5 0 0 0 0 1h4a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 13.5 2h-4Z"/></svg>',"flip-vertical":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M.5 8a.5.5 0 0 0 .5.5h15a.5.5 0 0 0 0-1H1A.5.5 0 0 0 .5 8ZM2 2.5A1.5 1.5 0 0 1 3.5 1h9A1.5 1.5 0 0 1 14 2.5v4a.5.5 0 0 1-1 0v-4a.5.5 0 0 0-.5-.5h-9a.5.5 0 0 0-.5.5v4a.5.5 0 0 1-1 0v-4Zm0 11v-4a.5.5 0 0 1 1 0v4a.5.5 0 0 0 .5.5h9a.5.5 0 0 0 .5-.5v-4a.5.5 0 0 1 1 0v4a1.5 1.5 0 0 1-1.5 1.5h-9A1.5 1.5 0 0 1 2 13.5Z"/></svg>',group:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M1.5 3A1.5 1.5 0 0 0 0 4.5v7A1.5 1.5 0 0 0 1.5 13H7a.5.5 0 0 0 0-1H1.5a.5.5 0 0 1-.5-.5v-7a.5.5 0 0 1 .5-.5H7a.5.5 0 0 0 0-1H1.5ZM9 4a.5.5 0 0 0 0 1h5.5a.5.5 0 0 1 .5.5v7a.5.5 0 0 1-.5.5H9a.5.5 0 0 0 0 1h5.5a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 14.5 3H9Z"/></svg>',ungroup:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M0 1.5A1.5 1.5 0 0 1 1.5 0h5A1.5 1.5 0 0 1 8 1.5V7H1.5A1.5 1.5 0 0 1 0 5.5v-4Zm8 0V7h6.5A1.5 1.5 0 0 0 16 5.5v-4A1.5 1.5 0 0 0 14.5 0h-5A1.5 1.5 0 0 0 8 1.5Zm-8 8A1.5 1.5 0 0 1 1.5 8H8v6.5A1.5 1.5 0 0 1 6.5 16h-5A1.5 1.5 0 0 1 0 14.5v-5Zm8 0V16h6a1.5 1.5 0 0 0 1.5-1.5v-5A1.5 1.5 0 0 0 14 8H8Z"/></svg>',lock:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2zM5 8h6a1 1 0 0 1 1 1v5a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V9a1 1 0 0 1 1-1z"/></svg>',unlock:'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M11 1a2 2 0 0 0-2 2v4a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V9a2 2 0 0 1 2-2h5V3a3 3 0 0 1 6 0v4a.5.5 0 0 1-1 0V3a2 2 0 0 0-2-2zM3 8a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V9a1 1 0 0 0-1-1H3z"/></svg>',"arrow-right":'<svg viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>'};let p=(()=>{class f{constructor(t){this.apiService=t,this.contextMenuVisibleSignal=(0,e.vPA)(!1),this.contextMenuPositionSignal=(0,e.vPA)({x:0,y:0}),this.containerBoundsSignal=(0,e.vPA)(null),this.focusedItemIndexSignal=(0,e.vPA)(-1),this.focusedSubmenuIdSignal=(0,e.vPA)(null),this.allMenuItemsCache=(0,e.EWP)(()=>{const r=this.getContextMenuSections()(),v=[];return r.forEach(k=>{k.items.forEach(B=>{v.push(B),B.submenu&&this.focusedSubmenuIdSignal()===B.id&&B.submenu.forEach(X=>{v.push(X)})})}),v})}getContextMenuVisible(){return this.contextMenuVisibleSignal.asReadonly()}getContextMenuPosition(){return this.contextMenuPositionSignal.asReadonly()}getContainerBounds(){return this.containerBoundsSignal.asReadonly()}getFocusedItemIndex(){return this.focusedItemIndexSignal.asReadonly()}getFocusedSubmenuId(){return this.focusedSubmenuIdSignal.asReadonly()}showContextMenu(t,r,v){this.contextMenuPositionSignal.set({x:t,y:r}),this.containerBoundsSignal.set(v||null),this.contextMenuVisibleSignal.set(!0),this.focusedItemIndexSignal.set(-1),this.focusedSubmenuIdSignal.set(null)}hideContextMenu(){this.contextMenuVisibleSignal.set(!1),this.focusedItemIndexSignal.set(-1),this.focusedSubmenuIdSignal.set(null)}getContextMenuSections(){return(0,e.EWP)(()=>{const t=this.apiService.getSelectedElements(),r=t.length>0,v=t.length>1,k=t.length>2,B=this.apiService.getClipboardInfo(),X=null!==B&&B.elementCount>0,G=r&&t.some(te=>te.groupId),K=r&&t.some(te=>te.locked),ae=r&&t.some(te=>!te.locked);return[{id:"clipboard",items:[{id:"cut",label:"Cut",shortcut:"Ctrl+X",enabled:r,visible:r,action:()=>this.apiService.cutElements()},{id:"copy",label:"Copy",shortcut:"Ctrl+C",enabled:r,visible:r,action:()=>this.apiService.copyElements()},{id:"paste",label:"Paste",shortcut:"Ctrl+V",enabled:X,visible:X,action:()=>this.apiService.pasteElements()},{id:"duplicate",label:"Duplicate",shortcut:"Ctrl+D",enabled:r,visible:r,divider:!0,action:()=>this.apiService.duplicateElements()}]},{id:"selection",items:[{id:"select-all",label:"Select All",shortcut:"Ctrl+A",enabled:!0,visible:!0,action:()=>this.apiService.selectAll()},{id:"delete",label:"Delete",shortcut:"Del",enabled:r,visible:r,divider:!0,action:()=>this.apiService.deleteSelectedElements()}]},{id:"arrange",items:[{id:"order",label:"Order",enabled:r,visible:r,submenu:[{id:"bring-to-front",label:"Bring to Front",shortcut:"Ctrl+Shift+]",enabled:!0,visible:!0,action:()=>this.apiService.bringToFront()},{id:"bring-forward",label:"Bring Forward",shortcut:"Ctrl+]",enabled:!0,visible:!0,action:()=>this.apiService.bringForward()},{id:"send-backward",label:"Send Backward",shortcut:"Ctrl+[",enabled:!0,visible:!0,action:()=>this.apiService.sendBackward()},{id:"send-to-back",label:"Send to Back",shortcut:"Ctrl+Shift+[",enabled:!0,visible:!0,action:()=>this.apiService.sendToBack()}]},{id:"transform",label:"Transform",enabled:r,visible:r,submenu:[{id:"align-left",label:"Align Left",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(w.Yu.Left)},{id:"align-center",label:"Align Center",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(w.Yu.Center)},{id:"align-right",label:"Align Right",enabled:!0,visible:!0,divider:!0,action:()=>this.apiService.alignElements(w.Yu.Right)},{id:"align-top",label:"Align Top",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(w.Yu.Top)},{id:"align-middle",label:"Align Middle",enabled:!0,visible:!0,action:()=>this.apiService.alignElements(w.Yu.Middle)},{id:"align-bottom",label:"Align Bottom",enabled:!0,visible:!0,divider:!0,action:()=>this.apiService.alignElements(w.Yu.Bottom)},{id:"distribute-horizontal",label:"Distribute Horizontally",enabled:k,visible:k,action:()=>this.apiService.distributeHorizontally()},{id:"distribute-vertical",label:"Distribute Vertically",enabled:k,visible:k,divider:!0,action:()=>this.apiService.distributeVertically()},{id:"flip-horizontal",label:"Flip Horizontal",enabled:!0,visible:!0,action:()=>this.apiService.flipHorizontal()},{id:"flip-vertical",label:"Flip Vertical",enabled:!0,visible:!0,action:()=>this.apiService.flipVertical()}]}]},{id:"object",items:[{id:"group",label:"Group",shortcut:"Ctrl+G",enabled:v,visible:v,action:()=>this.apiService.groupSelectedElements()},{id:"ungroup",label:"Ungroup",shortcut:"Ctrl+Shift+G",enabled:G,visible:G,action:()=>this.apiService.ungroupSelectedElements()},{id:"lock",label:"Lock",shortcut:"Ctrl+L",enabled:ae,visible:ae,action:()=>this.apiService.lockElements()},{id:"unlock",label:"Unlock",shortcut:"Ctrl+Shift+L",enabled:K,visible:K,action:()=>this.apiService.unlockElements()}]}].map(te=>({...te,items:te.items.filter(ne=>ne.visible)})).filter(te=>te.items.length>0)})}executeAction(t){try{t()}catch(r){console.error("Error executing context menu action:",r)}finally{this.hideContextMenu()}}focusNextItem(){const t=this.allMenuItemsCache(),r=t.filter(ae=>ae.enabled);if(0===r.length)return;const v=this.focusedItemIndexSignal(),k=v>=0?t[v]:null,X=((k?r.indexOf(k):-1)+1)%r.length,K=t.indexOf(r[X]);this.focusedItemIndexSignal.set(K)}focusPreviousItem(){const t=this.allMenuItemsCache(),r=t.filter(ae=>ae.enabled);if(0===r.length)return;const v=this.focusedItemIndexSignal(),k=v>=0?t[v]:null,B=k?r.indexOf(k):-1,K=t.indexOf(r[B<=0?r.length-1:B-1]);this.focusedItemIndexSignal.set(K)}focusFirstItem(){const t=this.allMenuItemsCache(),r=t.filter(B=>B.enabled);if(0===r.length)return;const k=t.indexOf(r[0]);this.focusedItemIndexSignal.set(k)}focusLastItem(){const t=this.allMenuItemsCache(),r=t.filter(B=>B.enabled);if(0===r.length)return;const k=t.indexOf(r[r.length-1]);this.focusedItemIndexSignal.set(k)}openFocusedSubmenu(){const t=this.allMenuItemsCache(),r=this.focusedItemIndexSignal();if(r<0||r>=t.length)return;const v=t[r];v.submenu&&v.enabled&&this.focusedSubmenuIdSignal.set(v.id)}closeFocusedSubmenu(){this.focusedSubmenuIdSignal.set(null)}executeFocusedAction(){const t=this.allMenuItemsCache(),r=this.focusedItemIndexSignal();if(r<0||r>=t.length)return;const v=t[r];v.enabled&&v.action?this.executeAction(v.action):v.submenu&&v.enabled&&this.openFocusedSubmenu()}getIcon(t){return t&&D[t]||""}getAllMenuItems(){return this.allMenuItemsCache()}static{this.\u0275fac=function(r){return new(r||f)(e.KVO(b.G))}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})();var P=x(2262),R=x(2173),d=x(6212);let y=(()=>{class f{constructor(t,r){this.apiService=t,this.configService=r}handleFiles(t){Array.from(t).forEach(r=>{if(r.type.startsWith(c.Vu.IMAGE)){const v=new FileReader;v.onload=k=>{const B=k.target?.result;if(B){const X=(0,R.n)(P.R.Image,{src:B,x:100,y:100,width:200,height:200,zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId());this.apiService.addElements([X])}},v.readAsDataURL(r)}})}handleText(t,r,v=!1){const k=this.configService.getConfig(),{x:B,y:X}=(0,d.y1)(k,{x:r.clientX,y:r.clientY});let G=t,K={color:k.strokeColor,fontSize:k.fontSize,fontFamily:k.fontFamily,fontWeight:"normal",fontStyle:"normal"};if(v){const me=(new DOMParser).parseFromString(t,"text/html");G=(me.body.textContent||"").trim();const te=me.body.firstElementChild;if(te){const ne=window.getComputedStyle(te);K={color:ne.color||K.color,fontSize:parseInt(ne.fontSize)||K.fontSize,fontFamily:ne.fontFamily||K.fontFamily,fontWeight:"bold"===ne.fontWeight||parseInt(ne.fontWeight)>=700?"bold":"normal",fontStyle:"italic"===ne.fontStyle?"italic":"normal"}}}if(G){const ae=(0,R.n)(P.R.Text,{x:B,y:X+.8*K.fontSize,text:G,style:K,zIndex:this.apiService.getNextZIndex()},this.apiService.getActiveLayerId());this.apiService.addElements([ae])}}handleElements(t,r){const v=this.configService.getConfig(),k=(0,d.y1)(v,{x:r.clientX,y:r.clientY}),B=t.map(X=>({...X,x:k.x+(X.x||0),y:k.y+(X.y||0),zIndex:this.apiService.getNextZIndex()}));this.apiService.addElements(B)}static{this.\u0275fac=function(r){return new(r||f)(e.KVO(b.G),e.KVO(s.w))}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})(),W=(()=>{class f{constructor(){this.apiService=(0,e.WQX)(b.G)}handleWheel(t){t.preventDefault(),t.ctrlKey?this.handleZoom(t):t.shiftKey?this.handleHorizontalPan(t):this.handleVerticalPan(t)}handleZoom(t){(t.deltaY<0?1:-1)>0?this.apiService.zoomIn():this.apiService.zoomOut()}handleHorizontalPan(t){const r=this.apiService.getConfig();this.apiService.pan(t.deltaY*c.aW/r.zoom,0)}handleVerticalPan(t){const r=this.apiService.getConfig();this.apiService.pan(0,t.deltaY*c.aW/r.zoom)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac})}}return f})(),L=(()=>{class f{constructor(t,r,v,k,B,X,G,K){this.toolsService=t,this.configService=r,this.EventBusService=v,this.keyboardShortcutService=k,this.apiService=B,this.contextMenuService=X,this.dragDropService=G,this.wheelHandlerService=K,this.pointerDownSig=(0,e.vPA)(null),this.pointerMoveSig=(0,e.vPA)(null),this.pointerUpSig=(0,e.vPA)(null),this.isSpaceHeld=!1}onPointerDown(t){if(t.button===c.fh.MIDDLE)return this.toolsService.pushTemporaryTool(i.p.Hand,c.Dr.PAN_MIDDLE),void this.safeGetHandTool()?.handlePointerDown?.(t);t.button!==c.fh.RIGHT&&!this.toolsService.hasTemporaryOverride()&&this.canDraw()&&(this.EventBusService.emit(u.w.DrawStart,t),this.toolsService.getActiveToolInstance()?.handlePointerDown?.(t),t.isDoubleClick&&this.EventBusService.emit(u.w.ElementDoubleClicked,{target:t.target,clientX:t.clientX,clientY:t.clientY}),this.pointerDownSig.set(t))}onPointerMove(t){this.toolsService.hasTemporaryOverride()?this.safeGetHandTool()?.handlePointerMove?.(t):this.canDraw()&&(this.EventBusService.emit(u.w.Drawing,t),this.toolsService.getActiveToolInstance()?.handlePointerMove?.(t),this.pointerMoveSig.set(t))}onPointerUp(t){if(t.button===c.fh.MIDDLE&&this.toolsService.hasTemporaryOverride())return this.safeGetHandTool()?.handlePointerUp?.(t),void this.toolsService.popTemporaryTool(c.Dr.PAN_MIDDLE);this.canDraw()&&(this.EventBusService.emit(u.w.DrawEnd),this.toolsService.getActiveToolInstance()?.handlePointerUp?.(t),this.pointerUpSig.set(t))}onKeyDown(t){if(t.code===c._.SPACE&&!this.isSpaceHeld&&!this.isTextToolEditing())return this.isSpaceHeld=!0,this.toolsService.pushTemporaryTool(i.p.Hand,c.Dr.PAN_SPACE),void t.preventDefault();this.toolsService.getActiveToolInstance()?.handleKeyDown?.(t),this.canUseKeyboardShortcuts()&&this.keyboardShortcutService.handleKeyDown(t)}onKeyUp(t){if(t.code===c._.SPACE&&this.isSpaceHeld&&!this.isTextToolEditing())return this.isSpaceHeld=!1,this.toolsService.popTemporaryTool(c.Dr.PAN_SPACE),void t.preventDefault();this.toolsService.getActiveToolInstance()?.handleKeyUp?.(t),this.canUseKeyboardShortcuts()&&this.keyboardShortcutService.handleKeyUp(t)}onWheel(t){this.canDraw()&&this.wheelHandlerService.handleWheel(t)}onDragOver(t){this.canDraw()&&t.dataTransfer&&(t.dataTransfer.dropEffect=c.c1.COPY)}onDrop(t){if(!this.canDraw())return;const r=t.dataTransfer?.files;if(r&&r.length>0)return void this.dragDropService.handleFiles(r);const v=t.dataTransfer?.getData(c.Wd.HTML);if(v)return void this.dragDropService.handleText(v,t,!0);const k=t.dataTransfer?.getData(c.Wd.PLAIN);if(k)return void this.dragDropService.handleText(k,t,!1);const B=t.dataTransfer?.getData(c.Wd.JSON);if(B)try{const X=JSON.parse(B);Array.isArray(X)&&this.dragDropService.handleElements(X,t)}catch(X){console.warn("Failed to parse dropped JSON:",X)}}onContextMenu(t,r){if(!this.canDraw())return;const v=this.getTargetElementFromPointer(t),k=this.apiService.selectedElements(),B=k.length>0;v?k.some(G=>G.id===v.id)||this.apiService.selectElements(v):B||this.apiService.clearSelection(),this.contextMenuService.showContextMenu(t.clientX,t.clientY,r)}canDraw(){return this.configService.getConfig().drawingEnabled}canUseKeyboardShortcuts(){return this.configService.getConfig().keyboardShortcutsEnabled}isTextToolEditing(){return this.toolsService.getActiveToolType()===i.p.Text&&!0===this.toolsService.getActiveToolInstance()?.isEditing}safeGetHandTool(){try{return this.toolsService.getToolInstance(i.p.Hand)}catch{return null}}getTargetElementFromPointer(t){const r=this.apiService.getElements();return(0,h.e)(t,r)}static{this.\u0275fac=function(r){return new(r||f)(e.KVO(o.H),e.KVO(s.w),e.KVO(E.W),e.KVO(a),e.KVO(b.G),e.KVO(p),e.KVO(y),e.KVO(W))}}static{this.\u0275prov=e.jDH({token:f,factory:f.\u0275fac,providedIn:"root"})}}return f})(),g=(()=>{class f{constructor(){this.configService=(0,e.WQX)(s.w),this.svgService=(0,e.WQX)(L),this.elementRef=(0,e.WQX)(e.aKT),this.isHovered=!1,this.lastInteractionTime=0,this.INTERACTION_TIMEOUT=500,this.handleMouseEnter=()=>{this.isHovered=!0,f.activeDirective=this},this.handleMouseLeave=()=>{this.isHovered=!1},this.handleInteraction=()=>{this.lastInteractionTime=Date.now(),f.activeDirective=this}}static{this.activeDirective=null}ngOnInit(){const t=this.elementRef.nativeElement;t.addEventListener("mouseenter",this.handleMouseEnter),t.addEventListener("mouseleave",this.handleMouseLeave),t.addEventListener("pointerdown",this.handleInteraction),t.addEventListener("pointerup",this.handleInteraction)}ngOnDestroy(){const t=this.elementRef.nativeElement;t.removeEventListener("mouseenter",this.handleMouseEnter),t.removeEventListener("mouseleave",this.handleMouseLeave),t.removeEventListener("pointerdown",this.handleInteraction),t.removeEventListener("pointerup",this.handleInteraction),f.activeDirective===this&&(f.activeDirective=null)}isActiveWhiteboard(){const t=Date.now()-this.lastInteractionTime<this.INTERACTION_TIMEOUT;return this.isHovered||t||f.activeDirective===this}onGlobalKeyDown(t){this.configService.getConfig().keyboardShortcutsEnabled&&this.isActiveWhiteboard()&&this.svgService.onKeyDown(t)}onGlobalKeyUp(t){this.configService.getConfig().keyboardShortcutsEnabled&&this.isActiveWhiteboard()&&this.svgService.onKeyUp(t)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275dir=e.FsC({type:f,selectors:[["","globalKeyboard",""]],hostBindings:function(r,v){1&r&&e.bIt("keydown",function(B){return v.onGlobalKeyDown(B)},!1,e.tSv)("keyup",function(B){return v.onGlobalKeyUp(B)},!1,e.tSv)},standalone:!0})}}return f})(),n=(()=>{class f{constructor(t){this.svgService=t,this.elementRef=(0,e.WQX)(e.aKT),this.lastClickTime=0,this.lastClickX=0,this.lastClickY=0,this.DOUBLE_CLICK_THRESHOLD=300,this.DOUBLE_CLICK_DISTANCE=10}onPointerDown(t){if(t.button!==c.fh.RIGHT&&t.preventDefault(),t.currentTarget&&t.currentTarget.setPointerCapture(t.pointerId),t.button===c.fh.RIGHT)return;const r=Date.now(),v=t.clientX,k=t.clientY;if(this.lastClickTime&&r-this.lastClickTime<this.DOUBLE_CLICK_THRESHOLD&&Math.abs(v-this.lastClickX)<this.DOUBLE_CLICK_DISTANCE&&Math.abs(k-this.lastClickY)<this.DOUBLE_CLICK_DISTANCE){const X=this.createPointerInfo(t);return X.isDoubleClick=!0,this.svgService.onPointerDown(X),void(this.lastClickTime=0)}this.lastClickTime=r,this.lastClickX=v,this.lastClickY=k;const B=this.createPointerInfo(t);this.svgService.onPointerDown(B)}onPointerMove(t){if(t.clientX===this.lastX&&t.clientY===this.lastY||(this.lastX=t.clientX,this.lastY=t.clientY,2&t.buttons))return;const r=this.createPointerInfo(t);this.svgService.onPointerMove(r)}onPointerUp(t){if(this.lastX=t.clientX,this.lastY=t.clientY,t.currentTarget&&t.currentTarget.hasPointerCapture(t.pointerId)&&t.currentTarget.releasePointerCapture(t.pointerId),t.button===c.fh.RIGHT)return;const r=this.createPointerInfo(t);this.svgService.onPointerUp(r)}onWheel(t){t.preventDefault(),this.svgService.onWheel(t)}onKeyDown(t){t.preventDefault(),this.svgService.onKeyDown(t)}onKeyUp(t){this.svgService.onKeyUp(t)}onDragOver(t){t.preventDefault(),t.stopPropagation(),this.svgService.onDragOver(t)}onDragEnter(t){t.preventDefault(),t.stopPropagation()}onDrop(t){t.preventDefault(),t.stopPropagation(),this.svgService.onDrop(t)}onContextMenu(t){t.preventDefault();const r=this.createPointerInfo(t),v=t.currentTarget.getBoundingClientRect(),k=this.getPointerPosition(t),B={...r,clientX:v.left+k.x,clientY:v.top+k.y};this.svgService.onContextMenu(B,v)}createPointerInfo(t){const{x:r,y:v}=this.getPointerPosition(t);return{x:r,y:v,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX,pageY:t.pageY,movementX:t.movementX,movementY:t.movementY,pressure:t.pressure,tangentialPressure:t.tangentialPressure,tiltX:t.tiltX,tiltY:t.tiltY,twist:t.twist,width:t.width,height:t.height,pointerType:t.pointerType,pointerId:t.pointerId,isPrimary:t.isPrimary,button:t.button,buttons:t.buttons,ctrlKey:t.ctrlKey,shiftKey:t.shiftKey,altKey:t.altKey,metaKey:t.metaKey,eventType:t.type,timeStamp:t.timeStamp,target:t.target}}getPointerPosition(t){const r=t.currentTarget.getBoundingClientRect();return{x:t.clientX-r.left,y:t.clientY-r.top}}static{this.\u0275fac=function(r){return new(r||f)(e.rXU(L))}}static{this.\u0275dir=e.FsC({type:f,selectors:[["","svg",""]],hostBindings:function(r,v){1&r&&e.bIt("pointerdown",function(B){return v.onPointerDown(B)})("pointermove",function(B){return v.onPointerMove(B)})("pointerup",function(B){return v.onPointerUp(B)})("wheel",function(B){return v.onWheel(B)})("keydown",function(B){return v.onKeyDown(B)})("keyup",function(B){return v.onKeyUp(B)})("dragover",function(B){return v.onDragOver(B)})("dragenter",function(B){return v.onDragEnter(B)})("drop",function(B){return v.onDrop(B)})("contextmenu",function(B){return v.onContextMenu(B)})},standalone:!0})}}return f})();var S=x(1152);const T="nw-resize",_="ne-resize",l="ns-resize",M="ew-resize";let U=(()=>{class f{constructor(){this.cornerGrips=["nw","ne","se","sw"],this.sideGrips=["n","s","e","w"]}transform(t,r){if(t.includes("rotate"))return"grab";const v=this.isHorizontalOrientation(r);return this.cornerGrips.includes(t)?this.getCornerCursor(t,v):this.sideGrips.includes(t)?this.getSideCursor(t,v):"default"}isHorizontalOrientation(t){const r=t%180;return r<45||r>135}getCornerCursor(t,r){return"nw"===t||"se"===t?r?T:_:r?_:T}getSideCursor(t,r){return"n"===t||"s"===t?r?l:M:r?M:l}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275pipe=e.EJ8({name:"gripCursor",type:f,pure:!0,standalone:!0})}}return f})(),j=(()=>{class f{transform(t,r){if(t.isDeleting)return.1;let v=(t.opacity||100)/100;if(void 0!==t.style?.opacity&&(v*=t.style.opacity),t.layerId){const k=r.find(B=>B.id===t.layerId);k&&void 0!==k.opacity&&(v*=k.opacity)}return v}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275pipe=e.EJ8({name:"elementOpacity",type:f,pure:!0,standalone:!0})}}return f})();function q(f,F){return[f[0]-F[0],f[1]-F[1]]}function he(f,F){return function ee(f){return f[0]*f[0]+f[1]*f[1]}(q(f,F))}function re(f,F){return Math.hypot(f[1]-F[1],f[0]-F[0])}function de(f,F,t){return function $(f,F){return[f[0]+F[0],f[1]+F[1]]}(f,function le(f,F){return[f[0]*F,f[1]*F]}(q(F,f),t))}function se(f){return[void 0!==f[0]?f[0]:0,void 0!==f[1]?f[1]:0,void 0!==f[2]?f[2]:1]}function ye(f,F){return Math.abs(f[0]-F[0])<1e-4&&Math.abs(f[1]-F[1])<1e-4}function ue(f){return`${ie(f[0])},${ie(f[1])} `}function oe(f,F){return`${ie((f[0]+F[0])/2)},${ie((f[1]+F[1])/2)} `}function ie(f){return Math.round(1e4*f)/1e4}let _e=(()=>{class f{transform(t,r){if(!t||0===t.length)return"";const v=function Pe(f,F={}){const{streamline:t=.5,size:r=16,simulatePressure:v=!1}=F;if(0===f.length)return[];const k=.15+.85*(1-t);let B=[...f],X=0;if(!v){let J=B[0];for(;J&&!(J[2]>=.025);)B.shift(),J=B[0]}if(!v){let J=B[B.length-1];for(;J&&!(J[2]>=.01);)B.pop(),J=B[B.length-1]}if(0===B.length){const J=f[0];return!J||"number"!=typeof J[0]||"number"!=typeof J[1]||isNaN(J[0])||isNaN(J[1])?[]:[se(J)]}let G=B[1];for(;G&&!(he(G,B[0])>(r/3)**2);)B[0][2]=Math.max(B[0][2],G[2]),B.splice(1,1),G=B[1];const K=B.pop();if(!K)return[];const ae=K;for(G=B[B.length-1];G&&!(he(G,ae)>(r/3)**2);)B.pop(),G=B[B.length-1],X++;B.push(ae);const me=F.last||!F.simulatePressure||B.length>1&&he(B[B.length-1],B[B.length-2])<r**2||X>0;if(2===B.length&&F.simulatePressure){const J=B[1];B=B.slice(0,-1);for(let xe=1;xe<5;xe++){const Oe=de(B[0],J,xe/4);Oe[2]=(B[0][2]+(J[2]-B[0][2]))*xe/4,B.push(Oe)}}const ce=[B[0]];let ve,Le,te=0,ne=ce[0];me&&t>0&&B.push(B[B.length-1]);for(let J=1,xe=B.length;J<xe;J++)ve=!k||F.last&&J===xe-1?B[J]:de(B[J],ne,1-k),!ye(ne,ve)&&(Le=re(ve,ne),te+=Le,!(J<4&&te<r)&&(ne=ve,ce.push(ve)));return ce}(t,r);return function De(f,F=!1){const t=f.length;if(0===t)return"";if(1===t){const B=f[0];if(!B||B.length<2||isNaN(B[0])||isNaN(B[1]))return"";const X=2;return`M ${B[0]} ${B[1]} m -${X}, 0 a ${X},${X} 0 1,0 ${2*X},0 a ${X},${X} 0 1,0 -${2*X},0`}let r=f[0],v=f[1];if(2===t)return`M${ue(r)}L${ue(v)}`;let k="";for(let B=2,X=t-1;B<X;B++)r=f[B],v=f[B+1],k+=oe(r,v);return F?`M${oe(f[0],f[1])}Q${ue(f[1])}${oe(f[1],f[2])}T${k}${oe(f[t-1],f[0])}${oe(f[0],f[1])}Z`:`M${ue(f[0])}Q${ue(f[1])}${oe(f[1],f[2])}${f.length>3?"T":""}${k}L${ue(f[t-1])}`}(v)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275pipe=e.EJ8({name:"pointsToPath",type:f,pure:!0,standalone:!0})}}return f})();const ke=["svgContainer"],Se=(f,F)=>F.id,pe=()=>["n","s","e","w"],Ee=()=>["nw","ne","se","sw"];function we(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"rect",15),e.k0s()),2&f){const t=e.XpG();e.BMQ("transform",t.gridConfig().transform),e.R7$(),e.BMQ("width",t.gridConfig().width+200)("height",t.gridConfig().height+200)}}function ge(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"path",17),e.nI1(2,"pointsToPath"),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("d",e.i5U(2,7,t.points,t.pathOptions))("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function fe(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"image",18),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("height",t.height)("width",t.width)("href",t.src,null,"xlink")("href",t.src)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function Te(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"line"),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)}}function Me(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"line",19),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)("fill",t.style.strokeColor)}}function be(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"rect"),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("rx",t.rx)("width",t.width)("height",t.height)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-linejoin",t.style.lineJoin)}}function Ae(f,F){if(1&f&&(e.qSk(),e.j41(0,"g"),e.nrm(1,"ellipse"),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("cx",t.cx)("cy",t.cy)("rx",t.rx)("ry",t.ry)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke",t.style.strokeColor)("fill",t.style.fill)}}function Be(f,F){if(1&f&&(e.qSk(),e.j41(0,"tspan"),e.EFF(1),e.k0s()),2&f){const t=F.$implicit,r=F.$index,v=e.XpG(2).$implicit;e.BMQ("x",0)("dy",0===r?0:1.2*(v.style.fontSize||16)),e.R7$(),e.JRh(t)}}function Ne(f,F){if(1&f&&(e.qSk(),e.j41(0,"g")(1,"text",20),e.Z7z(2,Be,2,3,":svg:tspan",null,e.Vm6),e.k0s()()),2&f){const t=e.XpG().$implicit;e.R7$(),e.BMQ("font-size",t.style.fontSize)("font-family",t.style.fontFamily)("fill",t.style.color)("font-style",t.style.fontStyle)("font-weight",t.style.fontWeight)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke",t.style.strokeColor)("stroke-width",t.style.strokeWidth),e.R7$(),e.Dyx(t.text.split("\n"))}}function We(f,F){if(1&f&&(e.qSk(),e.j41(0,"g",16),e.nI1(1,"elementOpacity"),e.DNE(2,ge,3,10)(3,fe,2,9)(4,Te,2,9)(5,Me,2,10)(6,be,2,9)(7,Ae,2,9)(8,Ne,4,11),e.k0s()),2&f){let t;const r=F.$implicit,v=e.XpG();e.xc7("pointer-events",r.isLocked?"none":"auto")("mix-blend-mode",r.blendMode),e.Y8G("id","item_"+r.id),e.BMQ("data-wb-id",r.id)("transform",r.transform)("opacity",e.i5U(1,9,r,v.layers())),e.R7$(2),e.vxM(2,(t=r.type)===v.types.Pen?2:t===v.types.Image?3:t===v.types.Line?4:t===v.types.Arrow?5:t===v.types.Rectangle?6:t===v.types.Ellipse?7:t===v.types.Text?8:-1)}}function He(f,F){if(1&f&&(e.qSk(),e.nrm(0,"rect",13)),2&f){const t=F;e.BMQ("x",t.x)("y",t.y)("width",t.width)("height",t.height)}}function Fe(f,F){if(1&f&&(e.qSk(),e.qex(0),e.nrm(1,"rect",24),e.nI1(2,"gripCursor"),e.bVm()),2&f){const t=F.$implicit,r=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_resize_"+t)("x","n"===t||"s"===t?r.x:"e"===t?r.x+r.width-5:r.x-5)("y","n"===t?r.y-5:"s"===t?r.y+r.height-5:r.y)("width","n"===t||"s"===t?r.width:10)("height","n"===t||"s"===t?10:r.height)("cursor",e.i5U(2,6,t,r.rotation))}}function Ze(f,F){if(1&f&&(e.qSk(),e.qex(0),e.nrm(1,"rect",25),e.nI1(2,"gripCursor"),e.bVm()),2&f){const t=F.$implicit,r=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_resize_"+t)("x",r.x+("ne"===t||"se"===t?r.width:0)-5)("y",r.y+("se"===t||"sw"===t?r.height:0)-5)("cursor",e.i5U(2,4,t,r.rotation))}}function Ye(f,F){if(1&f&&(e.qSk(),e.qex(0),e.nrm(1,"circle",26),e.nI1(2,"gripCursor"),e.bVm()),2&f){const t=F.$implicit,r=e.XpG();e.R7$(),e.BMQ("id","selectorGrip_rotate_"+t)("cx",r.x+("ne"===t||"se"===t?r.width:-20)+10)("cy",r.y+("se"===t||"sw"===t?r.height:-20)+10)("cursor",e.i5U(2,4,"rotate_"+t,r.rotation))}}function Ue(f,F){if(1&f&&(e.qSk(),e.j41(0,"g",14),e.nrm(1,"rect",21),e.DNE(2,Fe,3,9,"ng-container",22)(3,Ze,3,7,"ng-container",22),e.nrm(4,"circle",23),e.DNE(5,Ye,3,7,"ng-container",22),e.k0s()),2&f){const t=F;e.BMQ("transform","rotate("+t.rotation+","+(t.x+t.width/2)+","+(t.y+t.height/2)+")"),e.R7$(),e.BMQ("x",t.x)("y",t.y)("width",t.width)("height",t.height),e.R7$(),e.Y8G("ngForOf",e.lJ4(10,pe)),e.R7$(),e.Y8G("ngForOf",e.lJ4(11,Ee)),e.R7$(),e.BMQ("cx",t.handles.rotateHandle.x)("cy",t.handles.rotateHandle.y),e.R7$(),e.Y8G("ngForOf",e.lJ4(12,Ee))}}let Xe=(()=>{class f{constructor(){this.apiService=(0,e.WQX)(b.G),this.configService=(0,e.WQX)(s.w),this.toolsService=(0,e.WQX)(o.H),this.selectionService=(0,e.WQX)(S.A),this.canvasService=(0,e.WQX)(O.W),this.svgService=(0,e.WQX)(L),this.config=this.configService.getConfigSignal(),this.elements=this.apiService.allElements,this.layers=this.apiService.layers,this.selectedToolSignal=this.toolsService.selectedTool,this.selectionBoxSignal=this.selectionService.getSelectionBoxSignal(),this.boundingBoxSignal=this.selectionService.getBoundingBoxSignal(),this.transform=this.canvasService.getTransform(),this.filteredElements=(0,e.EWP)(()=>{const t=this.layers(),r=this.elements(),k=t.filter(G=>G.visible).map(G=>G.id);if(0===k.length)return[];const B=r.filter(G=>!G.layerId||k.includes(G.layerId));return(G=B,G.slice().sort((K,ae)=>{const me=K.layerId?t.find(ve=>ve.id===K.layerId):void 0,ce=ae.layerId?t.find(ve=>ve.id===ae.layerId):void 0;return 1e3*(me?.zIndex??0)+(K.zIndex??0)-(1e3*(ce?.zIndex??0)+(ae.zIndex??0))})).map(G=>({...G,transform:this.buildTransform(G),isLocked:this.computeIsLocked(G,t),blendMode:this.computeBlendMode(G,t)}));var G}),this.canvasWidth=(0,e.EWP)(()=>this.config().canvasWidth),this.canvasHeight=(0,e.EWP)(()=>this.config().canvasHeight),this.zoom=(0,e.EWP)(()=>this.config().zoom),this.x=(0,e.EWP)(()=>this.config().x),this.y=(0,e.EWP)(()=>this.config().y),this.canvasX=(0,e.EWP)(()=>this.config().canvasX),this.canvasY=(0,e.EWP)(()=>this.config().canvasY),this.gridSize=(0,e.EWP)(()=>this.config().gridSize),this.backgroundColor=(0,e.EWP)(()=>this.config().backgroundColor),this.enableGrid=(0,e.EWP)(()=>this.config().enableGrid),this.fullScreen=(0,e.EWP)(()=>this.config().fullScreen),this.svgDimensions=(0,e.EWP)(()=>{const t=this.fullScreen(),r=this.canvasWidth(),v=this.canvasHeight(),k=this.zoom();return t?{width:"100%",height:"100%"}:{width:r*k+"px",height:v*k+"px"}}),this.svgViewBox=(0,e.EWP)(()=>this.fullScreen()?`0 0 ${this.canvasWidth()/this.zoom()} ${this.canvasHeight()/this.zoom()}`:`0 0 ${this.canvasWidth()} ${this.canvasHeight()}`),this.contentTransform=(0,e.EWP)(()=>`translate(${this.x()}, ${this.y()})`),this.gridConfig=(0,e.EWP)(()=>{const t=this.x(),r=this.y(),v=this.zoom();return{transform:`translate(${t%100}, ${r%100})`,width:(this.canvasWidth()+100)/v,height:(this.canvasHeight()+100)/v}}),this.cursor=(0,e.EWP)(()=>this.toolsService.cursor()),this.types=P.R,this.tools=i.p}buildTransform(t){return`translate(${t.x},${t.y}) rotate(${t.rotation}) scale(${t.scaleX??1},${t.scaleY??1})`}computeIsLocked(t,r){return t.layerId&&r.find(k=>k.id===t.layerId)?.locked||!1}computeBlendMode(t,r){return t.layerId&&r.find(k=>k.id===t.layerId)?.blendMode||"normal"}ngAfterViewInit(){this.apiService.initializeWhiteboard(this.svgContainer.nativeElement)}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275cmp=e.VBU({type:f,selectors:[["ng-whiteboard-canvas"]],viewQuery:function(r,v){if(1&r&&e.GBs(ke,5),2&r){let k;e.mGM(k=e.lsd())&&(v.svgContainer=k.first)}},standalone:!0,features:[e.aNF],decls:18,vars:17,consts:[["svgContainer",""],["id","svgroot","xmlns","http://www.w3.org/2000/svg",0,"xmlns","xlink","http://www.w3.org/1999/xlink","tabindex","0","svg","","resizeHandler","","globalKeyboard",""],["id","svgcontent"],["id","smallGrid","patternUnits","userSpaceOnUse"],["fill","none","stroke","gray","stroke-width","0.5"],["id","grid","width","100","height","100","patternUnits","userSpaceOnUse"],["width","100","height","100","fill","url(#smallGrid)"],["d","M 100 0 H 0 V 100","fill","none","stroke","gray","stroke-width","2"],["id","arrow","refX","3","refY","3","markerWidth","6","markerHeight","6","stroke","context-stroke","fill","none","orient","auto"],["d","M 0 0 L 3 3 L 0 6"],["width","100%","height","100%"],[2,"pointer-events","all"],["transform-origin","center",1,"wb_element",3,"id","pointer-events","mix-blend-mode"],["stroke","blue","stroke-dasharray","5,5","fill","transparent"],["id","selectorParentGroup"],["x","-100","y","-100","fill","url(#grid)"],["transform-origin","center",1,"wb_element",3,"id"],["fill","none"],["preserveAspectRatio","none"],["marker-end","url(#arrow)"],["text-anchor","start","alignment-baseline","before-edge"],["id","selectorBox","fill","transparent","stroke","dodgerblue","stroke-width","1","cursor","move","pointer-events","all"],[4,"ngFor","ngForOf"],["id","selectorGrip_rotate_n","r","6","fill","white","stroke","green","stroke-width","1","cursor","grab"],["fill","transparent","stroke","transparent","pointer-events","all"],["width","10","height","10","fill","white","stroke","dodgerblue","stroke-width","1"],["r","6","fill","none","stroke","none","stroke-width","1"]],template:function(r,v){if(1&r&&(e.qSk(),e.j41(0,"svg",1,0)(2,"svg",2)(3,"defs")(4,"pattern",3),e.nrm(5,"path",4),e.k0s(),e.j41(6,"pattern",5),e.nrm(7,"rect",6)(8,"path",7),e.k0s(),e.j41(9,"marker",8),e.nrm(10,"path",9),e.k0s()(),e.nrm(11,"rect",10),e.DNE(12,we,2,3,":svg:g"),e.j41(13,"g",11),e.Z7z(14,We,9,12,":svg:g",12,Se),e.DNE(16,He,1,4,":svg:rect",13)(17,Ue,6,13,":svg:g",14),e.k0s()()()),2&r){let k,B;e.HbH("svgroot "+v.selectedToolSignal()),e.xc7("cursor",v.cursor()),e.R7$(2),e.BMQ("width",v.svgDimensions().width)("height",v.svgDimensions().height)("viewBox",v.svgViewBox())("x",v.canvasX())("y",v.canvasY()),e.R7$(2),e.BMQ("width",v.gridSize())("height",v.gridSize()),e.R7$(),e.BMQ("d","M "+v.gridSize()+" 0 H 0 V "+v.gridSize()),e.R7$(6),e.BMQ("fill",v.backgroundColor()),e.R7$(),e.vxM(12,v.enableGrid()?12:-1),e.R7$(),e.BMQ("transform",v.contentTransform()),e.R7$(),e.Dyx(v.filteredElements()),e.R7$(2),e.vxM(16,(k=v.selectionBoxSignal())?16:-1,k),e.R7$(),e.vxM(17,(B=v.boundingBoxSignal())?17:-1,B)}},dependencies:[I.MD,I.Sq,U,j,_e,n,m,g],styles:["[_nghost-%COMP%]{width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]{position:absolute;inset:0;-webkit-user-select:none;user-select:none;outline:none;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit;background-size:cover;background-position:50%;background-repeat:no-repeat;touch-action:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]:focus{outline:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%], [_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .selectorGroup[_ngcontent-%COMP%]{transform-box:fill-box;transform-origin:center}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-family:Arial,Helvetica,sans-serif}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%]{cursor:pointer}"],changeDetection:0})}}return f})();const je=["contextMenu"],Re=(f,F)=>F.id;function Ge(f,F){if(1&f&&(e.j41(0,"span",9),e.EFF(1),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.shortcut)}}function Ve(f,F){1&f&&(e.j41(0,"span",10),e.EFF(1,"\u203a"),e.k0s())}function Ke(f,F){if(1&f){const t=e.RV6();e.j41(0,"div",6),e.bIt("click",function(v){const k=e.eBV(t).$implicit,B=e.XpG(2);return e.Njj(B.onItemClick(k,v))})("mouseenter",function(v){const k=e.eBV(t).$implicit,B=e.XpG(2);return e.Njj(B.onItemHover(k,v))})("mouseleave",function(){e.eBV(t);const v=e.XpG(2);return e.Njj(v.onItemLeave())}),e.j41(1,"div",7)(2,"span",8),e.EFF(3),e.k0s(),e.DNE(4,Ge,2,1,"span",9)(5,Ve,2,0,"span",10),e.k0s()()}if(2&f){const t=F.$implicit,r=e.XpG(2);e.AVh("disabled",!t.enabled)("divider-after",t.divider)("has-submenu",t.submenu)("active",r.hoveredItem===t)("focused",r.isFocused(t)),e.BMQ("title",t.shortcut||null),e.R7$(3),e.JRh(t.label),e.R7$(),e.vxM(4,t.shortcut?4:-1),e.R7$(),e.vxM(5,t.submenu?5:-1)}}function $e(f,F){if(1&f&&(e.j41(0,"div",3),e.Z7z(1,Ke,6,14,"div",5,Re),e.k0s()),2&f){const t=F.$implicit;e.R7$(),e.Dyx(t.items)}}function Qe(f,F){if(1&f&&(e.j41(0,"span",9),e.EFF(1),e.k0s()),2&f){const t=e.XpG().$implicit;e.R7$(),e.JRh(t.shortcut)}}function Je(f,F){if(1&f){const t=e.RV6();e.j41(0,"div",13),e.bIt("click",function(v){const k=e.eBV(t).$implicit,B=e.XpG(2);return e.Njj(B.onItemClick(k,v))}),e.j41(1,"div",7)(2,"span",8),e.EFF(3),e.k0s(),e.DNE(4,Qe,2,1,"span",9),e.k0s()()}if(2&f){const t=F.$implicit,r=e.XpG(2);e.AVh("disabled",!t.enabled)("divider-after",t.divider)("focused",r.isFocused(t)),e.BMQ("title",t.shortcut||null),e.R7$(3),e.JRh(t.label),e.R7$(),e.vxM(4,t.shortcut?4:-1)}}function qe(f,F){if(1&f){const t=e.RV6();e.j41(0,"div",11),e.bIt("mouseenter",function(){e.eBV(t);const v=e.XpG();return e.Njj(v.onSubmenuEnter())})("mouseleave",function(){e.eBV(t);const v=e.XpG();return e.Njj(v.onSubmenuLeave())})("click",function(v){return e.eBV(t),e.Njj(v.stopPropagation())}),e.Z7z(1,Je,5,9,"div",12,Re),e.k0s()}if(2&f){const t=e.XpG();e.xc7("left",t.submenuPosition.left,"px")("top",t.submenuPosition.top,"px"),e.R7$(),e.Dyx(t.hoveredItem.submenu)}}let et=(()=>{class f{constructor(t){this.contextMenuService=t,this.hoveredItem=null,this.submenuPosition={left:0,top:0},this.submenuTimeout=null,this.isVisible=this.contextMenuService.getContextMenuVisible(),this.position=this.contextMenuService.getContextMenuPosition(),this.sections=this.contextMenuService.getContextMenuSections(),this.containerBounds=this.contextMenuService.getContainerBounds(),this.focusedItem=(0,e.EWP)(()=>{const r=this.contextMenuService.getFocusedItemIndex()();return this.contextMenuService.getAllMenuItems()[r]||null})}ngOnInit(){this.position=(0,e.EWP)(()=>{const t=this.contextMenuService.getContextMenuPosition()(),r=this.containerBounds();let v=t.x,k=t.y;return r&&(v=t.x-r.left,k=t.y-r.top),this.adjustPosition(v,k)})}ngOnDestroy(){this.contextMenuService.hideContextMenu(),this.submenuTimeout&&clearTimeout(this.submenuTimeout)}onItemClick(t,r){if(t.enabled){if(t.submenu)return void r.stopPropagation();t.action&&this.contextMenuService.executeAction(t.action)}}onItemHover(t,r){this.submenuTimeout&&(clearTimeout(this.submenuTimeout),this.submenuTimeout=null),t.submenu&&t.enabled?(this.hoveredItem=t,this.calculateSubmenuPosition(r.currentTarget)):this.hoveredItem=null}onItemLeave(){this.submenuTimeout&&clearTimeout(this.submenuTimeout),this.submenuTimeout=setTimeout(()=>{this.hoveredItem=null},100)}onSubmenuEnter(){this.submenuTimeout&&(clearTimeout(this.submenuTimeout),this.submenuTimeout=null)}onSubmenuLeave(){this.submenuTimeout&&clearTimeout(this.submenuTimeout),this.submenuTimeout=setTimeout(()=>{this.hoveredItem=null},100)}calculateSubmenuPosition(t){const r=t.getBoundingClientRect(),v=this.containerBounds();if(!v)return void(this.submenuPosition={left:r.right+4,top:r.top-4});const k=200,X=r.left-v.left,G=r.right-v.left,K=r.top-v.top,me=this.contextMenu?.nativeElement?.getBoundingClientRect(),ce=me?me.top-v.top:4,te=me?me.bottom-v.top:v.height-4;let ne=G+4;const ve=v.width-G-4;ve<k&&X-4>ve&&(ne=X-k-4);let J=K;const ze=32*(this.hoveredItem?.submenu?.length||0)+8;J+ze>te&&(J=te-ze),J<ce&&(J=ce),ne<4&&(ne=4),ne+k>v.width-4&&(ne=v.width-k-4),this.submenuPosition={left:ne,top:J}}onKeyDown(t){if(this.isVisible())switch(t.key){case"Escape":t.preventDefault(),this.contextMenuService.hideContextMenu();break;case"ArrowDown":t.preventDefault(),this.contextMenuService.focusNextItem();break;case"ArrowUp":t.preventDefault(),this.contextMenuService.focusPreviousItem();break;case"ArrowRight":t.preventDefault(),this.contextMenuService.openFocusedSubmenu();break;case"ArrowLeft":t.preventDefault(),this.contextMenuService.closeFocusedSubmenu();break;case"Enter":t.preventDefault(),this.contextMenuService.executeFocusedAction();break;case"Home":t.preventDefault(),this.contextMenuService.focusFirstItem();break;case"End":t.preventDefault(),this.contextMenuService.focusLastItem()}}onDocumentClick(t){this.isVisible()&&this.contextMenu?.nativeElement&&(this.contextMenu.nativeElement.contains(t.target)||this.contextMenuService.hideContextMenu())}adjustPosition(t,r){if(!this.contextMenu?.nativeElement)return{x:t,y:r};const k=this.contextMenu.nativeElement.getBoundingClientRect(),B=this.containerBounds();if(!B)return{x:t,y:r};let X=t,G=r;const K=10;t+k.width>B.width-K&&(X=Math.max(K,t-k.width)),X<K&&(X=K);const me=B.height-r-K,ce=Math.min(k.height,400);if(ce>me){const te=r-K;G=ce<=te?r-ce:te>me?r-Math.min(ce,te):Math.max(K,B.height-ce-K)}return G<K&&(G=K),G+ce>B.height-K&&(G=B.height-ce-K),{x:X,y:G}}isFocused(t){return this.focusedItem()===t}static{this.\u0275fac=function(r){return new(r||f)(e.rXU(p))}}static{this.\u0275cmp=e.VBU({type:f,selectors:[["wb-context-menu"]],viewQuery:function(r,v){if(1&r&&e.GBs(je,7),2&r){let k;e.mGM(k=e.lsd())&&(v.contextMenu=k.first)}},hostBindings:function(r,v){1&r&&e.bIt("keydown",function(B){return v.onKeyDown(B)},!1,e.EBC)("click",function(B){return v.onDocumentClick(B)},!1,e.EBC)},standalone:!0,features:[e.aNF],decls:6,vars:7,consts:[["contextMenu",""],[1,"context-menu",3,"click"],[1,"context-menu-content"],[1,"context-menu-section"],[1,"submenu",3,"left","top"],[1,"context-menu-item",3,"disabled","divider-after","has-submenu","active","focused"],[1,"context-menu-item",3,"click","mouseenter","mouseleave"],[1,"item-content"],[1,"item-label"],[1,"item-shortcut"],[1,"item-arrow"],[1,"submenu",3,"mouseenter","mouseleave","click"],[1,"context-menu-item","submenu-item",3,"disabled","divider-after","focused"],[1,"context-menu-item","submenu-item",3,"click"]],template:function(r,v){if(1&r){const k=e.RV6();e.j41(0,"div",1,0),e.bIt("click",function(X){return e.eBV(k),e.Njj(X.stopPropagation())}),e.j41(2,"div",2),e.Z7z(3,$e,3,0,"div",3,Re),e.k0s()(),e.DNE(5,qe,3,4,"div",4)}2&r&&(e.xc7("left",v.position().x,"px")("top",v.position().y,"px"),e.AVh("visible",v.isVisible()),e.R7$(3),e.Dyx(v.sections()),e.R7$(2),e.vxM(5,v.hoveredItem&&v.hoveredItem.submenu?5:-1))},dependencies:[I.MD],styles:['.context-menu[_ngcontent-%COMP%]{position:absolute;z-index:10000;opacity:0;visibility:hidden;transform:scale(.95);transition:all .1s ease-out;pointer-events:none}.context-menu.visible[_ngcontent-%COMP%]{opacity:1;visibility:visible;transform:scale(1);pointer-events:auto}.context-menu-content[_ngcontent-%COMP%]{background:#fff;border:1px solid #e0e0e0;border-radius:6px;box-shadow:0 4px 12px #00000026;padding:4px 0;min-width:200px;max-width:300px;max-height:400px;overflow-y:auto;-webkit-user-select:none;user-select:none}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar{width:6px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#f1f1f1;border-radius:3px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#c1c1c1;border-radius:3px}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#a8a8a8}.context-menu-section[_ngcontent-%COMP%]:not(:last-child){border-bottom:1px solid #f0f0f0;margin-bottom:4px;padding-bottom:4px}.context-menu-item[_ngcontent-%COMP%]{padding:8px 16px;cursor:pointer;transition:background-color .1s ease;position:relative}.context-menu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#f5f5f5}.context-menu-item.focused[_ngcontent-%COMP%]:not(.disabled){background-color:#e3f2fd;outline:2px solid #2196f3;outline-offset:-2px}.context-menu-item.disabled[_ngcontent-%COMP%]{opacity:.5;cursor:not-allowed}.context-menu-item.divider-after[_ngcontent-%COMP%]:after{content:"";position:absolute;bottom:0;left:16px;right:16px;height:1px;background-color:#e0e0e0;margin-bottom:-4px}.item-content[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;width:100%}.item-label[_ngcontent-%COMP%]{flex:1;font-size:14px;color:#333;font-weight:400}.item-shortcut[_ngcontent-%COMP%]{font-size:12px;color:#666;margin-left:16px;font-family:Monaco,Menlo,Ubuntu Mono,monospace}.item-arrow[_ngcontent-%COMP%]{margin-left:8px;font-size:16px;color:#999}.context-menu-item.has-submenu[_ngcontent-%COMP%]{position:relative}.context-menu-item.has-submenu.active[_ngcontent-%COMP%]{background-color:#f5f5f5}.submenu[_ngcontent-%COMP%]{position:absolute;background:#fff;border:1px solid #e0e0e0;border-radius:6px;box-shadow:0 4px 12px #00000026;padding:4px 0;min-width:200px;max-width:300px;-webkit-user-select:none;user-select:none;z-index:10001;opacity:1;transform:scale(1);transition:opacity .1s ease,transform .1s ease}.submenu-item[_ngcontent-%COMP%]{padding:8px 16px}.submenu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#f5f5f5}.context-menu-item.disabled[_ngcontent-%COMP%]   .item-label[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-shortcut[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-arrow[_ngcontent-%COMP%]{color:#999}@media (prefers-color-scheme: dark){.context-menu-content[_ngcontent-%COMP%], .submenu[_ngcontent-%COMP%]{background:#2a2a2a;border-color:#404040}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-track{background:#3a3a3a}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb{background:#666}.context-menu-content[_ngcontent-%COMP%]::-webkit-scrollbar-thumb:hover{background:#777}.context-menu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#404040}.context-menu-item.focused[_ngcontent-%COMP%]:not(.disabled){background-color:#1e3a5f;outline:2px solid #1976d2}.context-menu-item.has-submenu.active[_ngcontent-%COMP%]{background-color:#404040}.submenu-item[_ngcontent-%COMP%]:hover:not(.disabled){background-color:#404040}.item-label[_ngcontent-%COMP%]{color:#e0e0e0}.item-shortcut[_ngcontent-%COMP%]{color:#a0a0a0}.item-arrow[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-label[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-shortcut[_ngcontent-%COMP%], .context-menu-item.disabled[_ngcontent-%COMP%]   .item-arrow[_ngcontent-%COMP%]{color:#666}.context-menu-section[_ngcontent-%COMP%]:not(:last-child){border-bottom-color:#404040}.context-menu-item.divider-after[_ngcontent-%COMP%]:after{background-color:#404040}}']})}}return f})();var tt=x(6255),nt=x(3437),it=x(875),st=x(1389),ot=x(3909),rt=x(3452),at=x(4764),lt=x(710);let ct=(()=>{class f{constructor(){this.configService=(0,e.WQX)(s.w),this.apiService=(0,e.WQX)(b.G),this.toolsService=(0,e.WQX)(o.H),this.eventBusService=(0,e.WQX)(E.W),this.cd=(0,e.WQX)(e.gRc),this.instanceService=(0,e.WQX)(z.b),this.boardId=crypto.randomUUID(),this.ready=new e.bkB,this.destroyed=new e.bkB,this.drawStart=new e.bkB,this.drawing=new e.bkB,this.drawEnd=new e.bkB,this.elementsAdded=new e.bkB,this.elementsUpdated=new e.bkB,this.elementsSelected=new e.bkB,this.elementsRemoved=new e.bkB,this.elementDoubleClicked=new e.bkB,this.undo=new e.bkB,this.redo=new e.bkB,this.clear=new e.bkB,this.dataChange=new e.bkB,this.save=new e.bkB,this.imageAdded=new e.bkB,this.selectedToolChange=new e.bkB,this.configChange=new e.bkB,this.zoomChange=new e.bkB,this.eventsMap={[u.w.Ready]:this.ready,[u.w.Destroyed]:this.destroyed,[u.w.DrawStart]:this.drawStart,[u.w.Drawing]:this.drawing,[u.w.DrawEnd]:this.drawEnd,[u.w.ElementsAdded]:this.elementsAdded,[u.w.ElementsUpdated]:this.elementsUpdated,[u.w.ElementsSelected]:this.elementsSelected,[u.w.ElementsRemoved]:this.elementsRemoved,[u.w.ElementDoubleClicked]:this.elementDoubleClicked,[u.w.Undo]:this.undo,[u.w.Redo]:this.redo,[u.w.Clear]:this.clear,[u.w.DataChange]:this.dataChange,[u.w.Save]:this.save,[u.w.ImageAdded]:this.imageAdded,[u.w.ToolChange]:this.selectedToolChange,[u.w.ConfigChange]:this.configChange,[u.w.ZoomChange]:this.zoomChange}}set config(t){this.configService.updateConfig(t,!1)}get config(){return this.configService.getConfig()}set data(t){t&&t!==this.apiService.getElements()&&this.apiService.setElements(t)}set selectedTool(t){t&&this.toolsService.getActiveToolType()!==t&&this.toolsService.setActiveTool(t)}ngOnInit(){this.instanceService.register(this.boardId,this.apiService),this.eventsSubscription=this.eventBusService.listen().subscribe(t=>{const r=this.eventsMap[t.type];r&&(void 0!==t.payload?r.emit(t.payload):r.emit(),this.cd.markForCheck())})}ngOnDestroy(){this.instanceService.unregister(this.boardId),this.eventBusService.emit(u.w.Destroyed),this.eventsSubscription&&this.eventsSubscription.unsubscribe()}static{this.\u0275fac=function(r){return new(r||f)}}static{this.\u0275cmp=e.VBU({type:f,selectors:[["ng-whiteboard"]],inputs:{boardId:"boardId",config:"config",data:"data",selectedTool:"selectedTool"},outputs:{ready:"ready",destroyed:"destroyed",drawStart:"drawStart",drawing:"drawing",drawEnd:"drawEnd",elementsAdded:"elementsAdded",elementsUpdated:"elementsUpdated",elementsSelected:"elementsSelected",elementsRemoved:"elementsRemoved",elementDoubleClicked:"elementDoubleClicked",undo:"undo",redo:"redo",clear:"clear",dataChange:"dataChange",save:"save",imageAdded:"imageAdded",selectedToolChange:"selectedToolChange",configChange:"configChange",zoomChange:"zoomChange"},standalone:!0,features:[e.Jv_([L,b.G,tt.L,O.W,st.q,at.T,lt.l,S.A,ot.W,o.H,rt.r,E.W,s.w,a,nt.a,it.k,p,y,W]),e.aNF],decls:3,vars:0,consts:[[2,"width","100%","height","100%","position","relative"]],template:function(r,v){1&r&&(e.j41(0,"div",0),e.nrm(1,"ng-whiteboard-canvas")(2,"wb-context-menu"),e.k0s())},dependencies:[I.MD,Xe,et],styles:["[_nghost-%COMP%]{display:block;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}"],changeDetection:0})}}return f})()}}]);