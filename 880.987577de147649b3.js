"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[880],{7879:(ot,_,u)=>{u.d(_,{Be:()=>kt,Bn:()=>at,GF:()=>Tt,Mt:()=>d,RZ:()=>V,Sb:()=>gt,YO:()=>S,bO:()=>ft,i$:()=>Q,wM:()=>r});const d="selectorGroup",r="svgroot",V="item_",Q="selectorBox",S="selectorGrip_",gt="selectorGrip_resize",kt="selectorGrip_rotate",Tt=1e3,at="data-wb-id",ft={high:3,normal:2,low:1}},3052:(ot,_,u)=>{u.d(_,{X:()=>d});var d=function(r){return r.Save="save",r.Undo="undo",r.Redo="redo",r.Clear="clear",r.AddImage="addImage",r.ToggleGrid="toggleGrid",r.AddElement="addElement",r.UpdateElement="updateElement",r.RemoveElements="removeElements",r.SelectElements="selectElements",r.ToggleSelection="toggleSelection",r.DeselectElement="deselectElement",r.SelectAll="selectAll",r.ClearSelection="clearSelection",r.UpdateSelectedElements="updateSelectedElements",r.SetActiveTool="setActiveTool",r.SetCanvasDimensions="setCanvasDimensions",r.SetCanvasPosition="setCanvasPosition",r.UpdateGridTranslation="updateGridTranslation",r.UpdateElementsTranslation="updateElementsTranslation",r.FullScreen="fullScreen",r.CenterCanvas="centerCanvas",r.Batch="batch",r}(d||{})},2262:(ot,_,u)=>{u.d(_,{R:()=>d});var d=function(r){return r.Pen="pen",r.Rectangle="rectangle",r.Ellipse="ellipse",r.Line="line",r.Arrow="arrow",r.Text="text",r.Image="image",r}(d||{})},872:(ot,_,u)=>{u.d(_,{p:()=>d});var d=function(r){return r.Hand="hand",r.Select="select",r.Pen="pen",r.Rectangle="rectangle",r.Image="image",r.Line="line",r.Arrow="arrow",r.Ellipse="ellipse",r.Text="text",r.Eraser="eraser",r}(d||{})},6078:(ot,_,u)=>{u.d(_,{$3:()=>r,OP:()=>Q,o8:()=>d,pP:()=>V});var d=function(S){return S.Png="png",S.Jpeg="jpeg",S.Svg="svg",S.Base64="base64",S}(d||{}),r=function(S){return S.Round="round",S.Butt="butt",S.Square="square",S}(r||{}),V=function(S){return S.Round="round",S.Miter="miter",S.Bevel="bevel",S.MiterClip="miter-clip",S}(V||{}),Q=function(S){return S.NW="nw",S.N="n",S.NE="ne",S.E="e",S.SE="se",S.S="s",S.SW="sw",S.W="w",S}(Q||{})},1880:(ot,_,u)=>{u.d(_,{I:()=>Ai});var d=u(1635),r=u(4438),V=u(1985),Q=u(6977);function S(n){n||((0,r.Af3)(S),n=(0,r.WQX)(r.abz));const e=new V.c(t=>n.onDestroy(t.next.bind(t)));return t=>t.pipe((0,Q.Q)(e))}var Bt=u(5964),f=u(3052),_t=u(4523),J=u(4412),At=u(4572),Nt=u(9974);const{isArray:L}=Array;function pt(n){return 1===n.length&&L(n[0])?n[0]:n}var g=u(6450),M=u(1203),A=u(9326);function j(...n){const e=(0,A.ms)(n);return e?(0,M.F)(j(...n),(0,g.I)(e)):(0,Nt.N)((t,i)=>{(0,At.P)([t,...pt(n)])(i)})}function et(...n){return j(...n)}var lt=u(6354),b=u(7879),C=u(2262),m=u(6078);const W={strokeWidth:2,strokeColor:"#000000",fill:"#000000",lineJoin:m.pP.Miter,lineCap:m.$3.Butt,dasharray:"",dashoffset:0},ht={...W,fontSize:14,fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal",color:"#000000"};function z(){return Math.random().toString(36).substring(2).padEnd(12,"0").substring(0,12)}const $=1e-6;function F(n,e){return Math.atan2(e.y-n.y,e.x-n.x)*(180/Math.PI)}function ct(n){return(n%=360)<0?n+360:n}function Qt(n,e){return Math.abs(n)>Math.abs(e)?{x:n,y:0}:{x:0,y:e}}function yt(n,e,t,i){const s=t.x,o=t.y,a=i.x,l=i.y,h=(a-s)**2+(l-o)**2;if(0===h)return Math.sqrt((n-s)**2+(e-o)**2);let c=((n-s)*(a-s)+(e-o)*(l-o))/h;return c=Math.max(0,Math.min(1,c)),Math.sqrt((n-(s+c*(a-s)))**2+(e-(o+c*(l-o)))**2)}function we(n,e,t,i,s=$){const o=(x,P)=>x.x*P.y-x.y*P.x,a=(x,P)=>({x:x.x-P.x,y:x.y-P.y}),l=a(e,n),h=a(i,t),c=a(t,n),p=o(l,h),v=o(c,l);if(Math.abs(p)<s){if(Math.abs(v)>=s)return!1;const x=l.x*l.x+l.y*l.y,P=(c.x*l.x+c.y*l.y)/x,K=a(i,n),nt=(K.x*l.x+K.y*l.y)/x;return P>=0&&P<=1||nt>=0&&nt<=1||P<0&&nt>1||P>1&&nt<0}const O=v/p,T=o(c,h)/p;return O>=0&&O<=1&&T>=0&&T<=1}function zt(n,e,t,i){const s=[[{x:n.minX,y:n.minY},{x:n.maxX,y:n.minY}],[{x:n.maxX,y:n.minY},{x:n.maxX,y:n.maxY}],[{x:n.maxX,y:n.maxY},{x:n.minX,y:n.maxY}],[{x:n.minX,y:n.maxY},{x:n.minX,y:n.minY}]];for(const[o,a]of s)if(we(e,t,o,a,i))return!0;return!1}function Jt(n,e,t,i,s,o,a){const l={x:n,y:e},h={x:t,y:i};return yt(s.x,s.y,l,h)<=a||yt(o.x,o.y,l,h)<=a}function Kt(n,e,t,i=(s=>s)){return n*i(.5-e*(.5-t))}function Y(n,e){return[n[0]+e[0],n[1]+e[1]]}function U(n,e){return[n[0]-e[0],n[1]-e[1]]}function G(n,e){return[n[0]*e,n[1]*e]}function vt(n){return[n[1],-n[0]]}function Zt(n,e){return n[0]*e[0]+n[1]*e[1]}function Ie(n,e){return n[0]===e[0]&&n[1]===e[1]}function qt(n,e){return function _e(n){return n[0]*n[0]+n[1]*n[1]}(U(n,e))}function te(n){return function Oe(n,e){return[n[0]/e,n[1]/e]}(n,function Xe(n){return Math.hypot(n[0],n[1])}(n))}function Ae(n,e){return Math.hypot(n[1]-e[1],n[0]-e[0])}function St(n,e,t){let i=Math.sin(t),s=Math.cos(t),o=n[0]-e[0],a=n[1]-e[1];return[o*s-a*i+e[0],o*i+a*s+e[1]]}function Ut(n,e,t){return Y(n,G(U(e,n),t))}function ee(n,e,t){return Y(n,G(e,t))}var{min:dt,PI:Ne}=Math,xt=Ne+1e-4;const We={size:1,smoothing:1,thinning:0,streamline:1};function Yt(n,e=1){return function $e(n,e=!0){const t=n.length;if(t<4)return"";let i=n[0],s=n[1];const o=n[2];let a=`M${i[0].toFixed(2)},${i[1].toFixed(2)} Q${s[0].toFixed(2)},${s[1].toFixed(2)} ${((s[0]+o[0])/2).toFixed(2)},${((s[1]+o[1])/2).toFixed(2)} T`;for(let l=2,h=t-1;l<h;l++)i=n[l],s=n[l+1],a+=`${((i[0]+s[0])/2).toFixed(2)},${((i[1]+s[1])/2).toFixed(2)} `;return e&&(a+="Z"),a}(function Ye(n,e={}){return function ze(n,e={}){let{size:t=16,smoothing:i=.5,thinning:s=.5,simulatePressure:o=!0,easing:a=(w=>w),start:l={},end:h={},last:c=!1}=e,{cap:p=!0,easing:v=(w=>w*(2-w))}=l,{cap:O=!0,easing:T=(w=>--w*w*w+1)}=h;if(0===n.length||t<=0)return[];let Wt,x=n[n.length-1].runningLength,P=!1===l.taper?0:!0===l.taper?Math.max(t,x):l.taper,K=!1===h.taper?0:!0===h.taper?Math.max(t,x):h.taper,nt=Math.pow(t*i,2),bt=[],ut=[],Gt=n.slice(0,10).reduce((w,I)=>{let E=I.pressure;if(o){let D=dt(1,I.distance/t),Lt=dt(1,1-D);E=dt(1,w+.275*D*(Lt-w))}return(w+E)/2},n[0].pressure),X=Kt(t,s,n[n.length-1].pressure,a),$t=n[0].vector,Pt=n[0].point,Ot=Pt,st=Pt,rt=Ot,Ft=!1;for(let w=0;w<n.length;w++){let{pressure:I}=n[w],{point:E,vector:D,distance:Lt,runningLength:Mt}=n[w];if(w<n.length-1&&x-Mt<3)continue;if(s){if(o){let tt=dt(1,Lt/t),Vt=dt(1,1-tt);I=dt(1,Gt+.275*tt*(Vt-Gt))}X=Kt(t,s,I,a)}else X=t/2;void 0===Wt&&(Wt=X);let Ni=Mt<P?v(Mt/P):1,zi=x-Mt<K?T((x-Mt)/K):1;X=Math.max(.01,X*Math.min(Ni,zi));let ve=(w<n.length-1?n[w+1]:n[w]).vector,jt=w<n.length-1?Zt(D,ve):1,Se=null!==jt&&jt<0;if(Zt(D,$t)<0&&!Ft||Se){let tt=G(vt($t),X);for(let Vt=1/13,Xt=0;Xt<=1;Xt+=Vt)st=St(U(E,tt),E,xt*Xt),bt.push(st),rt=St(Y(E,tt),E,xt*-Xt),ut.push(rt);Pt=st,Ot=rt,Se&&(Ft=!0);continue}if(Ft=!1,w===n.length-1){let tt=G(vt(D),X);bt.push(U(E,tt)),ut.push(Y(E,tt));continue}let xe=G(vt(Ut(ve,D,jt)),X);st=U(E,xe),(w<=1||qt(Pt,st)>nt)&&(bt.push(st),Pt=st),rt=Y(E,xe),(w<=1||qt(Ot,rt)>nt)&&(ut.push(rt),Ot=rt),Gt=I,$t=D}let Z=n[0].point.slice(0,2),q=n.length>1?n[n.length-1].point.slice(0,2):Y(n[0].point,[1,1]),Ht=[],It=[];if(1===n.length){if(!P&&!K||c){let w=ee(Z,te(vt(U(Z,q))),-(Wt||X)),I=[];for(let E=1/13,D=E;D<=1;D+=E)I.push(St(w,Z,2*xt*D));return I}}else{if(!(P||K&&1===n.length))if(p)for(let I=1/13,E=I;E<=1;E+=I){let D=St(ut[0],Z,xt*E);Ht.push(D)}else{let I=U(bt[0],ut[0]),E=G(I,.5),D=G(I,.51);Ht.push(U(Z,E),U(Z,D),Y(Z,D),Y(Z,E))}let w=vt(function Re(n){return[-n[0],-n[1]]}(n[n.length-1].vector));if(K||P&&1===n.length)It.push(q);else if(O){let I=ee(q,w,X);for(let E=1/29,D=E;D<1;D+=E)It.push(St(I,q,3*xt*D))}else It.push(Y(q,G(w,X)),Y(q,G(w,.99*X)),U(q,G(w,.99*X)),U(q,G(w,X)))}return bt.concat(It,ut.reverse(),Ht)}(function Ue(n,e={}){var t;let{streamline:i=.5,size:s=16,last:o=!1}=e;if(0===n.length)return[];let a=.15+.85*(1-i),l=Array.isArray(n[0])?n:n.map(({x:T,y:x,pressure:P=.5})=>[T,x,P]);if(2===l.length){let T=l[1];l=l.slice(0,-1);for(let x=1;x<5;x++)l.push(Ut(l[0],T,x/4))}1===l.length&&(l=[...l,[...Y(l[0],[1,1]),...l[0].slice(2)]]);let h=[{point:[l[0][0],l[0][1]],pressure:l[0][2]>=0?l[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],c=!1,p=0,v=h[0],O=l.length-1;for(let T=1;T<l.length;T++){let x=o&&T===O?l[T].slice(0,2):Ut(v.point,l[T],a);if(Ie(v.point,x))continue;let P=Ae(x,v.point);if(p+=P,T<O&&!c){if(p<s)continue;c=!0}v={point:x,pressure:l[T][2]>=0?l[T][2]:.5,vector:te(U(v.point,x)),distance:P,runningLength:p},h.push(v)}return h[0].vector=(null==(t=h[1])?void 0:t.vector)||[0,0],h}(n,e),e)}(n,{...We,size:e}))}function ne(n){let e=1/0,t=1/0,i=-1/0,s=-1/0;for(const[o,a]of n)e=Math.min(e,o),t=Math.min(t,a),i=Math.max(i,o),s=Math.max(s,a);return{minX:e,minY:t,maxX:i,maxY:s,width:i-e,height:s-t}}function Fe(n,e,t,i){return n.minX-i<=Math.max(e.x,t.x)&&n.maxX+i>=Math.min(e.x,t.x)&&n.minY-i<=Math.max(e.y,t.y)&&n.maxY+i>=Math.min(e.y,t.y)}const se={[C.R.Arrow]:new class ke{create(e){return{type:C.R.Arrow,id:z(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,...e,style:{...W,...e.style}}}resize(e,t,i,s){return t.includes(m.OP.N)&&(e.y2+=s),t.includes(m.OP.S)&&(e.y1+=s),t.includes(m.OP.W)&&(e.x1+=i),t.includes(m.OP.E)&&(e.x2+=i),e}getBounds(e){const t=e.x1+e.x,i=e.y1+e.y,s=e.x2+e.x,o=e.y2+e.y;return{minX:Math.min(t,s),minY:Math.min(i,o),maxX:Math.max(t,s),maxY:Math.max(i,o),width:Math.abs(s-t),height:Math.abs(o-i)}}hitTest(e,t,i,s){const{x1:o,y1:a,x2:l,y2:h}=e;return Jt(o,a,l,h,t,i,s)}},[C.R.Ellipse]:new class Te{create(e){return{type:C.R.Ellipse,id:z(),x:0,y:0,cx:0,cy:0,rx:1,ry:1,rotation:0,opacity:100,...e,style:{...W,...e.style}}}resize(e,t,i,s){if(t.includes(m.OP.N)){const o=e.ry-s/2;o>0&&(e.ry=o,e.cy+=s/2)}if(t.includes(m.OP.S)){const o=e.ry+s/2;o>0&&(e.ry=o,e.cy+=s/2)}if(t.includes(m.OP.W)){const o=e.rx-i/2;o>0&&(e.rx=o,e.cx+=i/2)}if(t.includes(m.OP.E)){const o=e.rx+i/2;o>0&&(e.rx=o,e.cx+=i/2)}return e}getBounds(e){const t=e.cx+e.x,i=e.cy+e.y;return{minX:t-e.rx,minY:i-e.ry,maxX:t+e.rx,maxY:i+e.ry,width:2*e.rx,height:2*e.ry}}hitTest(e,t,i,s){const{cx:o,cy:a,rx:l,ry:h}=e;return function Pe(n,e,t,i,s,o,a){return yt(n,e,s,o)<=Math.max(t,i)+a}(o,a,l,h,t,i,s)}},[C.R.Image]:new class Be{create(e){return{type:C.R.Image,id:z(),x:0,y:0,width:1,height:1,src:"",rotation:0,opacity:100,...e,style:{...W,...e.style}}}resize(e,t,i,s){if(t.includes(m.OP.N)){const o=e.height-s;o>0&&(e.y+=s,e.height=o)}if(t.includes(m.OP.S)){const o=e.height+s;o>0&&(e.height=o)}if(t.includes(m.OP.W)){const o=e.width-i;o>0&&(e.x+=i,e.width=o)}if(t.includes(m.OP.E)){const o=e.width+i;o>0&&(e.width=o)}return e}getBounds(e){return{minX:e.x,minY:e.y,maxX:e.x+e.width,maxY:e.y+e.height,width:e.width,height:e.height}}hitTest(e,t,i,s){return zt(this.getBounds(e),t,i,s)}},[C.R.Line]:new class De{create(e){return{type:C.R.Line,id:z(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,...e,style:{...W,...e.style}}}resize(e,t,i,s){return t.includes(m.OP.N)&&(e.y1+=s),t.includes(m.OP.S)&&(e.y2+=s),t.includes(m.OP.W)&&(e.x1+=i),t.includes(m.OP.E)&&(e.x2+=i),e}getBounds(e){const t=e.x1+e.x,i=e.y1+e.y,s=e.x2+e.x,o=e.y2+e.y;return{minX:Math.min(t,s),minY:Math.min(i,o),maxX:Math.max(t,s),maxY:Math.max(i,o),width:Math.abs(s-t),height:Math.abs(o-i)}}hitTest(e,t,i,s){const{x1:o,y1:a,x2:l,y2:h}=e;return Jt(o,a,l,h,t,i,s)}},[C.R.Pen]:new class He{create(e){return{type:C.R.Pen,id:z(),x:0,y:0,points:[],path:"",rotation:0,opacity:100,...e,style:{...W,...e.style}}}resize(e,t,i,s){const o=ne(e.points),{points:a,position:l}=this.getScaleFactors(t,o,i,s),h=o.minX+o.width/2,c=o.minY+o.height/2,[p,v]=a;return o.width*p<10||o.height*v<10||(e.x+=l.x,e.y+=l.y,e.points=e.points.map(O=>[h+(O[0]-h)*p,c+(O[1]-c)*v]),e.path=Yt(e.points)),e}getScaleFactors(e,t,i,s){const o=[1,1],a={x:0,y:0};return e.includes("w")&&(o[0]=(t.width-i)/t.width,a.x+=i/2),e.includes("n")&&(o[1]=(t.height-s)/t.height,a.y+=s/2),e.includes("e")&&(o[0]=(t.width+i)/t.width,a.x+=i/2),e.includes("s")&&(o[1]=(t.height+s)/t.height,a.y+=s/2),{points:o,position:a}}getBounds(e){const{minX:t,minY:i,maxX:s,maxY:o,width:a,height:l}=ne(e.points);return{minX:t+e.x,minY:i+e.y,maxX:s+e.x,maxY:o+e.y,width:a,height:l}}hitTest(e,t,i,s){return function Me(n,e,t,i){for(let s=0;s<n.length-1;s++){const o={x:n[s][0],y:n[s][1]},a={x:n[s+1][0],y:n[s+1][1]};if(yt(e.x,e.y,o,a)<=i||yt(t.x,t.y,o,a)<=i)return!0}return!1}(e.points,t,i,s)}},[C.R.Rectangle]:new class Le{create(e){return{type:C.R.Rectangle,id:z(),x:0,y:0,width:1,height:1,rx:5,rotation:0,opacity:100,...e,style:{...W,...e.style}}}resize(e,t,i,s){if(t.includes(m.OP.N)){const o=e.height-s;o>0&&(e.y+=s,e.height=o)}if(t.includes(m.OP.S)){const o=e.height+s;o>0&&(e.height=o)}if(t.includes(m.OP.W)){const o=e.width-i;o>0&&(e.x+=i,e.width=o)}if(t.includes(m.OP.E)){const o=e.width+i;o>0&&(e.width=o)}return e}getBounds(e){return{minX:e.x,minY:e.y,maxX:e.x+e.width,maxY:e.y+e.height,width:e.width,height:e.height}}hitTest(e,t,i,s){return zt(this.getBounds(e),t,i,s)}},[C.R.Text]:new class je{create(e){return{type:C.R.Text,id:z(),x:0,y:0,text:"",rotation:0,opacity:100,scaleX:1,scaleY:1,...e,style:{...ht,...e.style}}}resize(e,t,i,s){const l=.016*i,h=.016*s;switch(t){case m.OP.NW:e.x+=i,e.y+=s,e.scaleX=Math.max(.1,e.scaleX-l),e.scaleY=Math.max(.1,e.scaleY-h);break;case m.OP.N:e.y+=s,e.scaleY=Math.max(.1,e.scaleY-h);break;case m.OP.NE:e.y+=s,e.scaleX=Math.max(.1,e.scaleX+l),e.scaleY=Math.max(.1,e.scaleY-h);break;case m.OP.E:e.scaleX=Math.max(.1,e.scaleX+l);break;case m.OP.SE:e.scaleX=Math.max(.1,e.scaleX+l),e.scaleY=Math.max(.1,e.scaleY+h);break;case m.OP.S:e.scaleY=Math.max(.1,e.scaleY+h);break;case m.OP.SW:e.x+=i,e.scaleX=Math.max(.1,e.scaleX-l),e.scaleY=Math.max(.1,e.scaleY+h);break;case m.OP.W:e.x+=i,e.scaleX=Math.max(.1,e.scaleX-l)}return e}getBounds(e){const{text:t,x:i,y:s,scaleX:o,scaleY:a,style:l}=e,h=l.fontSize??ht.fontSize??16,c=.5*h,p=t.split("\n"),O=c*p.reduce((x,P)=>Math.max(x,P.length),0)*o,T=h*p.length*a;return{minX:i,minY:s,maxX:i+O,maxY:s+T,width:O,height:T}}hitTest(e,t,i,s){return zt(this.getBounds(e),t,i,s)}}};function Ct(n){return se[n]}function it(n,e){return se[n].create(e)}var k=u(872),y=function(n){return n.Ready="ready",n.Destroyed="destroyed",n.DrawStart="drawStart",n.Drawing="drawing",n.DrawEnd="drawEnd",n.ElementsAdded="elementsAdded",n.ElementsUpdated="elementsUpdated",n.ElementsSelected="elementsSelected",n.ElementsDeleted="elementsDeleted",n.Undo="undo",n.Redo="redo",n.Clear="clear",n.DataChange="dataChange",n.Save="save",n.ImageAdded="imageAdded",n.ToolChange="toolChange",n.ConfigChange="configChange",n}(y||{});function re(n,e){const t=document.createElement("a");t.href=n,t.setAttribute("visibility","hidden"),t.download=e||"new white-board",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function Qe(n){return Ct(n.type).getBounds(n)}var Dt=u(1413);let wt=(()=>{class n{constructor(){this.eventSubject=new Dt.B}ngOnDestroy(){this.destroy()}emit(t,i){this.eventSubject.next({type:t,payload:i})}listen(){return this.eventSubject.asObservable()}listenTo(t){return this.eventSubject.pipe((0,Bt.p)(i=>i.type===t),(0,lt.T)(i=>i.payload))}destroy(){this.eventSubject.complete()}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275prov=r.jDH({token:n,factory:n.\u0275fac})}}return n})(),Rt=(()=>{class n{constructor(t){this.eventBusService=t,this.config={drawingEnabled:!0,canvasWidth:800,canvasHeight:600,fullScreen:!0,center:!0,strokeColor:"#333333",strokeWidth:2,backgroundColor:"#F8F9FA",lineJoin:m.pP.Miter,lineCap:m.$3.Butt,fill:"transparent",zoom:1,fontFamily:"sans-serif",fontSize:24,dasharray:"",dashoffset:0,x:0,y:0,enableGrid:!1,gridSize:10,snapToGrid:!0,gridTranslation:{x:0,y:0},elementsTranslation:{x:0,y:0}}}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t},this.eventBusService.emit(y.ConfigChange,t)}isConfigDifferent(t,i){return this.config[t]!==i}updateConfigValue(t,i){this.config[t]=i,this.eventBusService.emit(y.ConfigChange,{[t]:i})}checkAndUpdateConfig(t,i){this.isConfigDifferent(t,i)&&this.updateConfigValue(t,i)}static{this.\u0275fac=function(i){return new(i||n)(r.KVO(wt))}}static{this.\u0275prov=r.jDH({token:n,factory:n.\u0275fac})}}return n})(),Et=(()=>{class n{constructor(t,i,s){this.EventBusService=t,this.configService=i,this.undoStack=[],this.redoStack=[],this.initialData=[],this.data=new J.t([]),this.draftData=new J.t([]),this.selectedTool=new J.t(k.p.Pen),this.selectedElementIds=new J.t(new Set),this.selectionBox=new J.t({x:0,y:0,width:0,height:0,visible:!1}),this.boundingBox=new J.t(null),this.svgContainer=null,this.data$=this.data.pipe(et(this.draftData),(0,lt.T)(([o,a])=>[...o,...a])),this.selectedTool$=this.selectedTool.asObservable(),this.selectionBox$=this.selectionBox.asObservable(),this.boundingBox$=this.boundingBox.asObservable(),this.debouncedPushToUndo=function Ve(n,e){let t;return(...i)=>{clearTimeout(t),t=setTimeout(()=>n(...i),e)}}(()=>this.pushToUndo(),300),this.renderer=s.createRenderer(null,null)}initializeWhiteboard(t){this.svgContainer=t,this.initialData=JSON.parse(JSON.stringify(this.data.getValue())),this.EventBusService.emit(y.Ready)}getCanvas(){if(!this.svgContainer)throw new Error("SVG container not initialized");return this.svgContainer}getConfig(){return this.configService.getConfig()}getData(){return this.data.getValue()}getData$(){return this.data$}getElementById(t){return this.getData().find(i=>i.id===t)}setData(t){this.data.next(t),this.EventBusService.emit(y.DataChange,t)}getDraftData(){return this.draftData.getValue()}pushToUndo(){this.undoStack.push(JSON.parse(JSON.stringify(this.getData()))),this.undoStack.length>b.GF&&this.undoStack.shift(),this.redoStack=[]}undo(){if(!this.undoStack.length)return!1;const t=this.undoStack.pop();return this.redoStack.push(t),this.setData(this.undoStack.length?JSON.parse(JSON.stringify(this.undoStack[this.undoStack.length-1])):JSON.parse(JSON.stringify(this.initialData))),this.clearSelection(),this.EventBusService.emit(y.Undo),!0}redo(){if(!this.redoStack.length)return!1;const t=this.redoStack.pop();return this.undoStack.push(JSON.parse(JSON.stringify(t))),this.undoStack.length>b.GF&&this.undoStack.shift(),this.setData(t),this.clearSelection(),this.EventBusService.emit(y.Redo),!0}clear(){this.setData([]),this.pushToUndo(),this.EventBusService.emit(y.Clear)}addElements(t){const i=this.getData(),s=Array.isArray(t)?t:[t];this.setData([...i,...s]),this.pushToUndo(),this.EventBusService.emit(y.ElementsAdded,s)}addToDraft(t){this.draftData.next([...this.draftData.getValue(),t])}updateDraft(t){const i=this.draftData.getValue(),s=i.findIndex(o=>o.id===t.id);s>-1&&(i[s]=t,this.draftData.next(i))}commitDraftToData(){const t=this.draftData.getValue();t.length&&(this.setData([...this.data.getValue(),...t]),this.pushToUndo(),this.draftData.next([]))}updateElements(t,i=!0){const s=Array.isArray(t)?t:[t],o=this.getData();s.forEach(a=>{const l=o.findIndex(h=>h.id===a.id);l>-1&&(o[l]={...o[l],...a})}),this.setData(o),i&&(this.pushToUndo(),this.EventBusService.emit(y.ElementsUpdated,s))}removeElements(t,i=!0){const s=Array.isArray(t)?t:[t],o=s.map(a=>"string"==typeof a?a:a.id);if(s.length){const a=this.getData();this.EventBusService.emit(y.ElementsDeleted);const l=a.filter(h=>!o.includes(h.id));i&&(this.setData(l),this.pushToUndo())}}hasElement(t){return this.getData().some(i=>i.id===t.id)}getActiveTool(){return this.selectedTool.getValue()}setActiveTool(t){this.selectedTool.next(t),this.EventBusService.emit(y.ToolChange,t)}selectElements(t,i=!1){const o=(Array.isArray(t)?t:[t]).map(h=>"string"==typeof h?h:h.id),a=Array.from(this.selectedElementIds.getValue()),l=i?[...new Set([...a,...o])]:o;this.selectedElementIds.next(new Set(l)),this.updateBoundingBox(),this.EventBusService.emit(y.ElementsSelected,l.map(h=>this.getElementById(h)))}toggleSelection(t){const i="string"==typeof t?t:t.id,s=new Set(this.selectedElementIds.getValue());s.has(i)?s.delete(i):s.add(i),this.selectedElementIds.next(s),this.updateBoundingBox()}deselectElement(t){const i="string"==typeof t?t:t.id,s=new Set(this.selectedElementIds.getValue());s.delete(i),this.selectedElementIds.next(s),this.updateBoundingBox()}clearSelection(){this.selectedElementIds.getValue().size>0&&(this.selectedElementIds.next(new Set),this.clearBoundingBox(),this.EventBusService.emit(y.ElementsSelected,[]))}selectAll(){const t=new Set(this.getData().map(i=>i.id));this.selectedElementIds.next(t),this.updateBoundingBox()}getSelectedIds(){return Array.from(this.selectedElementIds.getValue())}getSelectedElements(){const t=this.getSelectedIds();return this.getData().filter(i=>t.includes(i.id))}updateSelectedElements(t){const i=this.getSelectedElements();i.forEach(s=>{const o={...s,...t};this.updateElements(o,!1)}),this.updateBoundingBox(),this.EventBusService.emit(y.ElementsSelected,i),this.debouncedPushToUndo()}transformSelectedElements(t){const i=this.getSelectedElements(),s=t(i);this.updateElements(s,!1),this.updateBoundingBox(),this.EventBusService.emit(y.ElementsSelected,i),this.debouncedPushToUndo()}updateBoundingBox(){const t=this.getSelectedElements();if(0===t.length)return void this.clearBoundingBox();const i=t.map(Qe),s=Math.min(...i.map(x=>x.minX)),o=Math.min(...i.map(x=>x.minY)),a=Math.max(...i.map(x=>x.maxX)),l=Math.max(...i.map(x=>x.maxY)),h=a-s;let O=0;1===t.length&&(O=t[0].rotation||0),this.boundingBox.next({x:s,y:o,width:h,height:l-o,handles:{topLeft:{x:s,y:o},topRight:{x:a,y:o},bottomLeft:{x:s,y:l},bottomRight:{x:a,y:l},rotateHandle:{x:s+h/2,y:o-20}},rotation:O})}getBoundingBox(){return this.boundingBox.getValue()}clearBoundingBox(){this.boundingBox.next(null)}setSelectionBox(t){this.selectionBox.next(t)}getSelectionBox(){return this.selectionBox.getValue()}clearSelectionBox(){this.selectionBox.next({x:0,y:0,width:0,height:0,visible:!1})}setCanvasDimensions(t,i){this.configService.updateConfig({canvasWidth:t,canvasHeight:i})}setCanvasPosition(t,i){this.configService.updateConfig({x:t,y:i})}updateGridTranslation(t,i){this.configService.updateConfig({gridTranslation:{x:t,y:i}})}updateElementsTranslation(t,i){this.configService.updateConfig({elementsTranslation:{x:t,y:i}})}fullScreen(){this.setCanvasDimensions(this.svgContainer?.clientWidth||0,this.svgContainer?.clientHeight||0)}centerCanvas(){const{canvasWidth:t,canvasHeight:i,zoom:s}=this.getConfig();this.setCanvasPosition(((this.svgContainer?.clientWidth||0)-t*s)/2,((this.svgContainer?.clientHeight||0)-i*s)/2)}toggleGrid(){const{enableGrid:t}=this.getConfig();this.configService.updateConfig({enableGrid:!t})}addImage(t){const i=new Image;i.onload=()=>{const s=this.getConfig().canvasHeight,o=i.width,a=i.height,h=a>s?s-40:a,c=h===s-40?i.width/i.height*(s-40):o;let p=t.x||(o-c)*(t.x||0),v=t.y||(a-h)*(t.y||0);p<0&&(p=0),v<0&&(v=0);const O=it(C.R.Image,{src:t.image,width:c,height:h,x:p,y:v});this.addElements(O),this.selectElements(O),this.pushToUndo(),this.EventBusService.emit(y.ImageAdded,O.src)},i.src=t.image}save(t,i="New board"){var s=this;return(0,_t.A)(function*(){const a=s.getCanvas().getElementById("svgcontent").cloneNode(!0),l=a.querySelector("#selectorParentGroup");l&&l.remove();const h=a.querySelector("#contentBackground");h&&h.removeAttribute("opacity"),a.setAttribute("x","0"),a.setAttribute("y","0");const c=(new XMLSerializer).serializeToString(a),p=yield function Je(n,e,t,i=m.o8.Png){return new Promise((s,o)=>{const a=document.createElement("canvas");a.width=e,a.height=t;const l=a.getContext("2d"),h=new Image;h.src=`data:image/svg+xml;base64,${btoa(n)}`,h.onload=()=>{l.drawImage(h,0,0,e,t);const c=a.toDataURL(`image/${i}`);s(c)},h.onerror=c=>{o(c)}})}(c,s.getConfig().canvasWidth,s.getConfig().canvasHeight,t);switch(t){case m.o8.Base64:s.EventBusService.emit(y.Save,p);break;case m.o8.Svg:{const v="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(c)));re(v,i),s.EventBusService.emit(y.Save,v);break}default:re(p,i),s.EventBusService.emit(y.Save,p)}})()}static{this.\u0275fac=function(i){return new(i||n)(r.KVO(wt),r.KVO(Rt),r.KVO(r._9s))}}static{this.\u0275prov=r.jDH({token:n,factory:n.\u0275fac})}}return n})();var oe=u(8306);let ae=(()=>{class n{constructor(t,i){this._dataService=t,this._whiteboardService=i,this.initializeActionListeners()}initializeActionListeners(){this._whiteboardService.actions$.pipe((0,Bt.p)(t=>t.length>0)).subscribe(t=>{t.forEach(i=>this.handleAction(i))})}handleAction(t){switch(t.type){case f.X.Undo:this._dataService.undo();break;case f.X.Redo:this._dataService.redo();break;case f.X.Clear:this._dataService.clear();break;case f.X.UpdateSelectedElements:this._dataService.updateSelectedElements(t.payload.partialElement);break;case f.X.Save:{const{format:i,name:s}=t.payload;this._dataService.save(i,s);break}case f.X.AddElement:this._dataService.addElements(t.payload.element);break;case f.X.UpdateElement:this._dataService.updateElements(t.payload.element);break;case f.X.RemoveElements:this._dataService.removeElements(t.payload.ids);break;case f.X.SelectElements:this._dataService.selectElements(t.payload.elementsOrIds);break;case f.X.SetActiveTool:this._dataService.setActiveTool(t.payload.tool);break;case f.X.ToggleSelection:this._dataService.toggleSelection(t.payload.elementOrId);break;case f.X.DeselectElement:this._dataService.deselectElement(t.payload.elementOrId);break;case f.X.SelectAll:this._dataService.selectAll();break;case f.X.ClearSelection:this._dataService.clearSelection();break;case f.X.ToggleGrid:this._dataService.toggleGrid();break;case f.X.AddImage:this._dataService.addImage(t.payload);break;case f.X.SetCanvasDimensions:{const{width:i,height:s}=t.payload;this._dataService.setCanvasDimensions(i,s);break}case f.X.SetCanvasPosition:{const{x:i,y:s}=t.payload;this._dataService.setCanvasPosition(i,s);break}case f.X.UpdateGridTranslation:{const{dx:i,dy:s}=t.payload;this._dataService.updateGridTranslation(i,s);break}case f.X.UpdateElementsTranslation:{const{dx:i,dy:s}=t.payload;this._dataService.updateElementsTranslation(i,s);break}case f.X.FullScreen:this._dataService.fullScreen();break;case f.X.CenterCanvas:this._dataService.centerCanvas();break;case f.X.Batch:t.payload.forEach(i=>this.handleAction(i))}}static{this.\u0275fac=function(i){return new(i||n)(r.KVO(Et),r.KVO(oe.K))}}static{this.\u0275prov=r.jDH({token:n,factory:n.\u0275fac})}}return n})();function le(n,e,t,i){const s=Math.PI/4,o=t-n,a=i-e,l=Math.atan2(a,o),h=Math.sqrt(o*o+a*a),c=Math.round(l/s)*s;return{x:n+h*Math.cos(c),y:e+h*Math.sin(c),a:c}}function R(n,e){return Math.round(n/e)*e}class H{constructor(e){this.dataService=e,this.active=!1}get whiteboardConfig(){return this.dataService?.getConfig()}getPointerPosition(e){return function Ke(n,{x:e,y:t}){const{zoom:i,x:s,y:o,elementsTranslation:a}=n;return{x:(e-s)/i-a.x,y:(t-o)/i-a.y}}(this.dataService.getConfig(),{x:e.offsetX,y:e.offsetY})}activate(){this.active=!0,this.onActivate?.()}deactivate(){this.active=!1,this.onDeactivate?.()}get isActive(){return this.active}}class Ze extends H{constructor(){super(...arguments),this.type=k.p.Hand,this.isDragging=!1,this.startX=0,this.startY=0}handlePointerDown(e){this.isDragging=!0,this.startX=e.clientX,this.startY=e.clientY}handlePointerMove(e){if(!this.isDragging)return;const t=e.clientX-this.startX,i=e.clientY-this.startY,{gridTranslation:s,elementsTranslation:o}=this.dataService.getConfig(),l={x:o.x+t,y:o.y+i};this.updateGridPosition((s.x+t)%100,(s.y+i)%100),this.updateElementsPosition(l.x,l.y),this.startX=e.clientX,this.startY=e.clientY}handlePointerUp(){this.isDragging=!1}updateGridPosition(e,t){this.dataService.updateGridTranslation(e,t)}updateElementsPosition(e,t){this.dataService.updateElementsTranslation(e,t)}}class qe extends H{constructor(){super(...arguments),this.type=k.p.Arrow,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(e){if(!this.active)return;const t=this.getPointerPosition(e);let{x:i,y:s}=t;const{snapToGrid:o}=this.whiteboardConfig;if(o){const{gridSize:a}=this.whiteboardConfig;i=R(i,a),s=R(s,a)}this.startPoint={x:i,y:s},this.lastX=i,this.lastY=s,this.element=it(C.R.Arrow,{x1:i,y1:s,x2:i,y2:s,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;const t=this.getPointerPosition(e);let i=t.x,s=t.y;const{snapToGrid:o}=this.whiteboardConfig;if(o){const{gridSize:a}=this.whiteboardConfig;i=R(i,a),s=R(s,a)}if(e.shiftKey){const a=this.element.x1,l=this.element.y1,{x:h,y:c}=le(a,l,i,s);i=h,s=c}(Math.abs(i-this.lastX)>this.MIN_LENGTH||Math.abs(s-this.lastY)>this.MIN_LENGTH)&&(this.element.x2=i,this.element.y2=s,this.lastX=i,this.lastY=s)}handlePointerUp(){this.active&&(this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null),this.lastX=0,this.lastY=0)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class ti extends H{constructor(){super(...arguments),this.type=k.p.Ellipse,this.element=null,this.startPoint=null}handlePointerDown(e){if(!this.active)return;let{x:t,y:i}=this.getPointerPosition(e);const{snapToGrid:s}=this.whiteboardConfig;if(s){const{gridSize:o}=this.whiteboardConfig;t=R(t,o),i=R(i,o)}this.startPoint={x:t,y:i},this.element=it(C.R.Ellipse,{cx:t,cy:i,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element||!this.startPoint)return;const{x:t,y:i}=this.getPointerPosition(e),s=this.startPoint.x,o=this.startPoint.y;let a=Math.abs(s+(t-s)/2),l=Math.abs(o+(i-o)/2),h=Math.abs(s-a),c=Math.abs(o-l);e.shiftKey&&(c=h,l=i>o?o+h:o-h),e.altKey&&(a=s,l=o,h=Math.abs(t-a),c=e.shiftKey?h:Math.abs(i-l)),this.element.rx=h,this.element.ry=c,this.element.cx=a,this.element.cy=l}handlePointerUp(){this.active&&this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class ei extends H{constructor(){super(...arguments),this.type=k.p.Eraser,this.isErasing=!1,this.hoveredElementIds=new Set,this.lastPosition=null}handlePointerDown(e){if(!this.active)return;this.hoveredElementIds.clear();const t=this.getPointerPosition(e);this.isErasing=!0,this.eraseElementsAt(t,t),this.lastPosition=t}handlePointerMove(e){if(!this.active||!this.isErasing||!this.lastPosition)return;const t=this.getPointerPosition(e);this.eraseElementsAt(this.lastPosition,t,e.altKey),this.lastPosition=t}handlePointerUp(){if(this.active){if(this.hoveredElementIds.size>0){const e=Array.from(this.hoveredElementIds);this.dataService.updateElements(e.map(t=>({id:t,isDeleting:!1})),!1),this.dataService.removeElements(e)}this.hoveredElementIds.clear(),this.isErasing=!1,this.lastPosition=null}}eraseElementsAt(e,t,i=!1){const s=this.dataService.getData(),o=this.dataService.getConfig()?.zoom||1,a=Math.hypot(t.x-e.x,t.y-e.y),c=10/o+a*(.5*Math.log2(a+1));for(const p of s)Fe(Ct(p.type).getBounds(p),e,t,c)&&this.isPointInElement(p,e,t,c)&&(i&&(this.hoveredElementIds.delete(p.id),p.isDeleting=!1),!i&&!this.hoveredElementIds.has(p.id)&&(this.hoveredElementIds.add(p.id),p.isDeleting=!0),this.dataService.updateElements(p,!1))}isPointInElement(e,t,i,s){return Ct(e.type).hitTest(e,t,i,s)}}class ii extends H{constructor(){super(...arguments),this.type=k.p.Image}handlePointerDown(e){const{x:t,y:i}=this.getPointerPosition(e),s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=o=>{const a=o.target.files;if(a){const l=new FileReader;l.onload=h=>{this.dataService.addImage({image:h.target.result,x:t,y:i})},l.readAsDataURL(a[0])}},s.click()}}class ni extends H{constructor(){super(...arguments),this.type=k.p.Line,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(e){if(!this.active)return;let{x:t,y:i}=this.getPointerPosition(e);const{snapToGrid:s}=this.whiteboardConfig;if(s){const{gridSize:o}=this.whiteboardConfig;t=R(t,o),i=R(i,o)}this.startPoint={x:t,y:i},this.lastX=t,this.lastY=i,this.element=it(C.R.Line,{x1:t,y1:i,x2:t,y2:i,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;const t=this.getPointerPosition(e);let i=t.x,s=t.y;const{snapToGrid:o}=this.whiteboardConfig;if(o){const{gridSize:a}=this.whiteboardConfig;i=R(i,a),s=R(s,a)}if(e.shiftKey){const a=this.element.x1,l=this.element.y1,{x:h,y:c}=le(a,l,i,s);[i,s]=[h,c]}(Math.abs(i-this.lastX)>this.MIN_LENGTH||Math.abs(s-this.lastY)>this.MIN_LENGTH)&&(this.element.x2=i,this.element.y2=s,this.lastX=i,this.lastY=s)}handlePointerUp(){this.active&&(this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null),this.lastX=0,this.lastY=0)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class si extends H{constructor(){super(...arguments),this.type=k.p.Pen,this.element=null}handlePointerDown(e){if(!this.active)return;const t=this.getPointerPosition(e);this.element=it(C.R.Pen,{points:[[t.x,t.y]],path:Yt([[t.x,t.y]]),style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;const{x:t,y:i}=this.getPointerPosition(e),s=this.element.points;s.push([t,i]),this.element.points=s,this.element.path=Yt(s)}handlePointerUp(){this.active&&this.element&&(this.dataService.commitDraftToData(),this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,lineJoin:this.whiteboardConfig.lineJoin,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class ri extends H{constructor(){super(...arguments),this.type=k.p.Rectangle,this.element=null,this.startPoint=null}handlePointerDown(e){if(!this.active)return;let{x:t,y:i}=this.getPointerPosition(e);const{snapToGrid:s}=this.whiteboardConfig;if(s){const{gridSize:o}=this.whiteboardConfig;t=R(t,o),i=R(i,o)}this.startPoint={x:t,y:i},this.element=it(C.R.Rectangle,{x:t,y:i,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element||!this.startPoint)return;const{x:t,y:i}=this.getPointerPosition(e),s=this.startPoint.x,o=this.startPoint.y;let a=Math.abs(t-s),l=Math.abs(i-o),h=null,c=null;e.shiftKey?(a=l=Math.max(a,l),h=s<t?s:s-a,c=o<i?o:o-l):(h=Math.min(s,t),c=Math.min(o,i)),e.altKey&&(a*=2,l*=2,h=s-a/2,c=o-l/2);const{snapToGrid:p}=this.whiteboardConfig;if(p){const{gridSize:v}=this.whiteboardConfig;a=R(a,v),l=R(l,v),h=R(h,v),c=R(c,v)}this.element.width=a,this.element.height=l,this.element.x=h,this.element.y=c}handlePointerUp(){this.active&&this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineJoin:this.whiteboardConfig.lineJoin,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}function he(n){if(!n?.target)return null;let e=n.target;for(;e;){if(e.id===b.wM)return null;if(e.id.includes(b.RZ)||e.id.includes(b.YO)||e.id.includes(b.i$))return e;if(!e.parentNode)break;e=e.parentNode}return null}var N=function(n){return n[n.None=0]="None",n[n.Select=1]="Select",n[n.Move=2]="Move",n[n.Resize=3]="Resize",n[n.Rotate=4]="Rotate",n[n.BoxSelect=5]="BoxSelect",n}(N||{});class ai extends H{constructor(){super(...arguments),this.type=k.p.Select,this.currentAction=N.None,this.startPoint=null,this.currentHandle=null,this.rotateStartAngle=null,this.rotateStartTransform=null,this.selectionCenter=null,this.SNAP_THRESHOLD=5,this.ROTATION_SNAP_ANGLES=[0,45,90,135,180,225,270,315]}getCurrentAction(){return this.currentAction}getStartPoint(){return this.startPoint}getCurrentHandle(){return this.currentHandle}handlePointerDown(e){const t=he(e),i=t?.id??"";if(this.startPoint=this.getPointerPosition(e),i.includes(b.RZ)){const s=t?.getAttribute(b.Bn)??null;this.handleElementSelect(s,e.shiftKey),this.currentAction=N.Move}else i.includes(b.Sb)?(this.currentHandle=this.getResizeDirection(i),this.currentAction=N.Resize):i.includes(b.Be)?(this.initializeRotation(e),this.currentAction=N.Rotate):i.includes(b.i$)?this.currentAction=N.Move:(this.initializeBoxSelect(e),this.currentAction=N.BoxSelect)}handlePointerMove(e){if(!this.startPoint)return;const t=this.getPointerPosition(e);switch(this.currentAction){case N.Move:this.handleMove(t,e.shiftKey);break;case N.Resize:this.handleResize(t,e.shiftKey);break;case N.Rotate:this.handleRotate(t,e.shiftKey);break;case N.BoxSelect:this.handleBoxSelect(t,e.shiftKey)}}handlePointerUp(){this.currentAction===N.BoxSelect&&this.dataService.clearSelectionBox(),this.currentAction=N.None,this.startPoint=null,this.currentHandle=null,this.rotateStartAngle=null,this.rotateStartTransform=null,this.selectionCenter=null}handleElementSelect(e,t){if(!e)return;const i=this.dataService.getElementById(e);i&&(t?this.dataService.toggleSelection(i):this.dataService.selectElements([i]))}handleMove(e,t){if(!this.startPoint)return;const i=e.x-this.startPoint.x,s=e.y-this.startPoint.y;let o=i,a=s;if(t){const l=Qt(i,s);o=l.x,a=l.y}this.dataService.transformSelectedElements(l=>l.map(h=>({...h,x:h.x+o,y:h.y+a}))),this.startPoint=e}handleResize(e,t){if(!this.startPoint||null===this.currentHandle)return;const i=this.currentHandle;if(!this.dataService.getSelectedElements().length)return;const o=e.x-this.startPoint.x,a=e.y-this.startPoint.y;let l=o,h=a;if(t){const c=Qt(o,a);l=c.x,h=c.y}this.dataService.transformSelectedElements(c=>c.map(p=>Ct(p.type).resize(p,i,l,h))),this.startPoint=e}handleRotate(e,t){if(!this.startPoint||!this.selectionCenter||null===this.rotateStartAngle)return;const i=F(this.selectionCenter,e),s=this.dataService.getSelectedElements();if(0===s.length)return;let o=i-this.rotateStartAngle;o>180&&(o-=360),o<-180&&(o+=360);let l=(s[0].rotation||0)+o;t&&(l=function Ce(n,e,t){const i=ct(n),s=e.reduce((a,l)=>Math.abs(i-l)<Math.abs(i-a)?l:a,e[0]);return Math.abs(i-s)<=t?s:n}(l,this.ROTATION_SNAP_ANGLES,this.SNAP_THRESHOLD)),this.dataService.transformSelectedElements(h=>h.map(c=>({...c,rotation:ct(l)}))),this.rotateStartAngle=i}handleBoxSelect(e,t){if(!this.startPoint)return;const i={x:Math.min(this.startPoint.x,e.x),y:Math.min(this.startPoint.y,e.y),width:Math.abs(e.x-this.startPoint.x),height:Math.abs(e.y-this.startPoint.y),visible:!0};this.dataService.setSelectionBox(i);const o=this.dataService.getData().filter(a=>this.checkElementInSelectionBox(a,i));this.dataService.selectElements(o,t),this.dataService.updateBoundingBox()}initializeBoxSelect(e){e.shiftKey||this.dataService.clearSelection();const{x:t,y:i}=this.getPointerPosition(e);this.dataService.setSelectionBox({x:t,y:i,width:0,height:0,visible:!0})}initializeRotation(e){const t=this.dataService.getBoundingBox();if(!t)return;this.selectionCenter={x:t.x+t.width/2,y:t.y+t.height/2};const i=this.getPointerPosition(e);this.rotateStartAngle=F(this.selectionCenter,i)}checkElementInSelectionBox(e,t){return function Ee(n,e){return n.minX<=e.x+e.width&&n.maxX>=e.x&&n.minY<=e.y+e.height&&n.maxY>=e.y}(Ct(e.type).getBounds(e),t)}getResizeDirection(e){const t=e.split("_")[2];let i;if(!Object.values(m.OP).includes(t))return m.OP.N;i=t;const s=this.dataService.getSelectedElements();return 0===s.length?i:function be(n,e){const t=Math.round(ct(e)/45)%8,i=Object.values(m.OP),o=(i.indexOf(n)+t)%8;return i[o]}(i,s[0].rotation||0)}onActivate(){this.dataService.clearSelection()}onDeactivate(){this.dataService.clearSelection()}}class li extends H{constructor(){super(...arguments),this.type=k.p.Text,this.textElement=null,this.textInput=null}handlePointerDown(e){if(!this.active)return;if(this.textInput)return void this.finishTextInput();const t=function oi(n,e){const t=he(n);if(t){if(t.id===b.Mt)return null;const i=t.getAttribute(b.Bn);return e.find(o=>o.id===i)||null}return null}(e,this.dataService.getData());if(t&&t.type===C.R.Text)return this.textElement=t,void this.createTextInput(t.x,t.y,t.text);const{x:i,y:s}=this.getPointerPosition(e);this.textElement=this.createTextElement(i,s),this.createTextInput(i,s)}handlePointerUp(){this.textInput&&(this.textInput.addEventListener("blur",()=>this.finishTextInput()),this.textInput.focus())}createTextElement(e,t){const{snapToGrid:i,gridSize:s}=this.whiteboardConfig;return it(C.R.Text,{x:i?R(e,s):e,y:i?R(t,s):t,text:"",style:this.getElementStyle()})}createTextInput(e,t,i=""){const{zoom:s,elementsTranslation:o}=this.whiteboardConfig,a=this.dataService.getCanvas().parentElement?.querySelector("#textInput");a.value=i,a.style.left=(e-Math.abs(o.x))*s+"px",a.style.top=(t-Math.abs(o.y))*s+"px",a.style.fontFamily=this.textElement?.style.fontFamily||this.whiteboardConfig.fontFamily,a.style.fontSize=`${this.textElement?.style.fontSize||this.whiteboardConfig.fontSize}px`,a.style.color=this.textElement?.style.color||this.whiteboardConfig.strokeColor,a.style.transform=`scale(${this.textElement?.scaleX||1}, ${this.textElement?.scaleY||1})`,a.style.display="block",a.addEventListener("input",()=>this.handleTextInput(a)),a.addEventListener("keydown",l=>{"Enter"===l.key&&this.finishTextInput()}),this.textInput=a}handleTextInput(e){e.style.width=`${e.value.length}ch`,this.textElement&&(this.textElement.text=e.value,this.dataService.updateElements(this.textElement))}finishTextInput(){this.textInput&&this.textElement&&(this.textInput.value.trim()?this.dataService.hasElement(this.textElement)||(this.dataService.addElements(this.textElement),this.dataService.pushToUndo()):this.dataService.removeElements([this.textElement.id]),this.textInput.style.display="none",this.textInput=null,this.textElement=null)}getElementStyle(){return{color:this.whiteboardConfig.strokeColor,fontSize:this.whiteboardConfig.fontSize,fontFamily:this.whiteboardConfig.fontFamily,lineJoin:this.whiteboardConfig.lineJoin,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,strokeColor:this.whiteboardConfig.fill,strokeWidth:0}}}let ce=(()=>{class n{constructor(t){this.dataService=t,this.toolRegistry=new Map,this.initializeDefaultTools(t),this.dataService.selectedTool$.pipe(S()).subscribe(i=>{this.setCurrentTool(i)})}registerTool(t,i){if(this.toolRegistry.has(t))throw new Error(`Tool of type '${t}' is already registered.`);this.toolRegistry.set(t,i)}initializeDefaultTools(t){this.registerTool(k.p.Hand,new Ze(t)),this.registerTool(k.p.Pen,new si(t)),this.registerTool(k.p.Line,new ni(t)),this.registerTool(k.p.Arrow,new qe(t)),this.registerTool(k.p.Rectangle,new ri(t)),this.registerTool(k.p.Ellipse,new ti(t)),this.registerTool(k.p.Text,new li(t)),this.registerTool(k.p.Image,new ii(t)),this.registerTool(k.p.Select,new ai(t)),this.registerTool(k.p.Eraser,new ei(t))}setCurrentTool(t){const i=this.currentTool,s=this.toolRegistry.get(t);if(i&&i.deactivate(),!s)throw new Error(`Tool of type '${t}' not found.`);s.activate(),this.currentTool=s}getCurrentTool(){const t=this.currentTool;if(!t)throw new Error("No active tool found.");return t}getCurrentToolType(){return this.currentTool.type}getTool(t){const i=this.toolRegistry.get(t);if(!i)throw new Error(`Tool of type '${t}' not found.`);return i}clearRegistry(){this.toolRegistry.clear()}static{this.\u0275fac=function(i){return new(i||n)(r.KVO(Et))}}static{this.\u0275prov=r.jDH({token:n,factory:n.\u0275fac})}}return n})(),de=(()=>{class n{constructor(t,i,s){this.toolManager=t,this.configService=i,this.EventBusService=s,this.pointerDownSubject=new Dt.B,this.pointerMoveSubject=new Dt.B,this.pointerUpSubject=new Dt.B}onPointerDown(t){if(!this.canDraw())return;this.EventBusService.emit(y.DrawStart,t);const i=this.toolManager.getCurrentTool();i&&i.handlePointerDown&&i.handlePointerDown(t),this.pointerDownSubject.next(t)}onPointerMove(t){if(!this.canDraw())return;this.EventBusService.emit(y.Drawing,t);const i=this.toolManager.getCurrentTool();i&&i.handlePointerMove&&i.handlePointerMove(t),this.pointerMoveSubject.next(t)}onPointerUp(t){if(!this.canDraw())return;this.EventBusService.emit(y.DrawEnd);const i=this.toolManager.getCurrentTool();i&&i.handlePointerUp&&i.handlePointerUp(t),this.pointerUpSubject.next(t)}getPointerDown$(){return this.pointerDownSubject.asObservable()}getPointerMove$(){return this.pointerMoveSubject.asObservable()}getPointerUp$(){return this.pointerUpSubject.asObservable()}canDraw(){return this.configService.getConfig().drawingEnabled}static{this.\u0275fac=function(i){return new(i||n)(r.KVO(ce),r.KVO(Rt),r.KVO(wt))}}static{this.\u0275prov=r.jDH({token:n,factory:n.\u0275fac})}}return n})();function B(){return function(n,e){Object.defineProperty(n,e,{get:function(){return this.getConfigValue(e)},set:function(t){this.setConfigValue(e,t)},configurable:!0})}}var ue=u(177);let hi=(()=>{class n{constructor(t){this.svgService=t}onPointerDown(t){0===t.button&&(t.currentTarget&&t.currentTarget.setPointerCapture(t.pointerId),this.svgService.onPointerDown(t))}onPointerMove(t){t.clientX===this.lastX&&t.clientY===this.lastY||(this.lastX=t.clientX,this.lastY=t.clientY,this.svgService.onPointerMove(t))}onPointerUp(t){0===t.button&&(this.lastX=t.clientX,this.lastY=t.clientY,t.currentTarget&&t.currentTarget.hasPointerCapture(t.pointerId)&&t.currentTarget.releasePointerCapture(t.pointerId),this.svgService.onPointerUp(t))}static{this.\u0275fac=function(i){return new(i||n)(r.rXU(de))}}static{this.\u0275dir=r.FsC({type:n,selectors:[["","svg",""]],hostBindings:function(i,s){1&i&&r.bIt("pointerdown",function(a){return s.onPointerDown(a)})("pointermove",function(a){return s.onPointerMove(a)})("pointerup",function(a){return s.onPointerUp(a)})}})}}return n})(),ci=(()=>{class n{constructor(t,i,s){this.elementRef=t,this.dataService=i,this._cd=s}ngOnInit(){this.resizeObserver=new ResizeObserver(([t])=>{if(t.target===this.elementRef.nativeElement){const{fullScreen:i,center:s}=this.dataService.getConfig();i&&this.dataService.fullScreen(),s&&!i&&this.dataService.centerCanvas(),this._cd.detectChanges()}}),this.resizeObserver.observe(this.elementRef.nativeElement)}ngOnDestroy(){this.resizeObserver?.disconnect()}static{this.\u0275fac=function(i){return new(i||n)(r.rXU(r.aKT),r.rXU(Et),r.rXU(r.gRc))}}static{this.\u0275dir=r.FsC({type:n,selectors:[["","resizeHandler",""]]})}}return n})();const ge="nw-resize",fe="ne-resize",pe="ns-resize",me="ew-resize";let mi=(()=>{class n{constructor(){this.cornerGrips=["nw","ne","se","sw"],this.sideGrips=["n","s","e","w"]}transform(t,i){if(t.includes("rotate"))return"grab";const s=this.isHorizontalOrientation(i);return this.cornerGrips.includes(t)?this.getCornerCursor(t,s):this.sideGrips.includes(t)?this.getSideCursor(t,s):"default"}isHorizontalOrientation(t){const i=t%180;return i<45||i>135}getCornerCursor(t,i){return"nw"===t||"se"===t?i?ge:fe:i?fe:ge}getSideCursor(t,i){return"n"===t||"s"===t?i?pe:me:i?me:pe}static{this.\u0275fac=function(i){return new(i||n)}}static{this.\u0275pipe=r.EJ8({name:"gripCursor",type:n,pure:!0,standalone:!0})}}return n})();const yi=["svgContainer"],vi=(n,e)=>e.id,Si=(n,e)=>[0,0,n,e],xi=()=>["n","s","e","w"],ye=()=>["nw","ne","se","sw"];function Ci(n,e){if(1&n&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"rect",17),r.k0s()),2&n){const t=r.XpG();r.BMQ("transform","translate("+t.gridTranslation.x+","+t.gridTranslation.y+")"),r.R7$(),r.BMQ("width",t.canvasWidth+200)("height",t.canvasHeight+200)}}function wi(n,e){if(1&n&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"path",18),r.k0s()),2&n){const t=r.XpG().$implicit;r.R7$(),r.BMQ("d",t.path)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function Ei(n,e){if(1&n&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"image",19),r.k0s()),2&n){const t=r.XpG().$implicit;r.R7$(),r.BMQ("height",t.height)("width",t.width)("href",t.src,null,"xlink")("href",t.src)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function bi(n,e){if(1&n&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"line"),r.k0s()),2&n){const t=r.XpG().$implicit;r.R7$(),r.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)}}function Pi(n,e){if(1&n&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"line",20),r.k0s()),2&n){const t=r.XpG().$implicit;r.R7$(),r.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)("fill",t.style.strokeColor)}}function Mi(n,e){if(1&n&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"rect"),r.k0s()),2&n){const t=r.XpG().$implicit;r.R7$(),r.BMQ("rx",t.rx)("width",t.width)("height",t.height)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-linejoin",t.style.lineJoin)}}function ki(n,e){if(1&n&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"ellipse"),r.k0s()),2&n){const t=r.XpG().$implicit;r.R7$(),r.BMQ("cx",t.cx)("cy",t.cy)("rx",t.rx)("ry",t.ry)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke",t.style.strokeColor)("fill",t.style.fill)}}function Ti(n,e){if(1&n&&(r.qSk(),r.j41(0,"g")(1,"text",21),r.EFF(2),r.k0s()()),2&n){const t=r.XpG().$implicit;r.BMQ("transform","scale("+t.scaleX+","+t.scaleY+")"),r.R7$(),r.BMQ("font-size",t.style.fontSize)("font-family",t.style.fontFamily)("fill",t.style.color)("font-style",t.style.fontStyle)("font-weight",t.style.fontWeight)("stroke-linecap",t.style.lineCap)("stroke-lineJoin",t.style.lineJoin)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke",t.style.strokeColor)("stroke-width",t.style.strokeWidth),r.R7$(),r.SpI(" ",t.text," ")}}function Bi(n,e){if(1&n&&(r.qSk(),r.j41(0,"g",13),r.DNE(1,wi,2,7)(2,Ei,2,9)(3,bi,2,9)(4,Pi,2,10)(5,Mi,2,9)(6,ki,2,9)(7,Ti,3,13),r.k0s()),2&n){let t;const i=e.$implicit,s=r.XpG();r.Y8G("id","item_"+i.id),r.BMQ("data-wb-id",i.id)("transform","translate("+i.x+","+i.y+")rotate("+i.rotation+")")("opacity",i.isDeleting?.1:i.opacity/100),r.R7$(),r.vxM(1,(t=i.type)===s.types.Pen?1:t===s.types.Image?2:t===s.types.Line?3:t===s.types.Arrow?4:t===s.types.Rectangle?5:t===s.types.Ellipse?6:t===s.types.Text?7:-1)}}function Di(n,e){if(1&n&&(r.qSk(),r.nrm(0,"rect",14)),2&n){const t=e;r.BMQ("x",t.x)("y",t.y)("width",t.width)("height",t.height)}}function Ri(n,e){if(1&n&&(r.qSk(),r.qex(0),r.nrm(1,"rect",25),r.nI1(2,"gripCursor"),r.bVm()),2&n){const t=e.$implicit,i=r.XpG();r.R7$(),r.BMQ("id","selectorGrip_resize_"+t)("x","n"===t||"s"===t?i.x:"e"===t?i.x+i.width-5:i.x-5)("y","n"===t?i.y-5:"s"===t?i.y+i.height-5:i.y)("width","n"===t||"s"===t?i.width:10)("height","n"===t||"s"===t?10:i.height)("cursor",r.i5U(2,6,t,i.rotation))}}function Oi(n,e){if(1&n&&(r.qSk(),r.qex(0),r.nrm(1,"rect",26),r.nI1(2,"gripCursor"),r.bVm()),2&n){const t=e.$implicit,i=r.XpG();r.R7$(),r.BMQ("id","selectorGrip_resize_"+t)("x",i.x+("ne"===t||"se"===t?i.width:0)-5)("y",i.y+("se"===t||"sw"===t?i.height:0)-5)("cursor",r.i5U(2,4,t,i.rotation))}}function Ii(n,e){if(1&n&&(r.qSk(),r.qex(0),r.nrm(1,"circle",27),r.nI1(2,"gripCursor"),r.bVm()),2&n){const t=e.$implicit,i=r.XpG();r.R7$(),r.BMQ("id","selectorGrip_rotate_"+t)("cx",i.x+("ne"===t||"se"===t?i.width:-20)+10)("cy",i.y+("se"===t||"sw"===t?i.height:-20)+10)("cursor",r.i5U(2,4,"rotate_"+t,i.rotation))}}function Xi(n,e){if(1&n&&(r.qSk(),r.j41(0,"g",15),r.nrm(1,"rect",22),r.DNE(2,Ri,3,9,"ng-container",23)(3,Oi,3,7,"ng-container",23),r.nrm(4,"circle",24),r.DNE(5,Ii,3,7,"ng-container",23),r.k0s()),2&n){const t=e;r.BMQ("transform","rotate("+t.rotation+","+(t.x+t.width/2)+","+(t.y+t.height/2)+")"),r.R7$(),r.BMQ("x",t.x)("y",t.y)("width",t.width)("height",t.height),r.R7$(),r.Y8G("ngForOf",r.lJ4(10,xi)),r.R7$(),r.Y8G("ngForOf",r.lJ4(11,ye)),r.R7$(),r.BMQ("cx",t.handles.rotateHandle.x)("cy",t.handles.rotateHandle.y),r.R7$(),r.Y8G("ngForOf",r.lJ4(12,ye))}}function _i(n,e){if(1&n&&(r.j41(0,"div",28),r.nrm(1,"input",29,1),r.k0s()),2&n){const t=r.sdS(2),i=r.XpG();r.xc7("font-family",i.fontFamily)("font-size",i.fontSize,"px")("pointer-events","none")("width",i.canvasWidth*i.zoom,"px")("height",i.canvasHeight*i.zoom,"px")("position","absolute")("top",i.y,"px")("left",i.x,"px"),r.R7$(),r.xc7("width",t.value.length+"ch")("height",2*i.zoom+"ch")}}let Ai=(()=>{class n{set data(t){t&&t!==this.dataService.getData()&&this.dataService.setData(t)}get data$(){return this.dataService.getData$()}set selectedTool(t){t&&this.dataService.getActiveTool()!==t&&this.dataService.setActiveTool(t)}get selectedTool(){return this.dataService.getActiveTool()}constructor(t,i,s,o,a,l){this.whiteboardService=t,this.actionHandler=i,this.configService=s,this.dataService=o,this.eventBusService=a,this.cd=l,this.ready=new r.bkB,this.destroyed=new r.bkB,this.drawStart=new r.bkB,this.drawing=new r.bkB,this.drawEnd=new r.bkB,this.elementsAdded=new r.bkB,this.elementsUpdated=new r.bkB,this.elementsSelected=new r.bkB,this.elementsDeleted=new r.bkB,this.undo=new r.bkB,this.redo=new r.bkB,this.clear=new r.bkB,this.dataChange=new r.bkB,this.save=new r.bkB,this.imageAdded=new r.bkB,this.selectedToolChange=new r.bkB,this.configChanged=new r.bkB,this.types=C.R,this.tools=k.p,this.eventsMap={[y.Ready]:this.ready,[y.Destroyed]:this.destroyed,[y.DrawStart]:this.drawStart,[y.Drawing]:this.drawing,[y.DrawEnd]:this.drawEnd,[y.ElementsAdded]:this.elementsAdded,[y.ElementsUpdated]:this.elementsUpdated,[y.ElementsSelected]:this.elementsSelected,[y.ElementsDeleted]:this.elementsDeleted,[y.Undo]:this.undo,[y.Redo]:this.redo,[y.Clear]:this.clear,[y.DataChange]:this.dataChange,[y.Save]:this.save,[y.ImageAdded]:this.imageAdded,[y.ToolChange]:this.selectedToolChange,[y.ConfigChange]:this.configChanged},this.initObservables()}ngOnInit(){this.options&&this.populateInputsFromOptions(this.options)}ngOnChanges(t){t.options&&t.options.currentValue&&this.populateInputsFromOptions(t.options.currentValue)}ngAfterViewInit(){this.dataService.initializeWhiteboard(this.svgContainer.nativeElement)}ngOnDestroy(){this.eventBusService.emit(y.Destroyed)}get gridTranslation(){return this.getConfigValue("gridTranslation")}get elementsTranslation(){return this.getConfigValue("elementsTranslation")}get selectionBox$(){return this.dataService.selectionBox$}get boundingBox$(){return this.dataService.boundingBox$}getConfigValue(t){return this.configService.getConfig()[t]}setConfigValue(t,i){this.configService.isConfigDifferent(t,i)&&(this.configService.updateConfigValue(t,i),["canvasWidth","canvasHeight","zoom"].includes(t)&&this.center&&!this.fullScreen&&this.dataService.centerCanvas())}populateInputsFromOptions(t){t&&Object.entries(t).forEach(([i,s])=>{void 0!==s&&this.setConfigValue(i,s)})}initObservables(){this.eventBusService.listen().pipe(S()).subscribe({next:t=>{t.payload?this.eventsMap[t.type].emit(t.payload):this.eventsMap[t.type].emit(),this.cd.detectChanges()},error:t=>console.error("Error occurred while listening to events:",t)})}static{this.\u0275fac=function(i){return new(i||n)(r.rXU(oe.K),r.rXU(ae),r.rXU(Rt),r.rXU(Et),r.rXU(wt),r.rXU(r.gRc))}}static{this.\u0275cmp=r.VBU({type:n,selectors:[["ng-whiteboard"]],viewQuery:function(i,s){if(1&i&&r.GBs(yi,5),2&i){let o;r.mGM(o=r.lsd())&&(s.svgContainer=o.first)}},inputs:{options:"options",data:"data",selectedTool:"selectedTool",drawingEnabled:"drawingEnabled",canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",fullScreen:"fullScreen",center:"center",strokeColor:"strokeColor",strokeWidth:"strokeWidth",backgroundColor:"backgroundColor",lineJoin:"lineJoin",lineCap:"lineCap",fill:"fill",zoom:"zoom",fontFamily:"fontFamily",fontSize:"fontSize",dasharray:"dasharray",dashoffset:"dashoffset",x:"x",y:"y",enableGrid:"enableGrid",gridSize:"gridSize",snapToGrid:"snapToGrid"},outputs:{ready:"ready",destroyed:"destroyed",drawStart:"drawStart",drawing:"drawing",drawEnd:"drawEnd",elementsAdded:"elementsAdded",elementsUpdated:"elementsUpdated",elementsSelected:"elementsSelected",elementsDeleted:"elementsDeleted",undo:"undo",redo:"redo",clear:"clear",dataChange:"dataChange",save:"save",imageAdded:"imageAdded",selectedToolChange:"selectedToolChange",configChanged:"configChanged"},features:[r.Jv_([de,Et,ce,wt,Rt,ae]),r.OA$],decls:22,vars:25,consts:[["svgContainer",""],["textInput",""],["id","svgroot","xlinkns","http://www.w3.org/2000/svg","svg","","resizeHandler",""],["id","svgcontent","xlinkns","http://www.w3.org/2000/svg"],["id","smallGrid","patternUnits","userSpaceOnUse"],["fill","none","stroke","gray","stroke-width","0.5"],["id","grid","width","100","height","100","patternUnits","userSpaceOnUse"],["width","100","height","100","fill","url(#smallGrid)"],["d","M 100 0 H 0 V 100","fill","none","stroke","gray","stroke-width","2"],["id","arrow","refX","3","refY","3","markerWidth","6","markerHeight","6","stroke","context-stroke","fill","none","orient","auto"],["d","M 0 0 L 3 3 L 0 6"],["width","100%","height","100%"],[2,"pointer-events","all"],["transform-origin","center",1,"wb_element",3,"id"],["stroke","blue","stroke-dasharray","5,5","fill","transparent"],["id","selectorParentGroup"],["id","text-editor",3,"font-family","font-size","pointer-events","width","height","position","top","left"],["id","grid","x","-100","y","-100","fill","url(#grid)"],["fill","none"],["preserveAspectRatio","none"],["marker-end","url(#arrow)"],["text-anchor","start","alignment-baseline","before-edge"],["id","selectorBox","fill","transparent","stroke","dodgerblue","stroke-width","1","cursor","move","pointer-events","all"],[4,"ngFor","ngForOf"],["id","selectorGrip_rotate_n","r","6","fill","white","stroke","green","stroke-width","1","cursor","grab"],["fill","transparent","stroke","transparent","pointer-events","all"],["width","10","height","10","fill","white","stroke","dodgerblue","stroke-width","1"],["r","6","fill","none","stroke","none","stroke-width","1"],["id","text-editor"],["type","text","id","textInput","autocomplete","off",1,"text-input"]],template:function(i,s){if(1&i&&(r.qSk(),r.j41(0,"svg",2,0)(2,"svg",3)(3,"defs")(4,"pattern",4),r.nrm(5,"path",5),r.k0s(),r.j41(6,"pattern",6),r.nrm(7,"rect",7)(8,"path",8),r.k0s(),r.j41(9,"marker",9),r.nrm(10,"path",10),r.k0s()(),r.nrm(11,"rect",11),r.DNE(12,Ci,2,3,":svg:g"),r.j41(13,"g",12),r.Z7z(14,Bi,8,5,":svg:g",13,vi),r.nI1(16,"async"),r.DNE(17,Di,1,4,":svg:rect",14),r.nI1(18,"async"),r.DNE(19,Xi,6,13,":svg:g",15),r.nI1(20,"async"),r.k0s()()(),r.DNE(21,_i,3,20,"div",16)),2&i){let o,a;r.HbH("svgroot "+s.selectedTool),r.R7$(2),r.BMQ("width",s.canvasWidth*s.zoom)("height",s.canvasHeight*s.zoom)("viewBox",r.l_i(22,Si,s.canvasWidth,s.canvasHeight))("x",s.x)("y",s.y),r.R7$(2),r.BMQ("width",s.gridSize)("height",s.gridSize),r.R7$(),r.BMQ("d","M "+s.gridSize+" 0 H 0 V "+s.gridSize),r.R7$(6),r.BMQ("fill",s.backgroundColor),r.R7$(),r.vxM(12,s.enableGrid?12:-1),r.R7$(),r.BMQ("transform","translate("+s.elementsTranslation.x+","+s.elementsTranslation.y+")"),r.R7$(),r.Dyx(r.bMT(16,16,s.data$)),r.R7$(3),r.vxM(17,(o=r.bMT(18,18,s.selectionBox$))?17:-1,o),r.R7$(2),r.vxM(19,(a=r.bMT(20,20,s.boundingBox$))?19:-1,a),r.R7$(2),r.vxM(21,s.selectedTool===s.tools.Text?21:-1)}},dependencies:[ue.Sq,hi,ci,ue.Jj,mi],styles:["[_nghost-%COMP%]{width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit;background-size:cover;background-position:50%;background-repeat:no-repeat;touch-action:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%], [_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .selectorGroup[_ngcontent-%COMP%]{transform-box:fill-box;transform-origin:center}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-family:Arial,Helvetica,sans-serif}[_nghost-%COMP%]   .svgroot.drawing[_ngcontent-%COMP%]{cursor:url(cursor.2cb01084080421f1.svg) 5 5,crosshair}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .hand[_ngcontent-%COMP%]{cursor:grab}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]{cursor:default}[_nghost-%COMP%]   .pen[_ngcontent-%COMP%]{cursor:url(pencil.fc7581cdb8f7bec4.svg) 1 18,crosshair}[_nghost-%COMP%]   .image[_ngcontent-%COMP%]{cursor:copy}[_nghost-%COMP%]   .line[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .arrow[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .rectangle[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .ellipse[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .text[_ngcontent-%COMP%]{cursor:text}[_nghost-%COMP%]   .eraser[_ngcontent-%COMP%]{cursor:url(eraser.ab38a28a2aaa11bd.svg) 0 12,crosshair}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%]{cursor:pointer}.text-input[_ngcontent-%COMP%]{display:none;position:absolute;background:transparent;border:1px dashed #0b89f0;outline:none;font-size:inherit;font-family:inherit;min-width:5ch;width:5ch;height:2ch;padding:0;pointer-events:auto;z-index:5;transform-origin:top left}"],changeDetection:0})}}return(0,d.Cg)([B(),(0,d.Sn)("design:type",Boolean)],n.prototype,"drawingEnabled",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"canvasWidth",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"canvasHeight",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Boolean)],n.prototype,"fullScreen",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Boolean)],n.prototype,"center",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",String)],n.prototype,"strokeColor",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"strokeWidth",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",String)],n.prototype,"backgroundColor",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",String)],n.prototype,"lineJoin",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",String)],n.prototype,"lineCap",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",String)],n.prototype,"fill",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"zoom",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",String)],n.prototype,"fontFamily",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"fontSize",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",String)],n.prototype,"dasharray",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"dashoffset",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"x",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"y",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Boolean)],n.prototype,"enableGrid",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Number)],n.prototype,"gridSize",void 0),(0,d.Cg)([B(),(0,d.Sn)("design:type",Boolean)],n.prototype,"snapToGrid",void 0),n})()},8306:(ot,_,u)=>{u.d(_,{K:()=>Nt});var d=u(1413),r=u(4412),V=u(8359),Q=u(9974),S=u(4360),gt=u(7908),kt=u(3888),Tt=u(9326),at=u(5225),Bt=u(5964),f=u(3052),_t=u(6078),J=u(7879),At=u(4438);let Nt=(()=>{class L{constructor(){this.BUFFER_SIZE=1e3,this.BATCH_INTERVAL=16,this.actionDispatcher=new d.B,this.priorityDispatcher=new r.t([]),this.actionBuffer=[],this.actions$=this.actionDispatcher.pipe(function ft(L,...pt){var g,M;const A=null!==(g=(0,Tt.lI)(pt))&&void 0!==g?g:kt.E,j=null!==(M=pt[0])&&void 0!==M?M:null,et=pt[1]||1/0;return(0,Q.N)((lt,b)=>{let C=[],m=!1;const W=$=>{const{buffer:mt,subs:F}=$;F.unsubscribe(),(0,gt.o)(C,$),b.next(mt),m&&ht()},ht=()=>{if(C){const $=new V.yU;b.add($);const F={buffer:[],subs:$};C.push(F),(0,at.N)($,A,()=>W(F),L)}};null!==j&&j>=0?(0,at.N)(b,A,ht,j,!0):m=!0,ht();const z=(0,S._)(b,$=>{const mt=C.slice();for(const F of mt){const{buffer:ct}=F;ct.push($),et<=ct.length&&W(F)}},()=>{for(;C?.length;)b.next(C.shift().buffer);z?.unsubscribe(),b.complete(),b.unsubscribe()},void 0,()=>C=null);lt.subscribe(z)})}(this.BATCH_INTERVAL),(0,Bt.p)(g=>g.length>0)),this.isProcessing=!1}addElement(g){this.dispatchWithPriority({type:f.X.AddElement,payload:{element:g}},"normal")}addImage(g,M,A){this.dispatchWithPriority({type:f.X.AddImage,payload:{image:g,x:M,y:A}},"normal")}centerCanvas(){this.dispatchWithPriority({type:f.X.CenterCanvas},"normal")}clear(){this.dispatchWithPriority({type:f.X.Clear},"high")}dispatchBatch(g){this.dispatchWithPriority({type:f.X.Batch,payload:g},"low")}fullScreen(){this.dispatchWithPriority({type:f.X.FullScreen},"normal")}removeElements(g){this.dispatchWithPriority({type:f.X.RemoveElements,payload:{ids:g}},"normal")}undo(){this.dispatchWithPriority({type:f.X.Undo},"high")}redo(){this.dispatchWithPriority({type:f.X.Redo},"high")}save(g=_t.o8.Base64,M="New board"){this.dispatchWithPriority({type:f.X.Save,payload:{format:g,name:M}},"normal")}selectElements(g){this.dispatchWithPriority({type:f.X.SelectElements,payload:{elementsOrIds:g}},"normal")}deselectElement(g){this.dispatchWithPriority({type:f.X.DeselectElement,payload:{elementOrId:g}},"normal")}toggleSelection(g){this.dispatchWithPriority({type:f.X.ToggleSelection,payload:{elementOrId:g}},"normal")}selectAll(){this.dispatchWithPriority({type:f.X.SelectAll},"normal")}clearSelection(){this.dispatchWithPriority({type:f.X.ClearSelection},"normal")}setActiveTool(g){this.dispatchWithPriority({type:f.X.SetActiveTool,payload:{tool:g}},"normal")}setCanvasDimensions(g,M){this.dispatchWithPriority({type:f.X.SetCanvasDimensions,payload:{width:g,height:M}},"normal")}setCanvasPosition(g,M){this.dispatchWithPriority({type:f.X.SetCanvasPosition,payload:{x:g,y:M}},"normal")}toggleGrid(){this.dispatchWithPriority({type:f.X.ToggleGrid},"normal")}updateElement(g){this.dispatchWithPriority({type:f.X.UpdateElement,payload:{element:g}},"normal")}updateSelectedElements(g){this.dispatchWithPriority({type:f.X.UpdateSelectedElements,payload:{partialElement:g}},"normal")}dispatchWithPriority(g,M="normal"){const A=this.priorityDispatcher.value,j={action:g,priority:M},et=A.findIndex(b=>this.getPriorityWeight(b.priority)<this.getPriorityWeight(M)),lt=-1===et?[...A,j]:[...A.slice(0,et),j,...A.slice(et)];this.priorityDispatcher.next(lt),this.isProcessing||this.processNextAction()}dispatch(g){this.manageBuffer(g),this.actionDispatcher.next(g)}getPriorityWeight(g){return J.bO[g]}manageBuffer(g){this.actionBuffer.length>=this.BUFFER_SIZE&&this.actionBuffer.shift(),this.actionBuffer.push(g)}processNextAction(){if(this.isProcessing)return;this.isProcessing=!0;const g=()=>{const M=this.priorityDispatcher.value;if(M.length>0){const{action:A}=M[0];this.dispatch(A),this.priorityDispatcher.next(M.slice(1)),g()}else this.isProcessing=!1};g()}static{this.\u0275fac=function(M){return new(M||L)}}static{this.\u0275prov=At.jDH({token:L,factory:L.\u0275fac,providedIn:"root"})}}return L})()}}]);