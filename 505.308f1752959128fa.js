"use strict";(self.webpackChunkdemo=self.webpackChunkdemo||[]).push([[505],{7879:(st,z,u)=>{u.d(z,{GF:()=>lt,Mt:()=>c,RZ:()=>H,Vf:()=>m,YO:()=>L,bO:()=>bt,wM:()=>r});const c="selectorGroup",r="svgroot",H="item_",L="selectorGrip",m="selectorBox",lt=1e3,bt={high:3,normal:2,low:1}},3052:(st,z,u)=>{u.d(z,{X:()=>c});var c=function(r){return r.Save="save",r.Undo="undo",r.Redo="redo",r.Clear="clear",r.AddImage="addImage",r.ToggleGrid="toggleGrid",r.AddElement="addElement",r.UpdateElement="updateElement",r.RemoveElements="removeElements",r.SelectElement="selectElement",r.UpdateSelectedElement="updateSelectedElement",r.SetActiveTool="setActiveTool",r.SetCanvasDimensions="setCanvasDimensions",r.SetCanvasPosition="setCanvasPosition",r.UpdateGridTranslation="updateGridTranslation",r.UpdateElementsTranslation="updateElementsTranslation",r.FullScreen="fullScreen",r.CenterCanvas="centerCanvas",r.Batch="batch",r}(c||{})},2262:(st,z,u)=>{u.d(z,{R:()=>c});var c=function(r){return r.Pen="pen",r.Rectangle="rectangle",r.Ellipse="ellipse",r.Line="line",r.Arrow="arrow",r.Text="text",r.Image="image",r}(c||{})},872:(st,z,u)=>{u.d(z,{p:()=>c});var c=function(r){return r.Hand="hand",r.Select="select",r.Pen="pen",r.Rectangle="rectangle",r.Image="image",r.Line="line",r.Arrow="arrow",r.Ellipse="ellipse",r.Text="text",r.Eraser="eraser",r}(c||{})},6078:(st,z,u)=>{u.d(z,{$3:()=>r,OP:()=>L,o8:()=>c,pP:()=>H});var c=function(m){return m.Png="png",m.Jpeg="jpeg",m.Svg="svg",m.Base64="base64",m}(c||{}),r=function(m){return m.Round="round",m.Butt="butt",m.Square="square",m}(r||{}),H=function(m){return m.Round="round",m.Miter="miter",m.Bevel="bevel",m.MiterClip="miter-clip",m}(H||{}),L=function(m){return m.NW="nw",m.N="n",m.NE="ne",m.E="e",m.SE="se",m.S="s",m.SW="sw",m.W="w",m}(L||{})},505:(st,z,u)=>{u.d(z,{I:()=>mi});var c=u(1635),r=u(4438),H=u(1985),L=u(6977);function m(i){i||((0,r.Af3)(m),i=(0,r.WQX)(r.abz));const e=new H.c(t=>i.onDestroy(t.next.bind(t)));return t=>t.pipe((0,L.Q)(e))}var Pt=u(5964),y=u(3052),Xt=u(4523),rt=u(4412),Rt=u(4572),It=u(9974);const{isArray:$}=Array;function ct(i){return 1===i.length&&$(i[0])?i[0]:i}var g=u(6450),E=u(1203),F=u(9326);function _(...i){const e=(0,F.ms)(i);return e?(0,E.F)(_(...i),(0,g.I)(e)):(0,It.N)((t,n)=>{(0,Rt.P)([t,...ct(i)])(n)})}function K(...i){return _(...i)}var ot=u(6354),T=u(7879),v=u(2262),p=u(6078);const N={strokeWidth:2,strokeColor:"#000000",fill:"#000000",lineJoin:p.pP.Miter,lineCap:p.$3.Butt,dasharray:"",dashoffset:0},dt={...N,fontSize:14,fontFamily:"Arial",fontStyle:"normal",fontWeight:"normal",color:"#000000"},Z=1e-6;function Jt(i,e,t,n,s=Z){const o=(P,X)=>P.x*X.y-P.y*X.x,a=(P,X)=>({x:P.x-X.x,y:P.y-X.y}),h=a(e,i),l=a(n,t),d=a(t,i),x=o(h,l),C=o(d,h);if(Math.abs(x)<s)return Math.abs(C)<s;const R=o(d,l)/x,D=o(d,h)/x;return R>=0&&R<=1&&D>=0&&D<=1}function gt(i,e,t,n){const s=t.x,o=t.y,a=n.x,h=n.y,l=(a-s)**2+(h-o)**2;if(0===l)return Math.sqrt((i-s)**2+(e-o)**2);let d=((i-s)*(a-s)+(e-o)*(h-o))/l;return d=Math.max(0,Math.min(1,d)),Math.sqrt((i-(s+d*(a-s)))**2+(e-(o+d*(h-o)))**2)}function zt(i,e,t,n){const s=[[{x:i.minX,y:i.minY},{x:i.maxX,y:i.minY}],[{x:i.maxX,y:i.minY},{x:i.maxX,y:i.maxY}],[{x:i.maxX,y:i.maxY},{x:i.minX,y:i.maxY}],[{x:i.minX,y:i.maxY},{x:i.minX,y:i.minY}]];for(const[o,a]of s)if(Jt(e,t,o,a,n))return!0;return!1}function Kt(i,e,t,n,s,o,a){const h={x:i,y:e},l={x:t,y:n};return gt(s.x,s.y,h,l)<=a||gt(o.x,o.y,h,l)<=a}function tt(){return Date.now().toString(36)+Math.random().toString(36).substring(2)}function B(i,e){const t=e;return Math.round(i/t)*t}function Zt(i,e,t,n){const s=Math.PI/4,o=t-i,a=n-e,h=Math.atan2(a,o),l=Math.sqrt(o*o+a*a),d=Math.round(h/s)*s;return{x:i+l*Math.cos(d),y:e+l*Math.sin(d),a:d}}function qt(i,e){const t=document.createElement("a");t.href=i,t.setAttribute("visibility","hidden"),t.download=e||"new white-board",document.body.appendChild(t),t.click(),document.body.removeChild(t)}function te(i,e,t,n=(s=>s)){return i*n(.5-e*(.5-t))}function A(i,e){return[i[0]+e[0],i[1]+e[1]]}function G(i,e){return[i[0]-e[0],i[1]-e[1]]}function U(i,e){return[i[0]*e,i[1]*e]}function ft(i){return[i[1],-i[0]]}function ee(i,e){return i[0]*e[0]+i[1]*e[1]}function Me(i,e){return i[0]===e[0]&&i[1]===e[1]}function ie(i,e){return function Te(i){return i[0]*i[0]+i[1]*i[1]}(G(i,e))}function ne(i){return function Pe(i,e){return[i[0]/e,i[1]/e]}(i,function ke(i){return Math.hypot(i[0],i[1])}(i))}function Be(i,e){return Math.hypot(i[1]-e[1],i[0]-e[0])}function pt(i,e,t){let n=Math.sin(t),s=Math.cos(t),o=i[0]-e[0],a=i[1]-e[1];return[o*s-a*n+e[0],o*n+a*s+e[1]]}function Ft(i,e,t){return A(i,U(G(e,i),t))}function se(i,e,t){return A(i,U(e,t))}var{min:at,PI:De}=Math,yt=De+1e-4;const ze={size:1,smoothing:1,thinning:0,streamline:1};function oe(i){let e=1/0,t=1/0,n=-1/0,s=-1/0;for(const[o,a]of i)e=Math.min(e,o),t=Math.min(t,a),n=Math.max(n,o),s=Math.max(s,a);return{minX:e,minY:t,maxX:n,maxY:s,width:n-e,height:s-t}}function Gt(i,e=1){return function Ge(i,e=!0){const t=i.length;if(t<4)return"";let n=i[0],s=i[1];const o=i[2];let a=`M${n[0].toFixed(2)},${n[1].toFixed(2)} Q${s[0].toFixed(2)},${s[1].toFixed(2)} ${((s[0]+o[0])/2).toFixed(2)},${((s[1]+o[1])/2).toFixed(2)} T`;for(let h=2,l=t-1;h<l;h++)n=i[h],s=i[h+1],a+=`${((n[0]+s[0])/2).toFixed(2)},${((n[1]+s[1])/2).toFixed(2)} `;return e&&(a+="Z"),a}(function Re(i,e={}){return function Oe(i,e={}){let{size:t=16,smoothing:n=.5,thinning:s=.5,simulatePressure:o=!0,easing:a=(S=>S),start:h={},end:l={},last:d=!1}=e,{cap:x=!0,easing:C=(S=>S*(2-S))}=h,{cap:R=!0,easing:D=(S=>--S*S*S+1)}=l;if(0===i.length||t<=0)return[];let Ut,P=i[i.length-1].runningLength,X=!1===h.taper?0:!0===h.taper?Math.max(t,P):h.taper,vt=!1===l.taper?0:!0===l.taper?Math.max(t,P):l.taper,ge=Math.pow(t*n,2),St=[],ht=[],At=i.slice(0,10).reduce((S,O)=>{let b=O.pressure;if(o){let k=at(1,O.distance/t),_t=at(1,1-k);b=at(1,S+.275*k*(_t-S))}return(S+b)/2},i[0].pressure),I=te(t,s,i[i.length-1].pressure,a),Nt=i[0].vector,Ct=i[0].point,Tt=Ct,it=Ct,nt=Tt,Wt=!1;for(let S=0;S<i.length;S++){let{pressure:O}=i[S],{point:b,vector:k,distance:_t,runningLength:wt}=i[S];if(S<i.length-1&&P-wt<3)continue;if(s){if(o){let J=at(1,_t/t),Ht=at(1,1-J);O=at(1,At+.275*J*(Ht-At))}I=te(t,s,O,a)}else I=t/2;void 0===Ut&&(Ut=I);let xi=wt<X?C(wt/X):1,vi=P-wt<vt?D((P-wt)/vt):1;I=Math.max(.01,I*Math.min(xi,vi));let fe=(S<i.length-1?i[S+1]:i[S]).vector,jt=S<i.length-1?ee(k,fe):1,pe=null!==jt&&jt<0;if(ee(k,Nt)<0&&!Wt||pe){let J=U(ft(Nt),I);for(let Ht=1/13,Dt=0;Dt<=1;Dt+=Ht)it=pt(G(b,J),b,yt*Dt),St.push(it),nt=pt(A(b,J),b,yt*-Dt),ht.push(nt);Ct=it,Tt=nt,pe&&(Wt=!0);continue}if(Wt=!1,S===i.length-1){let J=U(ft(k),I);St.push(G(b,J)),ht.push(A(b,J));continue}let ye=U(ft(Ft(fe,k,jt)),I);it=G(b,ye),(S<=1||ie(Ct,it)>ge)&&(St.push(it),Ct=it),nt=A(b,ye),(S<=1||ie(Tt,nt)>ge)&&(ht.push(nt),Tt=nt),At=O,Nt=k}let V=i[0].point.slice(0,2),Q=i.length>1?i[i.length-1].point.slice(0,2):A(i[0].point,[1,1]),$t=[],Bt=[];if(1===i.length){if(!X&&!vt||d){let S=se(V,ne(ft(G(V,Q))),-(Ut||I)),O=[];for(let b=1/13,k=b;k<=1;k+=b)O.push(pt(S,V,2*yt*k));return O}}else{if(!(X||vt&&1===i.length))if(x)for(let O=1/13,b=O;b<=1;b+=O){let k=pt(ht[0],V,yt*b);$t.push(k)}else{let O=G(St[0],ht[0]),b=U(O,.5),k=U(O,.51);$t.push(G(V,b),G(V,k),A(V,k),A(V,b))}let S=ft(function Ee(i){return[-i[0],-i[1]]}(i[i.length-1].vector));if(vt||X&&1===i.length)Bt.push(Q);else if(R){let O=se(Q,S,I);for(let b=1/29,k=b;k<1;k+=b)Bt.push(pt(O,Q,3*yt*k))}else Bt.push(A(Q,U(S,I)),A(Q,U(S,.99*I)),G(Q,U(S,.99*I)),G(Q,U(S,I)))}return St.concat(Bt,ht.reverse(),$t)}(function Xe(i,e={}){var t;let{streamline:n=.5,size:s=16,last:o=!1}=e;if(0===i.length)return[];let a=.15+.85*(1-n),h=Array.isArray(i[0])?i:i.map(({x:D,y:P,pressure:X=.5})=>[D,P,X]);if(2===h.length){let D=h[1];h=h.slice(0,-1);for(let P=1;P<5;P++)h.push(Ft(h[0],D,P/4))}1===h.length&&(h=[...h,[...A(h[0],[1,1]),...h[0].slice(2)]]);let l=[{point:[h[0][0],h[0][1]],pressure:h[0][2]>=0?h[0][2]:.25,vector:[1,1],distance:0,runningLength:0}],d=!1,x=0,C=l[0],R=h.length-1;for(let D=1;D<h.length;D++){let P=o&&D===R?h[D].slice(0,2):Ft(C.point,h[D],a);if(Me(C.point,P))continue;let X=Be(P,C.point);if(x+=X,D<R&&!d){if(x<s)continue;d=!0}C={point:P,pressure:h[D][2]>=0?h[D][2]:.5,vector:ne(G(C.point,P)),distance:X,runningLength:x},l.push(C)}return l[0].vector=(null==(t=l[1])?void 0:t.vector)||[0,0],l}(i,e),e)}(i,{...ze,size:e}))}const ae={[v.R.Arrow]:new class Se{create(e){return{type:v.R.Arrow,id:tt(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,...e,style:{...N,...e.style}}}resize(e,t,n,s){return t.includes(p.OP.N)&&(e.y2+=s),t.includes(p.OP.S)&&(e.y1+=s),t.includes(p.OP.W)&&(e.x1+=n),t.includes(p.OP.E)&&(e.x2+=n),e}getBounds(e){return{minX:Math.min(e.x1,e.x2),minY:Math.min(e.y1,e.y2),maxX:Math.max(e.x1,e.x2),maxY:Math.max(e.y1,e.y2),width:Math.abs(e.x2-e.x1),height:Math.abs(e.y2-e.y1)}}hitTest(e,t,n,s){const{x1:o,y1:a,x2:h,y2:l}=e;return Kt(o,a,h,l,t,n,s)}},[v.R.Ellipse]:new class Ce{create(e){return{type:v.R.Ellipse,id:tt(),x:0,y:0,cx:0,cy:0,rx:1,ry:1,rotation:0,opacity:100,...e,style:{...N,...e.style}}}resize(e,t,n,s){if(t.includes(p.OP.N)){const o=e.ry-s/2;o>0&&(e.ry=o,e.cy+=s/2)}if(t.includes(p.OP.S)){const o=e.ry+s/2;o>0&&(e.ry=o,e.cy+=s/2)}if(t.includes(p.OP.W)){const o=e.rx-n/2;o>0&&(e.rx=o,e.cx+=n/2)}if(t.includes(p.OP.E)){const o=e.rx+n/2;o>0&&(e.rx=o,e.cx+=n/2)}return e}getBounds(e){return{minX:e.cx-e.rx,minY:e.cy-e.ry,maxX:e.cx+e.rx,maxY:e.cy+e.ry,width:2*e.rx,height:2*e.ry}}hitTest(e,t,n,s){const{cx:o,cy:a,rx:h,ry:l}=e;return function me(i,e,t,n,s,o,a){return gt(i,e,s,o)<=Math.max(t,n)+a}(o,a,h,l,t,n,s)}},[v.R.Image]:new class we{create(e){return{type:v.R.Image,id:tt(),x:0,y:0,width:1,height:1,src:"",rotation:0,opacity:100,...e,style:{...N,...e.style}}}resize(e,t,n,s){if(t.includes(p.OP.N)){const o=e.height-s;o>0&&(e.y+=s,e.height=o)}if(t.includes(p.OP.S)){const o=e.height+s;o>0&&(e.height=o)}if(t.includes(p.OP.W)){const o=e.width-n;o>0&&(e.x+=n,e.width=o)}if(t.includes(p.OP.E)){const o=e.width+n;o>0&&(e.width=o)}return e}getBounds(e){return{minX:e.x,minY:e.y,maxX:e.x+e.width,maxY:e.y+e.height,width:e.width,height:e.height}}hitTest(e,t,n,s){return zt(this.getBounds(e),t,n,s)}},[v.R.Line]:new class be{create(e){return{type:v.R.Line,id:tt(),x:0,y:0,x1:0,y1:0,x2:0,y2:0,rotation:0,opacity:100,...e,style:{...N,...e.style}}}resize(e,t,n,s){return t.includes(p.OP.N)&&(e.y1+=s),t.includes(p.OP.S)&&(e.y2+=s),t.includes(p.OP.W)&&(e.x1+=n),t.includes(p.OP.E)&&(e.x2+=n),e}getBounds(e){return{minX:Math.min(e.x1,e.x2),minY:Math.min(e.y1,e.y2),maxX:Math.max(e.x1,e.x2),maxY:Math.max(e.y1,e.y2),width:Math.abs(e.x2-e.x1),height:Math.abs(e.y2-e.y1)}}hitTest(e,t,n,s){const{x1:o,y1:a,x2:h,y2:l}=e;return Kt(o,a,h,l,t,n,s)}},[v.R.Pen]:new class Ye{create(e){return{type:v.R.Pen,id:tt(),x:0,y:0,points:[],path:"",rotation:0,opacity:100,...e,style:{...N,...e.style}}}resize(e,t,n,s){const o=oe(e.points),{points:a,position:h}=this.getScaleFactors(t,o,n,s),l=o.minX+o.width/2,d=o.minY+o.height/2,[x,C]=a;return o.width*x<10||o.height*C<10||(e.x+=h.x,e.y+=h.y,e.points=e.points.map(R=>[l+(R[0]-l)*x,d+(R[1]-d)*C]),e.path=Gt(e.points)),e}getScaleFactors(e,t,n,s){const o=[1,1],a={x:0,y:0};return e.includes("w")&&(o[0]=(t.width-n)/t.width,a.x+=n/2),e.includes("n")&&(o[1]=(t.height-s)/t.height,a.y+=s/2),e.includes("e")&&(o[0]=(t.width+n)/t.width,a.x+=n/2),e.includes("s")&&(o[1]=(t.height+s)/t.height,a.y+=s/2),{points:o,position:a}}getBounds(e){const{minX:t,minY:n,maxX:s,maxY:o,width:a,height:h}=oe(e.points);return{minX:t+e.x,minY:n+e.y,maxX:s+e.x,maxY:o+e.y,width:a,height:h}}hitTest(e,t,n,s){return function xe(i,e,t,n){for(let s=0;s<i.length-1;s++){const o={x:i[s][0],y:i[s][1]},a={x:i[s+1][0],y:i[s+1][1]};if(gt(e.x,e.y,o,a)<=n||gt(t.x,t.y,o,a)<=n)return!0}return!1}(e.points,t,n,s)}},[v.R.Rectangle]:new class Ae{create(e){return{type:v.R.Rectangle,id:tt(),x:0,y:0,width:1,height:1,rx:5,rotation:0,opacity:100,...e,style:{...N,...e.style}}}resize(e,t,n,s){if(t.includes(p.OP.N)){const o=e.height-s;o>0&&(e.y+=s,e.height=o)}if(t.includes(p.OP.S)){const o=e.height+s;o>0&&(e.height=o)}if(t.includes(p.OP.W)){const o=e.width-n;o>0&&(e.x+=n,e.width=o)}if(t.includes(p.OP.E)){const o=e.width+n;o>0&&(e.width=o)}return e}getBounds(e){return{minX:e.x,minY:e.y,maxX:e.x+e.width,maxY:e.y+e.height,width:e.width,height:e.height}}hitTest(e,t,n,s){return zt(this.getBounds(e),t,n,s)}},[v.R.Text]:new class Ue{create(e){return{type:v.R.Text,id:tt(),x:0,y:0,text:"",rotation:0,opacity:100,scaleX:1,scaleY:1,...e,style:{...dt,...e.style}}}resize(e,t,n,s){const h=.016*n,l=.016*s;switch(t){case p.OP.NW:e.x+=n,e.y+=s,e.scaleX=Math.max(.1,e.scaleX-h),e.scaleY=Math.max(.1,e.scaleY-l);break;case p.OP.N:e.y+=s,e.scaleY=Math.max(.1,e.scaleY-l);break;case p.OP.NE:e.y+=s,e.scaleX=Math.max(.1,e.scaleX+h),e.scaleY=Math.max(.1,e.scaleY-l);break;case p.OP.E:e.scaleX=Math.max(.1,e.scaleX+h);break;case p.OP.SE:e.scaleX=Math.max(.1,e.scaleX+h),e.scaleY=Math.max(.1,e.scaleY+l);break;case p.OP.S:e.scaleY=Math.max(.1,e.scaleY+l);break;case p.OP.SW:e.x+=n,e.scaleX=Math.max(.1,e.scaleX-h),e.scaleY=Math.max(.1,e.scaleY+l);break;case p.OP.W:e.x+=n,e.scaleX=Math.max(.1,e.scaleX-h)}return e}getBounds(e){const t=10*e.text.length*e.scaleX,n=20*e.scaleY;return{minX:e.x,minY:e.y,maxX:e.x+t,maxY:e.y+n,width:t,height:n}}hitTest(e,t,n,s){return zt(this.getBounds(e),t,n,s)}}};function Yt(i){return ae[i]}function et(i,e){return ae[i].create(e)}var w=u(872),f=function(i){return i.Ready="ready",i.Destroyed="destroyed",i.DrawStart="drawStart",i.Drawing="drawing",i.DrawEnd="drawEnd",i.ElementAdded="elementAdded",i.ElementUpdated="elementUpdated",i.ElementSelected="elementSelected",i.ElementsDeleted="elementsDeleted",i.Undo="undo",i.Redo="redo",i.Clear="clear",i.DataChange="dataChange",i.Save="save",i.ImageAdded="imageAdded",i.ToolChange="toolChange",i.ConfigChange="configChange",i}(f||{}),Mt=u(1413);let mt=(()=>{class i{constructor(){this.eventSubject=new Mt.B}ngOnDestroy(){this.destroy()}emit(t,n){this.eventSubject.next({type:t,payload:n})}listen(){return this.eventSubject.asObservable()}listenTo(t){return this.eventSubject.pipe((0,Pt.p)(n=>n.type===t),(0,ot.T)(n=>n.payload))}destroy(){this.eventSubject.complete()}static{this.\u0275fac=function(n){return new(n||i)}}static{this.\u0275prov=r.jDH({token:i,factory:i.\u0275fac})}}return i})(),kt=(()=>{class i{constructor(t){this.eventBusService=t,this.config={drawingEnabled:!0,canvasWidth:800,canvasHeight:600,fullScreen:!0,center:!0,strokeColor:"#333333",strokeWidth:2,backgroundColor:"#F8F9FA",lineJoin:p.pP.Miter,lineCap:p.$3.Butt,fill:"transparent",zoom:1,fontFamily:"sans-serif",fontSize:24,dasharray:"",dashoffset:0,x:0,y:0,enableGrid:!1,gridSize:10,snapToGrid:!0,rubberBox:{x:0,y:0,width:0,height:0,display:"none"},gridTranslation:{x:0,y:0},elementsTranslation:{x:0,y:0}}}getConfig(){return{...this.config}}updateConfig(t){this.config={...this.config,...t},this.eventBusService.emit(f.ConfigChange,t)}isConfigDifferent(t,n){return this.config[t]!==n}updateConfigValue(t,n){this.config[t]=n,this.eventBusService.emit(f.ConfigChange,{[t]:n})}checkAndUpdateConfig(t,n){this.isConfigDifferent(t,n)&&this.updateConfigValue(t,n)}static{this.\u0275fac=function(n){return new(n||i)(r.KVO(mt))}}static{this.\u0275prov=r.jDH({token:i,factory:i.\u0275fac})}}return i})(),xt=(()=>{class i{constructor(t,n,s){this.EventBusService=t,this.configService=n,this.undoStack=[],this.redoStack=[],this.initialData=[],this.data=new rt.t([]),this.draftData=new rt.t([]),this.selectedTool=new rt.t(w.p.Pen),this.selectedElement=new rt.t(null),this.svgContainer=null,this.data$=this.data.pipe(K(this.draftData),(0,ot.T)(([o,a])=>[...o,...a])),this.selectedTool$=this.selectedTool.asObservable(),this.debouncedPushToUndo=function ve(i,e){let t;return(...n)=>{clearTimeout(t),t=setTimeout(()=>i(...n),e)}}(this.pushToUndo.bind(this),300),this.renderer=s.createRenderer(null,null)}initializeWhiteboard(t){this.svgContainer=t,this.initialData=JSON.parse(JSON.stringify(this.data.getValue())),this.EventBusService.emit(f.Ready)}getCanvas(){if(!this.svgContainer)throw new Error("SVG container not initialized");return this.svgContainer}getConfig(){return this.configService.getConfig()}getData(){return this.data.getValue()}getData$(){return this.data$}setData(t){this.data.next(t),this.EventBusService.emit(f.DataChange,t)}getDraftData(){return this.draftData.getValue()}pushToUndo(){this.undoStack.push(JSON.parse(JSON.stringify(this.getData()))),this.undoStack.length>T.GF&&this.undoStack.shift(),this.redoStack=[]}undo(){if(!this.undoStack.length)return!1;const t=this.undoStack.pop();return this.redoStack.push(t),this.setData(this.undoStack.length?JSON.parse(JSON.stringify(this.undoStack[this.undoStack.length-1])):JSON.parse(JSON.stringify(this.initialData))),this.selectElement(null),this.EventBusService.emit(f.Undo),!0}redo(){if(!this.redoStack.length)return!1;const t=this.redoStack.pop();return this.undoStack.push(JSON.parse(JSON.stringify(t))),this.undoStack.length>T.GF&&this.undoStack.shift(),this.setData(t),this.selectElement(null),this.EventBusService.emit(f.Redo),!0}clear(){this.setData([]),this.pushToUndo(),this.EventBusService.emit(f.Clear)}addElement(t){const n=this.getData();this.setData([...n,t]),this.pushToUndo(),this.EventBusService.emit(f.ElementAdded,t)}addElements(t){const n=this.getData();this.setData([...n,...t]),this.pushToUndo()}addToDraft(t){this.draftData.next([...this.draftData.getValue(),t])}updateDraft(t){const n=this.draftData.getValue(),s=n.findIndex(o=>o.id===t.id);s>-1&&(n[s]=t,this.draftData.next(n))}commitDraftToData(){const t=this.draftData.getValue();t.length&&(this.setData([...this.data.getValue(),...t]),this.pushToUndo(),this.draftData.next([]))}updateElement(t,n=!0){const s=this.getData(),o=s.findIndex(a=>a.id===t.id);o>-1&&(s[o]=t,this.setData(s),n&&(this.pushToUndo(),this.EventBusService.emit(f.ElementUpdated,t)))}patchElements(t,n=!0){const s=this.getData();t.forEach(o=>{const a=s.findIndex(h=>h.id===o.id);a>-1&&(s[a]={...s[a],...o})}),n&&(this.setData(s),this.pushToUndo())}removeElements(t,n=!0){const s=this.getData();if(s.filter(a=>t.includes(a.id)).length){this.EventBusService.emit(f.ElementsDeleted);const a=s.filter(h=>!t.includes(h.id));n&&(this.setData(a),this.pushToUndo())}}hasElement(t){return this.getData().some(n=>n.id===t.id)}getElementBbox(t){const n=`${T.RZ}${t.id}`,s=this.svgContainer?.querySelector(`#${n}`);if(s)return s.getBBox();throw new Error(`Element with id ${n} not found`)}getActiveTool(){return this.selectedTool.getValue()}setActiveTool(t){this.selectedTool.next(t),this.EventBusService.emit(f.ToolChange,t)}getSelectedElement(){return this.selectedElement.getValue()}selectElement(t){if(this.resetGrips(),t){this.selectedElement.next(t),this.setActiveTool(w.p.Select),this.selectedTool.next(w.p.Select);const n=this.getElementBbox(t);this.showGrips(n),this.EventBusService.emit(f.ElementSelected,t)}else this.selectedElement.next(null),this.EventBusService.emit(f.ElementSelected,null)}updateSelectedElement(t){const n=this.getSelectedElement();if(!n)return;const s={...n,...t};this.selectedElement.next(s),this.updateElement(s,!1),this.EventBusService.emit(f.ElementSelected,s),this.debouncedPushToUndo()}showGrips(t){const n=this.getSelectedElement();n&&this.configService.updateConfig({rubberBox:{x:t.x-.5*(n.style.strokeWidth||0),y:t.y-.5*(n.style.strokeWidth||0),width:t.width+n.style.strokeWidth||0,height:t.height+n.style.strokeWidth||0,display:"block"}})}resetGrips(){this.configService.updateConfig({rubberBox:{x:0,y:0,width:0,height:0,display:"none"}})}setCanvasDimensions(t,n){this.configService.updateConfig({canvasWidth:t,canvasHeight:n})}setCanvasPosition(t,n){this.configService.updateConfig({x:t,y:n})}updateGridTranslation(t,n){this.configService.updateConfig({gridTranslation:{x:t,y:n}})}updateElementsTranslation(t,n){this.configService.updateConfig({elementsTranslation:{x:t,y:n}})}fullScreen(){this.setCanvasDimensions(this.svgContainer?.clientWidth||0,this.svgContainer?.clientHeight||0)}centerCanvas(){const{canvasWidth:t,canvasHeight:n,zoom:s}=this.getConfig();this.setCanvasPosition(((this.svgContainer?.clientWidth||0)-t*s)/2,((this.svgContainer?.clientHeight||0)-n*s)/2)}toggleGrid(){const{enableGrid:t}=this.getConfig();this.configService.updateConfig({enableGrid:!t})}addImage(t){const n=new Image;n.onload=()=>{const s=this.getConfig().canvasHeight,o=n.width,a=n.height,l=a>s?s-40:a,d=l===s-40?n.width/n.height*(s-40):o;let x=t.x||(o-d)*(t.x||0),C=t.y||(a-l)*(t.y||0);x<0&&(x=0),C<0&&(C=0);const R=et(v.R.Image,{src:t.image,width:d,height:l,x,y:C});this.addElement(R),this.selectElement(R),this.pushToUndo(),this.EventBusService.emit(f.ImageAdded,R.src)},n.src=t.image}save(t,n="New board"){var s=this;return(0,Xt.A)(function*(){const a=s.getCanvas().getElementById("svgcontent").cloneNode(!0),h=a.querySelector("#selectorParentGroup");h&&h.remove();const l=a.querySelector("#contentBackground");l&&l.removeAttribute("opacity"),a.setAttribute("x","0"),a.setAttribute("y","0");const d=(new XMLSerializer).serializeToString(a),x=yield function Fe(i,e,t,n=p.o8.Png){return new Promise((s,o)=>{const a=document.createElement("canvas");a.width=e,a.height=t;const h=a.getContext("2d"),l=new Image;l.src=`data:image/svg+xml;base64,${btoa(i)}`,l.onload=()=>{h.drawImage(l,0,0,e,t);const d=a.toDataURL(`image/${n}`);s(d)},l.onerror=d=>{o(d)}})}(d,s.getConfig().canvasWidth,s.getConfig().canvasHeight,t);switch(t){case p.o8.Base64:s.EventBusService.emit(f.Save,x);break;case p.o8.Svg:{const C="data:image/svg+xml;base64,"+btoa(unescape(encodeURIComponent(d)));qt(C,n),s.EventBusService.emit(f.Save,C);break}default:qt(x,n),s.EventBusService.emit(f.Save,x)}})()}static{this.\u0275fac=function(n){return new(n||i)(r.KVO(mt),r.KVO(kt),r.KVO(r._9s))}}static{this.\u0275prov=r.jDH({token:i,factory:i.\u0275fac})}}return i})();var he=u(8306);let le=(()=>{class i{constructor(t,n){this._dataService=t,this._whiteboardService=n,this.initializeActionListeners()}initializeActionListeners(){this._whiteboardService.actions$.pipe((0,Pt.p)(t=>t.length>0)).subscribe(t=>{t.forEach(n=>this.handleAction(n))})}handleAction(t){switch(t.type){case y.X.Undo:this._dataService.undo();break;case y.X.Redo:this._dataService.redo();break;case y.X.Clear:this._dataService.clear();break;case y.X.UpdateSelectedElement:this._dataService.updateSelectedElement(t.payload.partialElement);break;case y.X.Save:{const{format:n,name:s}=t.payload;this._dataService.save(n,s);break}case y.X.AddElement:this._dataService.addElement(t.payload.element);break;case y.X.UpdateElement:this._dataService.updateElement(t.payload.element);break;case y.X.RemoveElements:this._dataService.removeElements(t.payload.ids);break;case y.X.SelectElement:this._dataService.selectElement(t.payload.element);break;case y.X.SetActiveTool:this._dataService.setActiveTool(t.payload.tool);break;case y.X.ToggleGrid:this._dataService.toggleGrid();break;case y.X.AddImage:this._dataService.addImage(t.payload);break;case y.X.SetCanvasDimensions:{const{width:n,height:s}=t.payload;this._dataService.setCanvasDimensions(n,s);break}case y.X.SetCanvasPosition:{const{x:n,y:s}=t.payload;this._dataService.setCanvasPosition(n,s);break}case y.X.UpdateGridTranslation:{const{dx:n,dy:s}=t.payload;this._dataService.updateGridTranslation(n,s);break}case y.X.UpdateElementsTranslation:{const{dx:n,dy:s}=t.payload;this._dataService.updateElementsTranslation(n,s);break}case y.X.FullScreen:this._dataService.fullScreen();break;case y.X.CenterCanvas:this._dataService.centerCanvas();break;case y.X.Batch:t.payload.forEach(n=>this.handleAction(n))}}static{this.\u0275fac=function(n){return new(n||i)(r.KVO(xt),r.KVO(he.K))}}static{this.\u0275prov=r.jDH({token:i,factory:i.\u0275fac})}}return i})();class W{constructor(e){this.dataService=e,this.active=!1}get whiteboardConfig(){return this.dataService?.getConfig()}getPointerPosition(e){return function Ne(i,{x:e,y:t}){const{zoom:n,x:s,y:o,elementsTranslation:a}=i;return{x:(e-s)/n-a.x,y:(t-o)/n-a.y}}(this.dataService.getConfig(),{x:e.offsetX,y:e.offsetY})}activate(){this.active=!0}deactivate(){this.active=!1}get isActive(){return this.active}}class We extends W{constructor(){super(...arguments),this.type=w.p.Hand,this.isDragging=!1,this.startX=0,this.startY=0}handlePointerDown(e){this.isDragging=!0,this.startX=e.clientX,this.startY=e.clientY}handlePointerMove(e){if(!this.isDragging)return;const t=e.clientX-this.startX,n=e.clientY-this.startY,{gridTranslation:s,elementsTranslation:o}=this.dataService.getConfig(),h={x:o.x+t,y:o.y+n};this.updateGridPosition((s.x+t)%100,(s.y+n)%100),this.updateElementsPosition(h.x,h.y),this.startX=e.clientX,this.startY=e.clientY}handlePointerUp(){this.isDragging=!1}updateGridPosition(e,t){this.dataService.updateGridTranslation(e,t)}updateElementsPosition(e,t){this.dataService.updateElementsTranslation(e,t)}}class $e extends W{constructor(){super(...arguments),this.type=w.p.Arrow,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(e){if(!this.active)return;const t=this.getPointerPosition(e);let{x:n,y:s}=t;const{snapToGrid:o}=this.whiteboardConfig;if(o){const{gridSize:a}=this.whiteboardConfig;n=B(n,a),s=B(s,a)}this.startPoint={x:n,y:s},this.lastX=n,this.lastY=s,this.element=et(v.R.Arrow,{x1:n,y1:s,x2:n,y2:s,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;const t=this.getPointerPosition(e);let n=t.x,s=t.y;const{snapToGrid:o}=this.whiteboardConfig;if(o){const{gridSize:a}=this.whiteboardConfig;n=B(n,a),s=B(s,a)}if(e.shiftKey){const a=this.element.x1,h=this.element.y1,{x:l,y:d}=Zt(a,h,n,s);n=l,s=d}(Math.abs(n-this.lastX)>this.MIN_LENGTH||Math.abs(s-this.lastY)>this.MIN_LENGTH)&&(this.element.x2=n,this.element.y2=s,this.lastX=n,this.lastY=s)}handlePointerUp(){this.active&&(this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null),this.lastX=0,this.lastY=0)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class _e extends W{constructor(){super(...arguments),this.type=w.p.Ellipse,this.element=null,this.startPoint=null}handlePointerDown(e){if(!this.active)return;let{x:t,y:n}=this.getPointerPosition(e);const{snapToGrid:s}=this.whiteboardConfig;if(s){const{gridSize:o}=this.whiteboardConfig;t=B(t,o),n=B(n,o)}this.startPoint={x:t,y:n},this.element=et(v.R.Ellipse,{cx:t,cy:n,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element||!this.startPoint)return;const{x:t,y:n}=this.getPointerPosition(e),s=this.startPoint.x,o=this.startPoint.y;let a=Math.abs(s+(t-s)/2),h=Math.abs(o+(n-o)/2),l=Math.abs(s-a),d=Math.abs(o-h);e.shiftKey&&(d=l,h=n>o?o+l:o-l),e.altKey&&(a=s,h=o,l=Math.abs(t-a),d=e.shiftKey?l:Math.abs(n-h)),this.element.rx=l,this.element.ry=d,this.element.cx=a,this.element.cy=h}handlePointerUp(){this.active&&this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}function je(i,e,t,n){return i.minX-n<=Math.max(e.x,t.x)&&i.maxX+n>=Math.min(e.x,t.x)&&i.minY-n<=Math.max(e.y,t.y)&&i.maxY+n>=Math.min(e.y,t.y)}class He extends W{constructor(){super(...arguments),this.type=w.p.Eraser,this.isErasing=!1,this.hoveredElements=new Set,this.lastPosition=null}handlePointerDown(e){if(!this.active)return;this.hoveredElements.clear();const t=this.getPointerPosition(e);this.isErasing=!0,this.eraseElementsAt(t,t),this.lastPosition=t}handlePointerMove(e){if(!this.active||!this.isErasing||!this.lastPosition)return;const t=this.getPointerPosition(e);this.eraseElementsAt(this.lastPosition,t,e.altKey),this.lastPosition=t}handlePointerUp(){if(this.active){if(this.hoveredElements.size>0){const e=Array.from(this.hoveredElements);e.forEach(t=>{t.isDeleting=!1}),this.dataService.patchElements(e,!1),this.dataService.removeElements(e.map(t=>t.id))}this.hoveredElements.clear(),this.isErasing=!1,this.lastPosition=null}}eraseElementsAt(e,t,n=!1){const s=this.dataService.getData(),o=this.dataService.getConfig()?.zoom||1,a=Math.hypot(t.x-e.x,t.y-e.y),d=10/o+a*(.5*Math.log2(a+1));for(const x of s)je(Yt(x.type).getBounds(x),e,t,d)&&this.isPointInElement(x,e,t,d)&&(n?(this.hoveredElements.delete(x),x.isDeleting=!1):(this.hoveredElements.add(x),x.isDeleting=!0),this.dataService.updateElement(x,!1))}isPointInElement(e,t,n,s){return Yt(e.type).hitTest(e,t,n,s)}}class Le extends W{constructor(){super(...arguments),this.type=w.p.Image}handlePointerDown(e){const{x:t,y:n}=this.getPointerPosition(e),s=document.createElement("input");s.type="file",s.accept="image/*",s.onchange=o=>{const a=o.target.files;if(a){const h=new FileReader;h.onload=l=>{this.dataService.addImage({image:l.target.result,x:t,y:n})},h.readAsDataURL(a[0])}},s.click()}}class Ve extends W{constructor(){super(...arguments),this.type=w.p.Line,this.element=null,this.startPoint=null,this.lastX=0,this.lastY=0,this.MIN_LENGTH=2}handlePointerDown(e){if(!this.active)return;let{x:t,y:n}=this.getPointerPosition(e);const{snapToGrid:s}=this.whiteboardConfig;if(s){const{gridSize:o}=this.whiteboardConfig;t=B(t,o),n=B(n,o)}this.startPoint={x:t,y:n},this.lastX=t,this.lastY=n,this.element=et(v.R.Line,{x1:t,y1:n,x2:t,y2:n,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;const t=this.getPointerPosition(e);let n=t.x,s=t.y;const{snapToGrid:o}=this.whiteboardConfig;if(o){const{gridSize:a}=this.whiteboardConfig;n=B(n,a),s=B(s,a)}if(e.shiftKey){const a=this.element.x1,h=this.element.y1,{x:l,y:d}=Zt(a,h,n,s);[n,s]=[l,d]}(Math.abs(n-this.lastX)>this.MIN_LENGTH||Math.abs(s-this.lastY)>this.MIN_LENGTH)&&(this.element.x2=n,this.element.y2=s,this.lastX=n,this.lastY=s)}handlePointerUp(){this.active&&(this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null),this.lastX=0,this.lastY=0)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class Qe extends W{constructor(){super(...arguments),this.type=w.p.Pen,this.element=null}handlePointerDown(e){if(!this.active)return;const t=this.getPointerPosition(e);this.element=et(v.R.Pen,{points:[[t.x,t.y]],path:Gt([[t.x,t.y]]),style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element)return;const{x:t,y:n}=this.getPointerPosition(e),s=this.element.points;s.push([t,n]),this.element.points=s,this.element.path=Gt(s)}handlePointerUp(){this.active&&this.element&&(this.dataService.commitDraftToData(),this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineCap:this.whiteboardConfig.lineCap,lineJoin:this.whiteboardConfig.lineJoin,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}class Je extends W{constructor(){super(...arguments),this.type=w.p.Rectangle,this.element=null,this.startPoint=null}handlePointerDown(e){if(!this.active)return;let{x:t,y:n}=this.getPointerPosition(e);const{snapToGrid:s}=this.whiteboardConfig;if(s){const{gridSize:o}=this.whiteboardConfig;t=B(t,o),n=B(n,o)}this.startPoint={x:t,y:n},this.element=et(v.R.Rectangle,{x:t,y:n,style:this.getElementStyle()}),this.dataService.addToDraft(this.element)}handlePointerMove(e){if(!this.active||!this.element||!this.startPoint)return;const{x:t,y:n}=this.getPointerPosition(e),s=this.startPoint.x,o=this.startPoint.y;let a=Math.abs(t-s),h=Math.abs(n-o),l=null,d=null;e.shiftKey?(a=h=Math.max(a,h),l=s<t?s:s-a,d=o<n?o:o-h):(l=Math.min(s,t),d=Math.min(o,n)),e.altKey&&(a*=2,h*=2,l=s-a/2,d=o-h/2);const{snapToGrid:x}=this.whiteboardConfig;if(x){const{gridSize:C}=this.whiteboardConfig;a=B(a,C),h=B(h,C),l=B(l,C),d=B(d,C)}this.element.width=a,this.element.height=h,this.element.x=l,this.element.y=d}handlePointerUp(){this.active&&this.element&&this.startPoint&&(this.dataService.commitDraftToData(),this.startPoint=null,this.element=null)}getElementStyle(){return{strokeColor:this.whiteboardConfig.strokeColor,strokeWidth:this.whiteboardConfig.strokeWidth,lineJoin:this.whiteboardConfig.lineJoin,fill:this.whiteboardConfig.fill,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset}}}function ce(i){if(!i?.target)return null;let e=i.target;for(;e;){if(e.id===T.wM)return null;if(e.id.includes(T.RZ)||e.id.includes(T.YO)||e.id.includes(T.Vf))return e;if(!e.parentNode)break;e=e.parentNode}return null}class Ze extends W{constructor(){super(...arguments),this.type=w.p.Select,this.isDragging=!1,this.currentAction=null,this.direction=p.OP.E}handlePointerDown(e){const t=ce(e);if(t){const n=t.id;n.includes(T.RZ)?(this.currentAction="select",this.handleSelect(t.getAttribute("data-wb-id"))):n.includes("selectorGrip_resize")?(this.currentAction="resize",this.direction=n.split("_")[2],this.handleResize(e)):n.includes("selectorBox")&&(this.currentAction="move",this.handleMove(e)),this.isDragging=!0}else this.dataService.selectElement(null),this.currentAction=null}handlePointerMove(e){this.isDragging&&this.currentAction&&("resize"===this.currentAction?this.handleResize(e):this.handleMove(e))}handlePointerUp(){this.isDragging&&(this.isDragging=!1,this.currentAction=null)}handleSelect(e){const t=this.dataService.getData().find(n=>n.id===e);t&&this.dataService.selectElement(t)}handleResize(e){const t=this.dataService.getSelectedElement();if(!t)return;this.dataService.showGrips(this.dataService.getElementBbox(t));const n=e.movementX,s=e.movementY,o=Yt(t.type).resize(t,this.direction,n,s);this.dataService.updateSelectedElement(o)}handleMove(e){const t=this.dataService.getSelectedElement();t&&this.dataService.updateSelectedElement({x:t.x+e.movementX,y:t.y+e.movementY})}}class qe extends W{constructor(){super(...arguments),this.type=w.p.Text,this.textElement=null,this.textInput=null}handlePointerDown(e){if(!this.active)return;if(this.textInput)return void this.finishTextInput();const t=function Ke(i,e){const t=ce(i);if(t){if(t.id===T.Mt)return null;const n=t.getAttribute("data-wb-id");return e.find(o=>o.id===n)||null}return null}(e,this.dataService.getData());if(t&&t.type===v.R.Text)return this.textElement=t,void this.createTextInput(t.x,t.y,t.text);const{x:n,y:s}=this.getPointerPosition(e);this.textElement=this.createTextElement(n,s),this.createTextInput(n,s)}handlePointerUp(){this.textInput&&(this.textInput.addEventListener("blur",()=>this.finishTextInput()),this.textInput.focus())}createTextElement(e,t){const{snapToGrid:n,gridSize:s}=this.whiteboardConfig;return et(v.R.Text,{x:n?B(e,s):e,y:n?B(t,s):t,text:"",style:this.getElementStyle()})}createTextInput(e,t,n=""){const{zoom:s,elementsTranslation:o}=this.whiteboardConfig,a=this.dataService.getCanvas().parentElement?.querySelector("#textInput");a.value=n,a.style.left=(e-Math.abs(o.x))*s+"px",a.style.top=(t-Math.abs(o.y))*s+"px",a.style.fontFamily=this.textElement?.style.fontFamily||this.whiteboardConfig.fontFamily,a.style.fontSize=`${this.textElement?.style.fontSize||this.whiteboardConfig.fontSize}px`,a.style.color=this.textElement?.style.color||this.whiteboardConfig.strokeColor,a.style.transform=`scale(${this.textElement?.scaleX||1}, ${this.textElement?.scaleY||1})`,a.style.display="block",a.addEventListener("input",()=>this.handleTextInput(a)),a.addEventListener("keydown",h=>{"Enter"===h.key&&this.finishTextInput()}),this.textInput=a}handleTextInput(e){e.style.width=`${e.value.length}ch`,this.textElement&&(this.textElement.text=e.value,this.dataService.updateElement(this.textElement))}finishTextInput(){this.textInput&&this.textElement&&(this.textInput.value.trim()?this.dataService.hasElement(this.textElement)||(this.dataService.addElement(this.textElement),this.dataService.pushToUndo()):this.dataService.removeElements([this.textElement.id]),this.textInput.style.display="none",this.textInput=null,this.textElement=null)}getElementStyle(){return{color:this.whiteboardConfig.strokeColor,fontSize:this.whiteboardConfig.fontSize,fontFamily:this.whiteboardConfig.fontFamily,lineJoin:this.whiteboardConfig.lineJoin,lineCap:this.whiteboardConfig.lineCap,dasharray:this.whiteboardConfig.dasharray,dashoffset:this.whiteboardConfig.dashoffset,strokeColor:this.whiteboardConfig.fill,strokeWidth:0}}}let de=(()=>{class i{constructor(t){this.dataService=t,this.toolRegistry=new Map,this.initializeDefaultTools(t),this.dataService.selectedTool$.pipe(m()).subscribe(n=>{this.setCurrentTool(n)})}registerTool(t,n){if(this.toolRegistry.has(t))throw new Error(`Tool of type '${t}' is already registered.`);this.toolRegistry.set(t,n)}initializeDefaultTools(t){this.registerTool(w.p.Hand,new We(t)),this.registerTool(w.p.Pen,new Qe(t)),this.registerTool(w.p.Line,new Ve(t)),this.registerTool(w.p.Arrow,new $e(t)),this.registerTool(w.p.Rectangle,new Je(t)),this.registerTool(w.p.Ellipse,new _e(t)),this.registerTool(w.p.Text,new qe(t)),this.registerTool(w.p.Image,new Le(t)),this.registerTool(w.p.Select,new Ze(t)),this.registerTool(w.p.Eraser,new He(t))}setCurrentTool(t){const n=this.currentTool,s=this.toolRegistry.get(t);if(n&&n.deactivate(),!s)throw new Error(`Tool of type '${t}' not found.`);s.activate(),this.currentTool=s}getCurrentTool(){const t=this.currentTool;if(!t)throw new Error("No active tool found.");return t}getCurrentToolType(){return this.currentTool.type}getTool(t){const n=this.toolRegistry.get(t);if(!n)throw new Error(`Tool of type '${t}' not found.`);return n}clearRegistry(){this.toolRegistry.clear()}static{this.\u0275fac=function(n){return new(n||i)(r.KVO(xt))}}static{this.\u0275prov=r.jDH({token:i,factory:i.\u0275fac})}}return i})(),ue=(()=>{class i{constructor(t,n,s){this.toolManager=t,this.configService=n,this.EventBusService=s,this.pointerDownSubject=new Mt.B,this.pointerMoveSubject=new Mt.B,this.pointerUpSubject=new Mt.B}onPointerDown(t){if(!this.canDraw())return;this.EventBusService.emit(f.DrawStart,t);const n=this.toolManager.getCurrentTool();n&&n.handlePointerDown&&n.handlePointerDown(t),this.pointerDownSubject.next(t)}onPointerMove(t){if(!this.canDraw())return;this.EventBusService.emit(f.Drawing,t);const n=this.toolManager.getCurrentTool();n&&n.handlePointerMove&&n.handlePointerMove(t),this.pointerMoveSubject.next(t)}onPointerUp(t){if(!this.canDraw())return;this.EventBusService.emit(f.DrawEnd);const n=this.toolManager.getCurrentTool();n&&n.handlePointerUp&&n.handlePointerUp(t),this.pointerUpSubject.next(t)}getPointerDown$(){return this.pointerDownSubject.asObservable()}getPointerMove$(){return this.pointerMoveSubject.asObservable()}getPointerUp$(){return this.pointerUpSubject.asObservable()}canDraw(){return this.configService.getConfig().drawingEnabled}static{this.\u0275fac=function(n){return new(n||i)(r.KVO(de),r.KVO(kt),r.KVO(mt))}}static{this.\u0275prov=r.jDH({token:i,factory:i.\u0275fac})}}return i})();function M(){return function(i,e){Object.defineProperty(i,e,{get:function(){return this.getConfigValue(e)},set:function(t){this.setConfigValue(e,t)},configurable:!0})}}let ti=(()=>{class i{constructor(t){this.svgService=t}onPointerDown(t){0===t.button&&(t.currentTarget&&t.currentTarget.setPointerCapture(t.pointerId),this.svgService.onPointerDown(t))}onPointerMove(t){t.clientX===this.lastX&&t.clientY===this.lastY||(this.lastX=t.clientX,this.lastY=t.clientY,this.svgService.onPointerMove(t))}onPointerUp(t){0===t.button&&(this.lastX=t.clientX,this.lastY=t.clientY,t.currentTarget&&t.currentTarget.hasPointerCapture(t.pointerId)&&t.currentTarget.releasePointerCapture(t.pointerId),this.svgService.onPointerUp(t))}static{this.\u0275fac=function(n){return new(n||i)(r.rXU(ue))}}static{this.\u0275dir=r.FsC({type:i,selectors:[["","svg",""]],hostBindings:function(n,s){1&n&&r.bIt("pointerdown",function(a){return s.onPointerDown(a)})("pointermove",function(a){return s.onPointerMove(a)})("pointerup",function(a){return s.onPointerUp(a)})}})}}return i})(),ei=(()=>{class i{constructor(t,n,s){this.elementRef=t,this.dataService=n,this._cd=s}ngOnInit(){this.resizeObserver=new ResizeObserver(([t])=>{if(t.target===this.elementRef.nativeElement){const{fullScreen:n,center:s}=this.dataService.getConfig();n&&this.dataService.fullScreen(),s&&!n&&this.dataService.centerCanvas(),this._cd.detectChanges()}}),this.resizeObserver.observe(this.elementRef.nativeElement)}ngOnDestroy(){this.resizeObserver?.disconnect()}static{this.\u0275fac=function(n){return new(n||i)(r.rXU(r.aKT),r.rXU(xt),r.rXU(r.gRc))}}static{this.\u0275dir=r.FsC({type:i,selectors:[["","resizeHandler",""]]})}}return i})();var ii=u(177);const ni=["svgContainer"],si=(i,e)=>e.id,ri=(i,e)=>[0,0,i,e];function oi(i,e){if(1&i&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"rect",16),r.k0s()),2&i){const t=r.XpG();r.BMQ("transform","translate("+t.gridTranslation.x+","+t.gridTranslation.y+")"),r.R7$(),r.BMQ("width",t.canvasWidth+200)("height",t.canvasHeight+200)}}function ai(i,e){if(1&i&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"path",17),r.k0s()),2&i){const t=r.XpG().$implicit;r.R7$(),r.BMQ("d",t.path)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke-linejoin",t.style.lineJoin)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function hi(i,e){if(1&i&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"image",18),r.k0s()),2&i){const t=r.XpG().$implicit;r.R7$(),r.BMQ("height",t.height)("width",t.width)("href",t.src,null,"xlink")("href",t.src)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)}}function li(i,e){if(1&i&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"line"),r.k0s()),2&i){const t=r.XpG().$implicit;r.R7$(),r.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)}}function ci(i,e){if(1&i&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"line",19),r.k0s()),2&i){const t=r.XpG().$implicit;r.R7$(),r.BMQ("x1",t.x1)("y1",t.y1)("x2",t.x2)("y2",t.y2)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke-linecap",t.style.lineCap)("stroke",t.style.strokeColor)("fill",t.style.strokeColor)}}function di(i,e){if(1&i&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"rect"),r.k0s()),2&i){const t=r.XpG().$implicit;r.R7$(),r.BMQ("rx",t.rx)("width",t.width)("height",t.height)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("fill",t.style.fill)("stroke",t.style.strokeColor)("stroke-linejoin",t.style.lineJoin)}}function ui(i,e){if(1&i&&(r.qSk(),r.j41(0,"g"),r.nrm(1,"ellipse"),r.k0s()),2&i){const t=r.XpG().$implicit;r.R7$(),r.BMQ("cx",t.cx)("cy",t.cy)("rx",t.rx)("ry",t.ry)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke-width",t.style.strokeWidth)("stroke",t.style.strokeColor)("fill",t.style.fill)}}function gi(i,e){if(1&i&&(r.qSk(),r.j41(0,"g")(1,"text",20),r.EFF(2),r.k0s()()),2&i){const t=r.XpG().$implicit;r.BMQ("transform","scale("+t.scaleX+","+t.scaleY+")"),r.R7$(),r.BMQ("font-size",t.style.fontSize)("font-family",t.style.fontFamily)("fill",t.style.color)("font-style",t.style.fontStyle)("font-weight",t.style.fontWeight)("stroke-linecap",t.style.lineCap)("stroke-lineJoin",t.style.lineJoin)("stroke-dasharray",t.style.dasharray)("stroke-dashoffset",t.style.dashoffset)("stroke",t.style.strokeColor)("stroke-width",t.style.strokeWidth),r.R7$(),r.SpI(" ",t.text," ")}}function fi(i,e){if(1&i&&(r.qSk(),r.j41(0,"g",13),r.DNE(1,ai,2,7)(2,hi,2,9)(3,li,2,9)(4,ci,2,10)(5,di,2,9)(6,ui,2,9)(7,gi,3,13),r.k0s()),2&i){let t;const n=e.$implicit,s=r.XpG();r.Y8G("id","item_"+n.id),r.BMQ("data-wb-id",n.id)("transform","translate("+n.x+","+n.y+")rotate("+n.rotation+")")("opacity",n.isDeleting?.1:n.opacity/100),r.R7$(),r.vxM(1,(t=n.type)===s.types.Pen?1:t===s.types.Image?2:t===s.types.Line?3:t===s.types.Arrow?4:t===s.types.Rectangle?5:t===s.types.Ellipse?6:t===s.types.Text?7:-1)}}function pi(i,e){if(1&i&&(r.qSk(),r.j41(0,"g",14)(1,"g",21)(2,"g",22),r.nrm(3,"rect",23),r.k0s(),r.j41(4,"g",22),r.nrm(5,"circle",24)(6,"circle",25)(7,"circle",26)(8,"circle",27)(9,"rect",28)(10,"rect",29)(11,"rect",30)(12,"rect",31)(13,"rect",32)(14,"rect",33)(15,"rect",34)(16,"rect",35),r.k0s()()()),2&i){const t=r.XpG();r.R7$(),r.xc7("display",t.rubberBox.display),r.BMQ("transform","translate("+t.selectedElement.x+","+t.selectedElement.y+")rotate("+t.selectedElement.rotation+")"),r.R7$(2),r.BMQ("x",t.rubberBox.x)("y",t.rubberBox.y)("width",t.rubberBox.width)("height",t.rubberBox.height),r.R7$(2),r.BMQ("cx",t.rubberBox.x-4)("cy",t.rubberBox.y-4),r.R7$(),r.BMQ("cx",t.rubberBox.x+t.rubberBox.width+4)("cy",t.rubberBox.y-4),r.R7$(),r.BMQ("cx",t.rubberBox.x+t.rubberBox.width+4)("cy",t.rubberBox.y+t.rubberBox.height+4),r.R7$(),r.BMQ("cx",t.rubberBox.x-4)("cy",t.rubberBox.y+t.rubberBox.height+4),r.R7$(),r.BMQ("x",t.rubberBox.x-4)("y",t.rubberBox.y-4),r.R7$(),r.BMQ("x",t.rubberBox.x+t.rubberBox.width/2-4)("y",t.rubberBox.y-4),r.R7$(),r.BMQ("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y-4),r.R7$(),r.BMQ("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y+t.rubberBox.height/2-4),r.R7$(),r.BMQ("x",t.rubberBox.x+t.rubberBox.width-4)("y",t.rubberBox.y+t.rubberBox.height-4),r.R7$(),r.BMQ("x",t.rubberBox.x+t.rubberBox.width/2-4)("y",t.rubberBox.y+t.rubberBox.height-4),r.R7$(),r.BMQ("x",t.rubberBox.x-4)("y",t.rubberBox.y+t.rubberBox.height-4),r.R7$(),r.BMQ("x",t.rubberBox.x-4)("y",t.rubberBox.y+t.rubberBox.height/2-4)}}function yi(i,e){if(1&i&&(r.j41(0,"div",36),r.nrm(1,"input",37,1),r.k0s()),2&i){const t=r.sdS(2),n=r.XpG();r.xc7("font-family",n.fontFamily)("font-size",n.fontSize,"px")("pointer-events","none")("width",n.canvasWidth*n.zoom,"px")("height",n.canvasHeight*n.zoom,"px")("position","absolute")("top",n.y,"px")("left",n.x,"px"),r.R7$(),r.xc7("width",t.value.length+"ch")("height",2*n.zoom+"ch")}}let mi=(()=>{class i{set data(t){t&&t!==this.dataService.getData()&&this.dataService.setData(t)}get data$(){return this.dataService.getData$()}set selectedTool(t){t&&this.dataService.getActiveTool()!==t&&(this.dataService.setActiveTool(t),this.dataService.selectElement(null))}get selectedTool(){return this.dataService.getActiveTool()}constructor(t,n,s,o,a,h){this.whiteboardService=t,this.actionHandler=n,this.configService=s,this.dataService=o,this.eventBusService=a,this.cd=h,this.ready=new r.bkB,this.destroyed=new r.bkB,this.drawStart=new r.bkB,this.drawing=new r.bkB,this.drawEnd=new r.bkB,this.elementAdded=new r.bkB,this.elementUpdated=new r.bkB,this.elementSelected=new r.bkB,this.elementsDeleted=new r.bkB,this.undo=new r.bkB,this.redo=new r.bkB,this.clear=new r.bkB,this.dataChange=new r.bkB,this.save=new r.bkB,this.imageAdded=new r.bkB,this.selectedToolChange=new r.bkB,this.configChanged=new r.bkB,this.types=v.R,this.tools=w.p,this.eventsMap={[f.Ready]:this.ready,[f.Destroyed]:this.destroyed,[f.DrawStart]:this.drawStart,[f.Drawing]:this.drawing,[f.DrawEnd]:this.drawEnd,[f.ElementAdded]:this.elementAdded,[f.ElementUpdated]:this.elementUpdated,[f.ElementSelected]:this.elementSelected,[f.ElementsDeleted]:this.elementsDeleted,[f.Undo]:this.undo,[f.Redo]:this.redo,[f.Clear]:this.clear,[f.DataChange]:this.dataChange,[f.Save]:this.save,[f.ImageAdded]:this.imageAdded,[f.ToolChange]:this.selectedToolChange,[f.ConfigChange]:this.configChanged},this.initObservables()}ngOnInit(){this.options&&this.populateInputsFromOptions(this.options)}ngOnChanges(t){t.options&&t.options.currentValue&&this.populateInputsFromOptions(t.options.currentValue)}ngAfterViewInit(){this.dataService.initializeWhiteboard(this.svgContainer.nativeElement)}ngOnDestroy(){this.eventBusService.emit(f.Destroyed)}get selectedElement(){return this.dataService.getSelectedElement()}get rubberBox(){return this.getConfigValue("rubberBox")}get gridTranslation(){return this.getConfigValue("gridTranslation")}get elementsTranslation(){return this.getConfigValue("elementsTranslation")}getConfigValue(t){return this.configService.getConfig()[t]}setConfigValue(t,n){this.configService.isConfigDifferent(t,n)&&(this.configService.updateConfigValue(t,n),["canvasWidth","canvasHeight","zoom"].includes(t)&&this.center&&!this.fullScreen&&this.dataService.centerCanvas())}populateInputsFromOptions(t){t&&Object.entries(t).forEach(([n,s])=>{void 0!==s&&this.setConfigValue(n,s)})}initObservables(){this.eventBusService.listen().pipe(m()).subscribe({next:t=>{t.payload?this.eventsMap[t.type].emit(t.payload):this.eventsMap[t.type].emit(),this.cd.detectChanges()},error:t=>console.error("Error occurred while listening to events:",t)})}static{this.\u0275fac=function(n){return new(n||i)(r.rXU(he.K),r.rXU(le),r.rXU(kt),r.rXU(xt),r.rXU(mt),r.rXU(r.gRc))}}static{this.\u0275cmp=r.VBU({type:i,selectors:[["ng-whiteboard"]],viewQuery:function(n,s){if(1&n&&r.GBs(ni,5),2&n){let o;r.mGM(o=r.lsd())&&(s.svgContainer=o.first)}},inputs:{options:"options",data:"data",selectedTool:"selectedTool",drawingEnabled:"drawingEnabled",canvasWidth:"canvasWidth",canvasHeight:"canvasHeight",fullScreen:"fullScreen",center:"center",strokeColor:"strokeColor",strokeWidth:"strokeWidth",backgroundColor:"backgroundColor",lineJoin:"lineJoin",lineCap:"lineCap",fill:"fill",zoom:"zoom",fontFamily:"fontFamily",fontSize:"fontSize",dasharray:"dasharray",dashoffset:"dashoffset",x:"x",y:"y",enableGrid:"enableGrid",gridSize:"gridSize",snapToGrid:"snapToGrid"},outputs:{ready:"ready",destroyed:"destroyed",drawStart:"drawStart",drawing:"drawing",drawEnd:"drawEnd",elementAdded:"elementAdded",elementUpdated:"elementUpdated",elementSelected:"elementSelected",elementsDeleted:"elementsDeleted",undo:"undo",redo:"redo",clear:"clear",dataChange:"dataChange",save:"save",imageAdded:"imageAdded",selectedToolChange:"selectedToolChange",configChanged:"configChanged"},features:[r.Jv_([ue,xt,de,mt,kt,le]),r.OA$],decls:19,vars:20,consts:[["svgContainer",""],["textInput",""],["id","svgroot","xlinkns","http://www.w3.org/2000/svg","svg","","resizeHandler",""],["id","svgcontent","xlinkns","http://www.w3.org/2000/svg"],["id","smallGrid","patternUnits","userSpaceOnUse"],["fill","none","stroke","gray","stroke-width","0.5"],["id","grid","width","100","height","100","patternUnits","userSpaceOnUse"],["width","100","height","100","fill","url(#smallGrid)"],["d","M 100 0 H 0 V 100","fill","none","stroke","gray","stroke-width","2"],["id","arrow","refX","3","refY","3","markerWidth","6","markerHeight","6","stroke","context-stroke","fill","none","orient","auto"],["d","M 0 0 L 3 3 L 0 6"],["width","100%","height","100%"],[2,"pointer-events","all"],[1,"wb_element",3,"id"],["id","selectorParentGroup"],["id","text-editor",3,"font-family","font-size","pointer-events","width","height","position","top","left"],["id","grid","x","-100","y","-100","fill","url(#grid)"],["fill","none"],["preserveAspectRatio","none"],["marker-end","url(#arrow)"],["text-anchor","start","alignment-baseline","before-edge"],["id","selectorGroup","transform","",1,"selectorGroup"],["display","inline"],["id","selectorBox","fill","none","stroke","#4F80FF",2,"cursor","move"],["id","selectorGrip_rotate_nw","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_ne","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_se","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_rotate_sw","fill","#000","r","8","stroke","#000","fill-opacity","0","stroke-opacity","0","stroke-width","0",1,"selector_rotate"],["id","selectorGrip_resize_nw","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","nw-resize"],["id","selectorGrip_resize_n","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","n-resize"],["id","selectorGrip_resize_ne","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","ne-resize"],["id","selectorGrip_resize_e","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","e-resize"],["id","selectorGrip_resize_se","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","se-resize"],["id","selectorGrip_resize_s","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","s-resize"],["id","selectorGrip_resize_sw","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","sw-resize"],["id","selectorGrip_resize_w","width","8","height","8","fill","#4F80FF","stroke","rgba(0,0,0,0)","pointer-events","all",2,"cursor","w-resize"],["id","text-editor"],["type","text","id","textInput","autocomplete","off",1,"text-input"]],template:function(n,s){1&n&&(r.qSk(),r.j41(0,"svg",2,0)(2,"svg",3)(3,"defs")(4,"pattern",4),r.nrm(5,"path",5),r.k0s(),r.j41(6,"pattern",6),r.nrm(7,"rect",7)(8,"path",8),r.k0s(),r.j41(9,"marker",9),r.nrm(10,"path",10),r.k0s()(),r.nrm(11,"rect",11),r.DNE(12,oi,2,3,":svg:g"),r.j41(13,"g",12),r.Z7z(14,fi,8,5,":svg:g",13,si),r.nI1(16,"async"),r.DNE(17,pi,17,31,":svg:g",14),r.k0s()()(),r.DNE(18,yi,3,20,"div",15)),2&n&&(r.HbH("svgroot "+s.selectedTool),r.R7$(2),r.BMQ("width",s.canvasWidth*s.zoom)("height",s.canvasHeight*s.zoom)("viewBox",r.l_i(17,ri,s.canvasWidth,s.canvasHeight))("x",s.x)("y",s.y),r.R7$(2),r.BMQ("width",s.gridSize)("height",s.gridSize),r.R7$(),r.BMQ("d","M "+s.gridSize+" 0 H 0 V "+s.gridSize),r.R7$(6),r.BMQ("fill",s.backgroundColor),r.R7$(),r.vxM(12,s.enableGrid?12:-1),r.R7$(),r.BMQ("transform","translate("+s.elementsTranslation.x+","+s.elementsTranslation.y+")"),r.R7$(),r.Dyx(r.bMT(16,15,s.data$)),r.R7$(3),r.vxM(17,s.selectedElement?17:-1),r.R7$(),r.vxM(18,s.selectedTool===s.tools.Text?18:-1))},dependencies:[ti,ei,ii.Jj],styles:["[_nghost-%COMP%]{width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]{-webkit-user-select:none;user-select:none;width:inherit;height:inherit;min-width:inherit;min-height:inherit;max-width:inherit;max-height:inherit;background-size:cover;background-position:50%;background-repeat:no-repeat;touch-action:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%], [_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .selectorGroup[_ngcontent-%COMP%]{transform-box:fill-box;transform-origin:center}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{font-family:Arial,Helvetica,sans-serif}[_nghost-%COMP%]   .svgroot.drawing[_ngcontent-%COMP%]{cursor:url(cursor.2cb01084080421f1.svg) 5 5,crosshair}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]{cursor:move}[_nghost-%COMP%]   .svgroot[_ngcontent-%COMP%]   .onMove[_ngcontent-%COMP%]   .handlers[_ngcontent-%COMP%]{display:block}[_nghost-%COMP%]   .hand[_ngcontent-%COMP%]{cursor:grab}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]{cursor:default}[_nghost-%COMP%]   .pen[_ngcontent-%COMP%]{cursor:url(pencil.fc7581cdb8f7bec4.svg) 1 18,crosshair}[_nghost-%COMP%]   .image[_ngcontent-%COMP%]{cursor:copy}[_nghost-%COMP%]   .line[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .arrow[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .rectangle[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .ellipse[_ngcontent-%COMP%]{cursor:crosshair}[_nghost-%COMP%]   .text[_ngcontent-%COMP%]{cursor:text}[_nghost-%COMP%]   .eraser[_ngcontent-%COMP%]{cursor:url(eraser.ab38a28a2aaa11bd.svg) 0 12,crosshair}[_nghost-%COMP%]   .select[_ngcontent-%COMP%]   .wb_element[_ngcontent-%COMP%]{cursor:pointer}.foreign[_ngcontent-%COMP%]{text-align:left}.insideforeign[_ngcontent-%COMP%]{display:inline-block}.text-input[_ngcontent-%COMP%]{display:none;position:absolute;background:transparent;border:1px dashed #0b89f0;outline:none;height:25px;font-size:inherit;font-family:inherit;min-width:5ch;width:5ch;height:2ch;padding:0;pointer-events:auto;z-index:5;transform-origin:top left}"],changeDetection:0})}}return(0,c.Cg)([M(),(0,c.Sn)("design:type",Boolean)],i.prototype,"drawingEnabled",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"canvasWidth",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"canvasHeight",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Boolean)],i.prototype,"fullScreen",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Boolean)],i.prototype,"center",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",String)],i.prototype,"strokeColor",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"strokeWidth",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",String)],i.prototype,"backgroundColor",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",String)],i.prototype,"lineJoin",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",String)],i.prototype,"lineCap",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",String)],i.prototype,"fill",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"zoom",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",String)],i.prototype,"fontFamily",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"fontSize",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",String)],i.prototype,"dasharray",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"dashoffset",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"x",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"y",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Boolean)],i.prototype,"enableGrid",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Number)],i.prototype,"gridSize",void 0),(0,c.Cg)([M(),(0,c.Sn)("design:type",Boolean)],i.prototype,"snapToGrid",void 0),i})()},8306:(st,z,u)=>{u.d(z,{K:()=>It});var c=u(1413),r=u(4412),H=u(8359),L=u(9974),m=u(4360),lt=u(7908),bt=u(3888),Lt=u(9326),Et=u(5225),Pt=u(5964),y=u(3052),Xt=u(6078),rt=u(7879),Rt=u(4438);let It=(()=>{class ${constructor(){this.BUFFER_SIZE=1e3,this.BATCH_INTERVAL=16,this.actionDispatcher=new c.B,this.priorityDispatcher=new r.t([]),this.actionBuffer=[],this.actions$=this.actionDispatcher.pipe(function Ot($,...ct){var g,E;const F=null!==(g=(0,Lt.lI)(ct))&&void 0!==g?g:bt.E,_=null!==(E=ct[0])&&void 0!==E?E:null,K=ct[1]||1/0;return(0,L.N)((ot,T)=>{let v=[],p=!1;const N=Y=>{const{buffer:q,subs:j}=Y;j.unsubscribe(),(0,lt.o)(v,Y),T.next(q),p&&dt()},dt=()=>{if(v){const Y=new H.yU;T.add(Y);const j={buffer:[],subs:Y};v.push(j),(0,Et.N)(Y,F,()=>N(j),$)}};null!==_&&_>=0?(0,Et.N)(T,F,dt,_,!0):p=!0,dt();const Z=(0,m._)(T,Y=>{const q=v.slice();for(const j of q){const{buffer:ut}=j;ut.push(Y),K<=ut.length&&N(j)}},()=>{for(;v?.length;)T.next(v.shift().buffer);Z?.unsubscribe(),T.complete(),T.unsubscribe()},void 0,()=>v=null);ot.subscribe(Z)})}(this.BATCH_INTERVAL),(0,Pt.p)(g=>g.length>0)),this.isProcessing=!1}addElement(g){this.dispatchWithPriority({type:y.X.AddElement,payload:{element:g}},"normal")}addImage(g,E,F){this.dispatchWithPriority({type:y.X.AddImage,payload:{image:g,x:E,y:F}},"normal")}centerCanvas(){this.dispatchWithPriority({type:y.X.CenterCanvas},"normal")}clear(){this.dispatchWithPriority({type:y.X.Clear},"high")}dispatchBatch(g){this.dispatchWithPriority({type:y.X.Batch,payload:g},"low")}fullScreen(){this.dispatchWithPriority({type:y.X.FullScreen},"normal")}removeElements(g){this.dispatchWithPriority({type:y.X.RemoveElements,payload:{ids:g}},"normal")}undo(){this.dispatchWithPriority({type:y.X.Undo},"high")}redo(){this.dispatchWithPriority({type:y.X.Redo},"high")}save(g=Xt.o8.Base64,E="New board"){this.dispatchWithPriority({type:y.X.Save,payload:{format:g,name:E}},"normal")}selectElement(g){this.dispatchWithPriority({type:y.X.SelectElement,payload:{element:g}},"normal")}setActiveTool(g){this.dispatchWithPriority({type:y.X.SetActiveTool,payload:{tool:g}},"normal")}setCanvasDimensions(g,E){this.dispatchWithPriority({type:y.X.SetCanvasDimensions,payload:{width:g,height:E}},"normal")}setCanvasPosition(g,E){this.dispatchWithPriority({type:y.X.SetCanvasPosition,payload:{x:g,y:E}},"normal")}toggleGrid(){this.dispatchWithPriority({type:y.X.ToggleGrid},"normal")}updateElement(g){this.dispatchWithPriority({type:y.X.UpdateElement,payload:{element:g}},"normal")}updateSelectedElement(g){this.dispatchWithPriority({type:y.X.UpdateSelectedElement,payload:{partialElement:g}},"normal")}dispatchWithPriority(g,E="normal"){const F=this.priorityDispatcher.value,_={action:g,priority:E},K=F.findIndex(T=>this.getPriorityWeight(T.priority)<this.getPriorityWeight(E)),ot=-1===K?[...F,_]:[...F.slice(0,K),_,...F.slice(K)];this.priorityDispatcher.next(ot),this.isProcessing||this.processNextAction()}dispatch(g){this.manageBuffer(g),this.actionDispatcher.next(g)}getPriorityWeight(g){return rt.bO[g]}manageBuffer(g){this.actionBuffer.length>=this.BUFFER_SIZE&&this.actionBuffer.shift(),this.actionBuffer.push(g)}processNextAction(){if(this.isProcessing)return;this.isProcessing=!0;const g=()=>{const E=this.priorityDispatcher.value;if(E.length>0){const{action:F}=E[0];this.dispatch(F),this.priorityDispatcher.next(E.slice(1)),g()}else this.isProcessing=!1};g()}static{this.\u0275fac=function(E){return new(E||$)}}static{this.\u0275prov=Rt.jDH({token:$,factory:$.\u0275fac,providedIn:"root"})}}return $})()}}]);